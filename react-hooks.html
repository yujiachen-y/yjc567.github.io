<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://raw.githubusercontent.com/yujiachen-y/yjc567.github.io/main/pictures/icon.JPG">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>React Hooks&nbsp;|&nbsp;Jiachenâ€™s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="React Hooks">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;*ï¸âƒ£&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://raw.githubusercontent.com/yujiachen-y/yjc567.github.io/main/pictures/icon.JPG"></span>&nbsp;
      
      <span>ä¸»é¡µ</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E6%9D%82%E6%96%87.html">
    <div class="Navbar__Btn">
      <span>æ‚æ–‡</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E6%8A%80%E6%9C%AF.html">
    <div class="Navbar__Btn">
      <span>æŠ€æœ¯</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E9%98%85%E8%AF%BB.html">
    <div class="Navbar__Btn">
      <span>é˜…è¯»</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="other.html">
        <div class="Navbar__Btn">
          
          <span>å…¶ä»–</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
          <span>å…³äº</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;*ï¸âƒ£&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">React Hooks</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on 2020å¹´6æœˆ27æ—¥å‘¨å…­</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/æŠ€æœ¯.html">æŠ€æœ¯</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/63b459e7eafa4e9ba74c295402c20041" class="PageRoot"><div id="https://www.notion.so/3a8b974806d44582ab185d9863333752" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ‰€æœ‰çš„ç†è§£éƒ½åŸºäºReact V16.11</strong></span><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/40ec7047f91045c4968be8bd1de587b1" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">ğŸ’¡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">ç»™ä¸€ç‚¹take away å§ï¼Œè¯´ä¸€è¯´å¯¹æˆ‘å¸®åŠ©æœ€å¤§çš„ä¸¤ä¸ªå¿ƒå¾—ï¼š
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">initialState</code></span><span class="SemanticString"> çš„æ”¹å˜ä¸ä¼šå½±å“hooks è¿”å›ç»“æœçš„æ”¹å˜ï¼Œå› ä¸ºmount å‰åçš„hooks å‡½æ•°æ ¹æœ¬å°±æ˜¯ä¸¤å¥—ã€‚
å¤šä¸ª </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> åˆ†åˆ«set ä¸€ä¸‹stateï¼Œdispatch ä¸€ä¸‹action å•¥çš„å…¶å®ä¸ä¸€å®šä¼šå¼•èµ·å¤šæ¬¡æ¸²æŸ“ï¼Œå› ä¸ºhook ä¼šç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">renderPhaseUpdates</code></span><span class="SemanticString"> æ¥åˆ¤æ–­race conditionï¼Œå¦‚æœä¼˜åŒ–å¤Ÿå¥½çš„è¯å¤šä¸ª </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> å’Œå•ä¸ªçš„æ•ˆæœåº”è¯¥å·®ä¸å¤šã€‚</span></span></p></div><div id="https://www.notion.so/51dc6b08b23d44f4abb4837257f9dc83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸¤ç¯‡å¾ˆæœ‰ç”¨çš„æ–‡ç« </span></span></p></div><div id="https://www.notion.so/972a489b0d2c4e0d9b734848919c5f4e" class="Bookmark"><a href="https://me.ursb.me/archives/useState.html#directory0792415527436750625"><h5 class="Bookmark__Title">React Hooks æºç è§£æï¼ˆ3ï¼‰ï¼šuseState</h5><p class="Bookmark__Desc">åœ¨å†™æœ¬æ–‡ä¹‹å‰ï¼Œäº‹å…ˆé˜…è¯»äº†ç½‘ä¸Šäº†ä¸€äº›æ–‡ç« ï¼Œå…³äº Hooks çš„æºç è§£æè¦ä¹ˆè¿‡äºæµ…æ˜¾ã€è¦ä¹ˆå°±ä¸ç»†è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ç€é‡è®²è§£æºç ï¼Œç”±æµ…å…¥æ·±ï¼Œäº‰å–ä¸€è¡Œä»£ç ä¹Ÿä¸æ”¾è¿‡ã€‚é‚£æœ¬ç³»åˆ—è®²è§£ç¬¬ä¸€ä¸ª Hooks ä¾¿æ˜¯ useStateï¼Œæˆ‘ä»¬å°†ä» useState çš„ç”¨æ³•å¼€å§‹ï¼Œå†é˜è¿°è§„åˆ™ã€è®²è§£åŸç†ï¼Œå†ç®€å•å®ç°ï¼Œæœ€åæºç è§£æã€‚å¦å¤–ï¼Œåœ¨æœ¬ç¯‡å¼€å¤´ï¼Œå†è¡¥å……ä¸€ä¸ª Hooks çš„æ¦‚è¿°ï¼Œå‰ä¸¤ç¯‡Â·é™äºç¯‡å¹…é—®é¢˜ä¸€ç›´æ²¡æœ‰å†™ä¸€å—ã€‚ æ³¨ï¼šè·ç¦»ä¸Šç¯‡æ–‡ç« å·²ç»è¿‡å»äº†ä¸¤ä¸ªæœˆï¼Œè¿™ä¸¤ä¸ªæœˆä¸šåŠ¡ç¹å¿™æ‰€ä»¥æ²¡æœ‰ä»€ä¹ˆæ—¶é—´æ›´æ–°è¯¥ç³»åˆ—çš„æ–‡ç« ï¼Œä½† react è¿™ä¸¤ä¸ªæœˆå´ä» 16.9 æ›´æ–°åˆ°äº† 16.11ï¼Œreview äº†ä¸€ä¸‹è¿™å‡ æ¬¡çš„æ›´æ–°éƒ½æœªæ¶‰åŠåˆ° hooksï¼Œæ‰€ä»¥æˆ‘ä¹Ÿç›´æ¥æŠŠæºç ç¬”è®°è¿™å—æ›´æ–°åˆ°äº† 16.11ã€‚ Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚å…¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬çº¦å®šä»¥ use å¼€å¤´ï¼Œå¯ä»¥ä¸º Function Component æ³¨å…¥ä¸€äº›åŠŸèƒ½ï¼Œèµ‹äºˆ Function Component ä¸€äº› Class Component æ‰€å…·å¤‡çš„èƒ½åŠ›ã€‚ ä¾‹å¦‚ï¼ŒåŸæœ¬æˆ‘ä»¬è¯´ Function Component æ— æ³•ä¿å­˜çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸è¯´ Stateless Function Componentï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å€ŸåŠ© useState è¿™ä¸ª</p><p class="Bookmark__Link">https://me.ursb.me/archives/useState.html#directory0792415527436750625</p></a></div><div id="https://www.notion.so/fbb2c4f7948b4390a94aa95f92aad2cf" class="Bookmark"><a href="https://me.ursb.me/archives/useEffect.html#directory087217065341216589"><p class="Bookmark__Link">https://me.ursb.me/archives/useEffect.html#directory087217065341216589</p></a></div><div id="https://www.notion.so/0b0a44ade6714f0590d117a0b423d632" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/a98cc073dd2a4e43b45c943d23f5f1d7" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">Hooks æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/dff55b749d034ecc9107261a455a1fd7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">èµ‹äºˆäº†å‡½æ•°å¼ç»„ä»¶çŠ¶æ€ï¼Œç”¨ç±»ç»„ä»¶æ¥ç®¡ç†çŠ¶æ€å¯èƒ½æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/90a532f661214243b65d5b3eb3437ab1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">é€»è¾‘åˆ†æ•£ï¼Œå¤„ç†åŒä¸€ä¸ªä¸œè¥¿çš„é€»è¾‘å¯èƒ½ä¼šè¢«åˆ†æ•£åœ¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">componentDidMount</code></span><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">componentDidUpdate</code></span><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">componentDidUnmount</code></span><span class="SemanticString"> é‡Œé¢ã€‚
ç‰¹åˆ«æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> æŠŠä¸€äº›å‰¯ä½œç”¨æ“ä½œéƒ½ç»Ÿä¸€äº†ã€‚</span></span></li><li id="https://www.notion.so/c1d320ea292e41c0985bf9dfb1744477" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">èŒƒå¼å¤æ‚ï¼Œclass å¯èƒ½æŠŠä¸€äº›åŸå¯ä»¥ç®€å•çš„ç»„ä»¶å¼„å¤æ‚äº†ã€‚</span></span></li></ul></div></details><details id="https://www.notion.so/7218296f3a93456585690b8756580e22" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">æ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„æœ‰å“ªäº›ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/7231d0039f8e463c8b416a16d6b47338" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">ğŸ’¡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªfiber å¯¹åº”ä¸€ä¸ªhooks é“¾è¡¨ï¼Œä¸€ä¸ªhook å¯¹åº”state å’Œupdate queueã€‚</span></span></p></div><details id="https://www.notion.so/f1a7547577df466cb662325403d8a0cd" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">è¿™äº›æ•°æ®ç»“æ„çš„å…·ä½“å®šä¹‰å’Œäº¤äº’æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/1505524c263c4789adf63780ca47acb0" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F91445c9d-3adb-49af-8b73-8b4e6c04cc8a%2FUntitled.png?width=672&amp;table=block&amp;id=1505524c-263c-4789-adf6-3780ca47acb0"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F91445c9d-3adb-49af-8b73-8b4e6c04cc8a%2FUntitled.png?width=672&amp;table=block&amp;id=1505524c-263c-4789-adf6-3780ca47acb0" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/5a6ced4f2ea84aeb84a949d99f52cac4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5a6ced4f2ea84aeb84a949d99f52cac4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Hook</span></span></h2><pre id="https://www.notion.so/b639e8f565de4ee2a09d3ed05c98480d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">hook</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  memorizedState<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  
  baseState<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  baseUpdate<span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  queue<span class="token operator">:</span> UpdateQueue<span class="token operator">&lt;&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

  next<span class="token operator">:</span> Hook <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/85c275440eac484cbc0a82fdc7643884" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">hooks é€šè¿‡é“¾è¡¨è¿æ¥åœ¨ä¸€èµ·ã€‚</span></span></li><li id="https://www.notion.so/2911025383f7418db59b79bf09e6d3ac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">æœ‰ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">memorizedState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseState</code></span><span class="SemanticString"> çš„åŒºåˆ«ï¼Œä¸¤è€…çš„ä¸åŒä¹‹å¤„ç›®å‰è¿˜ä¸å¾—è€ŒçŸ¥ï¼Œä¸è¿‡æ¯æ¬¡è°ƒç”¨hook è¿”å›çš„éƒ½æ˜¯</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">memorizedState</code></span><span class="SemanticString"> ã€‚</span></span></li></ul><div id="https://www.notion.so/5eb80f6be444425e8c9650f311a224f9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/f7d59416715346c482c3183f40360bba" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">memorizedState</code></span><span class="SemanticString"> å’Œ</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseState</code></span><span class="SemanticString"> æœ‰å¯èƒ½ä¸åŒå—ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/3a02ab269b304aec96db4c9acf21c440" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æœ‰å¯èƒ½ã€‚</span></span></p></div><div id="https://www.notion.so/e2f408ebb9cb4ee59e560964d385c4f6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">memorizedState</code></span><span class="SemanticString"> ä»£è¡¨çš„æ˜¯ä¸Šä¸€æ¬¡hook è¿”å›ç»™ç»„ä»¶çš„ stateï¼Œè€Œè¿™ä¸ª state æœ‰å¯èƒ½æ˜¯â€œéæ³•çŠ¶æ€â€ã€‚</span></span></p><div class="Text__Children"><div id="https://www.notion.so/5941aa8fa3ad41ed81f6cdbe1b77223a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è¿™ä¸ªâ€œéæ³•çŠ¶æ€â€ä¼šåœ¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">updateReducer</code></span><span class="SemanticString">é‡Œé¢è¯ç”Ÿï¼Œå½“éå† </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queue</code></span><span class="SemanticString"> ä¸­çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">update</code></span><span class="SemanticString"> ï¼Œè®¡ç®—æ–° state çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å‘ç”Ÿ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">update.expirationTime &lt; renderExpirationTime</code></span><span class="SemanticString"> çš„æƒ…å†µã€‚æ­¤æ—¶hook ä¼šé€‰æ‹©ä¸å»æ‰§è¡Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">update.action</code></span><span class="SemanticString"> ï¼Œéæ³•çŠ¶æ€å°±å°±è¯ç”Ÿäº†ã€‚</span></span></p></div></div></div><div id="https://www.notion.so/b524bd1dd7a54458b95aac777c835d29" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å½“ç„¶ï¼Œä¸ºäº†ä¹‹åä¿®æ­£å½“å‰çš„è¿™ä¸ªéæ³•çŠ¶æ€ï¼Œhook å°±æŠŠ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseUpdate</code></span><span class="SemanticString"> ç½®æˆäº†ç¬¬ä¸€æ¬¡skip æ—¶çš„ state å’Œ updateï¼ŒæŸä¸ªæ—¶åˆ»é‡æ–°ä» </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseUpdate</code></span><span class="SemanticString"> è®¡ç®—çœŸæ­£åˆæ³•çš„ stateã€‚</span></span></p></div><div id="https://www.notion.so/2f3a9ca22b4e4d5c99e09cbd0f7bcd46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">è¿™æ˜¯ä¸ºäº†åœ¨èµ„æºä¸è¶³çš„æƒ…å†µä¸‹ä¼˜å…ˆå®Œæˆé«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</strong></span></span></p></div><div id="https://www.notion.so/38542b0120bf4f249117759359feda71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ä¸ç®¡æ€ä¹ˆè¯´ï¼Œåœ¨èµ„æºå’Œæ—¶é—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œä» </strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">baseState</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> å’Œ </strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">baseUpdate</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> é‡æ–°è¿½èµ¶åå°±èƒ½å¾—åˆ°æ­£ç¡®çš„stateã€‚</strong></span></span></p></div></div></details><details id="https://www.notion.so/3d8fa074386448349d8f364e9c12630f" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">ä¸ºä»€ä¹ˆhook çš„</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queue</code></span><span class="SemanticString"> æœ‰æ—¶æ˜¯å¾ªç¯é“¾è¡¨ï¼Œæœ‰æ—¶ä¸æ˜¯ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/1922947dea1b4dde86dbdb6d7e41076a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å‚ç…§åé¢çš„æ›´æ–°çŠ¶æ€callback å…·ä½“å®ç°çš„sectionã€‚</span></span></p></div></div></details><h2 id="https://www.notion.so/792278a4a9d04eb6ab84c14b61b36c20" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/792278a4a9d04eb6ab84c14b61b36c20"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Update</span></span></h2><pre id="https://www.notion.so/2b2d1260e5ee4c0f8f7397cd3c451f4f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">type</span> <span class="token class-name">Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  expirationTime<span class="token operator">:</span> ExpirationTime<span class="token punctuation">,</span>
  suspenseConfig<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> SuspenseConfig<span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  eagerReducer<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  eagerState<span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  next<span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

  priority<span class="token operator">?</span><span class="token operator">:</span> ReactPriorityLevel<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/fa0ed0bc86db4fa9acc62879d2360a91" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">updates ä¹Ÿæ˜¯é€šè¿‡é“¾è¡¨è¿æ¥åœ¨ä¸€èµ·çš„ã€‚</span></span></li><li id="https://www.notion.so/d281408273c74909b689d70de882ec87" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">update æœ‰ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">expirationTime</code></span><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">suspenseConfig</code></span><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">priority</code></span><span class="SemanticString"> å„ç§é…ç½®å‚æ•°ã€‚</span></span></li></ul><div id="https://www.notion.so/3505f6b493ce4c9892809c1747ecf2c5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/9dde752dff2f43e09ad18afe853567b0" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">expirationTime</code></span><span class="SemanticString"> çš„å…·ä½“ä½œç”¨ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/207db993a7f7450799c36898cc79c84a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸çŸ¥é“ã€‚</span></span></p></div></div></details><details id="https://www.notion.so/4cf81d9acb374d4291d762520df9d266" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">å•¥æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">suspenseConfig</code></span><span class="SemanticString"> ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/e78a82300d3148afbcc69d1819d417f3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸çŸ¥é“ã€‚</span></span></p></div></div></details><details id="https://www.notion.so/44a259931fa44a86aa2c84aedc2c61b6" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">ä¸ºå•¥è¦æœ‰ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">eagerReducer</code></span><span class="SemanticString"> ï¼Œå’Œä¼ å…¥ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">updateReducer()</code></span><span class="SemanticString"> ä¸­çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">reducer</code></span><span class="SemanticString"> å‚æ•°äº’ç›¸åŒºåˆ†ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/85370fa9ab0e4b4a899fa4df54433e45" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸çŸ¥é“ã€‚</span></span></p></div></div></details><h2 id="https://www.notion.so/33ac195175854243ac919b0933a0b0a7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/33ac195175854243ac919b0933a0b0a7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">UpdateQueue</span></span></h2><pre id="https://www.notion.so/fbfe62b0b3c94d689e7e1df9a28f00c6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">type</span> <span class="token class-name">UpdateQueue<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  last<span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  dispatch<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">=></span> mixed<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  lastRenderedReducer<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  lastRenderedState<span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/03679191ac1b40f6b8d72ac9ccf0cbb6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dispatch</code></span><span class="SemanticString"> è¢«å°è£…è¿‡ï¼Œä¾›å¤–ç•Œè°ƒç”¨ä½¿ç”¨ã€‚æ‰€æœ‰çš„hook éƒ½å¯¹åŒä¸€ä¸ªå…¬å…±çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">dispatch</code></span><span class="SemanticString"> è¿›è¡Œäº†å°è£…ã€‚</span></span></li></ul><div id="https://www.notion.so/66c11255ffd64682847ee95a46507690" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/7a16aac9e3ba46559480b050a0c92b57" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queue</code></span><span class="SemanticString"> é‡Œé¢ä¸ºä»€ä¹ˆè¿˜è¦ç‰¹æ„å°è£…ä¸€ä¸‹ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">lastRenderedReducer</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">lastRenderedState</code></span><span class="SemanticString"> ï¼Ÿç”¨hook è‡ªå¸¦çš„ä¸€äº›ä¿¡æ¯ä¸å¥½å—ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/851d5a4a35884fae964e4867a5e35e05" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸çŸ¥é“ã€‚</span></span></p></div></div></details><h2 id="https://www.notion.so/87bd715e48d44e889bebdceaea437f09" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/87bd715e48d44e889bebdceaea437f09"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">HooksDispatcherOnMount &amp; HooksDispatcherOnUpdate</span></span></h2><pre id="https://www.notion.so/5fc6984288024241b14b3393709c1a2e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> HooksDispatcherOnMount<span class="token operator">:</span> Dispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
  readContext<span class="token punctuation">,</span>

  useCallback<span class="token operator">:</span> mountCallback<span class="token punctuation">,</span>
  useContext<span class="token operator">:</span> readContext<span class="token punctuation">,</span>
  useEffect<span class="token operator">:</span> mountEffect<span class="token punctuation">,</span>
  useImperativeHandle<span class="token operator">:</span> mountImperativeHandle<span class="token punctuation">,</span>
  useLayoutEffect<span class="token operator">:</span> mountLayoutEffect<span class="token punctuation">,</span>
  useMemo<span class="token operator">:</span> mountMemo<span class="token punctuation">,</span>
  useReducer<span class="token operator">:</span> mountReducer<span class="token punctuation">,</span>
  useRef<span class="token operator">:</span> mountRef<span class="token punctuation">,</span>
  useState<span class="token operator">:</span> mountState<span class="token punctuation">,</span>
  useDebugValue<span class="token operator">:</span> mountDebugValue<span class="token punctuation">,</span>
  useResponder<span class="token operator">:</span> createResponderListener<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> HooksDispatcherOnUpdate<span class="token operator">:</span> Dispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
  readContext<span class="token punctuation">,</span>

  useCallback<span class="token operator">:</span> updateCallback<span class="token punctuation">,</span>
  useContext<span class="token operator">:</span> readContext<span class="token punctuation">,</span>
  useEffect<span class="token operator">:</span> updateEffect<span class="token punctuation">,</span>
  useImperativeHandle<span class="token operator">:</span> updateImperativeHandle<span class="token punctuation">,</span>
  useLayoutEffect<span class="token operator">:</span> updateLayoutEffect<span class="token punctuation">,</span>
  useMemo<span class="token operator">:</span> updateMemo<span class="token punctuation">,</span>
  useReducer<span class="token operator">:</span> updateReducer<span class="token punctuation">,</span>
  useRef<span class="token operator">:</span> updateRef<span class="token punctuation">,</span>
  useState<span class="token operator">:</span> updateState<span class="token punctuation">,</span>
  useDebugValue<span class="token operator">:</span> updateDebugValue<span class="token punctuation">,</span>
  useResponder<span class="token operator">:</span> createResponderListener<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/15d0ef30da434084b62e7e8096456c0c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç¬¬ä¸€æ¬¡mount ç»„ä»¶æ—¶ç”¨mount ç³»åˆ—çš„hooks æ¥æ‰§è¡Œç›¸å…³çš„å‡†å¤‡ã€åˆ›å»ºæ“ä½œï¼›ä¹‹åupdate ç»„ä»¶ç”¨çš„æ˜¯update ç³»åˆ—çš„hooks ï¼Œæ ¹æ®ä¹‹å‰çš„çŠ¶æ€å’Œæ“ä½œæ¥è¿”å›æ–°çš„çŠ¶æ€ã€‚</span></span></p></div><div id="https://www.notion.so/5e5d0db5b64840bdb545f4f7062ab7d6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">renderWithHooks()</code></span><span class="SemanticString"> é‡Œé¢æœ‰ä¸€å¥ï¼š</span></span></p></div><pre id="https://www.notion.so/9eaa19bd60b8416eacdf7907904f65da" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>nextCurrentHook <span class="token operator">=</span> current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> current<span class="token punctuation">.</span>memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> 
  nextCurrentHook <span class="token operator">===</span> <span class="token keyword">null</span>
    <span class="token operator">?</span> HooksDispatcherOnMount
    <span class="token operator">:</span> HooksDispatcherOnUpdate<span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/3e126b2a0b374589bf0ebb5fc3df26c7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å…¶ä¸­ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">current</code></span><span class="SemanticString"> æ˜¯ä¼ å…¥ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">renderWithHooks()</code></span><span class="SemanticString"> çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªfiberï¼Œè‹¥ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">current === null</code></span><span class="SemanticString"> åˆ™ç›®å‰æ²¡æœ‰fiberï¼Œæ˜¯é¦–æ¬¡åŠ è½½ã€‚</span></span></p></div></div></details></div></details><details id="https://www.notion.so/72c94efd0b5e47e189a37597d8709f67" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">é¦–æ¬¡åŠ è½½æ—¶ï¼Œhooks ç›¸å…³çš„ä»£ç éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/f9b90bfe0835460a99cc845cac977608" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">ğŸ’¡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">é¦–æ¬¡åŠ è½½æ—¶è°ƒç”¨çš„æ˜¯mount ç³»åˆ—hooksï¼Œæ ¹æ®hooks ä»£ç çš„è°ƒç”¨åˆ›å»ºå¯¹åº”çš„hooksï¼Œå¹¶ä¸ºè¿™äº›è¢«åˆ›å»ºçš„hooks åˆ†åˆ«åˆ›å»ºqueueï¼Œä¸ºè¢«åˆ›å»ºçš„queue bind dispatch å‡½æ•°ã€‚</span></span></p></div><div id="https://www.notion.so/ef34d565d10d46ada54c14b641b1f433" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/96a226b9d4e743aa8602a5f48b68a250" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">å…·ä½“åˆ›å»ºhook çš„ä»£ç æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Ÿ</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/d825b65b5e84452ea2eef13d1ccbbb08" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">function</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Hook <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook<span class="token operator">:</span> Hook <span class="token operator">=</span> <span class="token punctuation">{</span>
    memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    baseState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    queue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    baseUpdate<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    firstWorkInProgressHook <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/3757194e2e7540469aa43dc5c79593f6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åˆ›å»ºä¸€ä¸ªhookï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºå…¨å±€å˜é‡ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">workInProgressHook</code></span><span class="SemanticString"> ï¼ŒåŒæ—¶ç»´æŠ¤ä¸€ä¸ªhooks é“¾è¡¨ï¼Œæ¯æ¬¡éƒ½æŠŠæ–°åˆ›å»ºçš„hook æ”¾åœ¨è¿™ä¸ªé“¾è¡¨çš„æœ€åã€‚</span></span></p></div></div></details></div></details><details id="https://www.notion.so/b69ab8d633414fd5a2416709fba8c404" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useReducer</code></span><span class="SemanticString"> ç³»åˆ—çš„hooks å¯ä»¥è¿”å›ä¸€ä¸ªæ›´æ”¹hooks çŠ¶æ€çš„callbackï¼Œè¿™é‡Œçš„çŠ¶æ€æ›´æ–°æ˜¯å’‹å®ç°çš„ï¼Œæœ‰æ²¡æœ‰race conditionï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/e9d8baace94944cb92abe3cb5fdef0f0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> å…¶å®å°±æ˜¯ç‰¹æ®Šæƒ…å†µä¸‹çš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useReducer</code></span><span class="SemanticString"> ï¼Œä¸¤è€…è¿”å›çš„callback å…¶å®å°±æ˜¯é¦–æ¬¡åŠ è½½ä¸­bind åˆ° </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">hook.queue.dispatch</code></span><span class="SemanticString"> ä¸Šçš„dispatch å‡½æ•°ã€‚</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/73b081a70d43488d973a2698c57a36a4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">çŠ¶æ€æ›´æ–°å°±æ˜¯æŠŠä¼ å…¥çš„action ç»™æ·»åŠ åˆ°queue çš„æœ€åï¼Œå¹¶å‘å‡ºä¸€ä¸ªè¯·æ±‚re-render çš„äº‹ä»¶ã€‚</span></span></li><li id="https://www.notion.so/026f6c783c0e40f4bb169fff278ca0ae" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">å½“ç„¶å¯èƒ½å­˜åœ¨race conditionï¼Œè¿™ä¸ªæ—¶å€™å°±åˆ›å»ºä¸€ä¸ªkey ä¸ºqueue çš„mapï¼Œç¼“å­˜ä¸€ä¸‹åœ¨re-render æœŸé—´å‘èµ·çš„actionï¼Œå¦‚æœrace condition è¢«å¼•å‘å¤šæ¬¡ï¼Œå°±æŠŠactions ä¸²æˆä¸€ä¸ªé“¾è¡¨ã€‚</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/9cedcf63ad4f45e28ead01f8efa23ba5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">é™¤æ­¤ä¹‹å¤–ï¼Œæ ¹æ®</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/facebook/react/blob/30b47103d4354d9187dc0f1fb804855a5208ca9f/packages/react-reconciler/src/ReactUpdateQueue.new.js">è¿™ä¸ªæ–‡ä»¶</a></span><span class="SemanticString">ä¸­çš„è¯´æ˜ï¼Œfiber çº§åˆ«è¿˜ä¼šæœ‰å¯¹race condition çš„å¤„ç†ï¼Œå½“è¿›è¡Œre-render æ—¶ï¼Œupdate é“¾è¡¨ä¼šåˆ†åˆ«åœ¨current pointer å’Œwork-in-progress pointer é‡Œé¢è¢«ç»´æŠ¤ï¼Œè¿™ä¸¤ä¸ªpointer æˆ‘ç†è§£è¢«å­˜åœ¨äº†ä¸åŒçš„fiber é‡Œé¢ã€‚æ¯å½“æœ‰ä¸€ä¸ªæ–°update äº‹ä»¶è¢«æ·»åŠ æ—¶ï¼Œè¿™ä¸ªupdate ä¼šè¢«åŒæ—¶æ·»åŠ è¿›è¿™ä¸¤ä¸ªpointer or fiber é‡Œï¼Œä»¥é˜²æ­¢åœ¨æŸäº›race condition ä¸‹è¢«æ·»åŠ çš„æ–°update äº‹ä»¶ä¸¢å¤±ã€‚</span></span></li></ul></li></ul><div id="https://www.notion.so/728c8807be6d4809a99ce2ae6aa7a3a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/5faaa3cb08054103b9ea545c4d17779c" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">æŠŠaction æ·»åŠ åˆ°queue çš„æ“ä½œæ˜¯å’‹æ ·çš„ï¼Œè¿™ä¸ªqueue æ˜¯å•é“¾è¡¨å¯¹å—ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/dd2e0267c34c40c9959380aa760b87f7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸æ˜¯å•é“¾è¡¨ï¼Œå½“ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queue.last === null</code></span><span class="SemanticString"> çš„æ—¶å€™ï¼Œè¢«åˆ›å»ºå‡ºçš„æ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚</span></span></p></div><div id="https://www.notion.so/446e4bd31378424088fa9778d8266bed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œæ˜¯å› ä¸º </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">queue.last === null</code></span><span class="SemanticString"> è¿™ä¸ªæ¡ä»¶åªä¼šåœ¨mount çš„æ—¶å€™å‘ç”Ÿï¼Œmount or commit ä¹‹åçš„re-render æ˜¯è¦ä»ç¬¬ä¸€ä¸ªupdate å¼€å§‹çš„ï¼Œè€ƒè™‘åˆ°ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/3014461249504551b6be21d9a0a1a39d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å¾ªç¯é“¾è¡¨çš„ </strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">last.next</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> å°±æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</strong></span></span></li><li id="https://www.notion.so/b8dd05ddb0f047a0a72582e226b47045" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">é™¤äº†ç¬¬ä¸€æ¬¡re-render åï¼Œä¹‹åçš„æ›´æ–°éƒ½æ˜¯ä»æœ€åä¸€æ¬¡update ä¹‹åçš„ update å¼€å§‹æ›´æ–°äº†ï¼Œé‚£ä¹ˆå¯»æ±‚çš„å°±æ˜¯update.nextã€‚</span></span></li></ul><div id="https://www.notion.so/85468a37820646a58b7288ca39434af7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æˆ‘è§‰å¾—ä½¿ç”¨å¾ªç¯é“¾è¡¨å¯ä»¥è¾¾åˆ°ä»¥ä¸‹ç›®çš„ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/ffdf84063e994b69b7250431e133b481" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">å°‘å­˜ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œåªæœ‰mount or commit å‰æ‰éœ€è¦å¤´èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™ä» </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">last.next</code></span><span class="SemanticString"> å–å°±å¥½äº†ï¼Œå…¶ä»–æƒ…å†µä¹Ÿä¸éœ€è¦å¤´èŠ‚ç‚¹ï¼Œæ­¤æ—¶queue å°±ä¸æ˜¯å¾ªç¯é“¾è¡¨äº†ã€‚</span></span></li><li id="https://www.notion.so/b3de45146afe405393fdb2cab59a8adf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">èŒƒå¼çš„ç»Ÿä¸€ã€‚</span></span></li></ul></div></details></div></details><details id="https://www.notion.so/8ca9500dcdf04d0183b24ee8765e9d34" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">react render çš„æ—¶å€™æ˜¯æ€ä¹ˆçŸ¥é“æ­¤æ—¶æ˜¯mount è¿˜æ˜¯updateï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/0d1895987c654dd59cfc704f0aa9f11e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ ¹æ®å½“å‰fiber æ˜¯å¦ä¸ºnull æ¥åˆ¤æ–­ã€‚</span></span></p></div></div></details><details id="https://www.notion.so/b7dd0ff335f6434bba4b1b45438f46ca" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">åœ¨é¦–æ¬¡åŠ è½½åï¼Œå†æ¬¡è°ƒç”¨hooks å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/4d950db6f08a4af89276f1cc2b09979a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é¦–æ¬¡åŠ è½½ä¹‹åçš„hooks å°±æ˜¯update ç³»åˆ—çš„hooks äº†ï¼Œå†æ‹¿ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useReducer</code></span><span class="SemanticString"> æ¥çœ‹ï¼Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> ä¼šç›´æ¥è°ƒç”¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">updateReducer</code></span><span class="SemanticString"> ï¼Œè€Œé¦–æ¬¡åŠ è½½åçš„ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useReducer</code></span><span class="SemanticString"> å°±æ˜¯ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">updateReducer</code></span><span class="SemanticString"> ã€‚</span></span></p></div><div id="https://www.notion.so/1d475340d3974df3ba0f23c4360b9677" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å½“ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">updateReducer</code></span><span class="SemanticString"> è¢«è°ƒç”¨æ—¶ï¼Œå…¶ä¼šåˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºre-render é˜¶æ®µï¼Œå¦‚æœæ˜¯ï¼ŒæŒ‰æˆ‘ä»¬ä¸Šé¢è¯´çš„ä¸€æ ·ï¼Œå»æ‰¾key ä¸ºqueue çš„mapï¼Œå–å‡ºupdate äº‹ä»¶é“¾è¡¨ï¼Œè®¡ç®—å‡ºæ–°çš„stateã€‚</span></span></p></div><div id="https://www.notion.so/1d85b78aeba94185b07a9a85e3d26a4f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¦‚æœä¸æ˜¯re-render é˜¶æ®µï¼Œé‚£ä¹ˆå°±éå†queue é‡Œé¢çš„update ï¼Œè®¡ç®—å‡ºæ–°çš„stateã€‚</span></span></p><div class="Text__Children"><div id="https://www.notion.so/5850d122e75a4a5bb8929f1d5d46d2c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸è¿‡è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ç‰¹æ®Šæƒ…å†µï¼Œä¼šæœ‰èµ„æºä¸è¶³è€Œè·³è¿‡ä¸€äº›update çš„æƒ…å†µï¼Œå‚ç…§ä¸Šæ–‡</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><code class="SemanticString__Fragment SemanticString__Fragment--Code">memorizedState</code></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> å’Œ</em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseState</code></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> æœ‰å¯èƒ½ä¸åŒå—ï¼Ÿ </em></span><span class="SemanticString">è¿™ä¸ªé—®é¢˜ã€‚</span></span></p></div><div id="https://www.notion.so/beb26b4ff76447a8a9afd5904ba2c786" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><details id="https://www.notion.so/41d1c565a73e4d1b92dbbc3699732dbd" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">è°ƒç”¨hook åï¼Œå…·ä½“è¢«æ“ä½œçš„hook æ˜¯æ€ä¹ˆè¢«æ‹¿åˆ°çš„ï¼Ÿ</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/e0b19c431b16494eb2a65729e8c1ad6f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">function</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Hook <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextWorkInProgressHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// There's already a work-in-progress. Reuse it.</span>
    workInProgressHook <span class="token operator">=</span> nextWorkInProgressHook<span class="token punctuation">;</span>
    nextWorkInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>
    nextCurrentHook <span class="token operator">=</span> currentHook <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> currentHook<span class="token punctuation">.</span>next <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Clone from the current hook.</span>
    currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>

    <span class="token keyword">const</span> newHook<span class="token operator">:</span> Hook <span class="token operator">=</span> <span class="token punctuation">{</span>
      memoizedState<span class="token operator">:</span> currentHook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span>

      baseState<span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseState<span class="token punctuation">,</span>
      queue<span class="token operator">:</span> currentHook<span class="token punctuation">.</span>queue<span class="token punctuation">,</span>
      baseUpdate<span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseUpdate<span class="token punctuation">,</span>

      next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      workInProgressHook <span class="token operator">=</span> firstWorkInProgressHook <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    nextCurrentHook <span class="token operator">=</span> currentHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/78c8bf48a9924705843f27bcfe146bdc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å…ˆçœ‹ä¸€çœ‹æœ‰æ²¡æœ‰workInProgressHookï¼Œå¦‚æœæœ‰çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»ä¹‹å‰ç•™ç€çš„hooks é“¾è¡¨é‡Œé¢æ‹·è´éœ€è¦çš„hook å‡ºæ¥ï¼Œè¿™æ ·çš„ç»“æœå°±æ˜¯æ¯æ¬¡re-render å®Œä¹‹åï¼Œéƒ½å¤šäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„hooks é“¾è¡¨ï¼Œæˆ‘çŒœè¿™é‡Œå¯èƒ½å’Œfiber æ¶‰åŠåˆ°çš„è°ƒè§£ç®—æ³•æœ‰å…³ã€‚</span></span></p></div></div></details></div></details><details id="https://www.notion.so/4fd93d5d260347ebb5fb4210d5f86351" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> çš„å®ç°ï¼Ÿ</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/157a9c80e47a4f44a5e4ec58f20b946d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">function</span> <span class="token function">commitHookEffectList</span><span class="token punctuation">(</span>
  unmountTag<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  mountTag<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  finishedWork<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> updateQueue<span class="token operator">:</span> FunctionComponentUpdateQueue <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>updateQuere<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> lastEffect <span class="token operator">=</span> updateQueue <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> updateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> firstEffect <span class="token operator">=</span> lastEffect<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token keyword">let</span> effect <span class="token operator">=</span> firstEffect<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>tag <span class="token operator">&amp;</span> unmountTag<span class="token punctuation">)</span> <span class="token operator">!==</span> NoHookEffect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Unmount</span>
        <span class="token keyword">const</span> destory <span class="token operator">=</span> effect<span class="token punctuation">.</span>destroy<span class="token punctuation">;</span>
        effect<span class="token punctuation">.</span>destory <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>destory <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>tag <span class="token operator">&amp;</span> mountTag<span class="token punctuation">)</span> <span class="token operator">!==</span> NoHookEffect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      <span class="token comment">// Mount</span>
        <span class="token keyword">const</span> create <span class="token operator">=</span> effect<span class="token punctuation">.</span>create<span class="token punctuation">;</span>
        effect<span class="token punctuation">.</span>destory <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
      effect <span class="token operator">=</span> effect<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token function">whlie</span> <span class="token punctuation">(</span>effect <span class="token operator">!==</span> firstEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/8b6d4537853a464eb81c3e251b92cd00" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è¿™é‡Œå¯ä»¥å‘ç°ï¼Œeffect çš„é“¾è¡¨å§‹ç»ˆæ˜¯å¾ªç¯é“¾è¡¨ï¼Œå› ä¸ºeffect ä¸€æ—¦mount äº†ä¹‹åæ•°é‡å°±æ˜¯æ’å®šçš„ï¼Œæ°¸è¿œä¸ä¼šå—åˆ°å…¶ä»–äº‹ä»¶çš„å½±å“ï¼Œæ‰€ä»¥æ¯æ¬¡ä» </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">lastEffect.next</code></span><span class="SemanticString"> èµ°èµ·å°±å¥½äº†ã€‚</span></span></p></div></div></details><details id="https://www.notion.so/5be7b3c92f494c4d95f3776e8875a658" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> å’Œ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> æœ‰ä½•ä¸åŒï¼Ÿ</span></span></summary><div class="Toggle__Content"><ul class="BulletedListWrapper"><li id="https://www.notion.so/9cdbc0fab4b94798bf1341c236b1e230" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useState</code></span><span class="SemanticString"> æ˜¯åœ¨fiber é‡Œé¢åˆ›å»ºåˆå§‹çŠ¶æ€ï¼Œç„¶åè¿”å›ä¸€ä¸ªcallback è®©ç”¨æˆ·æ¥schedule æ–°ä¸€è½®çš„re-renderã€‚</span></span></li><li id="https://www.notion.so/b9b0d50d4a0545c1a451f4691090db46" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">useEffect</code></span><span class="SemanticString"> æ˜¯åœ¨fiber é‡Œé¢åˆ›å»ºåˆå§‹çŠ¶æ€ï¼Œç„¶ååœ¨æ¯æ¬¡fiber commit ä¹‹åï¼ˆrender å®Œæˆä¹‹åï¼‰ï¼Œä¾æ¬¡æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨æ“ä½œã€‚</span></span></li></ul><div id="https://www.notion.so/174bd34168ef4d2fb4a6a7200d551056" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7d16a0c5-e596-41a7-b913-d228b5dd19db%2FUntitled.png?width=1523&amp;table=block&amp;id=174bd341-68ef-4d2f-b4a6-a7200d551056"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7d16a0c5-e596-41a7-b913-d228b5dd19db%2FUntitled.png?width=1523&amp;table=block&amp;id=174bd341-68ef-4d2f-b4a6-a7200d551056" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d39c20850269464e8a1566e12b78e436" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></details><details id="https://www.notion.so/6294db65f7274d19836fa5cd588365d3" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">update çš„</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">expirationTime</code></span><span class="SemanticString"> æ˜¯ä½•æ—¶è®¡ç®—çš„ï¼Ÿæœ‰ä½•ä½œç”¨ï¼Ÿ</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/b062fee9c1ed4a90aa9de23c97ed7e84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ˜¯åœ¨åˆ›å»ºupdate çš„æ—¶å€™å°±å†³å®šçš„ï¼Œç”¨æ¥å¸®åŠ©fiber ç¡®å®šupdate çš„ä¼˜å…ˆçº§ï¼Œfiber å› ä¸ºå…¶å……åˆ†åˆ©ç”¨device èµ„æºçš„ç‰¹æ€§ï¼Œä¼šæ ¹æ®å½“å‰çš„èµ„æºæ¥å†³å®šæ˜¯å¦è¿›è¡Œå½“å‰çš„updateï¼Œå¦‚æœèµ„æºä¸è¶³ï¼Œåˆ™è·³è¿‡ï¼Œè®°å½•è¢«è·³è¿‡çš„ç¬¬ä¸€ä¸ªupdate ä¸º </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseUpdate</code></span><span class="SemanticString"> å¾…ä¹‹ååˆè·å¾—èµ„æºåä» </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">baseUpdate</code></span><span class="SemanticString"> é‡æ–°æ›´æ–°ã€‚</span></span></p></div></div></details><div id="https://www.notion.so/b8cde68af34e487cb62b8cc2c5ebb1f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><details id="https://www.notion.so/2d3f60a7b8464c408fb7c4dad9c58b13" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">talk about fiber</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/b6648ea81ff94e438e8ac18653c41ecb" class="Bookmark"><a href="https://juejin.im/post/5dadc6045188255a270a0f85"><h5 class="Bookmark__Title">è¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„ React Fiber(æ—¶é—´åˆ†ç‰‡) æ‰“å¼€æ–¹å¼</h5><p class="Bookmark__Desc">å†™ä¸€ç¯‡å…³äº React Fiber çš„æ–‡ç« ï¼Œ è¿™ä¸ª Flag ç«‹äº†å¾ˆä¹…ï¼Œè¿™ä¹Ÿæ˜¯ä»Šå¹´çš„ç›®æ ‡ä¹‹ä¸€ã€‚ æœ€è¿‘çš„åœ¨æ˜é‡‘çš„æ–‡ç« è·å¾—å¾ˆå¤šå…³æ³¨å’Œé¼“åŠ±ï¼Œç»™äº†æˆ‘å¾ˆå¤šåŠ¨åŠ›ï¼Œæ‰€ä»¥ä¸‹å®šå†³å¿ƒå¥½å¥½æŠŠå®ƒå†™å‡ºæ¥ã€‚ æˆ‘ä¼šä»¥æœ€é€šä¿—çš„æ–¹å¼å°†å®ƒè®²é€, å› æ­¤è¿™ç®—æ˜¯ä¸€ç¯‡ç§‘æ™®å¼çš„æ–‡ç« ã€‚ä¸ç®¡ä½ æ˜¯ä½¿ç”¨Reactã€è¿˜æ˜¯Vueï¼Œè¿™é‡Œé¢çš„æ€æƒ³å€¼å¾—å­¦ä¹ å­¦ä¹ ! ä¸€å¹´ä¸€åº¦çš„ React æ˜¥æ™š: React Conf å³å°†åˆ°æ¥ï¼Œä¸çŸ¥é“ä»Šå¹´ä¼šä¸ä¼šæœ‰ä»€ä¹ˆæƒŠå–œï¼Œå»å¹´æ˜¯ React Hooksï¼Œå‰å¹´æ˜¯ React Fiber... æˆ‘å¾—èµ¶åœ¨ React Conf ä¹‹å‰å‘å¸ƒè¿™ç¯‡æ–‡ç« : ğŸ˜² React Fiber å·²ç»å‡ºæ¥è¿™ä¹ˆä¹…äº†ï¼Œ è¿™æ–‡ç« æ˜¯è€é…’è£…æ–°ç“¶å§? å¯¹äºæˆ‘æ¥è¯´ï¼Œé€šè¿‡è¿™ç¯‡æ–‡ç« æˆ‘é‡æ–°è®¤è¯†äº† React Fiberï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ–°ä¸œè¥¿, å®ƒä¹Ÿæ˜¯è€é…’è£…æ–°ç“¶ï¼Œä¸ä¿¡ä½ å°±çœ‹å§... ğŸ†• React Fiber ä¸æ˜¯ä¸€ä¸ªæ–°çš„ä¸œè¥¿ï¼Œä½†åœ¨å‰ç«¯é¢†åŸŸæ˜¯ç¬¬ä¸€æ¬¡å¹¿ä¸ºè®¤çŸ¥çš„åº”ç”¨ ã€‚ ğŸ˜¦ äº†è§£å®ƒæœ‰å•¥ç”¨? React Fiber ä»£ç å¾ˆå¤æ‚ï¼Œé—¨æ§›å¾ˆé«˜ï¼Œä½ ä¸äº†è§£å®ƒï¼Œåé¢ React æ–°å‡ºçš„ Killer Feature ä½ å¯èƒ½å°±æ›´ä¸èƒ½ç†è§£äº† ğŸ¤¥ æˆ‘ä¸æ˜¯å‡åˆ°React v16äº†å—?</p><p class="Bookmark__Link">https://juejin.im/post/5dadc6045188255a270a0f85</p></a></div><details id="https://www.notion.so/c7493f2b0eed436cb8b237616b666fb3" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">å•¥æ˜¯fiber</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/28b4e177cd1245e0924f72f4a5f2c049" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">ğŸ’¡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">React ä¸­çš„fiber åè°ƒç®—æ³•çš„æ‰§è¡Œå•å…ƒã€‚</span></span></p></div><div id="https://www.notion.so/818ebf6a6db1454eb3fb5f38936c58e9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è§£è¯»ä¸€ï¼šfiber ç›¸å½“äºæ˜¯react ä¸­çš„åç¨‹ã€‚å› ä¸ºåç¨‹ä¹‹é—´æ˜¯ä¸»åŠ¨åè°ƒä»»åŠ¡çš„ï¼Œæ‰€ä»¥å…¶å®react æ— æ³•å¯¹fiber è¿›è¡ŒæŠ¢å å¼è°ƒåº¦ï¼Œå…¨å‡­ä½¿ç”¨è€…çš„è‡ªè§‰ï¼Œä¸€èˆ¬fiber ä¼šä¸»åŠ¨æ£€æŸ¥æ˜¯å¦è¶…è¿‡äº†æµè§ˆå™¨ç»™çš„è¿è¡Œæ—¶é—´ï¼Œå¦‚æœè¶…è¿‡å°±ä¿å­˜ç°åœºï¼ŒæŠŠæ§åˆ¶æƒè¿˜ç»™æµè§ˆå™¨ï¼ˆä¸€èˆ¬æ¥è¯´è¿™ä¸ªè¿è¡Œæ—¶é—´æ˜¯16msï¼Œ1000ms / 60ï¼‰ã€‚</span></span></p></div><div id="https://www.notion.so/a67c12ba486e4d8b9f9ef3ac96f3bf46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è§£è¯»äºŒï¼šreact ä¸­çš„æ‰§è¡Œå•å…ƒï¼Œæ¯æ‰§è¡Œå®Œä¸€ä¸ªfiber å°±æ£€æŸ¥ä¸€ä¸‹å‰©ä½™æ—¶é—´ã€‚</span></span></p></div><div id="https://www.notion.so/96c86913b3d7403f8b59cb0f3bc16841" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/d40d10d1bcf943c4b265e8ba4c6a2e38" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3fc0f219-6bea-4400-a886-60e57ae173be%2FUntitled.png?width=960&amp;table=block&amp;id=d40d10d1-bcf9-43c4-b265-e8ba4c6a2e38"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3fc0f219-6bea-4400-a886-60e57ae173be%2FUntitled.png?width=960&amp;table=block&amp;id=d40d10d1-bcf9-43c4-b265-e8ba4c6a2e38" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></details><div id="https://www.notion.so/9f7ebea6ad8246ac8506e3ef9e1259cb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></details></article>
  <footer class="Footer">
</footer>
</body>

</html>