<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://raw.githubusercontent.com/yujiachen-y/yjc567.github.io/main/pictures/icon.JPG">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Golang GC 相关笔记&nbsp;|&nbsp;Jiachen’s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Golang GC 相关笔记">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://raw.githubusercontent.com/yujiachen-y/yjc567.github.io/main/pictures/icon.JPG"></span>&nbsp;
      
      <span>主页</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E6%9D%82%E6%96%87.html">
    <div class="Navbar__Btn">
      <span>杂文</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E6%8A%80%E6%9C%AF.html">
    <div class="Navbar__Btn">
      <span>技术</span>
    </div>
  </a>
  <span class="Navbar__Delim">&centerdot;</span>
  <a href="tag/%E9%98%85%E8%AF%BB.html">
    <div class="Navbar__Btn">
      <span>阅读</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="other.html">
        <div class="Navbar__Btn">
          
          <span>其他</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
          <span>关于</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">Golang GC 相关笔记</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on 2023年7月23日周日</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/技术.html">技术</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/775b615318ea46dd8328e497bcc7c803" class="PageRoot"><ul id="https://www.notion.so/0eee88287c1441898cc768eda2898484" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/dbacc461f0bb43449fd72486333581c7"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">模型</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f1538ea1f2e8406d85a4f9f7f176e5a9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟内存</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5690c1ce296945678487df290bfc5f2f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">特殊优化</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9149d369add7421eba8b1ef376f87b06"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">标记算法</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/76516bb44714411cb2575386090bf444"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">三色算法</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4a888acf9f1d44679d00c02e326bb594"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">写屏障</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0983406d1e9242ae8faa6f19b1fb7551"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">延迟</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/029694279e6a4858b77aeb312065dba7"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">其他</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/92e885fd89a04b59841243f18ef1f6fb"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">栈空间管理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e09bddbd3c3c417cac81b65fd8c9b870"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">逃逸分析</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8f8d05cce20c40269c20789685325551"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">栈扩容</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/30c1364a0b8640aab0aa9a70c27f10b9"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">栈缩容</strong></span></span></div></a></li></ul><h1 id="https://www.notion.so/dbacc461f0bb43449fd72486333581c7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/dbacc461f0bb43449fd72486333581c7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">模型</strong></span></span></h1><div id="https://www.notion.so/a70418c896404c8b8d159267dabb772e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">mark-sweep GC，从 root（比如局部和全局变量）开始遍历对象，给予标记，之后清除无法访问的对象。</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/cb90da9d977f44d1988125cb261c7edd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">并发</span></span></li><li id="https://www.notion.so/7d1e8aaf1b2142169609e12eed951f88" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">三色</span></span></li><li id="https://www.notion.so/7375b3aa4ad241eea20128b65535815b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">标记 - 交换</span></span></li></ul><div id="https://www.notion.so/e408b12e46ad4d49a3770710bcdf3c7b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/e945ef34ff6a452085df46eeca885a6e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">分代回收对 Go 不是特别有效，因为 Go 是在基于逃逸分析选择在堆上或栈上创建对象，而不是直接创建对象在堆中。</span></span></p></div><div id="https://www.notion.so/672623a338cd44c992b9ece014d2d824" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/fe11718c90ec44b0a89b789ecd45dffd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">涉及</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">两个资源</strong></span><span class="SemanticString">：CPU 和 内存。</span></span></p></div><div id="https://www.notion.so/8d9b5cea39a9401cb86895fd91f6080a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">目前 Go GC 的设计中，清理速度远快于标记速度，因此标记阶段主要影响 GO GC 的性能。</span></span></p></div><div id="https://www.notion.so/b18c86414b4a4ef7a40792b3df268c19" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Go GC 的设计权衡点主要是多占用 CPU 还是多占用内存。</span></span></p></div><div id="https://www.notion.so/0d47f780b8fa46d9b8bfe8495b6046bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/63f674f538a24c9aa246d04954c6cfdd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在内存消耗稳定的情况下，GC 的频次越少， CPU 占用越小，具体计算公式见图一，但说明这个关系不需要公式，想象一个极端情况：假如没有 GC，即 GC 频次为 0，那么就永远不会产生 GC 的 CPU 占用。</span></span></p></div><div id="https://www.notion.so/72b392226a1646b3bf8731fb1965e24c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/8f31f02b31e748d39622d38550c9cba1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">两个影响 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">GC 的参数</strong></span><span class="SemanticString">：GOGC 和 memory limit</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7a9664a90f0640d6a77ac1a131659401" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Math" data-latex="Target heap memory = Live heap + (Live heap + GC roots) * GOGC / 100"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>a</mi><mi>p</mi><mi>m</mi><mi>e</mi><mi>m</mi><mi>o</mi><mi>r</mi><mi>y</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>h</mi><mi>e</mi><mi>a</mi><mi>p</mi><mo>+</mo><mo stretchy="false">(</mo><mi>L</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>h</mi><mi>e</mi><mi>a</mi><mi>p</mi><mo>+</mo><mi>G</mi><mi>C</mi><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>G</mi><mi>O</mi><mi>G</mi><mi>C</mi><mi mathvariant="normal">/</mi><mn>100</mn></mrow><annotation encoding="application/x-tex">Target heap memory = Live heap + (Live heap + GC roots) * GOGC / 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord">/</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span></span></span><span class="SemanticString">，live heap 代表在上一次 GC cycle 没有被清除的 heap 大小，GOGC 代表一个可以增长的比例，达到这个比例即达到 target heap memory，开始 GC。</span></span></li><li id="https://www.notion.so/2f859bc769204fc196da22eb37c2f28c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">memory limit，在一些情况下用比例控制并不合适，Go 1.19 引入了 memory limit，理想情况一旦内存达到 limit 就立刻开启 GC，但 Go 并不是严格按照这个 limit 值执行的，用来避免 limit 过小导致 GC 无法停止。</span></span></li></ul><h2 id="https://www.notion.so/f1538ea1f2e8406d85a4f9f7f176e5a9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f1538ea1f2e8406d85a4f9f7f176e5a9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟内存</strong></span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/64a8bf7401eb4998a597b66bf48a3934" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Go runtime 不主动删除已经获得的虚拟内存，我个人理解如果释放的一个物理内存指向了虚拟内存，或者其他一些情况，相关的虚拟内存还是会被删除。</span></span></li><li id="https://www.notion.so/671c46eceb8b401abfff4a3b62c3be14" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Go runtime 会用虚拟内存存储一些内部数据结构，64位平台上这类内存大小大约是 700 MB，32位平台此类内存大小可忽略不计。</span></span></li></ul><h2 id="https://www.notion.so/5690c1ce296945678487df290bfc5f2f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5690c1ce296945678487df290bfc5f2f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">特殊优化</strong></span></span></h2><div id="https://www.notion.so/fbc9d0bd222c4134b776c067c099030d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 Go1.19 及之前（不确定以后的实现细节是否会改变）这些改动可以加速 GC：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/d97377a77ec74b8497d7199be9971085" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">从结构体中删除指针字段：GC 扫描指针指向的对象时需要 cache 原结构体的位置，取消结构体中的指针可以避免这种递归扫描。</span></span></li><li id="https://www.notion.so/9d4b1f161c0b4d58be4d16ab8218ccf9" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">在结构体中把指针字段放在最前面：因为 GC 在扫描到最后一个指针字段时就不会扫描剩下的字段，那么提前扫描指针就提前结束。</span></span></li></ol><h1 id="https://www.notion.so/9149d369add7421eba8b1ef376f87b06" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9149d369add7421eba8b1ef376f87b06"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">标记算法</span></span></h1><h2 id="https://www.notion.so/76516bb44714411cb2575386090bf444" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/76516bb44714411cb2575386090bf444"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">三色算法</strong></span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/ddd4ec83118a40128acd76b5a4a2fcd2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">白色，潜在的垃圾。</span></span></li><li id="https://www.notion.so/efc78e22fdfe4611b181f0b58cba1410" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">灰色，不是垃圾，但是和白色相连。</span></span></li><li id="https://www.notion.so/2204425915da4d6498915060cc0a4a87" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">黑色，不是垃圾，不和白色相连。</span></span></li></ul><div id="https://www.notion.so/6e8979dea40a4c2089c014091671a278" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/1764066726e843b79f621b7b7024e656" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">步骤：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/1e278ba75a4e4f7db09e0cdfe631106f" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">开始时所有的对象都是白色。</span></span></li><li id="https://www.notion.so/106e60b1d6294b158e98c9c7d626c0bc" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">遍历所有 root，标记它们为灰色。</span></span></li><li id="https://www.notion.so/d7c215c58cf84a3ca969b4d72793485e" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">任选一个灰色对象，将其标记为黑色，将其关联的所有白色对象标记为灰色。</span></span></li><li id="https://www.notion.so/5d08ca74f19b441b80a9641b64beda2d" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">重复以上步骤，直到没有灰色对象。</span></span></li></ol><div id="https://www.notion.so/4319aeeec9b540e0b612d7c6444b6eb7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/86c696167e714ea9958e3f9308cbe0dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">性质：不允许黑色对象指向白色对象，这样当灰色对象都被染成黑色时，内存中只有黑白两种对象，且黑色与白色不相连，白色对象可被清除。</span></span></p></div><h2 id="https://www.notion.so/4a888acf9f1d44679d00c02e326bb594" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4a888acf9f1d44679d00c02e326bb594"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">写屏障</strong></span></span></h2><div id="https://www.notion.so/a6a3d483961f448f88a43696c2c52ed4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用来保证没有一个黑色对象会指向白色对象。当一个白色对象因为写入而可以被追溯了，写屏障会将这个对象改为灰色。</span></span></p></div><h1 id="https://www.notion.so/0983406d1e9242ae8faa6f19b1fb7551" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0983406d1e9242ae8faa6f19b1fb7551"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">延迟</span></span></h1><div id="https://www.notion.so/942946e68f634b09bca2a156c1b86108" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://go.dev/talks/2015/go-gc.pdf">https://go.dev/talks/2015/go-gc.pdf</a></span><span class="SemanticString"> 这里的 Go 版本为 1.15。</span></span></p></div><div id="https://www.notion.so/a7e04d17292442d5894978499a549a93" class="ColumnList"><div id="https://www.notion.so/55ea9660d6aa4739a8310040ec03d921" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/824d203a0d0a461d98568c3cf22b528f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">GC 的主要流程：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/694fca1c222b4f12a612258d8ee0128b" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">栈扫描</span></span></li><li id="https://www.notion.so/6a9df33b5a2f4891b91ba3520f858678" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">标记</span></span></li><li id="https://www.notion.so/018c5897eced46ea9048fe10e9702c84" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">标记终止</span></span></li><li id="https://www.notion.so/4c3f039dbd9c439fa2d376ce53d42df1" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">清除</span></span></li></ol></div><div id="https://www.notion.so/c4a987a5db524ba4af5f2faf05c375d0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/484f9a1da55b4b1fb864efd4f5512700" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6f7cd742-4c20-45ef-a0d8-53c1c122b5fa%2FUntitled.png?width=1920&amp;table=block&amp;id=484f9a1d-a55b-4b1f-b864-efd4f5512700"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6f7cd742-4c20-45ef-a0d8-53c1c122b5fa%2FUntitled.png?width=1920&amp;table=block&amp;id=484f9a1d-a55b-4b1f-b864-efd4f5512700" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/d888d4407e034460a0f82f6c42ca92f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">两次 stop the world：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/7a7ca52d03644dc9b728b57f447e751c" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">栈扫描开始时，被扫描到 root 的 goroutines 会被暂停；这个过程很快，我理解这是因为具体操作是把 goroutines 栈内的变量放到等候队列里，而不是穷举所有和栈内关联的变量。</span></span></li><li id="https://www.notion.so/7bcd914bac6d4ba2a5fb680d5a573062" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">标记终止阶段会有个较长的 stop the world，此时需要确定哪些内存可以被清空，因此不允许内存变化了。</span></span></li></ol><div id="https://www.notion.so/551eb8680ec348ed964a611fb5d9e12d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/bf677a22eb4e4515a6dc12e66ee3b4a9" class="ColumnList"><div id="https://www.notion.so/f9c76444aacb4638a805834c44a80d71" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/b472e90aab2a4ca7a75b073b9c526210" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Go 1.15 之前的版本还会在标记时也 stop the world，Go 1.15 做出了并发标记的改动，标记阶段会占用 25% CPU 并在 goroutines 过多的情况下占用用户的 goroutines。右图中的 assist 我理解就是占用用户 goroutines，可能理解有误。</span></span></p></div></div><div id="https://www.notion.so/4871cee8bb614009b565a6fe2e3074a5" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/0d009e1fc7f2487a92bcfd4b3cd8797c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8edc78b2-f466-4389-92c8-e29a7e318b72%2FUntitled.png?width=1920&amp;table=block&amp;id=0d009e1f-c7f2-487a-92bc-fd4b3cd8797c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8edc78b2-f466-4389-92c8-e29a7e318b72%2FUntitled.png?width=1920&amp;table=block&amp;id=0d009e1f-c7f2-487a-92bc-fd4b3cd8797c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/17b3d326242545768119b473bf9d55da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/0bafa3ba11724954b27162d429d939dd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">标记阶段中对指针会有写屏障，防止在写指针值的时候改变了依赖关系，导致标记结果出错。</span></span></p></div><div id="https://www.notion.so/73ab485c55d947d0b88e1effdb6c4820" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/836998ec5b4149249ae0ce0da1f90bdd" class="ColumnList"><div id="https://www.notion.so/b687cbdb92d7417db59bc9e6b7955fdb" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/96aca3b19e374529b38b19b7be57bfb7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以上改动有效将 Go GC 的延迟降低到了毫秒级别，对比见右图。在 17 年延迟已经被优化到了微秒级别。</span></span></p></div><div id="https://www.notion.so/dccf4dbd9e554cde8ea7d85dc5597a44" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">注意：即使是毫秒级别，在一些场景下也是无法容忍的，如果各种调整依然无法解决，当前一个许多人正在尝试的方法是用 Rust 重写：</span></span></p></div><div id="https://www.notion.so/d2cf3b8a29b245df9e4a1c149e653be9" class="Bookmark"><a href="https://discord.com/blog/why-discord-is-switching-from-go-to-rust"><h5 class="Bookmark__Title">Why Discord is switching from Go to Rust</h5><p class="Bookmark__Link">https://discord.com/blog/why-discord-is-switching-from-go-to-rust</p></a></div></div><div id="https://www.notion.so/04864aab60ba4897a7197e927fdf1b95" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/b9e086e35edc4682b74a18c7bcd35f9d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd29e0e07-246b-441b-92d3-46870238c4bc%2FUntitled.png?width=1920&amp;table=block&amp;id=b9e086e3-5edc-4682-b74a-18c7bcd35f9d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd29e0e07-246b-441b-92d3-46870238c4bc%2FUntitled.png?width=1920&amp;table=block&amp;id=b9e086e3-5edc-4682-b74a-18c7bcd35f9d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><h1 id="https://www.notion.so/029694279e6a4858b77aeb312065dba7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/029694279e6a4858b77aeb312065dba7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">其他</span></span></h1><h2 id="https://www.notion.so/92e885fd89a04b59841243f18ef1f6fb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/92e885fd89a04b59841243f18ef1f6fb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">栈空间管理</span></span></h2><h3 id="https://www.notion.so/e09bddbd3c3c417cac81b65fd8c9b870" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e09bddbd3c3c417cac81b65fd8c9b870"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">逃逸分析</strong></span></span></h3><div id="https://www.notion.so/359df6b5cf1a4c74a612735d7796bfff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">两个原则</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/f27e6110e12b40b9ad9d8b0ab8d8004d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">指向栈对象的指针不能存在于堆中。</span></span></li><li id="https://www.notion.so/15ef50d61bd347ef832cf53283b122c0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">指向栈对象的指针在栈对象回收后无法存活。</span></span></li></ul><div id="https://www.notion.so/84e2f89b810948e391b47690c903ddec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">编译器通过对语法树的分析，找到违背这两个原则的指针，更改分配位置，不断循环，确保所有指针都满足以上两个原则，逃逸分析完成。</span></span></p></div><div id="https://www.notion.so/8c27b88424e44fb8a9d70993c4c698f3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">逃逸分析把大量小对象的内存位置都锁定在了栈上，降低了堆内存的使用，这是 Go GC 无需采用分代回收来优化 GC 的原因之一。</span></span></p></div><h3 id="https://www.notion.so/8f8d05cce20c40269c20789685325551" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/8f8d05cce20c40269c20789685325551"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">栈扩容</strong></span></span></h3><div id="https://www.notion.so/24794abdddaa49dda570c309c22f9752" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">自 Go1.3 起，Go 不再使用分段栈而是连续栈，当栈空间不足时，以下流程会被触发：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/eb754040128743bf9798c7ce10016cef" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">在内存空间中分配更大的栈内存空间。</span></span></li><li id="https://www.notion.so/1116b49593e6418880df42d92126f23d" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">将旧堆中的栈内容复制到新堆中。</span></span></li><li id="https://www.notion.so/c48f3208409a44c6bde62d51c2c421c3" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">将指向旧栈对应变量的指针重新指向新栈；由于逃逸分析的保证，只需要对所有栈内指针加上偏移量就完成了重新指向。</span></span></li><li id="https://www.notion.so/f1f048d8c5a84aa7b0ffb934c4648fef" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">销毁并回收旧栈的内存空间。</span></span></li></ol><h3 id="https://www.notion.so/30c1364a0b8640aab0aa9a70c27f10b9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/30c1364a0b8640aab0aa9a70c27f10b9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">栈缩容</strong></span></span></h3><div id="https://www.notion.so/6eb55e9139d644cdbb9a8e6b43bd8f04" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 GC 期间，如果一个栈只使用了栈内存的 1/4，那么其内存减半。</span></span></p></div></article>
  <footer class="Footer">
</footer>
</body>

</html>