<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Jiachen Yu (ZH)</title>
    <link>https://www.yujiachen.com/blog/zh/</link>
    <description>Jiachen Yu</description>
    <language>zh-CN</language>
    <lastBuildDate>Mon, 15 Sep 2025 00:00:00 GMT</lastBuildDate>
    <atom:link href="https://www.yujiachen.com/rss-zh.xml" rel="self" type="application/rss+xml" />
  <item>
    <title>写给 PM 的 LLM 工程知识点</title>
    <link>https://www.yujiachen.com/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/</guid>
    <pubDate>Mon, 15 Sep 2025 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p><em>由 Claude 从英文原文翻译。</em></p>
<blockquote>
<p>这篇文章最初由我发布于 Medium 的 <strong>OpusClip Engineering</strong>。<br>
原文：<a href="https://medium.com/opus-engineering/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together-147a36ab4089">Bridging the Gap: How Engineers and PMs Ship Winning LLM Features Together</a></p>
</blockquote>
<h1 id="写给-pm-的-llm-工程知识点">写给 PM 的 LLM 工程知识点</h1>
<p><strong>TL;DR：</strong></p>
<ul>
<li><strong>Prompt 放在配置里，不要写死在代码里。</strong></li>
<li><strong>动态变量尽量后置，最大化 KV cache 命中。</strong></li>
<li><strong>Schema 管格式，Prompt 管语义。</strong></li>
</ul>
<p>我们在 OpusClip 落地这三件事后，prompt 迭代从按天变成按分钟，API 成本明显下降，线上稳定性也更好。下面按实践展开。</p>
<h3 id="1-pm-到-prompt-的距离-pm-to-prompt-distance">1) PM 到 Prompt 的距离（PM-to-Prompt Distance）</h3>
<p><strong>定义：</strong> 从产品诉求到模型最终收到的 prompt，中间经历了多少层转译。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_1.png" alt="" class="article-image" width="1024" height="1572" />
</picture>
</p>
<p><a href="https://www.linkedin.com/posts/manus-im_product-to-prompt-distance-is-fast-becoming-activity-7349444736048320512-zjjS?utm_source=share&amp;utm_medium=member_desktop&amp;rcm=ACoAACdAQCkBye_l2SHKxHq1FoCJdVQJdLz5Boc">Tao Zhang first defines this metric in Manus.</a></p>
<p>一个常见链路是：</p>
<ol>
<li><strong>PM 写诉求</strong>：助手要“专业，但别生硬”。</li>
<li><strong>PRD 转译</strong>：正式语气里允许少量口语化表达。</li>
<li><strong>工程实现</strong>：写成系统 prompt。</li>
<li><strong>运行时再拼接</strong>：用户信息、历史上下文等动态内容。</li>
</ol>
<p>链路越长，问题越容易出现：</p>
<ul>
<li><strong>迭代慢</strong>：改一行文案，要跨多个环节。</li>
<li><strong>意图丢失</strong>：每一次转译都可能偏离原始需求。</li>
<li><strong>排查难</strong>：线上看到的最终 prompt 和代码里的模板往往不是一回事。</li>
</ul>
<p><strong>落地建议：</strong></p>
<ul>
<li>Prompt 放到动态配置（或 prompt 管理平台）。</li>
<li>做版本化管理，支持灰度和 A/B。</li>
<li>线上日志保留“最终拼装后的 prompt”用于回溯。</li>
</ul>
<h3 id="2-kv-cache-把静态内容放前面">2) KV cache：把静态内容放前面</h3>
<p><strong>KV cache 是什么？</strong>
简单说，就是把已经算过的上下文结果缓存起来，后续请求可以复用，不用每次都从头计算。</p>
<p>对产品和业务最直接的影响有两点：</p>
<ul>
<li><strong>延迟更低</strong>：响应更快。</li>
<li><strong>成本更低</strong>：重复计算更少，token 费用更低。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_2.png" alt="" class="article-image" width="1024" height="276" />
</picture>
</p>
<blockquote>
<p>在主流模型计费里，cached token 通常明显便宜于新 token。以 GPT-5 为例，输入 token 与 cached token 的单价存在约 10x 差异。</p>
</blockquote>
<p><strong>实操规则只有一条：</strong> 静态指令前置，动态变量后置。</p>
<p>❌ <strong>不推荐结构</strong>（缓存命中低）：</p>
<pre class="hljs"><code>User: {{user_name}}
Question: {{user_question}}
Conversation history: {{chat_history}}

You are a customer support agent for TechCorp.
Guidelines:
- Be empathetic and professional
- Check our knowledge base before answering
- Escalate billing issues to human agents
- Always verify account details first
</code></pre>
<p>✅ <strong>推荐结构</strong>（缓存命中高）：</p>
<pre class="hljs"><code>You are a customer support agent for TechCorp.
Guidelines:
- Be empathetic and professional
- Check our knowledge base before answering
- Escalate billing issues to human agents
- Always verify account details first

User: {{user_name}}
Question: {{user_question}}
Conversation history: {{chat_history}}
</code></pre>
<p>在高频场景里，这个调整通常是“低风险、高收益”。例如每天 10,000 次客服对话，光这个改动就可能带来可见的日成本下降。</p>
<h3 id="3-structured-output-schema-管格式-prompt-管语义">3) Structured Output：Schema 管格式，Prompt 管语义</h3>
<p><strong>定义：</strong> 不是让模型返回自由文本，而是让它按 schema 返回结构化 JSON。</p>
<p>关键点：</p>
<ul>
<li>Structured output 是 <strong>API 能力</strong>，不是 prompt 小技巧。</li>
<li>schema 在代码里定义，运行时负责校验。</li>
<li>prompt 不再描述“长什么样”，只描述“每个字段该填什么”。</li>
</ul>
<p>下面是一个示例：</p>
<pre class="hljs"><code>import OpenAI from &quot;openai&quot;
import { z } from &quot;zod&quot;
import { zodTextFormat } from &quot;openai/helpers/zod&quot;

// 1) Schema 留在代码中（Zod）
const RelevancyItem = z.object({
  clipId: z.string(),
  relevant: z.boolean(),
  relevantReason: z.string(),
  advertisement: z.boolean(),
})
const RelevancyArray = z.array(RelevancyItem)
type Relevancy = z.infer&lt;typeof RelevancyArray&gt;

// 2) 构建纯语义 prompt（不写输出格式）
const prompt = promptTemplate.join(&quot;\n&quot;).replace(INPUT_REPLACE, input)

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY })

// 3) Responses API 自动按 schema 解析和验证
const response = await openai.responses.parse({
  model: &quot;gpt-4o-mini&quot;,
  input: [
    { role: &quot;system&quot;, content: &quot;Judge search-trend relevancy using the definitions provided.&quot; },
    { role: &quot;user&quot;, content: prompt },
  ],
  text: {
    format: zodTextFormat(RelevancyArray, &quot;relevancy_results&quot;),
  },
})

// 4) 结果已完成解析和校验
const results: Relevancy = response.output_parsed

// 5) 后置过滤
const relatedResults = results.filter(
  (r) =&gt; r.relevant &amp;&amp; r.evergreen &amp;&amp; !r.advertisement
)
</code></pre>
<p><strong>常见错误：</strong> 代码里已经有 schema，prompt 里又写一遍输出格式要求。</p>
<p>这样会带来三个后果：</p>
<ul>
<li>校验失败和重试增多，延迟和成本上升。</li>
<li>模型在“内容”和“格式指令”之间来回拉扯，质量下降。</li>
<li>下游 typed 解析更容易崩。</li>
</ul>
<p>一句话：<strong>Schema 决定长相，Prompt 决定内容。</strong></p>
<p>❌ <strong>不推荐这样写 prompt：</strong></p>
<pre class="hljs"><code>Analyze these search results and return a JSON object with:
- videoId: the video identifier
- isRelevant: boolean indicating if it matches
- relevanceReason: explanation string
- isPaid: boolean for sponsored content
Format as valid JSON with these exact field names.
</code></pre>
<p>✅ <strong>推荐这样写 prompt：</strong></p>
<pre class="hljs"><code>Analyze these search results for relevance to the user's query.

For relevance assessment:
- Consider semantic match, not just keyword overlap
- Educational content is preferred over entertainment
- Recent content (last 6 months) is more relevant

For paid content detection:
- Look for &quot;Sponsored&quot;, &quot;Ad&quot;, or &quot;#ad&quot; markers
- Check if the channel name includes &quot;Official&quot; or &quot;Brand&quot;

Provide clear reasoning for why content is or isn't relevant.
</code></pre>
<p>另外一个非常实际的坑：工程 schema 用 <code>videoId</code>，需求文案写成 <code>video_id</code> 或 <code>clip_id</code>，不对齐就会直接影响稳定性。</p>
<h3 id="把三件事串起来">把三件事串起来</h3>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/bridging-the-gap-how-engineers-and-pms-ship-winning-llm-features-together/zh/image_3.png" alt="" class="article-image" width="1024" height="512" />
</picture>
</p>
<ol>
<li><strong>缩短 PM 到 Prompt 的距离</strong>：让迭代更快。</li>
<li><strong>优化 KV cache 命中</strong>：让每次迭代更便宜。</li>
<li><strong>用好结构化输出</strong>：让结果稳定可解析。</li>
</ol>
<h3 id="下一步">下一步</h3>
<p>阅读完这篇文章的你可以做什么？</p>
<ol>
<li>盘点现状：prompt 在哪、变量是否后置、是否混写了格式指令。</li>
<li>先改一个最高收益点：通常从 prompt 外置或变量后置开始。</li>
<li>建立指标：追踪迭代周期、单次请求成本、解析失败率。</li>
</ol>
<p>如果你有任何的疑问，欢迎评论。</p>
]]></content:encoded>
  </item>
  <item>
    <title>如何进行 1-on-1</title>
    <link>https://www.yujiachen.com/how-to-1-on-1/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/how-to-1-on-1/zh/</guid>
    <pubDate>Sat, 15 Feb 2025 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p><em>由 Claude 从英文原文翻译。</em></p>
<h1 id="为什么要做-1-on-1">为什么要做 1-on-1？</h1>
<p>驱动自己的职业成长是你自己的责任。</p>
<p>除非你主动说出来，否则没人知道你想要什么。所以公司通过每周的 1-on-1 来&quot;强迫&quot;你的经理帮助你做这件事。</p>
<p>一个更现实的理由是：你和经理的关系在很大程度上决定了你的工作体验。</p>
<h1 id="心态">心态</h1>
<h2 id="1-你的经理是你的资源">1. 你的经理是你的资源</h2>
<table>
<thead>
<tr>
<th>我是经理的资源</th>
<th>经理是我的资源</th>
</tr>
</thead>
<tbody>
<tr>
<td>不关心公司的运营状况。</td>
<td>讨论你对公司这两个月表现的不满（如果有的话），询问创始人或团队计划如何改善现状。</td>
</tr>
<tr>
<td>不问为什么，执行经理分配的任务就好。</td>
<td>向经理询问任务或项目的背景。如果你认为某个项目没有好的 impact，直接告诉经理为什么，并建议停掉这个项目。</td>
</tr>
<tr>
<td>不谈晋升或绩效，等经理来邀请你晋升。</td>
<td>主动询问晋升标准以及如何达到。询问下次绩效校准前需要做哪些准备。</td>
</tr>
<tr>
<td>经理是对的。</td>
<td>经理可能是错的。</td>
</tr>
</tbody>
</table>
<h2 id="2-聊你们不知道的事">2. 聊你们不知道的事</h2>
<table>
<thead>
<tr>
<th>聊你和经理都已经知道的事</th>
<th>聊经理不知道的事，或我需要知道的事</th>
</tr>
</thead>
<tbody>
<tr>
<td>在日常站会上刚汇报完工作，1-on-1 又汇报一遍。</td>
<td>聊你接下来计划做的事情或项目，请经理把它加到下一个双月 OKR 里。如果你发现任务太多无法按时交付，确保经理知道你会 miss timeline。</td>
</tr>
<tr>
<td>说一切都好，即使你收到了关于团队的负面反馈。</td>
<td>如果你从别人那里收到了关于团队的有价值的反馈，告诉你的经理。</td>
</tr>
<tr>
<td>聊一个你刚在 PSA 里写过的项目的 impact。</td>
<td>复盘你刚上线的项目，向经理请教反馈。</td>
</tr>
<tr>
<td>话不多说。</td>
<td>尽量多说。</td>
</tr>
</tbody>
</table>
<h1 id="其他建议">其他建议</h1>
<p><strong>每当你有想在下次 1-on-1 聊的事情，发到会议群里并置顶。</strong></p>
<p><strong>如果你觉得没必要开，就取消这次 1-on-1。</strong></p>
<p><strong>不要滥用 1-on-1。如果一个话题是公开的或应该公开，就在公开群里讨论。</strong></p>
<p><strong>不要&quot;向上管理&quot;</strong></p>
<blockquote>
<p>&quot;向上管理&quot;的另一个典型漏洞是它经常导致不必要的一对一会议。你可能不同意我的看法，但没关系。那么我所说的&quot;不必要&quot;是什么意思呢？这么说吧——如果有人能用大约100个字的文字消息说清楚一个问题，他们就不需要和我安排一对一会议。事实上，我更希望他们在群聊中发布，这样我就不必再传递信息了。但现实是，我经常被拖入关于此类问题的一对一会议中。</p>
<p>为什么人们更喜欢面对面的一对一对话？我发现有两个主要原因。首先，一对一对话会造成信息不对称，有助于&quot;向上管理&quot;，因为它可以防止第三方的潜在批评。但如果你在群聊中发布同样的问题，就很容易看到不同的意见。实际上，我认为大多数问题都不需要一对一沟通，只要不是机密信息。其次，面对面或电话的一对一对话有助于不断调整谈判策略。例如，如果对方观察到你对他/她之前说的话感到不满，他们往往会退让或缓和一下语气。</p>
<p>&quot;向上管理&quot;还有很多其他案例。我曾经听说过这样一件事——一个公关员工摸清了他/她老板订阅的微信和头条频道，然后在这些频道上发布公关内容，让老板注意到。</p>
<p>我不确定你对此有何感想。但我会觉得，如果CEO和领导者沉浸在一个信息被&quot;修饰&quot;的&quot;向上管理&quot;环境中，他们会非常困扰。假设指向你的信息是经过特殊角度处理的，或者我们在字节跳动所说的&quot;SEO化的信息&quot;，你将不得不通过其他渠道验证信息。那将非常低效。</p>
<p>来源：<a href="https://sourcecodecap.com/code-class-post/bytedances-zhang-yiming-bring-outside-in-and-avoid-managing-up-how-to-protect-the-comp/">ByteDance’s Zhang Yiming: “Bring Outside in” and Avoid “Managing up”— How to Protect the Company from Diseconomies of Scale</a></p>
</blockquote>
]]></content:encoded>
  </item>
  <item>
    <title>简单 vs 容易</title>
    <link>https://www.yujiachen.com/simple-vs-easy/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/simple-vs-easy/zh/</guid>
    <pubDate>Sun, 19 Jan 2025 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<ul>
<li>简单对应的英文是 “simple”，容易对应的英文是“easy”。</li>
<li>一个例子是手动榨汁机是“simple”的，原理简单好懂；对应“easy”的例子是电动榨汁机，很好使用，很简单，但其原理很复杂。</li>
<li>简单“simple”在这个语境里说的是简单可依赖；容易“easy”说的是外人觉得容易，但其实内部充满了复杂结构和不确定性。</li>
<li>再举一个“简单”的例子：段永平想明白了苹果是个好股票，就持有了十几年没卖，这期间他不需要做其他操作，天天打球就能获得二十倍收益，因为苹果利润高还有护城河，用户规模也一直在扩大，所以股价长期看一定是上涨的。“简单”就是想清楚后就不需要关心其他事情。他去和巴菲特说持仓的理由也就是一两句话，说完后苹果就没什么好谈的了。</li>
<li>对应一个“容易”的例子：昨天某币暴涨，如果有人在暴涨前全仓甚至加杠杆，那么一晚上就可以收获几千甚至万倍的收益，说起来容易，但操作时复杂性极大，极有可能爆仓，何况追热点的不确定性极大；即使现在来一个人和你说接下来做什么操作就能赚钱，有多少人相信呢？</li>
<li>我自己：更喜欢“简单”的事情，简单之所以简单，是因为其符合原理，不因参与者的多少和态度改变；不喜欢“容易”，容易的事情很难被再次复制，即使可以其可靠性也远低于“简单”，而且复杂系统的特点就是会因为参与者的人数和态度变化而发生改变，让人耗时耗力，还没有确定的回报。</li>
</ul>
]]></content:encoded>
  </item>
  <item>
    <title>Learnings from ByteDance</title>
    <link>https://www.yujiachen.com/learnings-from-bytedance/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/learnings-from-bytedance/zh/</guid>
    <pubDate>Thu, 02 Jan 2025 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<ol>
<li>不设边界：市场是公司的边界；需求是产品的边界；impact 是工作的边界。</li>
<li>效率至上：公司竞争的核心是 ROI 而不是成本水平。</li>
<li>向前看：竞争只会带来成本上涨，而收益不会来自竞争对手，而是来自用户。</li>
<li>逃离重力：每个公司都有能力圈，如果一家公司的引力比你大，不要在这个范围内做事。</li>
<li>需求供给是市场的核心：做业务最幸福的事情莫过于一群人需要你的资源，而另一群人愿意提供其他高价值的资源从你这里置换能力。所以多边的平台好过双边的，而双边的好过工具。工具不过是一种局部的手段。</li>
<li>关注事实：幻想对改造现实没有帮助，而现实是基于物理法则演变而来，必然是合理的。</li>
</ol>
]]></content:encoded>
  </item>
  <item>
    <title>新事情 vs 旧事情</title>
    <link>https://www.yujiachen.com/new-things-vs-old-things/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/new-things-vs-old-things/zh/</guid>
    <pubDate>Thu, 26 Dec 2024 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p>事情得从今天我被问的一个问题开始。</p>
<hr>
<h1 id="1">1</h1>
<p>今天我司的 recruiter 跑来问我：“你觉得 OpenAI 是现象级还是偶然性事件（技术壁垒不高）？”，因为有个候选人对她表示 OpenAI 的技术壁垒并不高，只是做了第一个吃螃蟹的人。目前来看，OpenAI 的进展确实放缓，据我所知其他一些厂商的追赶速度极快，甚至在一些模型上可以说是完胜了 OpenAI。但在我心中 OpenAI 还是一个特殊的存在，因为我会觉得 OpenAI 的价值并不在商业上，而是在技术上，更何况，现在 OpenAI 在商业上虽然说不上非常成功，但肯定不能算失败。</p>
<p>在之前就关注 OpenAI 的朋友应该知道，当时 GPT 和 GPT-2 在外界看来是很“玩具”的东西，同期 Google 的 Bert 才是最强的语言模型；以及 GPT-3 出来时，大家会觉得有意思，但依然是没啥用的状态；直到后续的 GPT-3.5 让大家看到了 AGI 的可能性。在 GPT-3.5 出来之前，OpenAI 独自在 GPT 架构上坚持了 4 年以及更久的时间，即使算上当时马斯克、奥特曼等人的资金很多，融资能力也强，OpenAI 作为一家创业公司一直在一个不一定成功的方向上坚定投入，这也是非常难的事情。</p>
<p>在我看来，OpenAI 的坚持才是这家公司和其他公司的主要不同，其他公司去做大语言模型，是因为商业需要；而 OpenAI 去做大语言模型，是因为这家公司相信这样可以创造一个有 AGI 的未来。这也是其他公司的所作所为“无意义”之处，在 OpenAI 已经推出 GPT 后，如果一个后来者（公司）想要为人类做出贡献，那必然是不应该选择大语言模型的工作的，因为除非你有和大众非常不一样的见解，那么这个领域已经是被 OpenAI 充分探索的领域了，这家后来者公司应该去独立思考还有什么领域是重要的，却被市场忽略而未能被探索的，这些领域才会有新的价值和技术被创造。也就是说，<strong>作为后来者的公司应该先考虑去做新事情，而不是抢着去做旧事情</strong>。</p>
<h1 id="2">2</h1>
<p>上面这句话可能会有不少人有反对意见，什么赚钱做什么呗。但我会觉得没有人竞争的市场才有丰厚的利润，在 LLM 这个大家挤破头的竞争领域，除非最后出现赢家，不然就是大家都是收着成本价打工。</p>
<p>一个例子是当年的 AI 四小龙（商汤、旷视、依图、云从），做的技术看上去很难，但其实大家同质化很严重，以至于后来大厂用了一段时间四小龙提供的各种解决方案后，就转向了内部自研，留下四小龙只能去走 ToB 和 ToG 路线。当然计算机视觉还有一个问题是没有太大的商业价值，此处不表。</p>
<p>另一个例子则是小米，小米总是在需求被市场验证后才进入市场，这就导致小米做的是“感动人心”的高性价比产品，商业模式无关对错，小米也是一家有很大的社会责任感的企业。但事实上小米的硬件产品利润率极低，也就没有太大的成本去做创新。</p>
<p>所以兜了一个圈子说回来，去做 LLM 赚钱吗？我个人会觉得这是个赔钱的生意，目前来看只有字节的豆包是个例外，因为 ChatGPT 无法对中国提供服务，而中国的大量普通用户也需要一个好用的 LLM app。</p>
<h1 id="3">3</h1>
<p>相对于其他公司，各家大厂做 LLM 其实是 OpenAI 做过的“旧事情”；而 OpenAI 之前在 GPT，过去两年在多模态，以及最近在 post training 上做的才是“新事情”。相比之下，我个人会偏爱做“新事情”，理由如下。</p>
<p>第一点，做新事情是有意义的，如 OpenAI 长达几年在 AGI 上的坚持换来了如今 AI 应用的大爆发。新技术会创造新需求和新资源，但旧事情更多是基于现有条件重新分配资源。</p>
<p>第二点，收益最大化，如果一件新事情成功了，那么你就是这件事情的行业第一，自然有非常大的商业利润，大量的资金会允许你做很多事情；相比之下做旧事情的利润总归是有限的，因为市场和用户需求都在逐渐固化，其他竞争者也想从你这里分一杯羹。新事情的成功概率其实是很低的，失败是更常见的结果，但其实失败也有很大的收益。90 年代，有一家叫做 General Magic 的公司想要制造出一个可以随身携带的触屏互联网设备，这是一个从现在看和 iPhone 很像的设备，结果也可想而知，90 年代的技术无法制造出 iPhone。 General Magic 失败了，但里面的不少员工因为这段经历得到了一个成功的职业生涯，Tony Fadell 离开 General Magic 后几经辗转来到了 Apple，主导了 iPod 的设计和开发工作；Kevin Lynch 则是主导了 Apple Watch 的开发；Andy Rubin 写出了一个叫做 Android 的操作系统并被 Google 收购。</p>
<p>第三点，领先者抄袭他人的优势是极大的，虽然领先者完成的”新事情“会被后来者抄袭成”旧事情“，但领先者又可以反过来抄袭后来者做的各种”微创新“。这样的例子不胜枚举，从 QQ 到苹果到 OpenAI，这些公司的所有追随者只是在帮助领先者验证一些他们没有时间去验证的需求，一旦需求被验证，领先者可以用极小的成本完成抄袭，甚至追随者原来的客户也会被领先者抢走。</p>
<p>第四点，被误解其实是一种巨大的优势。正因为短期的逐利者无法关注到你，你可以很轻松地筛选掉没有不认同你愿景的员工；因为你做的事情还没有成为风口，你可以用极低的成本从相关的供应商那里拿到资源；同时因为没有竞争，你也不会有太多时间上的压力，做“新事情”的节奏感和手感会好很多。</p>
<h1 id="4">4</h1>
<p>如果说我们更认同做“新事情”，那有什么实践是我们可以做到呢？</p>
<ol>
<li>职业上，偏好做“新事情”的公司：这样个人不仅可以获得更大的成长，也有小概率获得非常大的财务回报。</li>
<li>投资上，偏好做”新事情“的公司：这类公司的特点其实比较明显，他们专注做一些别人不愿意做的事情，因此股价很低，但这些事情一旦成功，会有很大的商业价值，在此之后这些公司的股价会发生极大的提升。不过对事情和公司的判断不只是说说而已，我也不推荐在投资上花费过多的时间和财力。</li>
<li>日常做事上，把评价事物的标准从注重”完成度“转换到注重”创新性“：我自己有一个很不好的学生思维就是明明花 20% 的时间可以拿到 80% 的成果，但自己会去花 100% 的时间去拿到 100% 的成果，但其实多出来的 20% 成果很多都是一些琐碎或不重要之事；现在对我来说，快速地 deliver 结果，验证 idea 的价值是更重要的事情。剩下的 20%，如果你的 80% 足够重要，那么会有很多人来愿意做的。</li>
</ol>
<hr>
<p>不知道的东西永远比已知的东西有价值。</p>
]]></content:encoded>
  </item>
  <item>
    <title>2024 年小结</title>
    <link>https://www.yujiachen.com/2024-year-in-review/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2024-year-in-review/</guid>
    <pubDate>Sat, 03 Aug 2024 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<hr>
<p>今年其实很早些时候就决定不写年终小结，但有一次一个同事和我说，写博客是为了见到新朋友，我觉得这个习惯还是要保持。</p>
<h1 id="无限">无限</h1>
<p>3 4 月份重看了《纸牌屋》第一季，当时我有个习惯是和 ChatGPT 讨论剧情，我很奇怪 Frank 追求的到底是什么。奇怪的是，多次和 ChatGPT 讨论，一次它竟然向我推荐了《有限和无限的游戏》 这本书，后来也去看了一些小晚对王兴的访谈。有限游戏的玩家，目标是在得到排名后尽快结束游戏，由此就达成了目标；而无限游戏的玩家，目标是尽可能地继续游戏，为此可以打破规则，不断设立新的目标。</p>
<p>今年 4 月份很意外地被猎头联系，发现对面是一家很有意思的公司，我索性直接跳槽了，在上海呆了几个月，又在海外呆了几个月。换工作的理由其实很简单，当时面试我的 3 个面试官里有 2 个是 NOI 选手，是我经历的面试中密度最大的，同时公司当时刚刚完成 A 轮融资，收入一直在增长，还是我很感兴趣的 AI 方向，那我就直接加入了。</p>
<p>我在现在公司里目的是很单纯的，就是支持公司和同事们的发展，因为我没有太多想达成的目标，更多的是好奇这家公司会变成什么样，与此同时我也开始阅读一些 Startup 相关的书籍和资料，对着公司做参考。如果公司有意思，我就会一直在这里做下去；如果不是，那我就自己想办法去创立公司，或说服自己放弃，那时候会遇到更大的困难，但困难就意味着新的东西，不断看见新的东西，总归是一种开心的状态。同时也会清楚地知道自己用尽全力的样子，这样应该不会有对现实的不满和情绪。</p>
<p>今年人生的无目标感非常强烈，因为我会觉得时间宝贵，没必要花费在知道的事情上，因为时间是目前人类唯一不能借贷的东西（或许未来可以，参考《星际穿越》哈哈哈）。即使按照长寿的预期估计，我的人生也过了 1/3 了，这是让我一直去做有意思事情的动力。</p>
<p>–&gt;</p>
<h1 id="向前跑">向前跑</h1>
<p>我觉得今年一个重要的感悟是未来比现在和过去都有意思，因为未来是可以被验证的，并且和人的行动有关，而现在即将成为过去，而过去会慢慢失去准确性。未来会让你聚焦在一个模糊的前方，也无法让你和身边的人事物做对比，毕竟你无法拿没有发生的事情去做对比。</p>
<blockquote>
<p>世界是动态的、前进的。如果你停下来去做别人已经做好的事情，你和对方都会被时代潮流拉下，因为世界不是只有你和你的对手。</p>
</blockquote>
<p>我觉得我对工具类产品是有着极度热爱的，23 年我会觉得自己要在 SaaS 领域上一直做下去。但读到一篇《花花公子》在 85 年对乔布斯的访谈后，我的观点有了改变——当乔布斯被问到未来的电脑可以做什么时，他回答道：“可以和亚里士多德对话”—— LLM 的出现在某个层面是一种必然。这也是我换工作的原因之一，新的方向才有更大的可能性。5 月份被前同事问到，为什么要去做 LLM 套壳产品，我反问：为什么你要在一个谷歌地图套壳产品上工作这么多年？不管怎么说，人们的需求是会改变的，现在下定论说一件事情有无可能性还是过早。</p>
<p>今年的另一个感悟是：做比说重要，或者说，鲁莽非常重要。在事情发生前后，人们讨论的态度和观点都会变化的，与其在发生前讨论各种利弊，我觉得不如先让事情发生了，然后接受大家的批评。让我有如此感悟的是公司的同事和项目，今年投入最多的项目是一个代码架构非常奇怪的项目，但是很神奇，这个项目可以跑，而且符合 PM 的预期，最后也有一定的 impact，这全都拜辞于我的 leader 对项目迭代速度的关心超过了其他方面。事后来看他的优先级排序很合理，如果连 impact 都没有，那遵循所谓的软件迭代流程去做事有什么意义呢？不如一开始就不做节省时间；如果觉得有 impact，那么最重要的事情就是把 impact deliver 给需要的人。</p>
<hr>
<h1 id="时光">时光</h1>
<p>5 月份去丰台车管所办事，之后在边上一家面馆吃面，叫祥和面馆，很好吃，我吃着吃着竟然哭了。倒也不是因为面好吃到感动，而是突然想到我爸爸经常在工作日的中午一个人找面馆吃面，这种平常的日子，他度过的时间有我的一倍多，真的好漫长啊，难怪人是会衰老的。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_1.png" alt="" class="article-image" width="1024" height="768" />
</picture>
</p>
<p>最近也在思考，衰老后我会怎么样，是身体无法满足心理上的欲望而变的丑陋呢，还是内心渴求的东西也随之变少，从而自己变的更加自洽佛系？也有前同事来找我八卦，“和这样的人在一起是不会幸福的”——我被这样评论，真没想到离职这么久了我还会出现在同事们的话题里。虽然是负面的评价，但某方面来说我在以不同的方式被不同的人记住，这也算是年龄渐长才会发生的事吧。</p>
<p>关于北京，离开了居住长达 5 年的北京，自己竟然最想念的是白塔寺旁边的 Polonio，趁接下来这段日子还在上海，我要多试试上海的一些特色咖啡店。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_2.png" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>暑期公司在东京团建，旅馆在南砂町附近，到达的第一天就是烟花大会，说实话烟花本身其实挺一般的，但氛围很好，整个街道都很安静，大家一起在江边看着烟火，也很难用某个照片记录下当时的感受，就放一张酒店的配餐在这里好了～

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_3.png" alt="" class="article-image" width="1024" height="768" />
</picture>
</p>
<p>自己顺便去看了正在上映的《蓦然回首》，事后也没想到这电影会在中国上映。这电影是很让我感动的，因为会让我想起大学的 ACM 时光，希望之后可以写一篇相关的文章，放个坑在这里，如果写好了来更新一下文章标题。</p>
<p>今年也在温哥华出差了很长一段时间，那里的自然景观真的挺不错，见到了此生见过最大的彩虹和最大的雾，当然最迷幻的事情是在那边可以全中文无障碍生活……

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_4.png" alt="" class="article-image" width="768" height="1024" />
</picture>


<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_5.png" alt="" class="article-image" width="768" height="1024" />
</picture>

圣诞前几天，在当地的一家画廊拍出了今年最满意的几何形状。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2024-year-in-review/zh/image_6.png" alt="" class="article-image" width="1024" height="768" />
</picture>
</p>
<p>谢谢你读完了我今年的故事和感悟，朋友。</p>
]]></content:encoded>
  </item>
  <item>
    <title>打造你的 Mac</title>
    <link>https://www.yujiachen.com/shape-your-mac/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/shape-your-mac/zh/</guid>
    <pubDate>Sun, 14 Jul 2024 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p><em>由 Claude 从英文原文翻译。</em></p>
<h1 id="前言">📖 前言</h1>
<p>你有没有自己布置过房间？说实话，我没有，因为我一直在租房。不过我确实会整理家里的东西。此刻，我正躺在沙发上写这篇文章。为了让它更生动，我决定放一张我现在环境的照片。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_1.png" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>我搬到上海还不到两个月，但已经让这里变得很熟悉了。这让我能够生活得开心且有一定&quot;效率&quot;——意思是房间的布置完美契合了我的日常习惯。</p>
<p>电脑也是一样，尤其是工作电脑。我们并不拥有工作电脑，它们属于公司。但既然我们大部分屏幕时间都花在上面，确保它们让我们感到愉快且高效就很重要。</p>
<h1 id="基础设置">🔧 基础设置</h1>
<h2 id="dotfiles">🗂️ Dotfiles</h2>
<p><a href="https://github.com/yujiachen-y/dotfiles">https://github.com/yujiachen-y/dotfiles</a></p>
<p>Dotfiles 可以看作是你电脑的元数据。我个人使用 <a href="https://github.com/yujiachen-y/dotfiles/blob/main/macos/Brewfile">Brewfile</a> 来管理 Mac 的依赖。只要一个应用能通过 Homebrew 安装，你就应该把它加到 Brewfile 里。实际上，只有极少数应用无法通过 Homebrew 安装。</p>
<p>我还把 <a href="https://github.com/yujiachen-y/dotfiles/blob/main/zsh/.zshrc">.zshrc</a> 和 <a href="https://github.com/yujiachen-y/dotfiles/blob/main/.vimrc">.vimrc</a> 文件存在 Dotfiles 里，这样就不需要重复配置 zsh 和 vim。</p>
<p>此外，把 <a href="https://github.com/yujiachen-y/dotfiles/blob/main/macos/system_settings.sh">Mac 设置</a>存在 dotfiles 里也是常见做法。不过，有些无法通过命令行修改的选项仍然需要去系统设置里手动配置。顺便说一句，每次我配置新 Mac 时，系统偏好设置里总会有 UI 变化和新选项。所以手动设置也帮我发现了苹果做了哪些改动 哈哈。</p>
<h2 id="命令行配置">💻 命令行配置</h2>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_2.png" alt="" class="article-image" width="1080" height="719" />
</picture>
</p>
<p>我使用 <a href="https://www.warp.dev/">Warp</a> 作为终端模拟器。不过我认为 Terminal.app、iTerm2 和 Warp 之间的差异并不大。对我来说，Warp 有三个主要优势：</p>
<ol>
<li>
<p><strong>建议功能</strong>：我觉得比 <a href="https://github.com/zsh-users/zsh-autosuggestions">zsh-autosuggestions</a> 更好用。</p>
</li>
<li>
<p><strong>AI Copilot</strong>：在我看来，所有 AI copilot 产品都可以被直接问 ChatGPT 替代。（更新：Warp 现在也有 agent 模式了。）</p>
</li>
<li>
<p><strong>内置 Shell 提示符</strong>：虽然不如 <a href="https://github.com/romkatv/powerlevel10k">p10k</a> 灵活或功能丰富，但我正在考虑换回我之前的 <a href="https://github.com/yujiachen-y/dotfiles/blob/main/zsh/.p10k.zsh">.p10k.zsh</a> 配置。</p>
</li>
</ol>
<p>你有没有看过你的 <code>.zshrc</code> 文件有多少行代码？那些行都在干什么？我检查了我的，只有 <a href="https://github.com/yujiachen-y/dotfiles/blob/3a77776963e3fee4a3df70c7e29230d40c1c2419/zsh/.zshrc">15 行</a>。通常，<code>.zshrc</code> 文件里全是 <code>[oh-my-zsh](https://github.com/ohmyzsh/ohmyzsh)</code> 的配置，但我只保留了几个必要的插件，删掉了不需要的。这里介绍几个值得一提的 <code>oh-my-zsh</code> 插件：</p>
<ul>
<li>
<p><strong><a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/dotenv/README.md">dotenv</a></strong>：自动将 .env 文件加载到环境变量中。</p>
</li>
<li>
<p><strong><a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/git/README.md">git</a></strong>：我每天都在用 <code>gaa</code>（<code>git add --all</code>）、<code>gsmsg</code>（<code>git commit --message</code>）和 <code>gcn!</code>（<code>git commit --verbose --no-edit --amend</code>）这些命令。</p>
<ul>
<li>一个 git 小技巧：请使用 <code>gcn!</code> 来避免 PR 中不必要的 commit 信息。</li>
</ul>
</li>
<li>
<p><strong><a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/z/README.md">z</a></strong>：用极少的按键访问你最常去的目录。</p>
</li>
</ul>
<p>如前所述，我使用 Warp 的内置 shell 提示符，它长这样：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_3.png" alt="" class="article-image" width="1080" height="719" />
</picture>
</p>
<p>不过，它不太灵活，也无法在其他终端模拟器中使用。如果你用 Warp 的 shell 提示符，在 VSCode 或其他文本编辑器和 IDE 中可能会遇到问题。<a href="https://github.com/warpdotdev/Warp/issues/257#issuecomment-1274198741">把 Warp 嵌入 VSCode 尤其困难</a>。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_4.png" alt="" class="article-image" width="1080" height="719" />
</picture>
</p>
<p>我推荐使用 <a href="https://github.com/romkatv/powerlevel10k">p10k</a> 作为你的 shell 提示符。它非常灵活，且不绑定特定终端模拟器，可以跨不同终端使用。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_5.png" alt="" class="article-image" width="765" height="516" />
</picture>
</p>
<p>这里我想提两个我最喜欢的 macOS 命令：<a href="https://ss64.com/mac/pbpaste.html">pbpaste</a> 和 <a href="https://ss64.com/mac/pbcopy.html">pbcopy</a>。它们的 Manual Page 上已经有一些实用的示例了。</p>
<h2 id="系统设置">⚙️ 系统设置</h2>
<blockquote>
<p>如前所述，以下部分设置可以整合到你的 dotfiles 中。</p>
</blockquote>
<p>这些设置将提升你的生产力：</p>
<ul>
<li><strong>防止自动休眠</strong></li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_6.png" alt="" class="article-image" width="1080" height="767" />
</picture>
</p>
<ul>
<li><strong>三指拖拽</strong></li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_7.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_7.png" alt="" class="article-image" width="1080" height="767" />
</picture>
</p>
<p><a href="https://youtu.be/-Fy6imaiHWE" title="Share link">How to select or drag using three fingers on your MacBook track pad</a></p>
<ul>
<li><strong>减少键盘延迟时间</strong>：将键盘延迟设置为最短。作为程序员，我们可不能浪费时间等键盘延迟。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_8.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_8.png" alt="" class="article-image" width="1080" height="767" />
</picture>
</p>
<ul>
<li><strong>关闭双空格句号</strong>：这个功能很烦人，最好关掉。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_9.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_9.png" alt="" class="article-image" width="1080" height="767" />
</picture>
</p>
<ul>
<li><strong>交换 Caps Lock 和 Command 键</strong>：你最常用的键应该更容易触达。把 Caps Lock 键和 Command 键互换。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_10.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_10.png" alt="" class="article-image" width="1080" height="796" />
</picture>
</p>
<ul>
<li><strong>关闭长按弹出</strong>：这个设置只能通过命令行关闭。如果你使用 <a href="https://opusclip.larksuite.com/wiki/Uu5NwIeBFilqHRk2dhSu5MNYsUg#LlCwdefVKo7DO3xvxUquBptVs9f">Vim</a>，可能不需要关闭这个设置，因为在 Vim 中长按按键本身就不是好的操作习惯。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_11.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_11.png" alt="" class="article-image" width="464" height="170" />
</picture>
</p>
<pre class="hljs"><code>defaults write -g ApplePressAndHoldEnabled -bool <span class="hljs-literal">false</span>
</code></pre>
<h1 id="应用">📱 应用</h1>
<blockquote>
<p>如前所述，这里列出的所有应用都应该通过 Brewfile 来管理。</p>
</blockquote>
<h2 id="raycast">🌟 Raycast</h2>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_12.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_12.png" alt="" class="article-image" width="1080" height="701" />
</picture>
</p>
<p><a href="https://www.raycast.com/store">Raycast 是 Mac 快捷操作的百宝箱。</a> 以下是我常用的一些快捷功能：</p>
<table>
<thead>
<tr>
<th>Clipboard History</th>
<th>Search Emoji</th>
<th>Window Management</th>
<th>Music Control</th>
<th>Kill Process</th>
<th>Search Browser Tabs</th>
<th>Reminder</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_13.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_13.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_14.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_14.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_15.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_15.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_16.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_16.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_17.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_17.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_18.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_18.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
<td>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_19.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_19.png" alt="" class="article-image" width="1080" height="661" />
</picture>
</td>
</tr>
</tbody>
</table>
<p>配合自定义快捷键，Raycast 会非常好用。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_20.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_20.png" alt="" class="article-image" width="1080" height="702" />
</picture>
</p>
<h2 id="alttab">🌟 AltTab</h2>
<p>在 Mac 上，你可以用 Command + Tab 切换应用。但内置的应用切换器不支持在同一应用的不同窗口之间切换，如果你需要频繁在一个应用的多个窗口间来回切换，就会很不方便。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_21.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_21.png" alt="" class="article-image" width="1080" height="701" />
</picture>
</p>
<p><a href="https://alt-tab-macos.netlify.app/">AltTab</a> 解决了这个问题，它允许你在不同 Mac 桌面的窗口之间切换。这样你就不需要用鼠标来切换窗口和桌面了。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_22.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/shape-your-mac/zh/image_22.png" alt="" class="article-image" width="1080" height="701" />
</picture>
</p>
<h1 id="备份">💾 备份</h1>
<blockquote>
<p>世界上有两种人：</p>
<ul>
<li>
<p>做备份的人</p>
</li>
<li>
<p>将来会做备份的人</p>
</li>
</ul>
<p>你拥有但没有备份的数据，随时可能永远消失。下面我们将介绍一些良好的备份基础知识以及某些方法的陷阱。</p>
<h2 id="3-2-1-原则"><strong>3-2-1 原则</strong></h2>
<p><a href="https://www.us-cert.gov/sites/default/files/publications/data_backup_options.pdf">3-2-1 原则</a>是备份数据的通用推荐策略。它要求你：</p>
<ul>
<li>
<p>至少有 <strong>3 份</strong>数据副本</p>
</li>
<li>
<p><strong>2</strong> 份副本存储在<strong>不同的介质</strong>上</p>
</li>
<li>
<p><strong>1</strong> 份副本存放在<strong>异地</strong></p>
</li>
</ul>
<p>这个建议背后的核心思想是不要把所有鸡蛋放在一个篮子里。拥有 2 个不同的设备/磁盘可以确保单个硬件故障不会夺走你所有的数据。同样，如果你唯一的备份存放在家里，而房子着火了或被盗了，你就会失去一切——这就是异地备份的意义。本地备份提供可用性和速度，异地备份提供灾难恢复能力。</p>
<p>来源：<a href="https://missing.csail.mit.edu/2019/backups/">Backups</a></p>
</blockquote>
<h1 id="反思">💭 反思</h1>
<ul>
<li>
<p>定期审视你的工作流程，尝试提升效率。</p>
</li>
<li>
<p><a href="https://www.catb.org/~esr/writings/taoup/html/ch01s06.html#id2878263">将知识折叠进数据，这样程序逻辑就可以简单而健壮。</a></p>
</li>
<li>
<p><a href="https://www.catb.org/~esr/writings/taoup/html/ch01s06.html#id2878666">程序员的时间很宝贵；优先节省人的时间而非机器时间。</a></p>
</li>
<li>
<p><a href="https://mcluhangalaxy.wordpress.com/2013/04/01/we-shape-our-tools-and-thereafter-our-tools-shape-us/">我们塑造了工具，然后工具塑造了我们。</a></p>
</li>
</ul>
]]></content:encoded>
  </item>
  <item>
    <title>权限模型的迷思</title>
    <link>https://www.yujiachen.com/the-permission-model-myth/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/the-permission-model-myth/zh/</guid>
    <pubDate>Sun, 25 Feb 2024 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<h1 id="基本概念">基本概念</h1>
<p>随着上下文不同，“权限”所指代的东西也是不同的，本文讨论的是在计算机领域下应用的“授权”（authorization），与之关联的几个概念有：</p>
<ul>
<li>“验证”（authentication）：简称 AuthN，是指确认某人或某事的身份的过程。在计算机安全领域，这通常涉及到确认一个用户或系统是否真的是它声称的那个实体。验证可以通过多种方式进行，包括密码、生物识别技术、智能卡或数字证书等。验证是访问控制过程的第一步，只有在成功验证身份后，系统才会进一步考虑授予访问权限。其涉及到的技术协议和框架有：OAuth, OpenID 及 SAML 等。</li>
<li>“授权”（authorization）：简称 AuthZ，在用户的身份得到验证后，系统需要决定该用户能够访问哪些资源，以及可以执行哪些操作。授权是一个定义和管理访问权限的过程，它决定了验证过的用户可以查看、使用、修改或删除哪些数据或资源，旨在确保只有得到适当权限的用户才能访问特定的资源或数据。其涉及到的授权模型有基于角色的访问控制（RBAC）、基于属性的访问控制（ABAC） 等。</li>
<li>“权限控制”（access control）：是一种更广泛的概念，涵盖了验证和授权的过程，是指限制对系统和数据的访问和使用的各种方法和技术的总称。</li>
</ul>
<h1 id="使用场景">使用场景</h1>
<p>下面列举一些研发场景中会遇到的权限场景。</p>
<h2 id="文件系统权限">文件系统权限</h2>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_1.png" alt="" class="article-image" width="1080" height="214" />
</picture>
</p>
<p>图中的 <code>drwx------</code> 即表示项目的权限，其中第一个字符表示文件类型（<code>-</code>表示普通文件，<code>d</code>表示目录），接下来的三组三个字符分别代表所有者、组和其他用户的读、写和执行权限。但我们看到有的字符串后面还跟着 <code>@</code> 和 <code>+</code> 符号，其中 <code>@</code> 符号表示当前文件或目录有扩展属性，此处不讨论；而 <code>+</code> 符号表示存在访问控制列表（Access Control List, ACL）。ACL 是一种用于定义额外权限的机制，允许对文件或目录进行更细粒度的访问控制，这意味着除了标准的文件权限（如读、写、执行）之外，还有额外的权限设置，这些设置可以针对不同的用户或组进行详细配置。使用 <code>ls -le</code> 操作后，我们可以看到这些访问控制列表：

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_2.png" alt="" class="article-image" width="1080" height="349" />
</picture>
</p>
<p>更具体的说明可以通过 <code>man chmod</code> 查看，这里我们有 2 点观察：</p>
<ul>
<li>Unix 的权限粒度过粗，只支持读、写和执行 3 种不同操作的权限管控，其他操作系统选择添加额外的 ACL 机制来打补丁。</li>
<li>macOS ACL 的规则格式为： <code>（用户，允许 / 拒绝，操作）</code> 的三元组。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_3.png" alt="" class="article-image" width="1080" height="810" />
</picture>
截图来自 macOS 14.2 manual</li>
</ul>
<h2 id="数据库权限">数据库权限</h2>
<p>数据库系统提供一系列的权限或权限组合，使数据库管理员可以为用户或用户组分配、审计权限。</p>
<p>下面的一系列截图是一组授权和查看权限的例子：

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_4.png" alt="" class="article-image" width="1080" height="114" />
</picture>
授权：为用户名为 ‘admin’ 的用户授予 ‘lark.message’ 表的 SELECT 权限。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_5.png" alt="" class="article-image" width="1080" height="232" />
</picture>
查看用户的全局权限：‘admin’用户没有任何全局权限。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_6.png" alt="" class="article-image" width="1080" height="152" />
</picture>
查看一个用户对一个数据表的权限：‘admin’用户对‘lark.message‘表有 SELECT 权限。</p>
<p>从上面的例子中我们也有如下观察：</p>
<ol>
<li>MySQL 的权限控制是有多个层级的，一个用户有全局范围的权限，也有针对具体表范围的权限。</li>
<li>MySQL 的权限控制也是<code>（用户，允许 / 拒绝，操作）</code> 的三元组。</li>
</ol>
<h1 id="访问控制模型">访问控制模型</h1>
<p>业界常用的访问控制模型有多种，如：自主访问控制（Discretionary Access Control, DAC）、强制访问控制（Mandatory Access Control, MAC）、基于角色的访问控制（Role-Based Access Control, RBAC）、基于属性的访问控制（Attribute-Based Access Control, ABAC）、基于策略的访问控制（Policy-Based Access Control, PBAC）。</p>
<blockquote class="callout callout-note">
<p>💡 请注意：虽然相关的访问控制模型算是一种共识，但目前业界并没有统一的标准去判定一个现实中的方案属于哪一个访问控制模型，因此下面的说明主要是起到概念说明的作用，而不是做明确的定义和区分。</p>
</blockquote>
<h2 id="dac">DAC</h2>
<p>DAC 是一种最基本的访问控制模型，允许资源的所有者对资源的访问进行控制。在 DAC 模型中，用户可以根据自己的判断将访问权限分配给其他用户。</p>
<p>上面举的文件系统权限和数据库权限的例子，其实都是 DAC 系统，直接指定了“谁可以做什么操作”，如文件系统的 <code>User 1 allow read</code> ，数据库的 <code>GRANT SELECT ON lark.message TO 'admin'@'%';</code>。</p>
<h2 id="rbac">RBAC</h2>
<p>RBAC 是一种以用户的角色为基础进行访问控制的模型，它允许系统管理员根据组织的职能和职责将用户分配到不同的角色中，每个角色都有一组预定义的访问权限。RBAC 简化了权限管理，因为管理员只需管理角色与权限的关系，而不是每个用户的权限。</p>
<p>下面的这篇文章介绍了如何在 SAP 中配置 RBAC：</p>
<p><a href="https://community.sap.com/t5/human-capital-management-blogs-by-sap/sap-commissions-implementing-authorization-with-user-roles-rbac/ba-p/13554527">SAP Commissions - Implementing Authorization With User Roles (RBAC)</a></p>
<p>通常在 RBAC 中，我们会有用户组的概念，用户组把用户和具体的授权绑定在一起。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_7.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_7.png" alt="" class="article-image" width="1080" height="650" />
</picture>
</p>
<p>RBAC 有简化管理、灵活可配置的优点，但实践中也会表现出如下缺点：</p>
<ol>
<li><strong>角色膨胀</strong>：在复杂的组织中，可能需要创建大量的角色来覆盖所有的访问需求，这可能导致角色管理变得复杂和难以维护。</li>
<li><strong>初始设置复杂</strong>：正确实施RBAC系统可能需要大量的前期规划和配置，特别是在将现有权限迁移到RBAC模型的过程中。</li>
<li><strong>灵活性限制</strong>：虽然RBAC提高了权限管理的效率，但在某些情况下，它可能限制了对个别用户特定需求的灵活性。</li>
<li><strong>性能问题</strong>：在拥有大量用户、角色和权限规则的大型系统中，权限检查可能会导致性能问题。</li>
<li><strong>管理挑战</strong>：随着组织的发展，管理和更新角色及其权限可能变得复杂，尤其是在缺乏自动化工具支持的情况下。</li>
</ol>
<h2 id="abac">ABAC</h2>
<p>ABAC 是一种更为灵活和动态的访问控制模型，它根据访问请求者的属性（如年龄、职位等）、资源的属性和环境条件（如时间）来决定访问权限。ABAC 提供了更细粒度的访问控制，支持更复杂的安全策略，适用于需要高度定制化访问控制的场景。</p>
<p>ABAC 相对于 RBAC 的优点，主要在于 RBAC 的授权基于用户组，一个组内的成员权限互通，用一个医疗系统举例，如果我们希望一个护士只能看见 ta 负责的病人病历，除非给每个护士创建一个用户组，不然无法用 RBAC 实现。而 RBAC 只需要 <code>病历负责护士 == 当前用户</code> 这样一个规则就可以实现。</p>
<p>一种现实中的实践是，用 RBAC 分发规则组，及一个用户需要哪些授权规则，到具体的授权规则上，则是 ABAC，即考虑用户和实体的属性来决定是否授权。</p>
<h2 id="现实案例">现实案例</h2>
<p><a href="https://www.youtube.com/watch?v=ZUmzELJ2UcM&amp;list=PLnobS_RgN7JZxK1wjUvQ84jMFqRZoJXbD&amp;index=1">https://www.youtube.com/watch?v=ZUmzELJ2UcM&amp;list=PLnobS_RgN7JZxK1wjUvQ84jMFqRZoJXbD&amp;index=1</a></p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_8.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_8.png" alt="" class="article-image" width="1080" height="608" />
</picture>
</p>
<p>视频中展示了 4 中访问控制：</p>
<ol>
<li>IP、登陆时间决定能否访问组织。</li>
<li>用户权限组决定能否访问对象。</li>
<li>角色、汇报线决定能否访问具体记录。</li>
<li>用户权限组决定能否访问一个记录上的具体字段。</li>
</ol>
<p>可以看到不同的权限访问控制模型存在于系统的不同层级，这也是权限系统的一个抽象难点。</p>
<h1 id="业界解决方案">业界解决方案</h1>
<p>早期业界的很多解决方案并不会刻意区分认证（AuthN）和授权（AuthZ），在我自己的观察中，RBAC 通常是这类框架首要支持的访问控制模型，因为认证是围绕着用户进行的，那么之后的访问控制围绕着用户展开也在情理之中。</p>
<ul>
<li><a href="https://github.com/spring-projects/spring-security">Spring Security</a>：没有控制面板、提供了各类 API，但不支持配置文件。</li>
<li><a href="https://github.com/apache/shiro">Apache Shiro</a>：没有控制面板、支持配置文件，但不支持 ABAC。</li>
</ul>
<p>上面的两个解决方案及其他较早的开源方案对访问控制模型的支持都比较简单，因此也不在本文的讨论范围内，而近年有两个方案对访问控制模型的支持则更加全面，分别是：</p>
<ul>
<li><a href="https://github.com/casbin/casbin">Casbin</a>：开源，定位是一个 SDK，支持各类访问控制模型，对现存的各类系统都有集成，通过配置定义权限。</li>
<li><a href="https://research.google/pubs/zanzibar-googles-consistent-global-authorization-system/">Zanzibar</a>：闭源，定位是一个鉴权服务，也支持各类访问各类控制模型，控制粒度更细，权限通过接口调用配置。</li>
</ul>
<h2 id="casbin">Casbin</h2>
<p>下面给一个 Casbin 创建 RBAC 的例子。</p>
<p>model 文件：</p>
<pre class="hljs"><code>[<span class="hljs-string">request_definition</span>]
<span class="hljs-string">r</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">act,</span> <span class="hljs-string">obj</span>

[<span class="hljs-string">policy_definition</span>]
<span class="hljs-string">p</span> <span class="hljs-string">=</span> <span class="hljs-string">sub,</span> <span class="hljs-string">act,</span> <span class="hljs-string">obj</span>

[<span class="hljs-string">role_definition</span>]
<span class="hljs-string">g</span> <span class="hljs-string">=</span> <span class="hljs-string">_,</span> <span class="hljs-string">_</span>
<span class="hljs-string">g2</span> <span class="hljs-string">=</span> <span class="hljs-string">_,</span> <span class="hljs-string">_</span>

[<span class="hljs-string">policy_effect</span>]
<span class="hljs-string">e</span> <span class="hljs-string">=</span> <span class="hljs-string">some(where</span> <span class="hljs-string">(p.eft</span> <span class="hljs-string">==</span> <span class="hljs-string">allow))</span>

[<span class="hljs-string">matchers</span>]
<span class="hljs-string">m</span> <span class="hljs-string">=</span> <span class="hljs-string">r.sub</span> <span class="hljs-string">==</span> <span class="hljs-string">p.sub</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">g(p.act,</span> <span class="hljs-string">r.act)</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">g2(p.obj,</span> <span class="hljs-string">r.obj)</span>
</code></pre>
<p>policy 文件：</p>
<pre class="hljs"><code><span class="hljs-string">p,</span> <span class="hljs-string">alice,</span> <span class="hljs-string">sub-reader,</span> <span class="hljs-string">sub1</span>
<span class="hljs-string">p,</span> <span class="hljs-string">bob,</span> <span class="hljs-string">rg-owner,</span> <span class="hljs-string">rg2</span>

<span class="hljs-string">//</span> <span class="hljs-string">subscription</span> <span class="hljs-string">role</span> <span class="hljs-string">to</span> <span class="hljs-string">subscription</span> <span class="hljs-string">action</span> <span class="hljs-string">mapping</span>
<span class="hljs-string">g,</span> <span class="hljs-string">sub-reader,</span> <span class="hljs-string">sub-read</span>
<span class="hljs-string">g,</span> <span class="hljs-string">sub-owner,</span> <span class="hljs-string">sub-read</span>
<span class="hljs-string">g,</span> <span class="hljs-string">sub-owner,</span> <span class="hljs-string">sub-write</span>

<span class="hljs-string">//</span> <span class="hljs-string">resourceGroup</span> <span class="hljs-string">role</span> <span class="hljs-string">to</span> <span class="hljs-string">resourceGroup</span> <span class="hljs-string">action</span> <span class="hljs-string">mapping</span>
<span class="hljs-string">g,</span> <span class="hljs-string">rg-reader,</span> <span class="hljs-string">rg-read</span>
<span class="hljs-string">g,</span> <span class="hljs-string">rg-owner,</span> <span class="hljs-string">rg-read</span>
<span class="hljs-string">g,</span> <span class="hljs-string">rg-owner,</span> <span class="hljs-string">rg-write</span>

<span class="hljs-string">//</span> <span class="hljs-string">subscription</span> <span class="hljs-string">role</span> <span class="hljs-string">to</span> <span class="hljs-string">resourceGroup</span> <span class="hljs-string">role</span> <span class="hljs-string">mapping</span>
<span class="hljs-string">g,</span> <span class="hljs-string">sub-reader,</span> <span class="hljs-string">rg-reader</span>
<span class="hljs-string">g,</span> <span class="hljs-string">sub-owner,</span> <span class="hljs-string">rg-owner</span>

<span class="hljs-string">//</span> <span class="hljs-string">subscription</span> <span class="hljs-string">resource</span> <span class="hljs-string">to</span> <span class="hljs-string">resourceGroup</span> <span class="hljs-string">resource</span> <span class="hljs-string">mapping</span>
<span class="hljs-string">g2,</span> <span class="hljs-string">sub1,</span> <span class="hljs-string">rg1</span>
<span class="hljs-string">g2,</span> <span class="hljs-string">sub2,</span> <span class="hljs-string">rg2</span>
</code></pre>
<p>请求： <code>alice, rg-read, rg1</code> ，返回： <code>true</code>。</p>
<p>其推理过程为，先匹配用户，alice 对应的配置是： <code>alice, sub-reader, sub1</code>

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_9.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_9.png" alt="" class="article-image" width="1080" height="573" />
</picture>

然后匹配操作，请求的操作是 <code>rg-read</code>，配置的 alice 操作角色是 <code>sub-reader</code>，配置 <code>g, sub-reader, rg-reader</code> 和 <code>g, rg-reader, rg-read</code> 可以从 alice 的 <code>sub-reader</code> 角色推理出其可以执行 <code>rg-read</code> 操作。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_10.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_10.png" alt="" class="article-image" width="1080" height="593" />
</picture>

最后匹配操作对象，请求的对象是 <code>rg1</code> ，配置的 alice 对象角色是 <code>sub1</code>，这层关系则可以通过 <code>g2, sub1, rg1</code> 配置推理出。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_11.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/the-permission-model-myth/zh/image_11.png" alt="" class="article-image" width="1080" height="583" />
</picture>
</p>
<h2 id="zanzibar">Zanzibar</h2>
<p>关于 Zanzibar 的具体介绍本文略过，下面的网址给出了 Zanzibar 的具体介绍。</p>
<p><a href="https://zanzibar.academy/">Zanzibar: A Global Authorization System - Presented by Auth0</a></p>
<p>值得一提的是 Zanzibar 作为一个独立服务，与 Casbin 作为 SDK 的不同点，独立服务有自己的存储来记录关系数据，也需要自己进行缓存、数据更新冲突等问题，Zanzibar 相比于 Casbin 肯定是一个更成熟的方案，但也意味着更多的运维成本，以及和 SDK 相比，对现有系统可能会有更多的兼容性问题。</p>
<h1 id="抽象的难点">抽象的难点</h1>
<p>权限系统没有像TCP/IP这样的通用标准，主要是因为权限管理的需求和实现方式在不同的应用和环境中差异很大。TCP/IP协议是网络通信的基础，为不同类型的网络提供了一个统一的通信标准，其设计目的是为了实现网络间的互连互通。而权限系统则涉及到更多层面的因素，包括但不限于业务逻辑、组织结构、安全要求等，这些因素在不同的应用场景中会有很大的不同。下面列出了几个为什么权限系统难以有通用标准的原因：</p>
<ol>
<li><strong>多样性的业务需求</strong>：不同类型的应用有着不同的业务模型和安全需求。例如，金融行业的权限管理系统需要考虑到复杂的合规性和审计要求，而社交媒体平台的权限系统可能更关注用户隐私和内容管理。这种多样性使得难以制定一个覆盖所有场景的统一标准。</li>
<li><strong>组织结构差异</strong>：不同组织的结构、政策和管理流程也会影响权限管理的实现。大型企业可能需要一个复杂的角色层次和细粒度的权限控制，而小型团队可能只需要一个简单的权限模型。</li>
<li><strong>技术发展迅速</strong>：IT技术（包括软件开发框架、数据库技术、云服务等）的快速发展意味着新的权限管理方法和工具不断出现，这使得难以维持一个长期有效的统一标准。</li>
<li><strong>安全性和灵活性的平衡</strong>：权限系统需要在安全性和灵活性之间找到平衡。不同的应用场景可能对这两者的重视程度不同，导致采用不同的权限管理策略。</li>
<li><strong>标准化的难度</strong>：虽然有些权限管理的概念（如基于角色的访问控制RBAC）被广泛接受和使用，但将这些概念扩展到一个通用的、覆盖所有可能用例的标准是非常困难的。尝试制定这样的标准可能会导致过于复杂和笨重，难以适应快速变化的技术和业务需求。</li>
</ol>
<p>因此，虽然在某些方面（如认证和加密技术）可以有一定程度的标准化，权限管理系统的具体实现往往需要根据特定的应用场景和需求来定制。</p>
<h2 id="拓展-零信任网络模型">拓展：零信任网络模型</h2>
<p>零信任网络模型更偏向于身份认知（即 AuthN）的内容，但是其许多思想与 AuthZ 的设计息息相关，因此本文最后罗列一下零信任网络模型的知识：</p>
<p>零信任（Zero Trust）是一种网络安全模型，其核心原则是“永不信任，始终验证”。这种模型要求对所有试图访问网络资源的用户和设备进行严格的身份验证，无论它们位于网络的内部还是外部。零信任模型的出发点是不再假设网络内部是安全的，而是认为威胁可能来自任何地方，因此需要对每个访问请求进行验证和授权。</p>
<p>零信任模型的核心原则包括：</p>
<ol>
<li><strong>最小权限原则</strong>：用户和设备仅获得完成其任务所需的最小权限，限制对敏感信息和系统的访问。</li>
<li><strong>持续验证</strong>：系统持续监控和验证用户和设备的信任状态，任何时候都不会假定它们是安全的。</li>
<li><strong>显式验证</strong>：所有访问尝试都必须进行身份验证和授权，无论用户或设备的位置。</li>
<li><strong>使用多因素认证</strong>（MFA）：增加安全层次，通过要求提供两个或更多证明身份的因素来降低密码泄露的风险。</li>
<li><strong>微分段</strong>：将网络划分为小的、受管理的段，以减少潜在攻击者的移动范围，并限制对敏感数据的访问。</li>
<li><strong>基于风险的适应性策略</strong>：根据用户的行为、设备的安全状态、访问时间和位置等因素，动态调整访问控制策略。</li>
</ol>
]]></content:encoded>
  </item>
  <item>
    <title>最大化 LLM 性能的技术概览</title>
    <link>https://www.yujiachen.com/maximizing-llm-performance/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/maximizing-llm-performance/</guid>
    <pubDate>Sun, 26 Nov 2023 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<blockquote>
<p>注：这里的”性能“原文为”performance”，指 LLM 回答问题的准确率，而不是运行时的计算资源消耗性能。</p>
</blockquote>
<p>原视频来自 OpenAI</p>
<p><a href="https://www.youtube.com/watch?v=ahnGLM-RC1Y">https://www.youtube.com/watch?v=ahnGLM-RC1Y</a></p>
<h1 id="优化-llm-性能的难点">优化 LLM 性能的难点</h1>
<ul>
<li>从各种噪声中找到信号，辨认出问题并不容易。</li>
<li>LLM 的性能评估抽象且难量化。</li>
<li>不知道从何入手解决问题。</li>
</ul>
<h1 id="优化路径">优化路径</h1>
<p>LLM 的优化路径</p>
<ul>
<li>上下文优化，让模型知道更多。</li>
<li>LLM 优化，改变模型的行为和方法。</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_1.png" alt="" class="article-image" width="1080" height="539" />
</picture>
</p>
<p>一般的演化方向</p>
<ol>
<li>Prompt engineering</li>
<li>RAG，类比给 LLM 加上短期记忆，针对具体问题提供具体信息。</li>
<li>Fine-tune model，类比给 LLM 加上长期记忆，让模型持续地遵循某种行为模式或输出结构。</li>
</ol>
<p>拿考试举例子，Fine-tuning 是闭卷考，你需要记住所有知识才能参加考试；RAG 是开卷考，你带着各种参考资料进考场。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_2.png" alt="" class="article-image" width="1080" height="526" />
</picture>
</p>
<h1 id="prompt-engineering">Prompt Engineering</h1>
<p>先用简单的提示词工程尝试解决问题，找到评估基准，判断性能瓶颈是上下文还是模型的行为模式。</p>
<p>当确定基准后，可以在 prompt 里添加 few-shot 示例，看是否可以带来性能提升。</p>
<h2 id="优点">优点</h2>
<ul>
<li>尽快地测试并获得反馈。</li>
<li>结合性能评估，这确定了性能优化的基准线。</li>
</ul>
<h2 id="缺点">缺点</h2>
<ul>
<li>prompt 中引入了新信息。</li>
<li>被上下文窗口限制。</li>
<li>token 使用效率低。</li>
</ul>
<h2 id="最佳实践">最佳实践</h2>
<ul>
<li>编写清晰的指令。</li>
<li>把复杂任务拆分成简单的子任务。</li>
<li>让 LLM 有时间思考，例如 CoT，ReAct。</li>
<li>用控制变量法系统性地测试改动控制变量法。</li>
</ul>
<h2 id="后续步骤">后续步骤</h2>
<ul>
<li>提供参考文本。</li>
<li>接入外部工具。</li>
</ul>
<h1 id="rag">RAG</h1>
<p>先根据问题找到相关的上下文，再要求 LLM 回答。</p>
<h2 id="优点-2">优点</h2>
<ul>
<li>可以不断向 LLM 提供最新的信息。</li>
<li>通过控制参考文本降低幻觉。</li>
</ul>
<h2 id="缺点-2">缺点</h2>
<ul>
<li>提供给 LLM 的信息仅限上下文片段，无法让 LLM 拥有更宽泛的领域知识。</li>
<li>不擅长让 LLM 按照规定格式或特定语言输出结果。</li>
<li>不利于降低 token 使用率。</li>
</ul>
<h2 id="进阶技巧">进阶技巧</h2>
<ul>
<li>用 cosine 计算向量相似度。</li>
<li>HyDE (Hypothetical Document Embedding)，让模型先回答，用回答去搜索上下文。</li>
<li>Fine-tuning embedding 模型。</li>
<li>分片后再进行 embedding。</li>
<li>重排，搜索到上下文后，重新计算和问题的相似程度，或施加一些人工规则，重新排序和剔除上下文。</li>
<li>分类，让模型先判断问题相关的上下文有可能在哪些数据集中找到，之后再进行搜索。</li>
<li>并行计算，把问题拆分成多个子问题，独立计算后合并答案。</li>
</ul>
<h2 id="评估">评估</h2>
<p>RAG 实质上给 LLM 引入了一个新的环节：检索，这也可能成为一个瓶颈。检索结果的质量很重要，如果一些无关、或者低质量的上下文被检索到，LLM 会给出和幻觉无差别的低质量回答。</p>
<p><a href="https://github.com/explodinggradients/ragas">https://github.com/explodinggradients/ragas</a></p>
<p>这里介绍了 Ragas 用来评测 RAG 的表现，评测分为两大类四个维度</p>
<ul>
<li>生成，LLM 回答的质量。
<ul>
<li>Faithfulness，生成回答的真实准确性。</li>
<li>Answer relevancy，生成回答和问题的相关性。</li>
</ul>
</li>
<li>检索，被检索文本和问题的相关性。
<ul>
<li>Context precision，被检索内容的信噪比。</li>
<li>Context recall，能否检索出所有和问题相关的内容。</li>
</ul>
</li>
</ul>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_3.png" alt="" class="article-image" width="1080" height="529" />
</picture>
</p>
<h1 id="fine-tuning">Fine-tuning</h1>
<p>继续在更小、特定领域的数据集上训练，优化特定任务的表现和效率。</p>
<ul>
<li>提高模型在特定任务上的表现。
<ul>
<li>不需要用 prompt 来规范模型的表现；和 few-shot learning 相比，你可以让模型充分学习相关的数据。</li>
</ul>
</li>
<li>提高模型的效率。
<ul>
<li>节省更多的上下文窗口，LLM 处理更快也更节省 token。</li>
<li>可以让小模型在特定任务上达到更多参数模型的表现，而小模型的费用和延时更优。</li>
</ul>
</li>
</ul>
<h2 id="优点-3">优点</h2>
<ul>
<li>强化模型中已有的知识。</li>
<li>自定义回答的结构或语气。</li>
<li>让模型学会复杂的指令，避开复杂的 prompt engineering。</li>
</ul>
<h2 id="缺点-3">缺点</h2>
<ul>
<li>如果 prompt engineering 无法提高模型的表现，那么 fine-tuning 也不行。</li>
<li>无法向基础模型中添加新知识。</li>
<li>无法适应新使用场景。</li>
</ul>
<h2 id="例子">例子</h2>
<p>Canva 使用 fine-tuning 来规范 LLM 的输出格式。</p>
<p>一个博客作者使用 Slack 聊天记录来 fine-tuning LLM，期望 LLM 学会他的语气，但 LLM 实际上学会了他消极怠工的态度，因此高质量的 fine-tuning 数据很重要。</p>
<h2 id="步骤">步骤</h2>
<ol>
<li>准备数据：收集、验证、格式化数据。</li>
<li>训练：选择超参数、损失函数，注意 LLM 的损失函数是 next token prediction 任务的代理，但这和 LLM 负责的下游任务不一定有相关性，比如在代码生成中，你有很多方式来解决一个代码问题，而不需要生成的代码和标准答案完全匹配。</li>
<li>评估：人工评估、LLM 评估。</li>
<li>推理</li>
</ol>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/maximizing-llm-performance/zh/image_4.png" alt="" class="article-image" width="1080" height="608" />
</picture>
</p>
<h2 id="最佳实践-2">最佳实践</h2>
<ul>
<li>先从 prompt engineering 和 few-shot learning 开始，确认 LLM 适合你的使用场景。</li>
<li>确认性能基准，确保 fine-tuning 后的 LLM 表现可衡量可比较。</li>
<li>从小数据集开始，注重数据质量，LLM 的训练过程已经解决了数据量的问题，fine-tuning 要着重注意数据质量。</li>
</ul>
]]></content:encoded>
  </item>
  <item>
    <title>2023 - pivot</title>
    <link>https://www.yujiachen.com/2023-pivot/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2023-pivot/</guid>
    <pubDate>Thu, 21 Sep 2023 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<p>23 年我经历了许多次转变。</p>
<h2 id="回到-2021">回到 2021</h2>
<p>我觉得，22 年和 23 年其实我都在处理 21 年的余波。
21 年发生了很多事情，例如自己带着其他职能一起做了一个项目，让我对自己代码之外的能力开始迷之自信；开始接触 SaaS；各种职场内外的人生际遇……
22 年我换了工作，希望对国内的商业环境、以及 SaaS 行业有更多的了解，努力不脱离预设的轨道。
23 年年中，一篇<a href="https://mp.weixin.qq.com/s/V5rM_pWx9bT1tzsc4c0A9w">《展望与计划 Prospecting vs Planning》</a>，还有 Paul Graham 的 <a href="https://paulgraham.com/greatwork.html">《How to Do Great Work》</a>让我反思规划这件事本身。</p>
<p>删掉了从 21 年记在 TODO 上的待办事项，重新见到了那年有共同经历的人们，回忆了很多好和不好的回忆，马上就是 24 年了，以更轻松的姿态继续这个旅程吧。</p>
<h2 id="感受-而非判断">感受，而非判断</h2>
<p>21 年接触 MBTI 的时候我对其十分厌恶，因为我觉得世界上有这么多人，怎么可以简单地用 16 个分类概括？当时听我这么说的朋友立刻判定我是 J 人，莫名被贴上一个我不知道的标签，更让我对此没有好感。
今年稍稍了解了 J 和 P 的分别，当然我的性格依然不能用 J 人来简单概括，但所谓 “J 人” 的特征让我反思了自身的缺点。我的 MBTI 是 INFJ（在我意识到 J 的问题后，重测一次变成了 INFP 😂），我一贯非常相信自己的直觉，对讨厌的东西往往会一眼看出然后指出其问题，但这种不容忍讨厌东西的性格阻碍了自己探索未知的事物。今年尝试放下对他人的评价，更关注优点，因此接触了原本不会有交集的人，知道了许多原本不会知道的事情。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2023-pivot/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2023-pivot/zh/image_1.png" alt="" class="article-image" width="1080" height="1080" />
</picture>
</p>
<p>另一件让我关注感受的事情是摩托车，我发现如果刻意在意摩托的各个部件，路上的各种路况和交规，那我上路时的大脑负担根本无法让我专心驾驶。相反，把车况和路况放进自己的潜意识，放下担心，才能在路上自如地驾驶，开心骑行。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2023-pivot/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2023-pivot/zh/image_2.png" alt="" class="article-image" width="937" height="937" />
</picture>
</p>
<h2 id="为了他人写作">为了他人写作</h2>
<p>今年开始注意用外部视角看自己，之前在网络上的表达会十分自我，想尽可能多的“宣泄”自己。今年开始注意表达的有效性，是否清晰、有条理、简短，也算是一种审视。
端午节自己写了一个 Go 的开源库，尝试在 Reddit 上推广下，结果被不少人说 useless 😂，一下让我反思自己的“自嗨”倾向。</p>
<p>以及尽可能地专注，12 月中旬北京下雪时，感受到一种宁静，“一次只做一件事也蛮好的”，这样的话出现在自己脑海中。虽然还有很多事情没有做，也很焦虑自己做到又慢又不好，但如果不够专注，啥也做不好呢。
往年自己会认为“做自己会使用的产品，作者与用户平等的产品”才是道德的，曾经我不能接受为了自身利益去利用人性的弱点，对相关的产品也是坚决不接触。随着今年接触了不同行业的人，尝试从他们的角度看待商业，自己接受了这些产品对系统有其自身的价值；并且只要其赚取更多的利润更多，其产生的价值也就越大，我开始避免进行过于武断的道德判断。</p>
<p>随着不断思考“作者与用户平等的产品”，我也意识到某种严格的对称性和对他人的期望其实也是种自恋，“富有同理心的产品”或者“liberal art”这个表述会更好。我希望自己搭建的东西是有温度的，而不是冷冰冰的巨大机器。
24 年，希望有机会探索更多的方向，并做出更贴地的实践。</p>
<h2 id="安利">安利</h2>
<p>今年最喜欢的书是乔帮主的 <a href="#">《Make Something Wonderful》</a>(<a href="https://book.stevejobsarchive.com/">https://book.stevejobsarchive.com/</a>)，最喜欢里面他说到自己从大学辍学，身无分文的那段时间：</p>
<blockquote>
<p>Character is built not in good times, but in bad times; not in a time of plenty, but in a time of adversity.
以及他谈到 Pixar 的新办公楼时，对设计的理解：
But when you decide to design your own building, you have to ask the question, “Who are we?” Because you want to capture some of the soul of the company in the building and reflect who we are.</p>
</blockquote>
]]></content:encoded>
  </item>
  <item>
    <title>【译】如何做出伟大工作</title>
    <link>https://www.yujiachen.com/how-to-do-great-work/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/how-to-do-great-work/</guid>
    <pubDate>Sat, 12 Aug 2023 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p><a href="http://paulgraham.com/greatwork.html">How to Do Great Work</a></p>
<blockquote class="callout callout-note">
<p>💡 DISCLAMER：</p>
<ol>
<li>原文中可以整理为列表的内容我都进行了整理，而没有遵循原文。</li>
<li>把注解融入进了正文。</li>
<li>一些原文有被删除。</li>
<li>自行划分了段落，并添加了标题。</li>
</ol>
</blockquote>
<p>如果你收集了很多不同领域内做出伟大工作的技巧列表，那么这些列表的交集会是什么样子呢？我决定亲自动手制作它来寻找答案。 我部分的目的是制作一份可以供任何领域的工作者使用的指南。但我也对这个交集的形态感到好奇。创作这篇指南的过程表明，这个交集确实有一个明确的形态；它不仅仅是一个被标记为“努力工作”的点。 以下的方法假设你有很大的雄心壮志：</p>
<h1 id="0-总览">0. <strong>总览</strong></h1>
<p>关于伟大工作的定义：伟大工作意味着把重要的事情做得非常出色，从而拓展了人们的想象空间。但请注意“出色”并没有明确的界限，这是一个程度问题，并且在当时难以被判断。因此作者觉得与其担心人们是否觉得某事重要，不如专注在发展自身的兴趣爱好上。只要努力去做一件了不起的事，至于是否成功，就留给后人去评说吧。</p>
<p>做出伟大工作的步骤：</p>
<ol>
<li>选择一个领域。</li>
<li>充分学习以到达这个领域的前沿。</li>
<li>注意到领域中的空缺之处。</li>
<li>选择有潜力的空缺，进行探索。</li>
</ol>
<p>步骤 2 和 4 需要努力工作，其中兴趣是让你超越一般勤奋的关键。三个最有力的动机：好奇心，愉悦，做出令人印象深刻之事的渴望（好胜心）。</p>
<p>关于步骤 1，选择领域的依据：</p>
<ol>
<li>你对此有天生的才华。</li>
<li>你对此深深感兴趣。</li>
<li>它为伟大的工作提供了足够的空间。</li>
</ol>
<p>第 3 点一般无需过于操心，即使是充满野心的人也会保守估计一个领域的潜在发展空间。因此关键是找到你有天分和感兴趣的领域。</p>
<p>确定适合你的领域本身就是一项重要工作。如果你对此还没有明确的想法，那就多尝试。即便是错误也有其价值。犯错误还可以加深你对不同领域的理解，从不同领域的交叉中，往往能够带来重大的发现。</p>
<p>因此，你需要培养进行个人项目的习惯。个人项目并不意味着是他人分派的工作，即便你的项目是某个更大项目的一部分，你也要确保你能够主导自己的项目部分。你应该确保你的项目野心勃勃，并且让你感到激动，项目可以让你激动是最重要的。令人激动的好奇心是伟大工作的动力和方向。</p>
<p>关于步骤 3，寻找缝隙的几个建议：</p>
<ol>
<li>对大多数人习以为常的事情提出质疑。</li>
<li>对质疑做出解答，如果你发现答案有些奇怪，那么这是一件好事。</li>
<li>大胆追逐奇怪想法，特别是人们不关心的那些。如果你的经验足够让你有把握地判断出这些想法被人们小瞧了，那这就是你能找到的最好赌注。</li>
</ol>
<p>最大的奖赏莫过于，从看似完整的知识体系中发现一个空缺，撬开它，里面是一个完整的世界。</p>
<h1 id="1-选择领域">1. <strong>选择领域</strong></h1>
<blockquote>
<p>对步骤 1 的拓展：如何选择一个领域。</p>
</blockquote>
<h2 id="1-1-选择的困境">1.1. 选择的困境</h2>
<p>首先要明白，探索本身有其双刃剑的特性，当你在探索一个领域时，以下四件事情在同时发生：</p>
<ol>
<li>你在一项工作上花费数年时间去了解自己是否喜欢它。</li>
<li>你在一项工作上花费数年时间去了解你是否擅长它。</li>
<li>你放弃了去做其他工作的机会。</li>
<li>你放弃了去了解其他工作的机会。</li>
</ol>
<p>因此，在最坏的情况下：尽管你非常努力地探索，你仍然可能基于不完整的信息做出一个过晚的选择。</p>
<p>进一步扩展上述过程：探索并不是找到当前的你，和当前已知问题中的哪一个更加匹配；而是找到探索完成时的你，和探索完成时的一系列问题中哪个更匹配。因此可供探索的空间是非常巨大的，理论上其等于未来所有可能的工作，加上未来所有可能的你，形成的巨大组合。</p>
<p>既然你没有办法搜索这一整个空间，那你只能依赖某种启发，选择一些看上去有潜力的道路，来探索这个空间，并期望好的匹配结果都聚集在空间中的某一处。当然，很多时候事情并不会这样。</p>
<p>其次，志向也会恶化这个选择问题。有两种志向：一种先于兴趣出现；另一种则是随着你对某物的兴趣增加，而慢慢出现。大多数人的志向是这两种的混合，前一种志向占比越高的人，就越难做出选择。</p>
<p>再者，你要明白大多数国家的教育系统会误导你认为选择是很轻松的事情。他们会期待你在对一个领域真正了解之前就对它做出承诺。因此，那些不按照教育系统预设的轨道行动、走在更优路径上的人，往往会被视为失败者。</p>
<p>因此，在选择探索方向时，教育系统不会给你什么帮助。请记住：要想知道你该做什么，只能靠你自己。</p>
<h2 id="1-2-跟随兴趣">1.2. 跟随兴趣</h2>
<p>选择一个领域很难，但一昧的等待也不会解决问题。你需要采取行动，但这并没有通用的解决方案可以供你遵循。人物传记可能揭示的一个重要因素是运气的作用，你需要使自己成为运气的目标，比如尝试许多事情、结识许多人、阅读许多书籍、提出许多问题。通过广撒网，好奇心强的人更有可能在一开始就找到合适的工作。</p>
<p>在多个选择面前感到困惑时，优先考虑你对哪个更感兴趣。你对一个领域了解越多，就应该越感兴趣，反正，那么这个领域可能并不适合你。并且你需要明白，如果你的兴趣与大多数人不同，这其实是一件好事，奇怪的品味通常表示你有强烈的兴趣，而强烈的兴趣让你在工作上高效。特别是那些别人觉得无聊或可怕的事情，你却觉得它们很有趣。</p>
<p>请记住，你选择的领域并非人，对它们没有必要忠诚。如果你发现你对另一个领域更感兴趣，就不要害怕切换。</p>
<p>当你开始制作某些东西时，确保它们是人们真正需要的，而不是你想象中的受众所需要的。最好的方式是制作你自己想要的东西。遵循“令人兴奋”规则，让你兴奋的东西显然就是你想要的东西。</p>
<p>请注意：如果你认为你的受众不如你成熟或精明世故，那么为他们制作东西是危险的。你可以通过这种方式赚到很多钱，但这不是通往伟大工作的道路。</p>
<p>装腔作势、追随时尚、恐惧、金钱、政治、他人的期待、名誉等都可能使你在寻找目标的路上迷失。但只要你始终保持对真正感兴趣的事物的追求，你就能抵御它们的影响。</p>
<h2 id="1-3-少做计划">1.3. 少做计划</h2>
<p>跟随兴趣并不是一个被动策略，它往往意味着需要克服各种困难，面对被拒绝和失败的风险。因此跟随兴趣需要有一定的勇气和果敢。</p>
<p>但当你需要勇气时，你并不需要制定详细的计划：只需要在令人兴奋的雄心勃勃的项目上努力工作，好的结果自然就会出现。与其详细计划并执行，不如只保持一些关键的因素不变，只要保证你的工作或项目在追求中不会偏离正确的方向即可。</p>
<p>计划只适合对可以提前预见的成就，比如赢得金牌或者富裕。但对于像发明和发现一类的伟大成就，单纯的计划并无法达成。</p>
<p>对大多数想要创造伟大成就的人来说，正确的策略并不是制定过多的计划，而是在每一个阶段都去做看上去最有趣的事情，并能为你的未来提供最佳选项的事情。“顺势而为”，这就是大部分创造伟大成就的人如何实现的。</p>
<h1 id="2-努力工作">2. 努力工作</h1>
<blockquote>
<p>步骤 2 和 4 需要努力工作，本章是对努力工作的进一步说明。</p>
</blockquote>
<p>努力工作总会遇到各种困难，因此如何努力工作也是有技巧的。</p>
<h2 id="2-1-开始工作">2.1. 开始工作</h2>
<ol>
<li>不要工作得太辛苦，这会导致收益递减，对一些最难的工作，一天工作四五个小时就够了。</li>
<li>尽量安排出连续的大块时间来工作。</li>
<li>为了开始工作，你可以欺骗自己任务并没有那么难。这不是你的性格缺陷，而是工作的本质导致的：开始工作需要的能量大于保持工作状态需要的能量。通常我们不能为了做出伟大的工作就欺骗自己，但这是一个罕见的特殊情况，这么做并不算欺骗。</li>
<li>开始一个新项目也是类似的，在开始前故意低估所需的工作量是合理的。年轻人在这方面有优势，他们更乐观，即使他们的乐观有时源于对工作的无知。但在开始工作这件事上，无知有时反而胜过过多的知识。</li>
<li>一旦开始，尽管可能比预期的工作量更大，你也要努力完成它。许多项目中最好的工作往往会在预计的最后阶段出现。</li>
<li>你还可以告诉自己你正在做的事情非常重要，如果这能帮你发现新的东西，那么这就不算是欺骗自己。</li>
</ol>
<h2 id="2-2-重视拖延">2.2. 重视拖延</h2>
<p>拖延有两种：每日工作的拖延和项目上的拖延。项目上的拖延非常危险，如果你一年一年地推迟启动重要的项目，那就是在以年为单位拖延，你会无法完成许多事情。我们往往会高估一天内能做的事情，低估自己花费几年可以做到的事情。那么同理，我们也会高估一天内拖延的严重性，而低估拖延几年的严重性。</p>
<p>每日的拖延可以被及时发现，但你很可能无法发现项目上的拖延。甚至有一种项目上的拖延会伪装成你的每日工作，这是拖延项目危险的原因之一，你太忙了，以至于注意不到自己在拖延。</p>
<p>一个好办法是周期性地停下来，然后问自己：“我是否在做我当前最想完成的工作？”，当你年轻时这个答案可以是“不是”，但随着年龄增大，这个否定的答案就会越危险。</p>
<p>通常你不能直接从你做的事情上获得报酬，特别是在早期。这时有两个选项：</p>
<ol>
<li>通过做类似的事情得到报酬，并期望把两件事推得更近；但记住这是一种妥协。</li>
<li>或者做完全不同的工作获得报酬，并兼职做自己的项目；缺点是你需要争取时间去做自己想做的事。</li>
</ol>
<p>两个方法都可行，也有各自的缺点。</p>
<h2 id="2-3-全情投入">2.3. 全情投入</h2>
<p>为了完成伟大工作，你需要花费大多数人看起来不合理的时间。你不能把这些时间当作你的成本，不然这成本看上去就过高了。你需要找到那些可以让你全情投入的工作。</p>
<p>有些工作可能需要你先花费数年时间在你并不喜欢的事情上，然后才有好的结果，但伟大工作不是这样实现的。要实现伟大工作，持续专注于你真正感兴趣的事情上。当你停下来回顾，你会惊讶自己已经走了这么远。</p>
<p>我们会惊讶，是因为我们低估了工作的累积效应。这就是全情投入的关键：持续。做大事的人不会每天都做很多事，但他们每天都会完成一些事情，而不是无所事事。</p>
<p>如果你做的工作具有复利效应，那你会获得指数级别的增长。大多数人无意识完成了复利积累，但这值得我们停下来思考一些什么工作具备这样的特性。例如，学习是一个例子，你对某个东西了解得越多，学习的速度就越快；粉丝群体的增长也是一个例子，你的粉丝越多，他们就会为你吸引更多的新粉丝。</p>
<p>指数增长的问题在于，它在开始时的增长感觉很平缓，即使它未来的增长会呈指数级别，但我们并不能直观地感受到这一点，这导致我们在早期会低估它。</p>
<p>指数增长的事物是如此有价值，它们值得我们付出非凡的努力去启动。但由于我们在早期会低估指数增长，这种指数增长的启动通常是无意识完成的：有的人是因为知道学习新东西总需要最初的努力；有的人则是因为别无他法。如果人们能意识到指数增长值得投资，那么会有更多的人这么做。</p>
<h2 id="2-4-走神">2.4. 走神</h2>
<p>工作并不仅仅在你专心致志的时候进行，走路，洗澡，或者躺在床上时，漫无目的的思考也很强大。一些困难在认真解决时十分棘手，但在走神时，你反而会发现解决方案。</p>
<p>不过，你必须以正常的方式努力工作，才能从这种现象中受益。你不能只是走来走去做白日梦。白日梦必须与刻意的工作交织在一起，先从工作中找到问题，再试图从白日梦中找到灵感。</p>
<p>如果你安排得当，你的生活就会自动实现 &quot;专注-放松 &quot;的循环。最完美的安排是你在办公室工作，并步行往返。</p>
<p>每个人都知道在工作的时候要避免分心，但在走神时也同样需要避免分心。往往一个人走神时，会先想到当下最关心的事情。如果走神抢走了你对工作的关心，那这就是分心，避免把思考浪费在分心上。（例外：不要避开让你分心的爱）</p>
<h2 id="2-5-做到最好">2.5. 做到最好</h2>
<p>在你的专业领域中，你需要主动培养自己的品味，只有清楚什么是最好的，以及为什么是最好的，你才能确切地知道自己的目标是什么。</p>
<p>你应该追求做到最好，因为如果你不这么做，你甚至可能达不到好的标准。其原因可能包括以下几点：</p>
<ol>
<li>即使在雄心勃勃追求最好的过程中犯错，你也会错在正确的方向——大部分没能击中目标的炮弹并不是错在瞄准上。</li>
<li>追求成为最好与仅仅追求成为好质量上有着本质的不同。</li>
<li>“做到好”这个目标可能过于模糊。</li>
</ol>
<p>考虑到一些不谙世事的人会不自觉地做出伟大工作，把做到最好的规则扩展到这种情况，那就成了：要么做到最好，要么不做。</p>
<p>同时，追求最好有一种规模效应。虽然你可能觉得尝试做到最好是一项沉重的负担，但实际上你经常会发现自己因此得到了更多。在某种程度上，尝试做到最好甚至比仅仅做到好要简单。</p>
<p>一种设定高目标的方式是去尝试创造一些百年之后人们仍然会关心的事物。因为百年之后仍然被认为是好的事物，更有可能是真正好的事物。</p>
<h2 id="2-6-避免做作">2.6. 避免做作</h2>
<p>做作就是模仿他人。你可能为了模仿出的魅力感到满足，但是这种虚假感往往最终会暴露在你的工作中。</p>
<p>想要成为别人对年轻人是最大的诱惑，但是你无需担心这个问题，只要你致力于一个有足够雄心的项目，这个问题就会自然得到解决。你只需去做，你的身份就会随之形成。</p>
<h2 id="2-7-真诚">2.7. <strong>真诚</strong></h2>
<p>“避免做作”的积极表述就是保持真诚。真诚不仅避免了做作，还让我们远离一系列类似的恶习。</p>
<p>真诚的优势：</p>
<ol>
<li>只有足够真诚，我们才能更加深入地观察到事物的真相，看见更多事实，从而得到更多的新想法。</li>
<li>真诚有助于我们在进行重要工作时，容忍和适应各种变形和扭曲。</li>
</ol>
<p>如何保持真诚：</p>
<ol>
<li>积极地愿意承认自己的错误，一旦你承认错误，你就从错误的负担中解脱出来。</li>
<li>不要在意形式，这样可以让我们更专注于重要的事情，保持儿童般天真无邪的勇敢尽管困难，但却非常重要。</li>
<li>保持乐观，即使这有时可能让你看起来像个傻瓜。如果你想发现新的东西，向人们分享你的想法要远胜于保持沉默。</li>
</ol>
<p>对第一点，承认错误的扩展：有一些不容置疑的信念是没问题的，但这个信念必须是不可证伪的。比如说，“法律应该平等对待每一个人”的原则是安全的，因为句子中的 &quot;应该 &quot;并不是对世界的真实陈述，因此很难被推翻。如果没有证据可以推翻你的某项原则，那么你就不可能为了维护它而忽略任何事实。</p>
<h2 id="2-8-如一">2.8. 如一</h2>
<p>伟大的作品不仅与创作者一致，而且与作品本身一致。这通常都是一脉相承的。因此，如果你在创作过程中面临抉择，不妨问问哪种选择更具有一致性。</p>
<p>下面有几个情景和一致性相关：</p>
<ul>
<li>取舍：去繁化简；</li>
<li>发现；</li>
<li>创造：尝试用最普遍的方法表达自己。</li>
</ul>
<p>你可能会不得不舍弃一些东西，然后重做，想要保持现状和懒惰会让你拒绝重做，为了克服这种情况，不妨问问自己：如果我已经做出了改变，我是否会想要回到当前的状态？要有信心做取舍，不要因为你为之感到自豪、或者因为你在上面花费了太多精力，就把一些不合适的东西留着。</p>
<p>事实上，在一些工作上，将所做事情剥离到本质是有好处的：</p>
<ul>
<li>结果会变得更加集中；</li>
<li>你会对此更加了解；</li>
<li>从事物的本质出发，你很难欺骗自己。</li>
</ul>
<p>关于此还能推导出一个概念：”优雅“，优雅是一个长线投资。相比之下，费力的解决方案往往在短期内更有声望。它们耗费大量精力，而且难以理解，这两点都会给人留下深刻印象，至少是暂时的。</p>
<p>当你发现很难说自己是在创造还是在发现时，这通常是一个好苗头。许多优秀作品看起来不费吹灰之力，某种意义上，它不需要被创造，只需要被看见。如果你要在创造与发现之间做选择，选择发现那一边。想象你只是一个单纯的管道，而思想通过这个管道自然形成。</p>
<p>（奇怪的是，一个例外是你选择要研究的问题。这通常看上去像是搜索，但在最好的情况下，这像是创造什么东西。你在探索的过程中创造了这个领域。）</p>
<p>类似地，当你尝试创造一个强大的工具时，要尽可能地减少对其使用的限制。强大的工具几乎都会被用于你无法预料的方式，所以应当倾向于消除限制，即使你并不清楚这样做的好处是什么。</p>
<p>伟大的工作总是像工具一样，可以被他人用来搭建其他东西。因此当你在创造其他人可以使用的想法，揭露他人可以回答的问题时，这些都是好的信号。好的想法在不同领域都能发挥作用。</p>
<p>如果你用最普遍的方法表达自己的想法，它们会比你想表达的更加真实诚恳。</p>
<h1 id="3-产生想法">3. 产生想法</h1>
<blockquote>
<p>对步骤 3 的扩展：注意到领域中的空缺之处。</p>
</blockquote>
<p>当然，仅有 &quot;真实 &quot;是不够的。伟大的想法必须是真实的、新颖的。即使你已经学到了足够的知识，到达了知识的前沿，也需要一定的能力才能看到新的想法。我们给这种能力取名为原创性、创造力和想象力，我们可能有很多所谓的“技术能力”，但在找到新想法上可能没有太多能力。</p>
<p>很多人或许被误导了，原创性不是一个过程，而是一个习惯。具有独创性思维的人无论专注于什么，都会产生新的想法，就像角磨机产生火花一样。</p>
<p>一些可以帮助你产生”原创性“想法的方式：</p>
<ol>
<li>当你在实际操作某件事，或者尝试理解某个稍显困难的事物时，你更容易产生创新的想法。</li>
<li>将你感兴趣的东西写出来，有些思考和创新想法只能通过将想法写下来才能产生。</li>
<li>改变你的环境，去一个新的地方，甚至只是简单地出去散步都可能激发你的新想法。</li>
<li>广泛涉猎不同的主题，你接触的主题越多，可能产生的新想法也就越多。这样既可以让你从不同角度看问题，也可以把不同主题进行类比。但是，不要把精力均匀分散在所有主题上。对少数几个话题保持专业好奇心，对更多话题保持闲暇好奇心。这有点类似把注意力按照幂律分布。</li>
<li>好奇心和原创性紧密相关，你的问题有多少好奇心，你的回答就有多少原创性。</li>
</ol>
<h2 id="3-1-发现错误观念">3.1. 发现错误观念</h2>
<p>产生新想法通常是一个发现一直就在你眼前的事物的过程。一旦你发现了一个新的想法，它往往显得十分明显。那为什么之前没人想到过这个呢？</p>
<p>当一个主意看上去同时新颖和明显，这可能是一个好想法。</p>
<p>发现显而易见的事情听起来很简单。然而，从经验上来看，产生新想法却很难。这其中的矛盾在于：</p>
<ol>
<li>看见新想法需要你改变看世界的方法。我们通过不同的观念看待世界，这既帮助了我们，也限制了我们。</li>
<li>当你修正了一个错误的观念，新的想法就会显得十分明显。然而，发现并修正错误的观念却很困难。</li>
</ol>
<p>因此，新的想法既显而易见，又难以被发现：只有当你完成一项困难的任务后，这些想法才会显得易于理解。</p>
<p>发现错误观念的一种方法就是比其他人更为严谨。错误的观念会在与现实冲突的地方留下痕迹，但大多数人并不想看到这些痕迹。他们过于依赖现有的观念，以至于无论这些痕迹在事后看起来多么明显，他们都会倾向于忽视它们。</p>
<p>为了发现新想法，你需要主动发现并关注那些错误或者问题的迹象，而不是选择回避。这就是爱因斯坦做到的。他之所以能看到麦克斯韦方程所带来的巨大可能性，更多的是因为他对问题的敏锐觉察和追求严谨，而非仅仅是在寻找新想法。</p>
<p>另一个修复错误观念的方法是敢于打破规则。听起来很矛盾，但如果你想改变你对世界的理解，那么做一个乐于打破规则的人会有所帮助。从旧观念来看，新的观念通常会打破一些隐含的规则。</p>
<p>很少有人理解打破规则的难度，因为新的观念一旦成功，它看起来会比旧的观念更保守。一旦你采用了由他人带来的新观念，这个新观念看起来就显得完全合理。然而，新观念在初次被提出时并非如此，日心说就花费了大半个世纪才被广泛接受，即使是在天文学家中，也是因为它当时看起来太错误了。</p>
<p>实际上，如果你仔细考虑，大多数人认为不好的新想法才可能是好想法，否则别人早就去探索它了。因此，你应该寻找看似疯狂，但可能是正确的想法。如何辨别这些想法呢？这没有确定的方法。往往看起来不好的想法就是不好的，但是看似疯狂却可能是正确的想法通常会让人感到兴奋，因为它们暗含了丰富的含义；而那些仅仅是坏的想法往往让人感到沮丧。</p>
<p>习惯于打破规则有两种方式：</p>
<ol>
<li>积极地独立思考，也就是喜欢打破规则。这类人通常很淘气，规则无法阻止他们；反而，打破规则给了他们额外的能量。</li>
<li>被动地独立思考，也就是对规则漠不关心，甚至可能不知道它们的存在。这就是为什么新手和外来者经常能发现新事物；他们的无知成为了一种被动的独立思考，让他们忽略了某一领域的常识。患有阿斯伯格综合征（社交互动和非语言交流障碍、局限的兴趣和重复的行为）的人也似乎对传统观念有一种免疫性。</li>
</ol>
<p>严谨性和打破规则听起来像是一个奇怪的组合。在大众文化中，它们被视为是对立的，这样观念是错误的。大众文化默认的是，这些问题都是微不足道的，在微不足道的问题上，严谨性和打破规则确实是对立的。但在真正重要的问题上，只有打破规则的人才能做到真正的严谨。</p>
<h2 id="3-2-被低估的想法">3.2. 被低估的想法</h2>
<p>一个被低估的想法往往要被掂量一段时间才会被丢掉。在你的潜意识中，你确实看到了它，但你潜意识中的另一部分却把它否决了，因为它太奇怪、太冒险、太费事、太有争议。这就提出了一个令人兴奋的可能性：如果你能关掉这些潜意识筛选，你就能看到更多的新想法。</p>
<p>方法之一是思考哪些想法适合别人去探索，这样你的潜意识就不会为了保护你免受批评或困难而否定这些想法。</p>
<p>你也可以从另一个方向来发现被忽视的想法：从遮蔽它们的东西入手。每一个被珍视但却错误的原则周围，都有一个由有价值的想法组成的 “死角”，这些想法因为与原则相悖而未被发掘。</p>
<p>宗教是人们所珍视但却错误的原则的集合。因此，任何可以从字面上或隐喻上被描述为宗教的东西，都会在其阴影下蕴藏着宝贵的未被探索的思想。哥白尼和达尔文都有过这样的发现。</p>
<p>你所在的领域中，有哪些原则是人们过于依赖，甚至近乎“信仰”的存在？这些原则真的像人们认为的那样理所当然吗？如果你放弃这些原则，又会怎样？</p>
<h2 id="3-3-被忽视的问题">3.3. 被忽视的问题</h2>
<p>人们在解决问题时展现出的原创性，远高于他们在选择解决哪些问题时所展现的。即使是最聪明的人，在决定研究什么问题时也会出奇地保守。那些从不想变得时髦的人，却会被时髦的问题吸引。</p>
<p>人们在选择问题时比选择解决方案更保守，原因之一是问题的赌注更大。一个问题可能会困扰你数年，而探索一个解决方案可能只需要几天。但我还是觉得人们过于保守，这种保守不仅仅是因为人们在应对风险，而更多地是受流行的影响。冷门的问题被低估了。</p>
<p>最有趣的冷门问题之一是那些被认为已完全探索，但实际上并未完全探索的问题。伟大的工作常常是挖掘已经存在事物的潜力。例如杜勒和瓦特。因此，如果你对别人认为已被挖掘殆尽的领域感兴趣，不要让他们的怀疑阻挡你。人们对此经常是错误的。</p>
<p>在一个冷门问题上工作可以非常愉悦：没有炒作，也无需着急；投机者和批评家都忙于其他地方；现有的工作具有老派的坚实性；此外，培养这些原本会被浪费的冷门想法，给人一种经济上的满足感。</p>
<p>但是，最常见的一种被忽视的问题并不是明显的不合时宜。它只是看起来并不重要，而实际上却很重要。如何发现这些问题？通过自我放纵——追随自己的好奇心，至少暂时抛开你脑中那个说你只应该研究 &quot;重要 &quot;问题的小声音。</p>
<p>你确实需要关注重要问题，但大多数人对重要问题的定义过于保守。如果周围有被忽视的重要问题，它可能已在你的潜意识雷达上。试着问自己：如果你暂停“严肃”的工作，去做有趣的事情，你会选择什么？答案可能比看起来更重要。</p>
<p>选择问题的原创性甚至比解决问题的原创性更重要。这区分了那些能发现全新领域的人。因此，起始阶段容易被忽略的一步——决定研究什么——其实是伟大工作的关键所在。</p>
<h2 id="3-4-先有问-后有答">3.4. 先有问，后有答</h2>
<p>很少有人能理解这一点。人们对新思想最大的误解之一，是其构成中问题与答案的比例。人们认为大创意就是答案，但真正的见解往往在问题中。</p>
<p>我们低估问题的部分原因在于学校使用问题的方式。在学校里，问题往往只是在得到答案之前短暂存在，之后便消失无踪。但真正的好问题远不止于此。一个真正的好问题是一个局部的发现。新物种是如何产生的？使物体坠落地球的力与使行星保持在其轨道上的力是否相同？即使提出这样的问题，你也已经进入了令人兴奋的新领域。</p>
<p>随身携带未解之谜会让人感到不舒服。但是，你带着的问题越多，你就越有可能注意到问题的解决方法，或者更令人兴奋的是，你可能会注意到两个未解之谜是一样的。</p>
<p>有时，你会带着一个问题很久。伟大工作往往来自于你多年前——甚至在你的童年时代——第一次注意到的问题，你就是会情不自禁地思考它。人们常说要保持年轻时的梦想，但保持年轻时的问题同样重要。</p>
<p>试着写下你年轻时疑惑的问题清单，也许是个不错的练习。你可能会发现自己现在有能力为其中的一些问题做些什么。</p>
<p>这也是实际专家与公众心目中专家的一大不同：在公众的想象中，专家总是确定无疑的。但实际上，你对重要问题的困惑越多，你就越有可能成为真正的专家，前提是这些问题是重要的，并且其他人也不了解。</p>
<p>想象一下，在新的想法诞生的前一刻会发生什么。往往一个拥有足够专业知识的人对某个问题产生了困惑。这就意味着，创新性的一部分来自于困惑——来自于混淆！你必须对充满未知的世界充满好奇，勇于面对问题，但你不能因为习惯了疑惑就放弃寻找答案。</p>
<p>一个拓展：原创性和不确定性之间的联系导致了一种奇怪的现象，由于墨守成规的人比独立思考的人更有把握，这往往会让他们在争论中占上风，尽管他们一般都比较愚蠢。“最好的人缺乏信念，而最差的人却充满激情。“</p>
<p>拥有众多尚未解决的问题是一件很棒的事情。这就像富人越来越富，因为获取新问题的最佳方式就是尝试回答现有的问题。问题不仅可以引领我们找到答案，还能引发更多的问题。</p>
<h1 id="4-探索问题">4. 探索问题</h1>
<blockquote>
<p>对步骤 4 的扩展：选择有潜力的空缺，进行探索。</p>
</blockquote>
<p>最好的问题是在回答中成长起来的。你可能在现有的理论体系中发现了一个待解的疑问，然后试着去拉它，它就会变得越来越长。因此，在尝试回答问题之前，不要要求问题明显很大。你很少能预测到这一点。注意到这些疑问本身就已经足够困难了，更不用说去预测你将会揭示出什么样的新东西。</p>
<p>最好是充满好奇心——多尝试去解答一些疑问，看看会发生什么。大事始于小事。大事的最初版本往往只是实验、副项目或会谈，然后发展成更大的事情。所以，要从很多小事做起。</p>
<p>多产的价值常常被低估。你尝试的事物越多，你发现新知识的机会就越大。但请理解，大量尝试也意味着大量的失败。好的想法必然伴随着大量的糟糕想法。</p>
<p>尽管先深入研究已有的知识成果看起来更为谨慎，但直接去尝试将会让你学得更快，也更有趣。当你尝试后再去看已有的成果，你会对其有更深的理解。因此，选择去尝试而非只是学习。当你能从小事开始，这一切就变得更简单了。快速开始和从小事做起，这两个理念就像拼图一样，能完美结合在一起。</p>
<p>如何从小做起，做成大事？答案是：不断迭代。伟大的事物几乎都是通过不断迭代产生的。你从小处着手，不断改进，最终的版本会比你计划中的任何版本都更巧妙和有野心。</p>
<p>当你为人们创造产品时，迭代制作就尤为重要了——快速向人们展示一个初版，然后根据他们的反馈进行改进。</p>
<p>首先，尝试最简单的方法。出乎意料的是，它往往会奏效。如果行不通，这至少可以让你开始尝试。</p>
<p>在任何一个版本中都不要试图加入太多新的元素。有一些例子：</p>
<ol>
<li>有人花费太长时间进行第一个版本的开发（最终效果却并不满意）。</li>
<li>第二系统效应：即第一版成功后，第二版试图引入过多的新功能而导致失败。</li>
</ol>
<p>新项目的早期版本有时会被人们视为玩具并忽视，这其实是一个好兆头。这意味着它已经具备了新创意需要的所有元素，只不过规模还不够大，但这总会随着时间发展而来。这也有利于你面对批评：攻击一个项目是 “玩具”，就好比攻击一个声明是 “不恰当的”。这意味着，再有实质性的批评也无法坚持下去。</p>
<p>与从小事做起、逐步演进的方法相对的是提前详细规划你要做的事。规划通常看起来更为负责任。说出“我们要先做X，然后是Y，最后是Z”听起来比“我们先尝试做X，看看会有什么发生”要来得有条理，但这往往效果不佳。</p>
<p>规划本身并不好。有时它是必要的，但它是必要之恶，是对无情条件的一种回应。你不得不这样做：要么你受到了某些客观条件的限制，而你无法改变这些条件；或者是因为你需要协调很多人的工作。如果你的项目规模不大，且外界条件相对灵活，你就不需要做太多的计划，你的设计反而可以不断发展。</p>
<h2 id="4-1-承担风险">4.1. 承担风险</h2>
<p>承担你能承受的风险。在一个有效市场中，风险与回报成正比，因此不要追求确定性，而要追求高预期价值的赌注。如果你不是偶尔失败，那可能是你太保守了。</p>
<p>虽然保守主义通常与老年人联系在一起，但年轻人才容易犯这种错误。经验不足让他们惧怕风险，但正是年轻的时候最能承受风险。</p>
<p>即使是失败的项目，也可能是有价值的。在项目进行的过程中，你会越过很少有人见过的领域，遇到很少有人问过的问题。而问题的最佳来源，可能莫过于你在尝试做一件稍显困难的事情时遇到的情况。</p>
<h2 id="4-2-年轻人的优势">4.2. 年轻人的优势</h2>
<p>当你年轻时，要充分利用年轻的优势，而当你年长了，也可以运用年长者的优势。年轻人的优势在于活力、时间、乐观和自由，而年长者的优势则体现在知识、效率、财富和权力。努力可以让你在年轻时获得年长者的优势，也可以让你在年长时保持年轻人的优势。</p>
<p>年长者的另一个优势是清楚了解自己具有哪些优势，而年轻人则常常未意识到这些。在这其中最大的优势可能是时间。将时间转化为优势的最好办法，就是以一种略微轻浮的方式来使用时间：出于好奇去了解一些你不需要了解的东西；或者尝试建造一些东西，只是因为这样做很酷；或者在某些方面变得异常出色。</p>
<p>在“以一种略微轻浮的方式来使用时间”这句话中，&quot;略微&quot;是一个重要的限定词。在年轻的时候轻浮地使用时间，并不代表简单地浪费它。做一些可能是浪费时间的事情，和做一些你肯定是浪费时间的事情，其实是有很大区别的。前者至少是一个赌注，甚至可能更好。</p>
<p>通过问一问自己是在创造还是在消费，你可以判断当前是否在浪费时间。比如，编写电脑游戏比玩电脑游戏更有价值，而在玩游戏的过程中创造一些东西，比仅仅玩游戏更有价值。</p>
<p>年轻，或者更准确地说，缺乏经验，最微妙的优势在于你能以全新的眼光看待一切。当你的大脑第一次接受一个想法时，有时两者并不能完美地结合在一起。通常问题出在你的大脑上，但偶尔也会出在想法上。这个想法中可能有一部分不太合理，而习惯了这个想法的人可能已经学会了忽略这个问题，但是你有机会不去忽视它。</p>
<p>另一个相关的优势是，如果你还没有公开发表任何观点，你就不会倾向于支持你之前的观点。只要你足够真诚，你就可以在这方面保持初心，但很少有人能做到这一点。</p>
<p>因此，当你第一次学习某样东西时，要注意那些看起来不对或遗漏的地方。你会很想忽略它们，因为有 99% 的可能问题出在你自己身上。为了继续学习，你可能不得不暂时放下你的疑虑。但不要忘记它们。当你深入研究这个主题后，回来看看它们是否还在。如果你现有的知识仍然不能解决这些疑虑，那么它们很可能代表了一种未被发现的想法。</p>
<h2 id="4-3-清除错误观念">4.3. 清除错误观念</h2>
<p>从经验中获得的最有价值的知识之一，就是知道什么是不用担心的。年轻人知道所有可能重要的事情，但不知道它们的相对重要性。因此，他们对所有事情都同样担心，而他们应该对少数几件事情担心得更多，对其他事情则几乎不担心。</p>
<p>但是，你不知道的事情只是缺乏经验问题的一半。另一半问题是你知道的事情并非如此。成年后，你的脑袋里装满了错误观念——你养成的坏习惯和别人教给你的错误的东西——要想做出伟大的工作，你需要清除这些错误的观念，至少是清除那些和你想要从事工作相关的错误观念。</p>
<p>大多数的错误观念是学校留给我们的。潜意识上我们习惯于把上学和学习等同起来，然而学校有许多奇怪的特性，这些特性可能会扭曲我们对学习和思考的理解。</p>
<p>比如：</p>
<ol>
<li>学校诱导被动。从你小时候开始，就有一个权威在教室前面告诉你们要学什么，然后衡量你们是否做到了。但无论是上课还是考试，都不是学习的本质；它们只是学校通常设计方式的产物。越早克服这种被动性越好。如果你还在上学，试着把你的学生生涯看作你的个人项目，你的老师是为你服务的，而不是相反。这似乎有点夸张，但这不仅仅是一个奇怪的思想实验。在经济上，这是事实；在最好的情况下，在理智上也是事实。最好的老师并不想成为你的老板。他们更希望你勇往直前，把他们当作建议的来源，而不是被他们牵着鼻子走。</li>
<li>学校也会让你对工作产生误解。在学校里，他们会告诉你问题是什么，而这些问题几乎总是可以用你目前所学到的知识来解决。而在现实生活中，你必须找出问题所在，而且往往根本不知道问题是否可以解决。</li>
<li>但学校对你做的最糟糕的事情，也许就是训练你通过破解考试来取胜。这样做是做不成大事的。你无法欺骗上帝。不要再寻找这种捷径了。真正打破现有规则的方式是专注于那些被忽视的问题和解决方案，而不是敷衍了事。</li>
</ol>
<p>除了学校带来的错误观念，还有一些错误观念也应该被避免：</p>
<p>不要认为你需要依赖某些“关键人物”来给你一个“重大突破”。即便这种可能性存在，获得这个突破的最好办法仍然是专注于出色的工作，而不是追逐有影响力的人。</p>
<p>不把评审团的拒绝放心上。给面试官和评奖委员会留下印象深刻的品质，与做出杰出工作所需要的品质往往是不同的。评审团的决定只有在它们构成反馈系统的一部分时才有意义，而这种情况十分罕见。</p>
<h2 id="4-4-抄袭">4.4. 抄袭</h2>
<p>进入一个新领域的人常常会抄袭现有工作，这本质上没有错，因为尝试复现是了解其工作原理的最佳途径。原创并不意味着完全避免旧思想，而在于有没有新想法。</p>
<p>抄袭有好与坏之分。如果要抄袭，请公开而不是秘密或下意识地进行，以免自己盲目跟随别人。如果你做得够好，抄袭会是使你领先他人的优势，而不是落后于他人的劣势。</p>
<p>很多领域的早期工作都是基于他人的，这是不可避免的。在他人的工作上开展工作，会被看作缺乏独创性，在自己的工作上开展则不会，但其实这两者没有结构性上的不同。有时，最新颖的想法一开始看起来缺乏原创性，就连发明者都说这是已有事物的变体，因为对新发现的概念词汇还未形成。</p>
<p>一种最强大的抄袭是把一个领域的东西拷贝到另一个领域。历史上充满了这种偶然的发现，所以特意学习一些其他领域是值得的。如果你擅长象征和比喻，可以从一个毫不相干的领域获取灵感。</p>
<p>抄袭确实存在风险，如盲目复制过时的内容。模仿时不要复制每个特点，特别是那些今天看起来荒谬的。一些你欣赏的特点可能是缺陷，最容易模仿的特点可能正是缺陷。</p>
<p>当你模仿他人行为的时候，这个道理就更对了。一些有天赋的人同时也是混蛋，有时未经世事的人会觉得成为混蛋是成为天才的一部分。这不是，天才只是他们没有受到惩罚的原因。</p>
<p>负面示例同样有启示作用，有时候从失败中学到的更多，缺失时你可能才会意识到某些东西的必要性。</p>
<h2 id="4-5-同伴">4.5. 同伴</h2>
<p>如果你所在领域有许多优秀的人都聚集在一个地方，那么去那个地方参观一段时间通常是一个好想法。这会增加你的雄心壮志，同时你发现他们也是普通人，你的自信也会增加。</p>
<p>作者故意将“一个地方”模糊表述，暗示这个地方可以是任何有优秀人士聚集的地方，不仅限于物理空间。在本文成文时，物理空间的优势难以被复制，但未来这点可能会改变。</p>
<p>如果你足够真诚，你会得到比你预期更热烈的欢迎。大多数擅长某事的人会很乐意与真正感兴趣的人谈论。他们可能把自己的工作视为一种爱好，而爱好者总是喜欢与人分享自己的兴趣。</p>
<p>但是，要找到真正擅长的人你需要付出一些努力。伟大工作的声望之高，有时会在某些地方，特别是大学里，会让你产生一种每个人都在从事它的幻觉。这种情况并非真实。大学内部的人不会公开评论，但不同院系的工作质量有着极大的差异。有的院系有人正在做出伟大工作；有的院系曾经有过；有的院系则从未有人取得过卓越成就。</p>
<p>找到最好的同伴。有很多项目无法一个人完成，即使你做的项目可以一个人完成，有其他人来鼓励你，和你意见碰撞也是好事。</p>
<p>同伴不仅影响你的工作；他们还会影响你。所以和你想成为的人一起工作，因为你最终会成为他们。</p>
<p>在同伴中，质量比数量更重要。与其拥有一大堆不错的同伴，不如有一两个卓越的同伴。事实上，这不仅仅是更好，而是非常必要。从历史上看：伟大工作往往发生在一些特定的群体，这暗示你身边的同伴常常决定你能否做出伟大工作。</p>
<p>你如何知道你身边有足够好的同伴呢？根据我的经验，当你身边有了足够好的同伴，你自然就知道了。这也就意味着，如果你不确定，这就代表你大概率没有。但我会尝试着给出一个更明确的回答：足够好的同伴会提供让你惊讶的观点。他们可以看见你看不到的东西，做到你完不成的事情。如果你有一些同伴足以让你时刻保持警觉和最佳状态，那你大概已经有足够好的同伴了。</p>
<p>我们中的大多数可以从与他人合作中受益，但一些项目需要大量的人力，一些人并不适合做这件事。如果你需要进行大量人力的项目，你大概率会变成一个管理者，并且管理像其他类型的工作一样，需要天赋和兴趣。如果你没有天赋和兴趣，那么这是一个二选一的问题：你要么强迫你自己学习管理，直到管理成为了你的第二语言；要么避免这样的项目。</p>
<p>当人们可以做的事情非常有限时，大量人力的项目可以不需要管理，比如 SETI@home （一项利用全球联网的计算机共同搜寻地外文明(SETI)的科学实验计划）和比特币。这一类工作通过严格的协议和更自由的节点操作，扩大了领域规模。</p>
<h2 id="4-6-士气-i">4.6. 士气 I</h2>
<p>注重你的士气。当你在开展一个野心勃勃的项目时，士气是一切的基础。你需要像对待一个生命一样，培养和保护它。</p>
<p>士气始于你的人生观。如果你是一个乐天派，那么你更可能做出伟大工作；如果你觉得自己很幸运，而不是觉得自己是一个受害者，那么你也更可能做出伟大工作。</p>
<p>实际上，工作一定程度可以保护你，让你不受个人问题的打扰。如果你选择的工作很纯粹，它的难题会是你每日生活难题的避难所。如果说这是逃避主义，那这也是逃避主义具有生产力的一面，这也是被历史上许多伟大思想使用的逃避主义。</p>
<p>高昂的士气助你做好工作，好的工作成果又反馈提振士气。这是一个正向循环。但反之亦然，工作不佳会打击士气，进一步影响工作。当你遇挫时，转向更简单的工作也是策略之一，它能助你重新找到成就感。</p>
<p>雄心勃勃的人会犯下的最大错误之一就是让一次挫折摧毁他所有的士气，就像扎破气球一样。给自己打预防针，把挫折当作进展的一部分。解决困难的问题总是会有挫折的。</p>
<p>做伟大工作是一种深度优先搜索，其根节点是 “渴望”。因此，&quot;如果一开始没有成功，那就尝试，再尝试 &quot;并不完全正确。应该是 如果一开始没有成功，要么再试一次，要么倒回去再试一次。</p>
<p>&quot;永不言弃 &quot;也不太对。很明显，有时放弃是正确的选择。更准确的说法应该是：永远不要让挫折让你惊慌失措，使你不得不走回头路。进一步说：即使放弃一个节点，也不要放弃搜索的根结点，不要放弃你的渴望。</p>
<p>如果工作很吃力，并不一定是坏兆头，就像跑步时气喘吁吁也不是坏兆头一样。这取决于你跑得有多快。因此，要学会区分好的疼痛和坏的疼痛。好的疼痛是努力的表现，坏的疼痛是受损的表现。</p>
<h2 id="4-7-士气-ii">4.7. 士气 II</h2>
<p>受众是保持士气的关键。无论是学者的同行，还是艺术界的观众，受众不必太多。因为受众的价值并不完全随其数量增加。这对名人来说可能不是好消息，但对初出茅庐的人来说，意味着有一个小而忠实的受众就可以支撑你前行。只要有一小部分人真心支持你，那就已经足够。</p>
<p>尽量减少与受众之间的中间环节。虽然某些工作中这是无法避免的，但如果能够直接与受众交流会给你带来更大的自由。例如，如果你可以创造某种避免中间人、直接与受众互动的方式，那肯定是个好选择。</p>
<p>与你共度时光的人对你的士气也有很大影响。有的人能带给你正能量，有的则相反。你需要聚集那些给你带来正能量的人，并远离那些消耗你能量的人。但如果有人需要你照顾，那自然是首要任务。</p>
<p>选择一个理解和支持你工作的伴侣是非常重要的。如果你充满雄心壮志，工作对你来说就像是必需品。所以，选择一个不能支持你工作的伴侣，无异于是选择了一个不真正了解或关心你的人。</p>
<p>身体健康对于士气也至关重要。你需要通过身体来思考和工作，所以保持身体健康是基础。定期锻炼、合理饮食、良好的作息以及远离有害药物都很重要。尤其是跑步和散步，不仅有助于锻炼，还利于思考。固定的锻炼路线可以帮助你更集中地思考。</p>
<p>做出伟大工作的人不一定比其他人更幸福，但他们至少比那些没有尝试的人更幸福。对于那些聪明且雄心壮志的人来说，不努力尝试是一种危险，因为那会让他们逐渐变得痛苦和失望。</p>
<h2 id="4-8-指标">4.8. 指标</h2>
<p>有一些指标可以用来评价你的工作：</p>
<ol>
<li>你所尊重的人的评价。向别人展示自己的能力是可以的，但要选择对的人。你尊重的人的评价是信号。而名声，即更大群体的评价，你可能会尊重，也可能不会，但它只会带来更多的噪音。</li>
<li>工作的声望。一种工作的声望在最好的情况下也只是一个滞后指标，有时甚至是完全错误的。如果你把任何事情做得非常好，你就可以使其变得有声望。因此，对于一个工种的问题不是它有多大的声望，而是它可以做得多好。</li>
<li>竞争。竞争可以是一种强大的动力，但不要让它决定你的目标；不要因为看到别人在追求某些东西就盲目跟随。实际上，除了更努力之外，不要让竞争者决定你要做的具体事情。</li>
<li>好奇心。好奇心是最佳的向导。你的好奇心永远不会误导你，并且它比你更知道哪些事情值得关注。</li>
</ol>
<h1 id="5-结尾">5. 结尾</h1>
<p>注意“好奇心”这个词在本文中的出现频率。如果你向一位先知询问做出伟大工作的秘诀，并且他只用一个词回答你，我敢肯定，他会说“好奇心”。</p>
<p>这并不意味着可以直接被当作建议。仅仅拥有好奇心是不足够的，你也不能强迫自己或他人产生好奇心。但你可以去培养它，让它成为你的动力。</p>
<p>好奇心是做出伟大工作的四个关键步骤的核心：它会帮你找到你的兴趣领域；引领你到达该领域的前沿；帮你发现其中的空缺；并激发你去深入探究。整个过程可以被视为与好奇心的一场舞蹈。</p>
<p>不管你信不信，我真的尽力让这篇文章变得简短。但它的长度至少起到了筛选的作用。如果你走到现在这一步，你一定对做出伟大的工作充满兴趣。而如果真的如此，你已经走得比你可能意识到的更远了，因为真正想要这样做的人实际上并不多。</p>
<p>完成伟大工作的关键因素包括：能力、兴趣、努力和运气。运气是你无法控制的，所以我们可以不考虑它。如果你真的想完成伟大的工作，那么你肯定会付出相应的努力。因此，问题的核心是能力与兴趣。你能找到一个能够让你的能力和兴趣结合并产生海量新想法的工作领域吗？</p>
<p>对此，我们有乐观的理由。有很多不同的方式可以完成伟大的工作，还有更多的方法尚待发掘。在所有这些不同类型的工作中，你最适合的那种可能与你的特质有着夸张地、超出预期的吻合。关键是能否找到它，以及你的能力和兴趣能让你在这个领域走多远。而这个问题，只有通过实践才能得到答案。</p>
<p>想要完成伟大工作的人，远超于真正付诸实践的人。阻碍他们前进的，是他们的谦逊与恐惧。试图成为下一个牛顿或莎士比亚，听起来似乎过于傲慢，且困难重重。如果你决意如此尝试，可能会面临失败。事实上，很少有人会明确地思考是否应该追求伟大的工作，大多数人是在潜意识中回避这个问题。</p>
<p>因此，我要提醒你一下：你真的想要做伟大的工作吗？现在，你需要明确地做出选择。对不起让你面临这种选择，但我们都知道，你已经产生了兴趣。</p>
<p>不要因为怕被视为傲慢而犹豫。你不必向任何人宣告你的抱负。即使事情变得异常艰难，甚至以失败告终，又有何妨？有很多人面临着比这更为严重的问题。事实上，如果这是你遇到的最大问题，那么你已经很幸运了。</p>
<p>的确，你需要付出极大的努力。但许多人都在为他们的目标而努力。如果你正在做的事情真的让你兴趣盎然，那么相比于许多同龄人的日常工作，你的任务或许会显得更为有趣，甚至更轻松。</p>
<p>那些伟大的发现就在那里，等待着有人去探索、去挖掘。为何那个人不能是你呢？</p>
]]></content:encoded>
  </item>
  <item>
    <title>Golang 泛型</title>
    <link>https://www.yujiachen.com/golang-generics/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/golang-generics/zh/</guid>
    <pubDate>Fri, 26 May 2023 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>泛型是一种编程范式，允许在编写代码时使用通用的类型，从而提高代码的复用性和灵活性。在许多编程语言（如 Java、C++ 和 C#）中，泛型已经成为一种非常重要的特性，使得开发者能够编写更加通用、灵活且类型安全的代码。然而，Go 语言在最初的设计中并没有包含泛型特性，这导致了一些局限性和不便。随着 Go 语言的发展，为了使其更加完善，并满足开发者在实际工作中的需求，Go 语言社区逐渐引入了泛型特性。通过引入泛型，Go 语言能够实现更加通用的数据结构和函数，从而提高开发效率和代码质量。</p>
<p>举个例子：</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;golang.org/x/exp/constraints&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GMin</span>[<span class="hljs-title">T</span> <span class="hljs-title">constraints</span>.<span class="hljs-title">Ordered</span>]<span class="hljs-params">(x, y T)</span></span> T {
    <span class="hljs-keyword">if</span> x &lt; y {
        <span class="hljs-keyword">return</span> x
    }
    <span class="hljs-keyword">return</span> y
}

</code></pre>
<p>不过 Go 泛型和其他语言的泛型略有不同，本文从 Go 的类型参数提案出发，结合实现代码和示例，说明 Go 泛型的一些特性，期望可以达到让大家在工作中更好更高效使用泛型的目的。</p>
<blockquote>
<p>主要参考：<a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md</a></p>
</blockquote>
<h1 id="名词解释">名词解释</h1>
<ul>
<li>parameter，也被称作形参，指函数定义时指定需要传入的参数，实际上是一个占位符，没有真实值，例如 <code>func Add(a, b int) int</code> 中的 <code>a</code> 和 <code>b</code> 。下文用类型参数指代，例如 <code>func Add[T any](a, b T) T</code> 中的 <code>T</code> 就是 type parameter 类型参数。</li>
<li>argument，也被称作实参，指函数被调用时实际传入的参数，是一个真实值，例如 <code>sum := Add[int](a, 2)</code> 中的 <code>a</code> 和 <code>2</code>，此示例中 <code>a</code> 是一个命名变量或常量，2 是一个未命名常量。下文用类型实参，例子中 <code>Add[int]</code> 中的 <code>int</code> 就是 type argument 类型实参。</li>
<li>function，指 Golang 中的函数，如 <code>func Add(a, b int) int</code>。<a href="https://go.dev/ref/spec#Function_types">https://go.dev/ref/spec#Function_types</a></li>
<li>method，指 Golang 中结构体的方法，如 <code>func (s *Struct) Get() string</code>。<a href="https://go.dev/ref/spec#Method_declarations">https://go.dev/ref/spec#Method_declarations</a></li>
<li>operation，可以理解为 Golang 中内置类型支持的运算符（见下），Go spec 中使用 operator 这个名词。<a href="https://go.dev/ref/spec#Operators">https://go.dev/ref/spec#Operators</a></li>
</ul>
<pre class="hljs"><code>Expression = UnaryExpr | Expression binary_op Expression .
UnaryExpr  = PrimaryExpr | unary_op UnaryExpr .

binary_op  = &quot;||&quot; | &quot;&amp;&amp;&quot; | rel_op | add_op | mul_op .
rel_op     = &quot;==&quot; | &quot;!=&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; .
add_op     = &quot;+&quot; | &quot;-&quot; | &quot;|&quot; | &quot;^&quot; .
mul_op     = &quot;*&quot; | &quot;/&quot; | &quot;%&quot; | &quot;&lt;&lt;&quot; | &quot;&gt;&gt;&quot; | &quot;&amp;&quot; | &quot;&amp;^&quot; .

unary_op   = &quot;+&quot; | &quot;-&quot; | &quot;!&quot; | &quot;^&quot; | &quot;*&quot; | &quot;&amp;&quot; | &quot;&lt;-&quot; .

</code></pre>
<h1 id="总览">总览</h1>
<p>Go 类型参数提案归纳了 Go 类型参数的几个要点（<a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#summary%EF%BC%89%EF%BC%9A">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#summary）：</a></p>
<ul>
<li>函数和类型可以有类型参数，类型参数由类型约束定义，类型约束的类型为 interface。(注意，这里没有提及方法，也就是说方法不可以有类型参数）</li>
<li>类型约束描述了 type argument，即传入的实参需要实现的方法，和允许传入实参的类型。</li>
<li>类型约束描述了 type parameter，即定义的形参支持的方法和运算符。</li>
<li>当调用支持类型参数的函数时，类型推断有时可以推断出类型实参，此时不需要显示传入类型实参。（即调用 <code>func Add[T any](a, b T) T</code>时，我们通常可以直接使用<code>sum := Add(a, 2)</code>，而不需要使用<code>sum := Add[int](a, 2)</code>。</li>
</ul>
<p>接下来我们从这几个角度来说明 Go 泛型的设计和使用：</p>
<ul>
<li>类型约束的具体定义</li>
<li>类型推断是如何实现的</li>
<li>一些其他相关知识点</li>
<li>一些类型推断的代码节选</li>
</ul>
<h1 id="类型约束">类型约束</h1>
<p>Go 类型约束可以看作是类型参数的“类型” ，例如下面的例子中，<code>T</code>是类型参数，而<code>Stringer</code>则是类型约束，即<code>T</code>的类型。</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Stringify</span>[<span class="hljs-title">T</span> <span class="hljs-title">Stringer</span>]<span class="hljs-params">(s []T)</span></span> (ret []<span class="hljs-type">string</span>) {
        <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> s {
                ret = <span class="hljs-built_in">append</span>(ret, v.String())
        }
        <span class="hljs-keyword">return</span> ret
}

</code></pre>
<p>类型约束自身的类型为 interface，在 Go 1.8 之前，interface 是方法的集合，如上面的例子中，<code>Stringer</code>描述了 T 应该是具有<code>func (T) String() string</code>这个方法的类型。但如果 interface 只能作为方法的集合，下面的函数则无法实现：</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span>[<span class="hljs-title">T</span> <span class="hljs-title">constraints</span>.<span class="hljs-title">Integer</span>]<span class="hljs-params">(a, b T)</span></span> T {
        <span class="hljs-keyword">return</span> a + b
}

</code></pre>
<p>试问，<code>constraints.Integer</code>作为一个 interface 如何表述其支持<code>+</code>这个操作呢？实际上 <a href="https://pkg.go.dev/golang.org/x/exp/constraints">constraints</a> 包中的定义如下：</p>
<pre class="hljs"><code><span class="hljs-keyword">type</span> Integer <span class="hljs-keyword">interface</span> {
        Signed | Unsigned
}

<span class="hljs-keyword">type</span> Signed <span class="hljs-keyword">interface</span> {
        ~<span class="hljs-type">int</span> | ~<span class="hljs-type">int8</span> | ~<span class="hljs-type">int16</span> | ~<span class="hljs-type">int32</span> | ~<span class="hljs-type">int64</span>
}

<span class="hljs-keyword">type</span> Unsigned <span class="hljs-keyword">interface</span> {
        ~<span class="hljs-type">uint</span> | ~<span class="hljs-type">uint8</span> | ~<span class="hljs-type">uint16</span> | ~<span class="hljs-type">uint32</span> | ~<span class="hljs-type">uint64</span> | ~<span class="hljs-type">uintptr</span>
}

</code></pre>
<p>可以看到，<code>Integer</code> interface 并没有定义任何方法，这里就涉及到接下来说到的 underlying type。</p>
<h2 id="underlying-type">Underlying type</h2>
<blockquote>
<p>参考：<a href="https://go.dev/ref/spec#Underlying_types">https://go.dev/ref/spec#Underlying_types</a></p>
</blockquote>
<p>范型为了使类型约束的表达更加宽泛，把 interface 的定义从“方法的集合”扩展到了“类型的集合”，两者主要的区别是内置运算符的不同。在 Go 中，<code>&lt;</code>, <code>==</code> 等内置运算符是不支持重置的（Go 本身就没有 override 的概念），只有内置类型可以拥有这些运算符，自定义类型是无法拥有和定义这类运算符的。原先 interface 作为“方法的集合”，无法表达出一个类型是否支持比较相等等内置运算（因为内置运算不能被定义）。为了解决这个问题， Go 引入了 underlying type 并规定凡是 underlying type 支持内置运算符的类型，都能复用其 underlying type 的内置运算。interface 也不仅仅可以用来表达方法集合，而是可以用 ~ underlying type 等语法表示对应的类型集合。</p>
<p>一个类型的 underlying type 的判定规则如下：</p>
<ol>
<li>自身就是underlying type的类型
<ol>
<li>boolean</li>
<li>numeric</li>
<li>string</li>
<li>type literal
<ol>
<li>ArrayType</li>
<li>StructType</li>
<li>PointerType</li>
<li>FunctionType</li>
<li>InterfaceType</li>
<li>SliceType</li>
<li>MapType</li>
<li>ChannelType</li>
</ol>
</li>
</ol>
</li>
<li>不符合以上的情况时，一个类型的underlying type是其被创建时所指向的类型的underlying type。比如：</li>
</ol>
<pre class="hljs"><code><span class="hljs-keyword">type</span> (
    A1 = <span class="hljs-type">string</span>
    A2 = A1
)

</code></pre>
<p>这里A1符合规则1，其underlying type是string，A2符合规则2，其underlying type是string。</p>
<p>回看上面<code>constraints.Integer</code>的定义，其表达的含义是所有 underlying type 为<code>int</code>, <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>uint</code>, <code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code> 或 <code>uintptr</code>的类型集合。而这些类型都支持<code>+</code>操作，故 <code>Add</code>函数可以被定义出。</p>
<h2 id="使用-type-parameter-和直接使用-interface-的区别">使用 type parameter 和直接使用 interface 的区别</h2>
<blockquote>
<p>参考：<a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#values-of-type-parameters-are-not-boxed">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#values-of-type-parameters-are-not-boxed</a></p>
</blockquote>
<p>Go 的泛型由于类型约束的存在，看上去会和 interface 类似，在这里与 interface 的主要不同是相关函数的返回值可以是具体的类型，而不只是 interface 。</p>
<p>用上面的 <code>Add</code> 举例子，删除其类型参数则变成：</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span><span class="hljs-params">(a, b <span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-keyword">interface</span>{} {
        n, _ := a.(<span class="hljs-type">int</span>)
        m, _ := b.(<span class="hljs-type">int</span>)
        <span class="hljs-keyword">return</span> n + m
}

</code></pre>
<p>如果 <code>Add</code>使用上述实现，调用方得到的返回值只能是 <code>interface</code> 或某一个特定的类型，而不能根据调用方的需求返回特定类型。如果返回的是<code>interface</code>，调用方想得到返回值的具体类型，还需要进行拆箱 (unboxing) 操作，如：</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        a, b := <span class="hljs-number">1</span>, <span class="hljs-number">2</span>
        c := Add(a, b)
        d, ok := c.(<span class="hljs-type">int</span>)
        ...
}

</code></pre>
<p>同时，回忆一下 Go 中 interface 实例是如何构造的，一个interface里包含了两个值，代表其指向元素的type和value，构造 interface 实例，即装箱 (boxing) ，这会带来额外的内存开销，泛型可以避免这个内存开销。</p>
<h1 id="类型推断">类型推断</h1>
<p>并不是每次调用支持泛型的函数都需要传入类型参数的，在一些条件下，类型推断可以推断出缺失的类型参数，这个技术被叫做类型推断。注意类型推断并不验证推断出的类型是否能通过编译，该检查在推断结束后进行。</p>
<p>接下来会介绍类型推断的 3 个知识点，并在最后介绍完整的类型推断流程。</p>
<h2 id="类型归一化-type-unification">类型归一化 ( Type unification )</h2>
<blockquote>
<p>参考：<a href="https://go.dev/ref/spec#Type_unification">https://go.dev/ref/spec#Type_unification</a></p>
<p>这个名词我瞎翻译的，ChatGPT 建议翻译这个为“类型统一”</p>
</blockquote>
<h3 id="功能描述">功能描述</h3>
<p><strong>输入</strong></p>
<ol>
<li>映射关系 P -&gt; A，P 代表类型参数，A 代表已知的类型实参。例如 <code>func Add[T any](a, b T) T</code>一个可能的映射关系是 T -&gt; int。</li>
<li>两个类型，这两个类型可以带有类型参数，也可以不带。</li>
</ol>
<p><strong>输出</strong></p>
<ol>
<li>基于已知的映射关系，判断输入的两个类型是否有可能相等。</li>
</ol>
<h3 id="具体操作">具体操作</h3>
<ol>
<li>不带有类型参数的类型，与比较类型必须等价，否则归一失败。
<ol>
<li>两个类型相等自然等价。</li>
<li>如果两个类型是 channel 类型，忽略 channel 方向后类型相等，也可以判定为等价。</li>
<li>如果两个类型的 underlying types 是一致的，那也可以判定为等价。</li>
</ol>
</li>
<li>带有类型参数的类型，在不考虑类型参数的前提下，该类型与比较类型在结构上必须相等，否则归一失败。
<ol>
<li>例如 <code>[]map[T1]T2</code> 和 <code>[]T3</code> 在结构上是一致的，<code>T3</code> 可以被替换成 <code>map[T1]T2</code>，同理 <code>[]map[T1]bool</code> 和 <code>[]map[string]T2</code> 在结构上也是一致的。</li>
<li>例如 <code>[]map[T1]T2</code> 和 <code>int</code>, <code>struct{}</code>, <code>[]struct{}</code> 等类型在结构上不可能一致。</li>
</ol>
</li>
<li>如果匹配成功，且类型带有类型参数，便知道了新的 P’ -&gt; A’ 映射关系，将新的映射关系加入到原有的映射关系中。</li>
</ol>
<h2 id="函数实参类型推断-function-argument-type-inference">函数实参类型推断 ( Function argument type inference )</h2>
<blockquote>
<p>参考：</p>
<ul>
<li><a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#function-argument-type-inference">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#function-argument-type-inference</a></li>
<li><a href="https://go.dev/ref/spec#Function_argument_type_inference">https://go.dev/ref/spec#Function_argument_type_inference</a></li>
</ul>
</blockquote>
<h3 id="功能描述-2">功能描述</h3>
<ol>
<li>在调用有类型参数的函数时，若调用方没有传入类型参数，则根据实参推断出类型参数。</li>
</ol>
<h3 id="具体实现">具体实现</h3>
<ol>
<li>根据调用方传入实参得到一组 <code>(parameter, argument)</code>，即参数到实参的组合。</li>
<li>先忽略 <code>argument</code> 中没有类型的组合，没有类型即为常量，常量有自身的类型推断规则；对有类型的<code>(parameter, argument)</code>组合，对其对应的类型进行类型归一化，并不断更新映射关系 P -&gt; A。</li>
<li>接下来处理常量的<code>(parameter, argument)</code>组合，如果一个组合中<code>parameter</code>对应的类型参数已经在步骤 3 中被推断出来，那么忽略；如果没有，认定常量<code>argument</code>的取值为该常量对应的默认类型，进行类型归一化。</li>
<li>当所有<code>(parameter, argument)</code>都被处理完成后，推断结束，中途若发生处理失败的情况，则推断失败。</li>
</ol>
<p>接下来用一个示例描述上述步骤：</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scale</span>[<span class="hljs-title">Number</span> ~<span class="hljs-title">int64</span>|~<span class="hljs-title">float64</span>|~<span class="hljs-title">complex128</span>]<span class="hljs-params">(v []Number, s Number)</span></span> []Number {
        ...
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">var</span> vector []<span class="hljs-type">float64</span>
        scaledVector := scale(vector, <span class="hljs-number">42</span>)
        ...
}

</code></pre>
<p>函数实参类型推断开始时，得到两个<code>(parameter, argument)</code>组合：</p>
<ol>
<li><code>(v []Number, vector []float64)</code></li>
<li><code>(s Number, 42)</code></li>
</ol>
<p>先对<code>(v []Number, vector []float64)</code>的类型进行类型归一化，得到映射关系<code>Number -&gt; float64</code>。</p>
<p>因为上面已经推断出了映射关系<code>Number -&gt; float64</code>，<code>(s Number, 42)</code>组合就不必进行类型归一化。</p>
<p>如果没有映射关系<code>Number -&gt; float64</code>，<code>(s Number, 42)</code>中 42 的类型会被认定为默认类型 <code>int</code>，那么映射关系则为<code>Number -&gt; int</code>。</p>
<h2 id="约束类型推断-constraint-type-inference">约束类型推断 ( Constraint type inference )</h2>
<blockquote>
<p>参考：<a href="https://go.dev/ref/spec#Constraint_type_inference">https://go.dev/ref/spec#Constraint_type_inference</a></p>
</blockquote>
<h3 id="功能描述-3">功能描述</h3>
<ol>
<li>根据定义的类型参数约束，从一个已知类型参数推导出其他暂时未知的类型参数。</li>
<li>例如有一个函数 <code>func Double[S ~[]E, E constraints.Integer] (s S) S</code> ，这个函数被这样调用 <code>Double([]int{1, 2, 3})</code>，可以从类型约束<code>S ~[]E</code>和<code>S -&gt; []int</code> ，推断出<code>E -&gt; int</code>。</li>
</ol>
<h3 id="具体实现-2">具体实现</h3>
<ol>
<li>遍历所有类型参数
<ol>
<li>如果类型参数已有对应的实参，对两者的 underlying type 进行归一化，如<code>Double</code>的例子中，<code>S</code>的 underlying type 是 <code>[]E</code>，则对<code>[]E</code>和已知实参<code>[]int</code>进行归一化，推断出<code>E -&gt; int</code>。</li>
<li>如果类型参数没有对应的实参，但类型参数的类型约束只有一个类型，那么推断该类型参数对应的实参为约束类型。</li>
</ol>
</li>
<li>在已知的映射关系中，检查是否存在一组 P -&gt; A 和 Q -&gt; B 关系，其中 A 中包含了类型参数 Q，用 B 替换 A 中的 Q。例如<code>func Copy[T any, P *T](value T, dst P)</code>，已知 <code>T -&gt; int</code>，<code>P -&gt; *T</code>，那么可以推断出<code>P -&gt; *int</code>。</li>
<li>重复步骤 2，直到已知的映射关系中再也找不到一个类型参数 P 被某个类型实参 A 包含。</li>
</ol>
<h2 id="类型推断执行步骤">类型推断执行步骤</h2>
<blockquote>
<p>参考：<a href="https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L33">https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L33</a></p>
</blockquote>
<p>根据代码注释我们可以知道具体执行步骤如下：</p>
<ol>
<li>利用类型实参进行函数实参类型推断。</li>
<li>再进行一次约束类型推断。</li>
<li>对剩下无类型实参进行函数实参类型推断。</li>
<li>最后进行一次约束类型推断。</li>
</ol>
<p>举一个例子：</p>
<pre class="hljs"><code><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;golang.org/x/exp/constraints&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Multiple</span>[<span class="hljs-title">S</span> ~[]<span class="hljs-title">E</span>, <span class="hljs-title">E</span>, <span class="hljs-title">X</span> <span class="hljs-title">constraints</span>.<span class="hljs-title">Integer</span>]<span class="hljs-params">(s S, x X)</span></span> S {
        <span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> s {
                s[i] *= x
        }
        <span class="hljs-keyword">return</span> s
}

<span class="hljs-keyword">type</span> IntVector []<span class="hljs-type">int</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        vector := IntVector{<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>}
        vector = Multiple(vector, <span class="hljs-number">3</span>)
        fmt.Printf(<span class="hljs-string">&quot;%s\\n&quot;</span>, vector)
        <span class="hljs-comment">// output: [0, 3, 6, 9, 12]</span>
}

</code></pre>
<p><code>Multiple</code>函数类型推断的步骤如下：</p>
<ol>
<li>对有类型的函数实参进行类型推断，即对<code>(s S, vector IntVector)</code>进行类型推断，得到：<code>S -&gt; IntVector</code>。</li>
<li>进行约束类型推断，<code>S</code>的约束为<code>[]E</code>，<code>IntVector</code>的underlying type 为<code>[]int</code>，则对<code>[]E, []int</code>进行类型归一化，得到<code>E -&gt; int</code>。</li>
<li>对无类型函数实参进行类型推断，即对<code>(x X, 3)</code>进行类型推断，对常量 <code>3</code>取默认值 <code>int</code>，得到<code>X -&gt; int</code>。</li>
<li>再次进行约束类型推断，但因为所有参数类型已知，提前结束。</li>
</ol>
<h1 id="其他">其他</h1>
<p>一些其他相关内容整理</p>
<h2 id="泛型窘境">泛型窘境</h2>
<blockquote>
<p>参考：<a href="https://research.swtch.com/generic">https://research.swtch.com/generic</a></p>
</blockquote>
<p>在一个编程语言中添加泛型，势必会增加下列三方中至少一方的复杂度：</p>
<ul>
<li>程序员，C 语言采用了这种方法，即只支持泛型语法，但编译器和运行时都不考虑泛型带来的问题，如有问题程序员自己排查。</li>
<li>编译，C++ 采用了这种方法，在编译时推断出类型，运行时泛型已不存在，这会增加编译耗时以及增加编译产物的数据大小。</li>
<li>运行时，Java 采用了这种方法，在运行时携带参数的类型信息，这会降低运行时的效率，针对 Java，这也引入了类型擦除问题（有兴趣可自行了解）。</li>
</ul>
<p>由前文可以看出，Go 采取的是增加编译耗时，编译时就推断出了一个方法需要的全部类型信息。</p>
<h2 id="使用-t-而不是-t">使用 [T] 而不是 <code>&lt;T&gt;</code></h2>
<p>相信很多同学对泛型的第一印象都是 C++ 或 Java 中的 <code>&lt;T&gt;</code>语法，<a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#why-not-use-the-syntax-like-c_and-java">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#why-not-use-the-syntax-like-c_and-java</a> 中解释了 <code>&lt;</code>和<code>&gt;</code>两个符号因为也用做比较符号，区分<code>&lt;</code>和<code>&gt;</code>是在表示比较还是类型参数会带来额外的负担，故最后选择了 <code>[T]</code></p>
<h2 id="为何-go-泛型不支持-method">为何 Go 泛型不支持 method？</h2>
<blockquote>
<p>本段说明略跳跃和简短，更详细的说明和示例请参考：<a href="https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#no-parameterized-methods">https://go.googlesource.com/proposal/+/HEAD/design/43651-type-parameters.md#no-parameterized-methods</a></p>
</blockquote>
<p>在 Go 中，结构体可以使用类型参数，但一个结构体的方法是不被允许使用类型参数的，最主要的原因是因为 Go interface 的特性所致。上文有提到，interface 可以表达“方法的集合”，即一个 interface 可以代表所有实现了其定义方法的结构体。假设说 method 支持泛型，那会出现如下的 interface 定义：</p>
<pre class="hljs"><code><span class="hljs-keyword">type</span> Phone <span class="hljs-keyword">interface</span> {
        Call[N PhoneNumber](n N)
        Download[A App](a A)
}

</code></pre>
<p>同时考虑到 Go 的 interface 和结构体之间没有显式的关系定义，即不存在类似<code>struct iPhone extend Phone</code>这样的语法。因此确定一个 interface 下各个方法的类型参数，以及确定一个类型是否符合一个 interface 会需要大量的类型推断，会给带来非常大的工作量和编译损耗。</p>
<h2 id="支持指针方法">支持指针方法</h2>
<p>当我们定义了一个泛型函数 <code>F[T C]</code>，相应类型参数的约束 <code>C</code>定义了一些方法，向这个函数传入类型 <code>c</code>时，如果<code>C</code>中定义的各种方法被定义在了<code>*c</code>类型而不是 <code>c</code>上，此时代码将无法编译。</p>
<p>举一个具体例子：</p>
<pre class="hljs"><code><span class="hljs-keyword">type</span> Setter <span class="hljs-keyword">interface</span> {
        Set(<span class="hljs-type">string</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FromStrings</span>[<span class="hljs-title">T</span> <span class="hljs-title">Setter</span>]<span class="hljs-params">(s []<span class="hljs-type">string</span>)</span></span> []T {
        result := <span class="hljs-built_in">make</span>([]T, <span class="hljs-built_in">len</span>(s))
        <span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> s {
                result[i].Set(v)
        }
        <span class="hljs-keyword">return</span> result
}

<span class="hljs-keyword">type</span> Settable <span class="hljs-type">int</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Settable)</span></span> Set(s <span class="hljs-type">string</span>) {
        i, _ := strconv.Atoi(s) <span class="hljs-comment">// real code should not ignore the error</span>
        *p = Settable(i)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">F</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// INVALID</span>
        nums := FromStrings[Settable]([]<span class="hljs-type">string</span>{<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>})
        <span class="hljs-comment">// Here we want nums to be []Settable{1, 2}.</span>
        ...
}

</code></pre>
<p>上面的例子中，<code>result</code>的类型为<code>[]Settable</code>，而<code>Settable</code>并不支持 <code>Set</code> 方法，支持<code>Set</code>方法的是<code>*Settable</code>，故<code>result[i].Set(v)</code>无法正常调用。</p>
<p>相应的解法如下：</p>
<pre class="hljs"><code><span class="hljs-keyword">type</span> Setter2[B any] <span class="hljs-keyword">interface</span> {
        Set(<span class="hljs-type">string</span>)
        *B <span class="hljs-comment">// non-interface type constraint element</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FromStrings2</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>, <span class="hljs-title">PT</span> <span class="hljs-title">Setter2</span>[<span class="hljs-title">T</span>]]<span class="hljs-params">(s []<span class="hljs-type">string</span>)</span></span> []T {
        result := <span class="hljs-built_in">make</span>([]T, <span class="hljs-built_in">len</span>(s))
        <span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> s {
                <span class="hljs-comment">// The type of &amp;result[i] is *T which is in the type set</span>
                <span class="hljs-comment">// of Setter2, so we can convert it to PT.</span>
                p := PT(&amp;result[i])
                <span class="hljs-comment">// PT has a Set method.</span>
                p.Set(v)
        }
        <span class="hljs-keyword">return</span> result
}

</code></pre>
<p>即在泛型函数中明确区分出类型<code>T</code>和其对应的指针类型 <code>PT</code>，并通过类型约束<code>Setter2[B any]</code>定义其之间的转化关系，调用<code>Set</code>时转换类型，调用成功。</p>
<h2 id="在工作中使用泛型">在工作中使用泛型</h2>
<p>以上，我们从 Go 的类型约束出发，了解了定义泛型函数需要的知识点，并了解了类型推断的关键点，最后我们讨论下在泛型在工作中的应用：</p>
<ul>
<li>容器操作。</li>
<li>通用数据结构。</li>
<li>通用操作逻辑，自己日常维护的代码中有请求数据网关服务的操作，由于数据网关返回的数据是一个固定的结构体，使用相对比较麻烦，自己用泛型对请求和返回进行了封装，使不同数据源返回的数据可以转化为特定的结构体。</li>
</ul>
<p>如果你在工作中有其他的泛型使用方法，或者有其他好用的泛型库推荐，欢迎评论补充 : )</p>
<h1 id="类型推断代码">类型推断代码</h1>
<h2 id="类型归一化">类型归一化</h2>
<blockquote>
<p>参考：<a href="https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/unify.go">https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/unify.go</a></p>
</blockquote>
<p>不断递归判断<code>x, y Type</code>在映射关系<code>p * ifacePair</code>下是否有可能相等，如果发现<code>x</code>或<code>y</code>为没有推断出的类型参数，则匹配并返回相等。</p>
<pre class="hljs"><code><span class="hljs-comment">// nify implements the core unification algorithm which is an</span>
<span class="hljs-comment">// adapted version of Checker.identical. For changes to that</span>
<span class="hljs-comment">// code the corresponding changes should be made here.</span>
<span class="hljs-comment">// Must not be called directly from outside the unifier.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *unifier)</span></span> nify(x, y Type, p *ifacePair) (result <span class="hljs-type">bool</span>) {

        ......

        <span class="hljs-comment">// Cases where at least one of x or y is a type parameter.</span>
        <span class="hljs-keyword">switch</span> i, j := u.x.index(x), u.y.index(y); {
        <span class="hljs-keyword">case</span> i &gt;= <span class="hljs-number">0</span> &amp;&amp; j &gt;= <span class="hljs-number">0</span>:
                <span class="hljs-comment">// both x and y are type parameters</span>
                <span class="hljs-keyword">if</span> u.join(i, j) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
                }
                <span class="hljs-comment">// both x and y have an inferred type - they must match</span>
                <span class="hljs-keyword">return</span> u.nifyEq(u.x.at(i), u.y.at(j), p)

        <span class="hljs-keyword">case</span> i &gt;= <span class="hljs-number">0</span>:
                <span class="hljs-comment">// x is a type parameter, y is not</span>
                <span class="hljs-keyword">if</span> tx := u.x.at(i); tx != <span class="hljs-literal">nil</span> {
                        <span class="hljs-keyword">return</span> u.nifyEq(tx, y, p)
                }
                <span class="hljs-comment">// otherwise, infer type from y</span>
                u.x.set(i, y)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

        <span class="hljs-keyword">case</span> j &gt;= <span class="hljs-number">0</span>:

                ......

        }

        ......

        <span class="hljs-keyword">switch</span> x := x.(<span class="hljs-keyword">type</span>) {

        ......

        <span class="hljs-keyword">case</span> *Slice:
                <span class="hljs-comment">// Two slice types are identical if they have identical element types.</span>
                <span class="hljs-keyword">if</span> y, ok := y.(*Slice); ok {
                        <span class="hljs-keyword">return</span> u.nify(x.elem, y.elem, p)
                }

        <span class="hljs-keyword">case</span> *Struct:
                <span class="hljs-comment">// Two struct types are identical if they have the same sequence of fields,</span>
                <span class="hljs-comment">// and if corresponding fields have the same names, and identical types,</span>
                <span class="hljs-comment">// and identical tags. Two embedded fields are considered to have the same</span>
                <span class="hljs-comment">// name. Lower-case field names from different packages are always different.</span>
                <span class="hljs-keyword">if</span> y, ok := y.(*Struct); ok {
                        <span class="hljs-keyword">if</span> x.NumFields() == y.NumFields() {
                                <span class="hljs-keyword">for</span> i, f := <span class="hljs-keyword">range</span> x.fields {
                                        g := y.fields[i]
                                        <span class="hljs-keyword">if</span> f.embedded != g.embedded ||
                                                x.Tag(i) != y.Tag(i) ||
                                                !f.sameId(g.pkg, g.name) ||
                                                !u.nify(f.typ, g.typ, p) {
                                                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
                                        }
                                }
                                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
                        }
                }

        ......

        <span class="hljs-keyword">default</span>:
                <span class="hljs-built_in">panic</span>(sprintf(<span class="hljs-literal">nil</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;u.nify(%s, %s), u.x.tparams = %s&quot;</span>, x, y, u.x.tparams))
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

</code></pre>
<h2 id="函数实参类型推断">函数实参类型推断</h2>
<h3 id="有类型的实参直接归一化">有类型的实参直接归一化</h3>
<blockquote>
<p>参考：<a href="https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L250">https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L250</a></p>
</blockquote>
<pre class="hljs"><code>        <span class="hljs-comment">// indices of the generic parameters with untyped arguments - save for later</span>
        <span class="hljs-keyword">var</span> indices []<span class="hljs-type">int</span>
        <span class="hljs-keyword">for</span> i, arg := <span class="hljs-keyword">range</span> args {
                par := params.At(i)
                <span class="hljs-comment">// If we permit bidirectional unification, this conditional code needs to be</span>
                <span class="hljs-comment">// executed even if par.typ is not parameterized since the argument may be a</span>
                <span class="hljs-comment">// generic function (for which we want to infer its type arguments).</span>
                <span class="hljs-keyword">if</span> isParameterized(tparams, par.typ) {
                        <span class="hljs-keyword">if</span> arg.mode == invalid {
                                <span class="hljs-comment">// An error was reported earlier. Ignore this targ</span>
                                <span class="hljs-comment">// and continue, we may still be able to infer all</span>
                                <span class="hljs-comment">// targs resulting in fewer follow-on errors.</span>
                                <span class="hljs-keyword">continue</span>
                        }
                        <span class="hljs-keyword">if</span> targ := arg.typ; isTyped(targ) {
                                <span class="hljs-comment">// If we permit bidirectional unification, and targ is</span>
                                <span class="hljs-comment">// a generic function, we need to initialize u.y with</span>
                                <span class="hljs-comment">// the respective type parameters of targ.</span>
                                <span class="hljs-keyword">if</span> !u.unify(par.typ, targ) {
                                        errorf(<span class="hljs-string">&quot;type&quot;</span>, par.typ, targ, arg)
                                        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
                                }
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> _, ok := par.typ.(*TypeParam); ok {
                                <span class="hljs-comment">// Since default types are all basic (i.e., non-composite) types, an</span>
                                <span class="hljs-comment">// untyped argument will never match a composite parameter type; the</span>
                                <span class="hljs-comment">// only parameter type it can possibly match against is a *TypeParam.</span>
                                <span class="hljs-comment">// Thus, for untyped arguments we only need to look at parameter types</span>
                                <span class="hljs-comment">// that are single type parameters.</span>
                                indices = <span class="hljs-built_in">append</span>(indices, i)
                        }
                }
        }

</code></pre>
<h3 id="没有类型的实参赋予常量默认值后归一化">没有类型的实参赋予常量默认值后归一化</h3>
<blockquote>
<p>参考：<a href="https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L297">https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L297</a></p>
</blockquote>
<pre class="hljs"><code>        <span class="hljs-comment">// Use any untyped arguments to infer additional type arguments.</span>
        <span class="hljs-comment">// Some generic parameters with untyped arguments may have been given</span>
        <span class="hljs-comment">// a type by now, we can ignore them.</span>
        <span class="hljs-keyword">for</span> _, i := <span class="hljs-keyword">range</span> indices {
                tpar := params.At(i).typ.(*TypeParam) <span class="hljs-comment">// is type parameter by construction of indices</span>
                <span class="hljs-comment">// Only consider untyped arguments for which the corresponding type</span>
                <span class="hljs-comment">// parameter doesn&#x27;t have an inferred type yet.</span>
                <span class="hljs-keyword">if</span> targs[tpar.index] == <span class="hljs-literal">nil</span> {
                        arg := args[i]
                        targ := Default(arg.typ)
                        <span class="hljs-comment">// The default type for an untyped nil is untyped nil. We must not</span>
                        <span class="hljs-comment">// infer an untyped nil type as type parameter type. Ignore untyped</span>
                        <span class="hljs-comment">// nil by making sure all default argument types are typed.</span>
                        <span class="hljs-keyword">if</span> isTyped(targ) &amp;&amp; !u.unify(tpar, targ) {
                                errorf(<span class="hljs-string">&quot;default type&quot;</span>, tpar, targ, arg)
                                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
                        }
                }
        }

</code></pre>
<h2 id="约束类型推断">约束类型推断</h2>
<blockquote>
<p>参考：<a href="https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L468">https://github.com/golang/go/blob/go1.18/src/cmd/compile/internal/types2/infer.go#L468</a></p>
</blockquote>
<h3 id="类型参数-core-type-处理">类型参数 core type 处理</h3>
<p>在约束类型推断的一阶段，引入了一个新概念 core type，本文不做过多介绍，可以理解为类型约束对应约束类型的 underlying type。利用 core type 与已知实参可以完成一些类型推断。</p>
<pre class="hljs"><code>                <span class="hljs-keyword">for</span> i, tpar := <span class="hljs-keyword">range</span> tparams {
                        <span class="hljs-comment">// If there is a core term (i.e., a core type with tilde information)</span>
                        <span class="hljs-comment">// unify the type parameter with the core type.</span>
                        <span class="hljs-keyword">if</span> core, single := coreTerm(tpar); core != <span class="hljs-literal">nil</span> {
                                <span class="hljs-comment">// A type parameter can be unified with its core type in two cases.</span>
                                tx := u.x.at(i)
                                <span class="hljs-keyword">switch</span> {
                                <span class="hljs-keyword">case</span> tx != <span class="hljs-literal">nil</span>:

                                        ......

                                        <span class="hljs-keyword">if</span> !u.unify(tx, core.typ) {
                                                <span class="hljs-comment">// TODO(gri) improve error message by providing the type arguments</span>
                                                <span class="hljs-comment">//           which we know already</span>
                                                <span class="hljs-comment">// Don&#x27;t use term.String() as it always qualifies types, even if they</span>
                                                <span class="hljs-comment">// are in the current package.</span>
                                                tilde := <span class="hljs-string">&quot;&quot;</span>
                                                <span class="hljs-keyword">if</span> core.tilde {
                                                        tilde = <span class="hljs-string">&quot;~&quot;</span>
                                                }
                                                check.errorf(pos, <span class="hljs-string">&quot;%s does not match %s%s&quot;</span>, tpar, tilde, core.typ)
                                                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-number">0</span>
                                        }

                                <span class="hljs-keyword">case</span> single &amp;&amp; !core.tilde:
                                        <span class="hljs-comment">// The corresponding type argument tx is unknown and there&#x27;s a single</span>
                                        <span class="hljs-comment">// specific type and no tilde.</span>
                                        <span class="hljs-comment">// In this case the type argument must be that single type; set it.</span>
                                        u.x.set(i, core.typ)

                                <span class="hljs-keyword">default</span>:
                                        <span class="hljs-comment">// Unification is not possible and no progress was made.</span>
                                        <span class="hljs-keyword">continue</span>
                                }

                                ......

                        }
                }

</code></pre>
<h3 id="映射关系化简">映射关系化简</h3>
<p>约束类型推断的二阶段，不断化简映射关系。</p>
<pre class="hljs"><code>                smap := makeSubstMap(tparams, types)
                n := <span class="hljs-number">0</span>
                <span class="hljs-keyword">for</span> _, index := <span class="hljs-keyword">range</span> dirty {
                        t0 := types[index]
                        <span class="hljs-keyword">if</span> t1 := check.subst(nopos, t0, smap, <span class="hljs-literal">nil</span>); t1 != t0 {
                                types[index] = t1
                                dirty[n] = index
                                n++
                        }
                }

</code></pre>
]]></content:encoded>
  </item>
  <item>
    <title>re:2022</title>
    <link>https://www.yujiachen.com/re-2022/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/re-2022/</guid>
    <pubDate>Wed, 25 Jan 2023 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<p>2022年过去了，如果我的人生是一部电影的话，有好几年的时光都可以放在字幕中略过，但我觉得2022年我经历的事情太多，几句话难说清，若是可以的话，我还想再重新经历一次。</p>
<p>2021年12月31日晚上我是一个人度过的，那天傍晚我一个人去单元楼的楼顶拍日落，那时的我，觉得非常孤单。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_1.png" alt="" class="article-image" width="1080" height="721" />
</picture>
</p>
<p>之后的假期过得一般般，我在北京到处乱逛，谈不上抑郁但也无聊极了，有天晚上我路过家楼下的铁锅炖大鹅，自己想去吃好几次了，但没人陪我去，次次都是作罢。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_2.png" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>过年回家后，我爸不愿回农村老家过年，但我还是坚持一个人去我姑姑家过了年——因为老家要被拆了，那一次就是我最后一次在老家过年了。但我也没留下什么老家的照片，吃完年夜饭，我走到村口拦车，这是我第一次尝试搭顺风车，于是就离开了老家。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_3.png" alt="" class="article-image" width="1080" height="720" />
</picture>
年三十在姑姑家</p>
<p>之后回到北京的日子平平淡淡，那是一个很好的春天，认识了一位朋友，我经常去家附近的公园散步，听好听的歌。后来疫情来了，那时早上我会悠闲地在家楼下喝咖啡，不能进店就搬把小椅子坐在梧桐树下。傍晚我会绕着整个街区跑个六七公里，全身都觉得状态良好。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_4.png" alt="" class="article-image" width="918" height="689" />
</picture>
楼下的咖啡店
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_5.png" alt="" class="article-image" width="1080" height="810" />
</picture>
一日跑步所拍</p>
<p>北京解封后我就回了老家县城，那时乡下老家已经被拆了，回去给爷爷扫墓的时候，天气倒是很好，适合出片。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_6.png" alt="" class="article-image" width="1080" height="721" />
</picture>
被拆的乡下老家
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_7.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_7.png" alt="" class="article-image" width="960" height="1280" />
</picture>
扫墓</p>
<p>端午后，我还去宁波、黄山、杭州玩了一周多，那时南方刚过梅雨季，虽然空气潮湿很恼人，但是我很喜欢这样的南方。如果可以，我真想留在这样的季节里，和喜欢的人一起，过悠闲的日子。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_8.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_8.png" alt="" class="article-image" width="1080" height="721" />
</picture>
雨后杭州</p>
<p>但是时间在向前，其实我心里还有一部分我并不容许这种悠闲的日子。我找了一份新工作，离职了，于是这些悠闲的日子彻底结束。不过在入职前，我去学了摩托车，当时我还意外得了阑尾炎，但是我身残志坚，依然顺利取得了驾照。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_9.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_9.png" alt="" class="article-image" width="1080" height="810" />
</picture>
驾校</p>
<p>严格有意义上入职后的工作并不繁重，只不过可自由支配的时间少了很多，活干完了也不能下班，只能在工位上学习。我也正式搬进了一居室，结束了之前的合租生活。那段时候下班最喜欢做的事情是去骑着共享单车乱逛，心情舒畅，虽然浪费了不少时间。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_10.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_10.png" alt="" class="article-image" width="1080" height="810" />
</picture>
夜间租屋
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_11.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_11.png" alt="" class="article-image" width="1080" height="810" />
</picture>
骑车遇见的狗狗</p>
<p>工作后的周末我也充实了起来，九月份我连着两周往外地飞，一次是和某人过中秋，一次是老家同学结婚。之前在我觉得此类生活是浪费时间，但却一下变得不无聊了。然后我的摩托车也到了，虽然它很丑，以至于我至今没给它拍过什么好照片。但它长得很怪，没人和我撞车，我觉得它会陪伴我度过很长的一段时间。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_12.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_12.png" alt="" class="article-image" width="1080" height="810" />
</picture>
中秋
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_13.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_13.png" alt="" class="article-image" width="1080" height="810" />
</picture>
县城老家街道</p>
<p>十一月份北京又开始封控，当时挺让人抑郁的，我也开始后悔自己这样跳槽，觉得之前要是出国多好。结合前几年的经验，我决定赌一把，退租后老家，春节后再回来。但故事完全不是按我想得发展的，退租两周后，解封了。当时在老家也让人闷闷不乐，电影院没有电影，气温也急转直下，一直下着雨没有晴天，所以当我知道两周后又需要回北京的时候，简直整个人都爆炸了。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_14.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_14.png" alt="" class="article-image" width="1080" height="810" />
</picture>
部分搬家行李</p>
<p>十二月回北京后，一切开始恢复正常。那时也没有太多工作，每天轻松完成工作之后则是充实的学习。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_15.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_15.png" alt="" class="article-image" width="1080" height="810" />
</picture>
楼下药房</p>
<p>一转眼，就是新一年的元旦了，2022年12月31日傍晚，在灵境胡同瞎逛，意外地发现那儿新开了一家悠航鲜啤，在那儿她随手给我拍下了一张照片。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/re-2022/zh/image_16.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/re-2022/zh/image_16.png" alt="" class="article-image" width="816" height="1088" />
</picture>
</p>
<p>一年就这样结束了。</p>
]]></content:encoded>
  </item>
  <item>
    <title>哈佛商业评论摘抄</title>
    <link>https://www.yujiachen.com/harvard-business-review-excerpts/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/harvard-business-review-excerpts/</guid>
    <pubDate>Mon, 02 Jan 2023 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<h1 id="what-makes-a-leader">What makes a leader?</h1>
<p><a href="https://www.hbrtaiwan.com/article/11022/what-makes-a-leader">成為全方位領導人 | 哈佛商業評論・與世界一流管理接軌</a></p>
<p>工作EQ的五项要素：</p>
<h2 id="1-自我认知">1. 自我认知</h2>
<p>定义：分辨及了解自己的心情、情绪、驱动力的能力，以及这些情绪对别人的影响。 特征：</p>
<ul>
<li>自信</li>
<li>务实的自我评价</li>
<li>自嘲式幽默</li>
</ul>
<p>在招募人才时，往往可以发现应聘者是否具备自我认知。如果你要求应聘者说明，是否曾受情绪影响而做出令自己后悔的事。有自我认知的应聘者会坦然承认自己曾有过这类失败的经历，而且往往是带着微笑述说事情的经过。自我认知的一项特征，就是有自我调侃的幽默感。</p>
<h2 id="2-自我规范">2. 自我规范</h2>
<p>定义：有能力控制及扭转一时冲动、失控情绪，先思考后行动，不妄下判断。 特征：</p>
<ul>
<li>值得信赖及正直</li>
<li>对模棱两可处之泰然</li>
<li>对改变持开放态度</li>
</ul>
<p>为什么自我规范对领导人如此重要？首先，能控制自己感觉及冲动情绪的人（也就是明理的人），能创造信任与公平的环境。这种环境可以大幅减少政治权谋与相互攻击，生产力就能够提高。优秀人才会流向这样的组织，而且不会轻易被挖走。自我规范有上行下效的效果，如果上司以冷静处事闻名，部署就不希望自己看起来个性毛躁。如果高阶主管没有太多负面的情绪，整个组织的气氛自然良好。 其次，自我规范对竞争也相当重要。擅长控制情绪的人可以顺应瞬息万变的商业环境。 <strong>组织因正直而受益</strong></p>
<h2 id="3-驱动力">3. 驱动力</h2>
<p>定义：不只为金钱及地位而工作的热情，努力不懈追求目标。 特征：</p>
<ul>
<li>强烈渴望有所成就</li>
<li>失败时仍保持乐观</li>
<li>对组织的热切投入</li>
</ul>
<h2 id="4-同理心">4. 同理心</h2>
<p>定义：了解别人的情绪，与人相处时，能考量对方的情绪反应。 特征：</p>
<ul>
<li>有培养及留住优秀人才的能力</li>
<li>跨文化的敏感度</li>
<li>对客户提供服务</li>
</ul>
<h2 id="5-社交技巧">5. 社交技巧</h2>
<p>定义：擅长管理人际关系与建立人际网络，能够找出共识及建立关系。 特征：</p>
<ul>
<li>有效领导变革</li>
<li>有说服力</li>
<li>擅长建立及领导团队</li>
</ul>
<h1 id="竞争力如何塑造策略">竞争力如何塑造策略</h1>
<blockquote>
<p>文章列举了很多具体因素去帮助企业分析策略，但是唯一核心的原则就是通过平衡各个影响自身竞争力的（负面）因素，达到自身难以被这些因素竞争倒，在市场上保存高利率存活。 比如里面说到一个做各种奇怪口味的派柏汽水（Dr Pepper），它利用了供应商在服务各大汽水商之外，想要产能满载的需求来维持产能，且不去构建供应链；并且因为自己占据市场太小，成本更低，避免了大汽水厂的竞争；并且通过广告维持了一定的客户群体；这就占据了竞争优势。 所以一个好的生意，我理解不是看体量有多大，而是看能否在不断变化的环境中维持自身的竞争优势，统合负面因素，最好让负面因素之间互相制衡，保持自身的利润率。 下面是一篇参考文章，创业，需要弄明白的是自己的整体模式并坚持下去，骑墙往往没有好下场。</p>
</blockquote>
<p><a href="https://mp.weixin.qq.com/s/QOB2sYVWDMZVVopMGfzvOg">向前兼容：微软在多个领域后发先至的秘密</a></p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/harvard-business-review-excerpts/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/harvard-business-review-excerpts/zh/image_1.png" alt="" class="article-image" width="700" height="855" />
</picture>
</p>
<h1 id="蓝海战略">蓝海战略</h1>
<blockquote>
<p>蓝海企业在意的是创造价值，而其竞争对手在意的是战胜对手，为了胜利而竞争本身就是一个巨大的认知障碍，导致对手只知道跟在蓝海企业的屁股后行动。 没错，我说的就是抖音和微视。</p>
</blockquote>
<p>我们发现开创蓝海的企业，与凡事遵照传统规则行事的公司，形成尖锐的对比，从来不把竞争视为标竿。相反地，它们为顾客和公司本身创造价值跃进，把竞争变得毫无意义。</p>
<p>蓝海战略因为能创造出相当大的经济和认知障碍，让对手很难模仿。</p>
<h1 id="破坏性创新">破坏性创新</h1>
<blockquote>
<p>为什么大公司会被小公司击败？因为大公司不够努力和细致？主要还是因为大公司过于依赖制度去构造一个线性环境，结果导致一些非线性因素无法被察觉。 一个好的想法虽然听起来很糟糕，但是这也表示着没有人和你竞争，没有人会偷窃你的想法。小规模特定市场，不流行却正确的产品才是创业公司追求的东西。</p>
</blockquote>
<p>两个特点：</p>
<ol>
<li>它们提供一组不同的性能特质，而至少在一开始，这些特质并不受现有顾客青睐。</li>
<li>其中有些是先有顾客真正重视的性能特质，这些特质改进速度极快，因此新技术稍后就可以入侵那些既有市场。</li>
</ol>
<p>大多数公司都有完备的流程，以确认有潜力的延续性技术，并追踪它的进展。但极少公司拥有系统化流程，可找出并追踪有潜力的破坏式技术。</p>
<p>找出破坏式技术的一种方法，是检视内部对于开发新产品或技术出现的意见分歧。行销与财务经理人出于本身的管理和财务诱因，很少会支持破坏式技术。另一方面，以往绩效杰出的技术人员，往往坚持主张技术新市场将会出现，就算面对关键顾客及行销与财务人员的反应也一样。两方人马的分歧经常是一种讯号，显示有值得最高阶主管探究的破坏式技术。</p>
<h1 id="自我管理">自我管理</h1>
<p>知识工作者必须成为自己的 CEO，因为多数公司并不怎么在乎员工的发展。</p>
<ul>
<li>我的长处是什么
<ul>
<li>回馈分析法，决策时记录预期，定期和预期比较。</li>
<li><strong>专注长处</strong>，纠正不良习惯。</li>
</ul>
</li>
<li>我的工作方式是怎么样？每个人在下面的分类中都会偏向不同的属性，思考自己的长处
<ul>
<li>如何吸收信息
<ul>
<li>读者（离线文字）</li>
<li>听者（实时语音）</li>
</ul>
</li>
<li>学习
<ul>
<li>听讲</li>
<li>写作</li>
<li>对话</li>
</ul>
</li>
<li>合作
<ul>
<li>领导</li>
<li>下属</li>
<li>单干</li>
<li>协作</li>
</ul>
</li>
<li>如何才能取得成果？
<ul>
<li>决策者（承受压力，迅速决策）</li>
<li>顾问（冷静思考，全面考虑）</li>
</ul>
</li>
<li>不要试图改变自我，但可以改变工作方式。</li>
</ul>
</li>
<li>我的价值观是什么
<ul>
<li>工作解决问题的方式你是否认同，（我自己加一句：工作希望解决的问题是不是你感兴趣的问题</li>
<li>我属于何处 -&gt; 根据上述三点知道自己应该，或者至少不应该做什么样的工作，这样才能在机遇出现时知道如何把握。</li>
</ul>
</li>
<li>我该做出什么贡献
<ul>
<li>当前形势的要求是什么？鉴于我的长处、我的工作方式以及我的价值观，我怎样才能对需要完成的任务做出最大贡献？最后，必须取得什么结果才能产生重要影响？</li>
<li>怎么衡量成功、挑战性、有意义、明显可见、可衡量。</li>
</ul>
</li>
<li>对人际关系负责，用和同事、上级更喜欢的方式沟通是你的责任。</li>
<li>管理后半生，尽早开始准备第二份职业。任何人都不能指望自己在生活和工作中很长时间都不遭受严重挫折，所以不要把鸡蛋都放在一个篮子里。</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s/GS5SjC1LNVZGWA5V2yYfMw">我们如何对自己进行自我管理</a></p>
<p><a href="https://mp.weixin.qq.com/s/puFziJd4G6Wb1XP4FEsGzQ">德鲁克 | 管理自我 （Managing Oneself）</a></p>
]]></content:encoded>
  </item>
  <item>
    <title>Software Design Book 小记</title>
    <link>https://www.yujiachen.com/software-design-book-notes/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/software-design-book-notes/zh/</guid>
    <pubDate>Sun, 09 Oct 2022 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>半年前从一位朋友那里借了一本他还没读完的 《A Philosophy of Software Design》，自己一直没读。十一期间花了3天时间断断续续的看完，这本书对我最有用的部分是其在增订版中对 《Clean Code》 中一些观点的反对，其实软件工程这门学科还很年轻，虽然有一些大多数人赞同的最佳实践，但没有什么是一定正确的 。以及自己之前就从其他书本中看到过本书中的各种观点，有的甚至更进一步，比如：本书只提到了为什么对象继承不好，而没有说什么更好，但《Effective Java》 中就鲜明提出了 perfer compositation over inheritation，以及《程序员修炼之道》中还提到了extension。</p>
<p>以及书本中关于复杂度的种种论述都对软件开发非常有帮助，但其他部分就一般般，有经验的开发者快速浏览下即可。</p>
<h2 id="复杂度的定义"><strong>复杂度的定义</strong></h2>
<p>用一个公式概括地说，软件复杂度的定义是软件中各个组件的复杂度 * 其被修改频率之和。也就是说为了降低软件复杂度，我们可以把组件个体的复杂度降低，也可以从整体出发，把复杂度高的逻辑放在被修改频率偏低的模块中。</p>
<p>复杂度增长会带来3个问题：</p>
<ol>
<li>代码修改的复杂度上升，一处修改，处处修改。</li>
<li>认知负担变重，需要了解过多概念才知道如何修改。</li>
<li>unknown unknown，既不知道哪些知识是认识问题所需的，更不知道如何获得这些知识，即使代码改错，或者有一些地方没有改，工程师也无法知道。</li>
</ol>
<p>代码之间的依赖混乱会带来1和2问题，而关键信息缺失（比如多处代码与文档中信息不一致）会带来3和2问题。</p>
<h2 id="战略编程-vs-战术编程"><strong>战略编程 vs 战术编程</strong></h2>
<ul>
<li>战略编程：以整体软件的设计为重，最小可用和最短时间不被单独考虑（但合理的开发成本和可用代码也是设计的重要组成部分）。</li>
<li>战术编程：用最短的编程时间得到最小可用的代码。</li>
</ul>
<p>但是注意这里说的战略依然以敏捷流程为执行周期，而不是waterfall模型，waterfall模型中，项目过大，执行时间和反馈周期过长，对设计更优的软件架构不利。</p>
<p>书本上说，基于战术编程的时间，多投入10%-20%就可以转化为战略编程。但是我不这么认为，战略编程会带来非常多的throwaway work，各种比较调研，总体上我倾向于<strong>严密</strong>的战略编程的开发成本是<strong>极限</strong>战术编程的一倍。但我对书中的一个图例很赞同，使用战略编程的项目，取得的进展和花费的时间是近线形的关系，而使用战术编程的项目，取得一个单位进展，需要近指数级的开发时间投入。因为战略编程可以利用良好的架构隐藏复杂度，让每一单位进展都尽量独立于已有的代码；而战术编程往往导致每一份新代码都需要考虑到已有老代码，越来越积重难返。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/software-design-book-notes/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/software-design-book-notes/zh/image_1.png" alt="" class="article-image" width="640" height="391" />
</picture>
</p>
<p>同时书中说到的10-20%的时间，让我想到了：</p>
<ul>
<li>Google的20%自由工作时间。</li>
<li>Asana每个Q有一周的时间专门用来软件重构。（考虑上休假，以及工程师并不是所有的时间都用在编程上，这个时间也接近10%？）这个我是从 &lt;Effective Engineer&gt; 中读到的，中文版我有参加审校，快去买！</li>
</ul>
<p>书中认为好的代码可以吸引到更好的开发者，而一些startup认为采用战术编程可以跑得快，等业务跑起来了再用钱请更好的开发者来修代码其实是不可取的。我觉得这对一家科技公司来说是肯定的，但是对一个业务驱动的公司来说，可能还是看业务本身是否需要强有力的技术支持，有一些业务的确不需要。</p>
<h2 id="模块应该尽量深"><strong>模块应该尽量深</strong></h2>
<p>一个模块隐藏的实现越多，暴露接口越少，同时不让使用者觉得使用不便，那可以认为这个模块的复杂度是令人满意的。</p>
<p><img src="https://img2.doubanio.com/view/thing_review/l/public/p7997103.jpg" alt="" /></p>
<p>文章中说到了一个非常有趣的例子：Go和Java中的GC，实现非常复杂，但是GC使得编程语言不需要暴露释放内存地址的接口。哪怕我们需要添加大量的复杂代码，但经过适当的排布后，这些代码甚至可以降低原有代码的接口数量。</p>
<p>感觉GC的例子和服务端负责计算，客户端负责渲染的情况有共同之处，复杂计算逻辑统一到一处，那么各种客户端就不需要各自独立维护一份计算代码了。</p>
<p>作者也认为当今一些开发者倾向于把函数和class越拆越小，也会导致函数和class变得shallow（not deep），平时开发中要注意。</p>
<h2 id="信息隐藏-和泄漏"><strong>信息隐藏（和泄漏）</strong></h2>
<p>这一章节说的是不同模块负责的内容应该正交（互不相关），我归纳了一下书中例子想要强调的特性：</p>
<ul>
<li>低耦合
<ul>
<li>一个大函数拆解成多个小函数后，被拆解的各个小函数不应该互相依赖，特别注意在调用顺序上，一个函数能否正确被执行也不应该依赖于前几个特定函数的执行。</li>
<li>文件的读模块和写模块都拥有解析文件格式的知识是不合理的，可以考虑把两者合并成一个读写模块，或者把解析文件格式单独抽成一个模块。</li>
</ul>
</li>
<li>高内聚
<ul>
<li>负责生成http response的调用代码不应该先在response中填写http version再把response指派给各个相应模块，而是应该把填写http version的职责下放到各个模块中。</li>
</ul>
</li>
<li>隐藏实现
<ul>
<li>一个内部用map存储信息的class，在向外部暴露信息时，不应该把内部map暴露出去，这会导致外部可以直接修改内部信息，同时未来如果想把map换成其他实现时，会异常麻烦。</li>
</ul>
</li>
</ul>
<h2 id="越通用-越简单"><strong>越通用，越简单</strong></h2>
<p>（自己瞎意译的，原文是 General-Purpose Modules are Deeper，因为deep在书中指代deep module，其一个重要属性就是复杂度低，即简单)</p>
<p>我理解因为软件逻辑的复杂度被简化到了一定程度后只能转移，而不能被消除，在接口和实现之间分配复杂度就是在决定各个复杂度被使用者接触到的频率。通常接口越简单通用，实现就会越复杂，从而让模块变得更深（deeper）。</p>
<p>作者也在这里强调了设计通用的接口并不是让大家over design，通用的接口在未来有兼容更多需求的可能性，但未来也可能没有新的相关需求，甚至会出现一个破坏现有接口的需求。我们可以先保留接口的通用性，但是只实现满足当前需求的代码，待未来有需要了再基于现有接口做改进，扩展模块内部的实现，让模块变得更深。</p>
<h2 id="层次不同-抽象不同"><strong>层次不同，抽象不同</strong></h2>
<p>不同的层次应该有不同的抽象，如果不同层次有相同的抽象，那么往往说明相应层次的代码不够深。</p>
<p>比如经典的 The Principle of Least Knowledge，一个调用链，A -&gt; B -&gt; C，如果B只是简单地把请求转发到C，那么A不应该调用B，而是应该直接调用C。因为凡是新增代码就是在增加复杂度，当添加一份代码时，我们要考虑新增代码带来的收益和其增加的复杂度，在上述情况中，让B转发请求，只是增加了复杂度，而没有带来任何收益，反而增加了之后维护代码的成本。</p>
<p>书里面还讨论了decorators和pass-through variables的情况。</p>
<p>关于装饰器，Java和Python都通过注解的方式很优雅解决了问题，其他语言就需要注意一下，作者建议考虑一下不去使用修饰器（有点废话了）：</p>
<ul>
<li>直接把新功能加入被修饰的方法或对象中。</li>
<li>如果修饰器添加的功能是为了处理一些特殊case，但被修饰方法处理的是通用case，那么能否在其他地方处理这些特殊case。</li>
<li>把新功能添加进其他装饰器里面。</li>
</ul>
<p>pass-through variables指一个调用链中，每个方法都要传递的变量，比如Go中的ctx context.Context，作者建议的方法是类似用thread local的方法把context存在某个实例中，但我觉得其实现在大家并没有特别好的方法来解决这个问题。自己觉得更优雅的方法或许是类似Guice或其他依赖注入框架针对线程做依赖注入的方法，即把从thread local中存取变量的逻辑都托管给框架，框架对方法做封装，填充thread local中已有的变量，剩下的变量暴露出来让调用方传入，不过我也没有在实践中有使用过，也没有调研过相关框架的能力。</p>
<h2 id="为长函数辩护"><strong>为长函数辩护</strong></h2>
<p>书中提到了 Robert Martin 所著的 《Clean Code》，其中提倡一个函数的长度应该越短越好。</p>
<p>但作者并不认同所有的函数都应该越短越好，Each method should do one thing and do it completely. 如果一个函数很难被拆分成几个更短函数的组合，或者被拆解出的短函数无法做到互相独立，之间有上下文依赖，那么这种（不负责任的）拆分反而会增加代码的复杂度和维护成本。</p>
<h2 id="注释"><strong>注释</strong></h2>
<h3 id="要不要写注释"><strong>要不要写注释</strong></h3>
<p>在这里作者又旗帜鲜明地和 《Clean Code》 唱起了反调，《Clean Code》 认为代码注释在最好的情况下也是“必要之恶”，通常注释代表了代码本身的失败，开发者无法写出充满表达性的代码。</p>
<p>但作者认为注释和代码是相辅相成的，两者共同降低了复杂度，没有注释反而会带来复杂度的增加。比如：有了注释就不需要过长的函数名（书中的例子 isLeastRelevantMultipleOfNextLargerPrimeFactor ）；有了注释就没必要硬生生地把函数拆解成多个互相关联不独立的短函数（ 《Clear Code》 认为函数就是注释）。</p>
<p>函数的注释可以使代码使用者不需要阅读代码即可以使用函数，这也是一种抽象。同时注释可以记录下代码中无法反映出的，开发者设计代码时考虑的一些额外信息。</p>
<h3 id="注释应该描述代码中不明显的部分"><strong>注释应该描述代码中不明显的部分</strong></h3>
<p>作者不鼓励把那些阅读代码就可以直接得到的信息写在注释中，书中的反例如下：</p>
<pre class="hljs"><code>ptr_copy=get_copy(obj)    #G*etpointercopy
ifis_*unlocked(ptr_copy):  #Isobjfre*e?
returnobj                 #re*turncurrentobj
</code></pre>
<p>注释可以被分类为这几类，各自有不同的标准：</p>
<ul>
<li>细节注释（ lower-level comments ），帮助开发者更准确地理解代码中的一些细节。</li>
<li>高阶注释（ higher-level comments ），帮助开发者不用阅读代码就能从直觉上明白代码在做什么。</li>
<li>接口文档（ interface documentation ），不去描述实现细节，而是让开发者知道应该如何使用相应的接口。好的接口文档代表接口完成了好的抽象，如果接口文档必须描述接口内部的实现，那么有可能接口的底层实现太浅 (shallow) 了。</li>
<li>实现注释（ implementation comments ），描述代码做了什么，为什么要这么做，但不必描述如何做到，因为代码本身就有如何做到的信息（ what and why, not how ）。</li>
</ul>
<p>对一些 cross-module design ，即一个设计被多个 module 使用，作者建议把相关的注释写在多个 module 共用的一些结构体定义里，或者在源代码中附上一个叫 designNotes 的文件。</p>
<h3 id="先写注释-后写代码"><strong>先写注释，后写代码</strong></h3>
<p>作者认为在写完代码后写注释并不是个好习惯，因为在代码都写完后才写注释会增大写注释的阻力；同时写完代码后再写注释，很可能一些关键信息已经被大脑丢弃了，想找回来很费力。</p>
<p>其实这就好比我看完书立刻就写读书笔记一样，最省事儿哈哈。</p>
<p>所以作者提倡先写注释，后写代码。</p>
<p>作者说一般人不这么做的理由通常是代码需要来回几次修改才能最终固定下来，所以等代码写完再写注释最省力。但作者提出反复修改代码的代价太大，提前写注释其实就是一种固定代码结构的方法，如果代码的结构需要反复修改，不如就在注释中反复修改，这样修改成本更小，开发成本反而更低。</p>
]]></content:encoded>
  </item>
  <item>
    <title>如何阅读一本书</title>
    <link>https://www.yujiachen.com/how-to-read-a-book/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/how-to-read-a-book/</guid>
    <pubDate>Sun, 14 Aug 2022 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p>三年前刚开始工作时我保留着学生时代的习惯——在吃饭、等车的各种空隙打开微信阅读看书。《如何阅读一本书》算是见证了我这个习惯的消失，我还记得开始看这本书的时候我刚入职，得去湾区呆一个月，回国前我逞着放假从三藩飞去LA玩几天，在飞机上我看了这本书的开头，坐在我身边的老奶奶偷瞄了我好几眼——看着我阅读汉字，同时做着汉字的笔记。</p>
<p>后来因为工作的繁忙我就丢掉了阅读的习惯，这本书也就看了个开头，其实那时的阅读习惯是势必会被丢掉的。因为工作上要学的东西很多，而且那时的阅读漫无目的，看到什么书就读。不是说漫无目的不好，不适合工作初期的自己而已。</p>
<p>今年年初的时候，自己把以前的笔记做了整理和再分类，于是看到了备忘录里自己记的笔记：</p>
<blockquote>
<p>“阅读”：</p>
<ul>
<li>理解力相当，获得资讯。</li>
<li>资讯相当，获得理解力。</li>
</ul>
</blockquote>
<p>这句话说的很泛，导致我后来在阅读、沟通、写作的时候总会想起这句话，书中也说了类似的话：</p>
<blockquote>
<p>阅读的艺术包括了所有非辅助型自我发现学习的技巧：敏锐的观察、灵敏可靠的记忆、想象的空间，再者当然就是训练有素的分析、省思能力。</p>
</blockquote>
<p>因此我决定重读这本书。</p>
<p>也有和在大学时代就读过这本书的朋友讨论过此书，结合我观察豆瓣上的评论来看，还是有很多人觉得此书无关紧要，说了很多本该如此的废话。但我自己觉得这本书提出的阅读规则如书中所说：</p>
<blockquote>
<p>这些分析阅读的规则是一个理想化的阅读。没有多少人用过这样的方法来阅读一本书。 …… 当我们说默认读书“读得很好”时，我们心中应该要有这些标准来做衡量的依据。</p>
</blockquote>
<p>单单说提出一个衡量阅读质量的框架，我觉得本书的目的已经达到了。虽然我并没有用书中提出的阅读规则来阅读此书，很多我觉得自己用不到的技巧和篇幅我都是跳着看的。例如怎么读历史书，等我以后想好好读历史书的时候再读读参考也不迟。</p>
<h1 id="检视阅读">检视阅读</h1>
<p>许多书都值得精读。但有更多的书只要浏览一下就行了。要成为一个好读者，就要懂得依照一本书的特质，运用不同的阅读技巧来阅读。</p>
<h2 id="有系统的略读">有系统的略读</h2>
<ol>
<li>先看书名页，如果有序就先看序。</li>
<li>研究目录页。</li>
<li>检阅索引，知道自己感兴趣的名词出现在哪里。</li>
<li>从外包装了解信息。</li>
<li>从上面的步骤知道自己感兴趣的篇章，从这些篇章入手。</li>
<li>随意翻阅，注意看到文字的要点。</li>
</ol>
<h2 id="粗浅的阅读">粗浅的阅读</h2>
<p>头一次面对一本难读的书的时候，从头到尾先读完一遍，碰到不懂的地方不要停下来查询或思索。很快你会遇到你读得懂的地方。</p>
<p>你从头到尾读了一遍之后的了解——就算只有50%或更少——能帮助你在后来重读第一次略过的部分时，增进理解。就算你不重读，对一本难度很高的书了解了一半，也比什么都不了解来得要好些——如果你让自己在一碰上困难的地方就停住，最后就可能对这本书真的一无所知了。</p>
<p>每一本书，不论是多么难读的书，在无关紧要的间隙部分就可以读快一点。而一本好书，总会包含一些比较困难，应该慢慢阅读的内容。</p>
<p>在阅读一本书的时候，慢不该慢到不值得，快不该快到有损于满足与理解。</p>
<h2 id="避免摄入过多信息">避免摄入过多信息</h2>
<p>太多的资讯就如同太少的资讯一样，都是一种对理解力的阻碍。换句话说，现代的媒体正以压倒性的泛滥资讯阻碍了我们的理解力。</p>
<p>如何将知识分子的态度与观点包装起来，是当今最有才智的人在做的最活跃的事业之一。目的都在让人不需要面对困难或努力，很容易就整理出“自己”的思绪。</p>
<p>这里的“学习”指的是理解更多的事情，而不是记住更多的资讯——和你已经知道的资讯在同一水平的资讯。</p>
<p>一个读得很广泛，却读不精的人，与其值得赞美，不如值得同情。就像霍布斯所说：“如果我像一般人一样读那么多书，我就跟他们一样愚蠢了。”</p>
<h1 id="做笔记">做笔记</h1>
<p>有必要时才做笔记。</p>
<h2 id="结构笔记">结构笔记</h2>
<ol>
<li>这是什么样的一本书</li>
<li>整本书在谈的是什么？</li>
<li>作者是借着怎样的整体架构，来发展他的观点或陈述他对这个主题的理解？</li>
</ol>
<p>书中还提到了概念笔记和辩证笔记，前者是就一个主题阅读不同的书记录出的笔记，后者则是在前者之上，分析不同书本之间的矛盾观点。</p>
<p>但我自己目前的记笔记方法就是单纯地提炼“整本书在谈论什么”，并且尝试用这个来回答自己关心的问题，我觉得这样的笔记方法就够了。</p>
<h1 id="自我提问">自我提问</h1>
<p>你在阅读时要提出问题来——在阅读的过程中，你自己必须尝试去回答的问题——但不是说这些问题你必须回答。</p>
<h2 id="基本问题">基本问题</h2>
<ol>
<li>
<p>整体来说，这本书到底在谈些什么？</p>
</li>
<li>
<p>作者细部说了什么，怎么说的？</p>
</li>
<li>
<p>这本书说得有道理吗？是全部有道理，还是部分有道理？</p>
</li>
<li>
<p>这本书跟你有什么关系？有意义吗？如果你想做什么？要如何利用此书？</p>
</li>
</ol>
<p>前三个问题确保了读者对内容的理解，尽量规避语言的不完美。</p>
<p>最后一个问题区别了讯息与理解之间的差异，我个人觉得这是本书的关键：</p>
<blockquote class="callout callout-note">
<p>💡 “阅读”：</p>
<ul>
<li>理解力相当，获得资讯。</li>
<li>资讯相当，获得理解力。</li>
</ul>
</blockquote>
<h2 id="语言的缺陷">语言的缺陷</h2>
<p>字与意思之间的关系并不是一对一的。在应用这个规则时，你会犯的最大错误就是认为在语言及思想或知识之间，是一对一的关系。</p>
<p>在关于主旨的种种论述中，文字的血肉和许多概念的重复显现出了作用，你无法确保读者可以正确接受你的思想，甚至你会害怕自己的一些言语会让别人产生误解，所以需要不断从不同角度，结合例子去阐述自己的观点。</p>
<p>书的主旨是骨架，是作者想要论述的东西，而书的文字与表达是血肉，是防止读者误解和不解施加的必要措施。</p>
<p>站在叙述者或作者的角度来看，修辞就是要知道如何去说服对方。因为这也是最终的目标，所有其他的沟通行为也必须做到这个程度才行。在写作时讲求文法与逻辑的技巧，会使作品清晰，容易理解，也是达到目标的一个过程。相对的，在读者或听者的立场，修辞的技巧是知道当别人想要说服我们时，我们该如何反应。</p>
<h1 id="分析阅读">分析阅读</h1>
<p>前两个阶段对应 <a href="https://www.notion.so/6704aaaa1ef044fd9c92e2a85ad57ece?pvs=21">基本问题</a> 的前两个，最后一个阶段最后最后两个基本问题。</p>
<p>第一个阶段，找出一本书在谈论什么：</p>
<ol>
<li>知道这本书的种类和主题是什么</li>
<li>整体性：使用尽可能简短的话，来叙述整本书的内容。</li>
<li>复杂度：将书中重要篇章列举出来，说明它们如何按照顺序组成一个整体的架构，再将各个部分的纲要也一一列出。</li>
<li>找出作者要问的问题，或作者想要解决的问题。</li>
</ol>
<p>以上是为了让读者掌握结构大纲，不会在文本中迷失，并知道作者想通过书籍解决的问题。</p>
<p>第二阶段，找出一本书在说什么</p>
<ol>
<li>找出重要单字，透过它们与作者达成共识。</li>
<li>将一本书中最重要的句子圈出来，找出其中的主旨。</li>
<li>如果可以，找出书中说明重要论述的段落。但是，如果这个论述并没有这样表达出来，你就要去架构出来。</li>
<li>确定作者已经解决了哪些问题，还有哪些是没解决的。再判断哪些是作者知道他没解决的问题。</li>
</ol>
<p>以上是为了诠释作者意图，读者需要和作者一起努力达成沟通，防止误解或理解力不够。</p>
<p>第三阶段，公正评价</p>
<ol>
<li>在你说出“我同意”，“我不同意”，或“我暂缓评论”之前，你一定要能肯定地说：“我了解了。”</li>
<li>当你不同意作者的观点时，要理性地表达自己的意见，不要无理地辩驳或争论。</li>
<li>尊重知识与个人观点的不同，在作任何评断之前，都要找出理论基础。</li>
</ol>
<h2 id="find-context-from-the-air">find context from the air</h2>
<p>在一个又长又复杂的句子里，区分出不同的主旨是很重要的。</p>
<p>除非你能在一个复杂句中辨认出不同的主旨，否则你无法判断这个作者在谈些什么。</p>
<p>一个读者如果不能区别出知识的理论说明与个人观点的阐述，那他就无法从阅读中学到东西。</p>
<p>用归纳法或演绎法阐述主旨。</p>
<p>阐述没有启发性的主旨（定义），或有启发性的主旨。</p>
<p>必须能评论，提出批评，才算真正完成了这件事。</p>
<p>一个人如果不能自动自发地运用独立的判断力，他根本就不可能学习到任何东西。或许他可以受训练，却不能受教。因此，最能学习的读者，也就是最能批评的读者。</p>
<p>在作这样的沟通时，接受的一方如果也想同样认真，那就不但要有回应，还要做一个负责的倾听者。你对自己所听到的要有回应，还要注意到对方背后的意图。</p>
<h2 id="四种反对角度">四种反对角度</h2>
<ol>
<li>你的知识不足</li>
<li>你的知识有错误</li>
<li>你不合逻辑——你的推论无法令人信服</li>
<li>你的分析不够完整</li>
</ol>
<h1 id="争论">争论</h1>
<h2 id="确认对方的理解程度">确认对方的理解程度</h2>
<p>你唯一能做的是有礼貌地请他们重述你的论点，再说明他们对你的非难之处。如果他们做不到，或是不能用他们自己的话重述你的观点，你就知道他们其实并不了解你在说什么。</p>
<h2 id="不被争论影响">不被争论影响</h2>
<p>大多数人会以赢得辩论为目标，却没想到要学习的是真理。</p>
<p>把谈话当作是战争的人，要赢得战争就得为反对而反对，不论自己对错，都要反对成功。</p>
<p>读者在自己书房和一本书进行对话的时候，没有什么可以阻止他去赢得这场争辩。</p>
<p>然而，学识比较高的人，有权指正比较无知的人所犯的错误。这种不同意见所造成的争论也是可以更正的。</p>
<p>他们必须用来沟通的语言是不完美的媒介，被情绪遮盖着，被个人的喜好渲染着，被不恰当的思想穿梭着。</p>
<h1 id="其他">其他</h1>
<blockquote class="callout callout-note">
<p>💡 阅读的艺术包括了所有非辅助型自我发现学习的技巧：敏锐的观察、灵敏可靠的记忆、想象的空间，再者当然就是训练有素的分析、省思能力。</p>
</blockquote>
<p>虽然他们通常比一些差一点的书要复杂一些，但他们的复杂也是一种单纯，因为他们的各个部分都组织得更完善，也更统一。</p>
<h2 id="实用性书籍">实用性书籍</h2>
<p>关于实用性的书有一件事要牢记在心：任何实用性的书都不能解决该书所关心的问题。一本理论性的作品可以解决自己提出的问题。但是实际的问题却只能靠行动来解决。</p>
<p>阅读实用性书籍的最高规则就是把它应用到行动中。</p>
<p>对作者而言，为了让你去行动，或者相信行动中可以运用这些规则，必然要在书中加上雄辩甚至狡辩，这没有错，但你必须意识到这一点。</p>
<h2 id="想象文学">想象文学</h2>
<p>论说性作品要传达的是知识，而想象文学是在阐述一个经验本身。</p>
<p>就算我们真的要逃避现实，应该也是逃避到一个更深沉、或更伟大的真实里。</p>
<p>论说性作品希望一个词只会表达一个意思，但想象文学常常带有隐喻，有时一个词会表达多种含义。</p>
<ol>
<li>不要抗拒想象文学带给你的影响力。</li>
<li>在想象文学中，不要去找共识、主旨或论述。</li>
<li>不要用适用于传递知识的，与真理一致的标准来批评小说。</li>
</ol>
<p>没有必要去强迫自己记住小说中的名字，好比你去参加了一场聚会，不可能记住每一个参会人的名字，但总能记住一些让你印象深刻的人，阅读小说也是这样。</p>
<h2 id="哲学书">哲学书</h2>
<p>能够保留孩子看世界的眼光，又能成熟地了解到保留这些问题的意义，确实是非常稀有的能力——拥有这种能力的人也才可能对我们的思想有重大的贡献。</p>
]]></content:encoded>
  </item>
  <item>
    <title>个人数据备份实践</title>
    <link>https://www.yujiachen.com/personal-data-backup-practices/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/personal-data-backup-practices/</guid>
    <pubDate>Sat, 02 Jul 2022 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>最近因为跳槽之间的gap赋闲在家，整理了一下个人数据并尝试对其备份，在这里简单记录一下。</p>
<h1 id="策略">策略</h1>
<p>备份整体的策略就是遵循3-2-1原则：至少三个备份，两种介质，一个offsite（备份之间的最大物理距离不能过于接近，即不要把所有备份放在同一处）。</p>
<p>自己因为是苹果全家桶，所以可以从文件系统层面进行备份，之前也有想过针对不同应用和文件类型做不同的备份策略，但这需要的工作量过大且不必要。基于苹果全家桶的文件系统备份如下：用Time Machine和iCloud分别备份整个/部分文件系统，因为Time Machine是把备份写在硬盘上，我们就可以利用多个移动硬盘制作对个备份，恰好我作为打工人有老家、出租屋多个住所，所以可以为每个住所设置一个备份。</p>
<p>基于此，不同类型的数据还需要不同的处理：</p>
<h1 id="文档">文档</h1>
<p>一般的pdf等各种资料文档不表，存储起来都很简单，自己整理是发现和预期不符的是各种笔记app。</p>
<p>我平时主要用3个笔记app：</p>
<ul>
<li>Notion - 规划项目需要其database功能（整个新潮点的词就是low-code），同时其比较好的扩展性也适合各种wiki和<strong>条理类记录</strong>的文档。（等之后入职飞书了可以比较一下两者异同，目前来看两者的核心卖点不同）</li>
<li>Ulysses - 核心功能是其特有的markdown XL格式，适合写作，写作要面临的一个问题是语言的多义性和节奏感，markdown XL的注释删除等功能可以帮助作者快速修改文字。</li>
<li>Flomo - 个人版微博，Flomo最大的优点是输入无阻力，已有卡片回溯性强，用来梳理想法非常方便，梳理完后可以方便把内容整合进上面两个app。</li>
</ul>
<p>这期间我也比较了这些笔记类app是否可以用其他app替代，因为市面上有更方便导出数据的笔记类app。出乎我意料的是不能，因为这些app的核心功能的数据即使可以导出，我们也没有合适的解析器—— Notion就是database数据的最佳解析器，Ulysses的markdown XL就没有其他笔记类app支持。Flomo的情况也略类似，我们随便用一个笔记app都能实现Flomo的卡片笔记，但貌似没啥用，Flomo的优势是笔记之间的关联性和灵活的多级标签系统，这些数据也无法找到合适的编辑与解析器。</p>
<p>因此这些App的备份目的只是为了保证数据在本地有一个备份，防止服务器断网或产品停止运营这一类极小概率事件，所以不需要过于仔细，有一个数据备份就好，不必过于在意数据解析的问题。</p>
<p>同理类似的还有微信聊天记录，你也无法从微信里导出（除非使用一些非正常途径，不一定能成功复现还可能会丢图片），我用mac微信备份了相关的聊天记录，同时mac微信的数据则由Time Machine负责备份。</p>
<h2 id="影音资料">影音资料</h2>
<p>影音资料的问题则是太大了，同时影音资料的信噪比偏低，比如我的很多相机照片都是重复的，还是RAW，修理过并导出的照片其实我都存在了iCloud里；还有很多电影，网上都有各种资源可以重复下载。</p>
<p>所以这一类我单独存在了一块硬盘中，未来会考虑在家中安装NAT，配合放置在别处的硬盘进行备份。</p>
<h2 id="隐私">隐私</h2>
<p>密码和一些证件照片我则是统一收集到了1Password里面，这一类的备份并不是特别重要，首先证件照片即使丢失也有本体，密码的话我有重设密码的方法。</p>
]]></content:encoded>
  </item>
  <item>
    <title>编程以外的编程知识</title>
    <link>https://www.yujiachen.com/the-missing-semester-of-your-cs-education/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/the-missing-semester-of-your-cs-education/</guid>
    <pubDate>Tue, 14 Jun 2022 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<blockquote class="callout callout-note">
<p>💡 学习完这门课程后，我也有了自己的 dotfile repo：<a href="https://github.com/yujiachen-y/dotfiles">https://github.com/yujiachen-y/dotfiles</a></p>
</blockquote>
<p>知道的前提是知道自己不知道什么。</p>
<p><a href="https://missing.csail.mit.edu/">The Missing Semester of Your CS Education</a></p>
<h1 id="shell">Shell</h1>
<ul>
<li>Connecting programs
<ul>
<li><code>&lt; file</code> and <code>&gt; file</code> rewire the input and output streams of a program to a file.</li>
<li><code>&gt;&gt;</code> to append to a file.</li>
<li><code>|</code> chain programs by the output of one is the input of another.</li>
</ul>
</li>
<li><code>sysfs</code> exposes a number of kernel parameters as files.</li>
<li>Conditionally execute commands, <code>&amp;&amp;</code> and <code>||</code></li>
<li>Separate commands within the same line <code>;</code></li>
<li>Get the output of a command as a variable.
<ul>
<li><code>$( CMD )</code> , directly replace the output in the command.</li>
<li><code>&lt;( CMD )</code> , execute <code>CMD</code> and place the output in a temporary file and substitute the <code>&lt;()</code> with that file’s name.</li>
</ul>
</li>
<li>Shell globbing
<ul>
<li><code>?</code> and <code>*</code> to match one or any amount of characters.</li>
<li><code>{}</code> expand a series of commands
<ul>
<li>e.g. <code>convert image.{png,jpg}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://tldp.org/LDP/abs/html/special-chars.html">Special Characters</a></p>
<p><a href="https://github.com/koalaman/shellcheck">GitHub - koalaman/shellcheck: ShellCheck, a static analysis tool for shell scripts</a></p>
<h2 id="tools">Tools</h2>
<p><a href="https://en.wikipedia.org/wiki/List_of_GNU_Core_Utilities_commands">GNU coreutils</a> via <a href="https://formulae.brew.sh/formula/coreutils">Homebrew</a></p>
<ul>
<li><code>xargs</code></li>
<li><code>man</code> replacement: <a href="https://tldr.sh/"><code>TLDR</code></a></li>
<li>Finding files <a href="https://github.com/sharkdp/fd"><code>fd</code></a></li>
<li>Finding code <code>grep</code> <a href="https://github.com/beyondgrep/ack3"><code>ack</code></a> <a href="https://github.com/ggreer/the_silver_searcher"><code>ag</code></a> <a href="https://github.com/BurntSushi/ripgrep"><code>rg</code></a></li>
<li>Shell finding commands <a href="https://github.com/junegunn/fzf/wiki/Configuring-shell-key-bindings#ctrl-r"><code>fzf</code></a></li>
<li>Directory Navigation <a href="https://github.com/clvv/fasd"><code>fasd</code></a> <a href="https://github.com/wting/autojump"><code>autojump</code></a> <a href="https://web.archive.org/web/20210421120120/https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Places/Frecency_algorithm"><code>frecency</code></a></li>
<li>View directory structure <a href="https://linux.die.net/man/1/tree"><code>tree</code></a> <a href="https://github.com/Canop/broot"><code>broot</code></a> <a href="https://github.com/jarun/nnn"><code>nnn</code></a> <a href="https://github.com/ranger/ranger"><code>ranger</code></a></li>
<li>Stream editor <code>sed</code> , a useful programming language <code>awk</code> (人生苦短，我用Python</li>
<li><a href="https://www.man7.org/linux/man-pages/man1/rsync.1.html"><code>rsync</code></a></li>
</ul>
<h2 id="job-control">Job Control</h2>
<ul>
<li><code>kill</code></li>
<li>Stop a process <code>Ctrl-Z</code></li>
<li>Continue the paused job in the foreground or in the background using <code>fg</code> or <code>bg</code></li>
<li><code>jobs</code></li>
<li><code>tmux</code></li>
</ul>
<h2 id="aliases">Aliases</h2>
<p>Note that there is no space around the equal sign <code>=</code>, because <a href="https://www.man7.org/linux/man-pages/man1/alias.1p.html"><code>alias</code></a>  is a shell command that takes a single argument.</p>
<h2 id="dotfiles">Dotfiles</h2>
<p><a href="https://dotfiles.github.io/">GitHub does dotfiles - dotfiles.github.io</a></p>
<p><a href="https://abdullah.today/encrypted-dotfiles/">Use Git to manage secret content</a> via creating bash functions to encrypt / decrypt secret content into / from Git.</p>
<h3 id="portability">Portability</h3>
<pre class="hljs"><code><span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-subst">$(uname)</span>&quot;</span> == <span class="hljs-string">&quot;Linux&quot;</span> ]]; <span class="hljs-keyword">then</span> {do_something}; <span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Check before using shell-specific features</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$SHELL</span>&quot;</span> == <span class="hljs-string">&quot;zsh&quot;</span> ]]; <span class="hljs-keyword">then</span> {do_something}; <span class="hljs-keyword">fi</span>

<span class="hljs-comment"># You can also make it machine-specific</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-subst">$(hostname)</span>&quot;</span> == <span class="hljs-string">&quot;myServer&quot;</span> ]]; <span class="hljs-keyword">then</span> {do_something}; <span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Test if ~/.aliases exists and source it</span>
<span class="hljs-keyword">if</span> [ -f ~/.aliases ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">source</span> ~/.aliases
<span class="hljs-keyword">fi</span>
</code></pre>
<p>gitconfig supports including configurations from local files.</p>
<pre class="hljs"><code>[include]
    path = ~/.gitconfig_local
</code></pre>
<h2 id="ssh-configuration">SSH Configuration</h2>
<ul>
<li>generate a key pair → <code>ssh-keygen</code></li>
<li>manage passphrase → <code>ssh-agent</code> <code>gpg-agent</code></li>
</ul>
<p><a href="https://help.github.com/articles/connecting-to-github-with-ssh/">Connecting to GitHub with SSH - GitHub Docs</a></p>
<p><a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">What’s ssh port forwarding and what’s the difference between ssh local and remote port forwarding</a></p>
<p><code>~/.ssh/config</code></p>
<pre class="hljs"><code>Host vm
    User foobar
    HostName 172.16.174.141
    Port 2222
    IdentityFile ~/.ssh/id_ed25519
    LocalForward 9999 localhost:8888

# Configs can also take wildcards
Host *.mit.edu
    User foobaz
</code></pre>
<h3 id="key-based-authentication">Key based authentication</h3>
<pre class="hljs"><code><span class="hljs-built_in">cat</span> .ssh/id_ed25519.pub | ssh foobar@remote <span class="hljs-string">&#x27;cat &gt;&gt; ~/.ssh/authorized_keys&#x27;</span>

<span class="hljs-comment"># Or</span>
ssh-copy-id -i .ssh/id_ed25519 foobar@remote
</code></pre>
<h3 id="copying-files-over-ssh">Copying files over SSH</h3>
<p><code>rsync</code></p>
<h2 id="zsh">ZSH</h2>
<p>为什么不使用fish？</p>
<p>因为我对shell不够了解，fish不支持Posix标准，我觉得有很多我不知道的坑。</p>
<h1 id="editors-vim">Editors (Vim)</h1>
<p>Know keyboard shortcuts about your most recently used editor!d</p>
<p><a href="https://missing.csail.mit.edu/2020/files/vimrc"></a></p>
<p><a href="https://vimawesome.com/"></a></p>
<p><a href="https://reversed.top/2016-08-13/big-list-of-vim-like-software">The big list of Vim-like software</a></p>
<h1 id="keyboard-remapping">Keyboard remapping</h1>
<p><a href="https://pqrs.org/osx/karabiner/">Karabiner-Elements</a></p>
<p><a href="https://github.com/koekeishiya/skhd">GitHub - koekeishiya/skhd: Simple hotkey daemon for macOS</a></p>
<p><a href="https://folivora.ai/">folivora.ai - Great Tools for your Mac!</a></p>
<h1 id="daemon-automation">Daemon &amp; Automation</h1>
<p><code>systemd</code></p>
<pre class="hljs"><code><span class="hljs-comment"># /etc/systemd/system/myapp.service</span>
[Unit]
Description=My Custom App
After=network.target

[Service]
User=foo
Group=foo
WorkingDirectory=/home/foo/projects/mydaemon
ExecStart=/usr/bin/local/python3.7 app.py
Restart=on-failure

[Install]
WantedBy=multi-user.target
</code></pre>
<p><code>cron</code></p>
<p><a href="https://www.hammerspoon.org/">Hammerspoon</a></p>
<h1 id="fuse">FUSE</h1>
<p>filesystem in user space，对文件系统的中间抽象，用来加上远程、分布式、加密等功能。</p>
<ul>
<li><a href="https://github.com/libfuse/sshfs">sshfs</a> - Open locally remote files/folder through an SSH connection.</li>
<li><a href="https://rclone.org/commands/rclone_mount/">rclone</a> - Mount cloud storage services like Dropbox, GDrive, Amazon S3 or Google Cloud Storage and open data locally.</li>
<li><a href="https://nuetzlich.net/gocryptfs/">gocryptfs</a> - Encrypted overlay system. Files are stored encrypted but once the FS is mounted they appear as plaintext in the mountpoint.</li>
<li><a href="https://keybase.io/docs/kbfs">kbfs</a> - Distributed filesystem with end-to-end encryption. You can have private, shared and public folders.</li>
<li><a href="https://borgbackup.readthedocs.io/en/stable/usage/mount.html">borgbackup</a> - Mount your deduplicated, compressed and encrypted backups for ease of browsing.</li>
</ul>
<h1 id="backups">Backups</h1>
<p><a href="https://www.cisa.gov/uscert/sites/default/files/publications/data_backup_options.pdf">https://www.cisa.gov/uscert/sites/default/files/publications/data_backup_options.pdf</a></p>
<h1 id="filesystem-hierarchy-standard">Filesystem Hierarchy Standard</h1>
<ul>
<li><code>/bin</code> - Essential command binaries</li>
<li><code>/sbin</code> - Essential system binaries, usually to be run by root</li>
<li><code>/dev</code> - Device files, special files that often are interfaces to hardware devices</li>
<li><code>/etc</code> - Host-specific system-wide configuration files</li>
<li><code>/home</code> - Home directories for users in the system</li>
<li><code>/lib</code> - Common libraries for system programs</li>
<li><code>/opt</code> - Optional application software</li>
<li><code>/sys</code> - Contains information and configuration for the system</li>
<li><code>/tmp</code> - Temporary files (also <code>/var/tmp</code>). Usually deleted between reboots.</li>
<li><code>/usr/</code> - Read only user data
<ul>
<li><code>/usr/bin</code> - Non-essential command binaries</li>
<li><code>/usr/sbin</code> - Non-essential system binaries, usually to be run by root</li>
<li><code>/usr/local/bin</code> - Binaries for user compiled programs</li>
</ul>
</li>
<li><code>/var</code> - Variable files like logs or caches</li>
</ul>
]]></content:encoded>
  </item>
  <item>
    <title>不要成为一个程序员</title>
    <link>https://www.yujiachen.com/dont-be-a-programmer/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/dont-be-a-programmer/zh/</guid>
    <pubDate>Sun, 01 May 2022 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p>深夜，一个人冲着热水澡，躲在厕所的浴帘后，仿佛像躲在一个温室，或者说像一个培养皿。不想结束冲洗，不想离开这个封闭的环境。我觉得自己的压力很大，这时我往往会做一些缓解压力和焦虑的事情，可缓解的过程又把时间给浪费了，从而又加重了自己的焦虑。做程序员常常会面临这样的情况，想象中的生活往往带着“财富自由”等各种光鲜亮丽的词汇，但是却深陷于日常的各种泥潭中。</p>
<p>我突然想到之前看到的一句话：“要多想怎么做产品，少想怎么做产品经理”，我想这句话也可以推广到编程上，“要多想怎么写程序，少想怎么成为一个程序员”。没错，你不需要成为一名程序员，每天的大多数时间都在面对屏幕，和眼睛的肿胀。身体在日渐臃肿，想要健身却腾不出时间；越来越刻板的机械思维方式，以及和人越来越少的接触。理想很美好，现实却又如此沮丧。毕竟上个时代的程序员有那么多财富自由的机会。多少造富神话，甚至改变世界的经典故事都在程序员发生。如今这个时代却远去了，我们只能看着这个时代的余晖，夕阳一点点落下。</p>
<p>最近在准备跳槽，发现面试需背的八股文全是各种我不知道的东西。难免觉得焦虑，又发现连总结八股文都被人做成了风生水起的公众号和个人IP。羡慕和嫉妒，也是程序员总会有的负面情绪。你会想为什么那个人比你厉害；为什么ta如此努力，而我却做不到；为什么有些事对ta而言水到渠成，我却不行。渴望的机会和不确定性让这个行业变得刺激，它让你的嫉妒心无限膨胀，让你觉得通过努力就可以收获无限多的东西，甚至让人觉得自己和世界之间的间距，和梦想之间的间距，也在不断变小。但事实真的是如此吗，我们总是有着各种各样的压力。社会也对程序员有了足够刻板的印象，我多么想不再有那么多的加班，多么希望生活轻松的同时自己也成为一个大牛，在网络上各种炫耀，被他人羡慕。</p>
<p>有如此的渴望，程序员的工作却未免有些冷冰冰和抽象，过人的理解力，甚至智慧，却失去了那么多丰富的感情。生活也越发单调、幼稚。</p>
<p>我为什么会选择成为一名程序员呢？冲洗完后，我看着窗外的夜空问自己。我想是各种创业故事给我的激励和情怀，还有一个就是热爱抽象。程序，本质上就是一门更简单的语言，我们却能用这个语言描绘出世界中各种各样的问题和解法。语言是如此重要，好比我正在用中文写下这篇文章。语言，当我们在讨论编程的时候，我们在讨论什么？我们讨论的是编程本身，代码如何抽象现实，如何设计，不同设计的好与坏，但讨论的却不是程序员。</p>
<p>可以成为程序员的同时，依然热爱生活吗，当然是可以的，虽然我不知道怎么做，但个人有个人的解法。虽然我也在为我的前途而焦虑，我不知道还能在这个行业再待几年，几年后我会落伍，也不知道未来能有多少的收入，会过上怎样的生活，更说不清有多少次的裁员在等待着你。但这种不确定性又带来了特别多的刺激，失望、兴奋像潮水般起起落落，这就是这个行业的特殊性吧，风险与回报总是一同到来。</p>
<p>拥抱更多的不确定性吧，拥抱真正的热爱，用语言去重新组织生活，热爱代码，热爱编程，热爱结构化和设计模式，但不要去成为一个所谓的程序员。</p>
]]></content:encoded>
  </item>
  <item>
    <title>2021 年小结</title>
    <link>https://www.yujiachen.com/2021-year-in-review/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2021-year-in-review/</guid>
    <pubDate>Tue, 28 Dec 2021 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<p>又是一年圣诞假，我坐在书桌前，精疲力尽，十几天的假期，被我用来看资料、读书、总结，不断循环。写完6篇文章后，终于跑到了最后一篇——今年的年终小结，此时的我略感疲惫和麻木，有意义吗？我还是相信有的。</p>
<p>今年清空了自己觉得不重要的微博，只留了几条动态，我自己觉得，微博有半年前内容不可见的功能，又鼓励用户产生各种各样的信息，这些矛盾的体验设计，也让用户变得矛盾，一方面想要快速（缺少思考），充满号召力地表现出自己的观点，另一方面却是对过去自己的躲避和忽视。
所以写小结的动力之一也是想要没有逃避（但有保留）地把自己投射到网络空间里，就像岩层一样，每年变厚一些。或许有一天这些文章和豆瓣都会从网络上消失，我的所作所为也不会有意义，但也就先这样做下去吧。
<a href="https://music.apple.com/cn/album/take-5-remastered-2018/1444575348?i=1444575401">https://music.apple.com/cn/album/take-5-remastered-2018/1444575348?i=1444575401</a></p>
<p>如上所说，我今年对社交媒体和弥漫在上面的各种情绪不再关心了。并不是说社交媒体上的情绪都是不好的，社会上的很多事情都需要大家的关注，但有时这注意力并不是很集中。印象深刻的一个例子是今年9月份的《迪迦奥特曼》下架，当时也冲上了微博热搜，本以为迪迦会永久下架了。某日，我想着为什么这种片子都会消失，渐渐就有了一些不满的情绪，本打算去买迪迦的T恤，把朋友圈封面改成迪迦那个创造亚当的剧照来表示自己的态度。结果到了凌晨，我就发现迪迦重新上架了，删去了一些暴力片段（虽然的确是删改，但也的确只删了很少一点打斗片段）。这种热点的突然发生和平息，让当时的我瞬间感到疲惫。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2021-year-in-review/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2021-year-in-review/zh/image_1.png" alt="" class="article-image" width="1080" height="675" />
</picture>
</p>
<p>网络上各种事件的讨论和反转有太多的例子了，还有一个严肃的例子就是阿里女员工出差陪酒的事件，一些人因为这个事件从阿里辞职，但事情发酵了后竟然也发生了反转。当然不公值得我们的关注，也需要被关注，比如今年的西安地铁事件、上海小红楼事件……</p>
<p>说实话，现在的我已经对这类事情麻木了，世界上有很多事件值得我们关心，但这一类事件里也掺杂进了一些不需要所有人去关心的事件。我也不知道有什么正确的应对方法和态度，现在我能做的事情就是尽量把注意力放在自己身上，并努力保持专注。希望以后我可以知道如何去处理这些永远消化不完的信息。</p>
<h2 id="大事记">大事记</h2>
<p>今年上半年是很混乱的半年，各种突然的冲击，职场上、感情上、感情和职场上……</p>
<p>上半年在家里办公了2个月，回到家乡后，两场电影让我印象深刻，一部是大鹏的《吉祥如意》，一部是贾玲的《你好，李焕英》，我也是大鹏在《吉祥如意》里表现的“进京打工人”之一，在北京和家乡的生活几乎是完全割裂的。这两部电影让我开始在家乡寻找那些埋在记忆深处的体验，我在家乡生活了接近20年，却因为几年的在外生活对这一切感到陌生。雨，空气，山路，夜晚，深夜无人的寂静街道，孤独还喜欢控制人的父亲，因为去年疫情而不能相见的亲戚朋友们。</p>
<p>带着这种状态回到北京的我，一下变得不知道怎么去处理事情，因为升职涨薪带来的焦躁感，因为雾气弥漫的江南给我的印象太深刻，因为“你走的前一天，都是下雨天”。加上老板们的push，那段时间我总在加班，就连周末都在工作，很不可思议，3月份我只休息了3天，这件事还发生在外企。那段时间我需要发各种豆瓣动态来消解内心的情绪，人际关系也越来越复杂，同事们也不愿意给我支持。PM给的需求是错的，我因为不了解相关的项目，把很奇怪的需求都做完了才发现产品有问题，之后PM就不管了，反而需要我去和他们撕逼才能推进项目。中途几次我都不想做了，但EM也不给我别的活。直到9月份才launch了这个neutral 的feature。</p>
<p>就这样用一种很奇怪的方式体验了PM和PMO的角色，而至今还有不同职能的人和我谈起这个项目，说起别人的不是，说起别人怎么在背后说我的不是，别人也在我面前说他人的不是。因此项目结束后我又有了类似罗生门的体验，只不过侦探是我，罪犯是我，受害者也是我，证词却是从他人那里来的。但总之，这让我感觉到了组织上沟通的问题，也让我更想出去看看其他组织是如何沟通的，以及是如何规划产品的。是否之后就会选择一直做业务呢？也许会吧，最近看了《大教堂与集市》、《硅谷传奇》，才明白所谓技术本身一直在不断演化，各种技术存在的目的不过是为了满足人的需求，帮助人更高效地和环境交互，和他人沟通，我对此仍有很大的兴趣。</p>
<p>&gt; — &lt;The Evolution of the Unix Time-sharing System&gt;</p>
<p>前面说到的项目让我学到了很多（当然也让我焦虑了很多），10月份做新项目的时候，我才知道怎么去要人要资源，新的项目因为我向上预期管理的不错，还额外要到了好几个eng 帮我开发，PM也是换了正常的PM，所以很轻松。上线后我就开始休假了。本来放假期间还打算按去年年终小结说的那样，走一波《大唐西域记》的路线，为此还做了详细的<a href="https://jiachen-yu.notion.site/Go-West-19b60194783548a68eea23e172294713">出游计划</a>，结果出发前几天西安就突然疫情了。于是我就决定待在北京家里宅着，看了几本书，接下来还剩几天假，也不想学习，属实不知道该做啥了……</p>
<h2 id="专注">专注</h2>
<p>内心的自卑和焦虑，一直是我的问题，就比如学历的问题一直让我很困惑，今年北京放宽了落户政策，但还是轮不到我这个双非本科生（我猜测自己应该是公司工程师里的学历下限了😅）。同学们也有发展特别好的，比较下来我也会感到焦虑不安，特别是我司的技术栈和国内很不一样，技术挑战也少。</p>
<p>最近学到了一个定理——“帕金森琐碎定理”</p>
<blockquote>
<p>该定理显示，群体将给予更多的时间和注意力来处理琐碎的问题，而不是用来处理严肃而实质性的问题。
常见的虚构例子是委员会批准核电站的计划，他们大部分时间都在讨论自行车棚的结构，而不是电厂本身等更为重要的设计。如果没有大量的专业知识或者准备，很难给非常大的复杂主题讨论提供宝贵的意见。但是，人们希望看到更多意见。因此，他们倾向于将大量时间集中在很容易推敲，但不一定被看重的小细节上。</p>
</blockquote>
<p>自己或多或少也陷入了这样的思维陷阱，虽然焦虑但也不去解决。今年下半年决定直面跳槽的问题了，但我也没有准备跳槽，而是决定在这之前先把公司的资料和自己一直想看的书看完，因为害怕跳槽之后就没有时间了。2022年自己会开始不断接触外面的公司，希望没有拖得太久。当然也并不是说跳槽就能解决自卑和焦虑的问题了，就我而言，面对这些问题更好的方法貌似就是给它们适当的关注，关心感受但努力不去沉溺在情绪里，把更多的时间留在想要完成的事情里。让事情完成的成就感、和从中学到的新认知去消解部分负面情绪。</p>
<p>接回工作来说，今年在工作上学会了很多沟通的软技能，，也知道如何去衡量一件事情的ROI和优先级。以前自己总会主动地（加班）完成边边角角的事情，比如重构代码，把前端动画做得更好看等等，让事情看上去很完美，但其实这些边角并不是重点。代码优雅与否，都没有是否能解决产品需求来得重要；而需求能否奏效，也要看战略是否正确，用户是否买账。当然当然，我也不是说优雅的代码，严谨的需求不重要，不懂业务的时候，先把目标放在理解业务上，自己的产出质量差一些没关系，能跟上团队其他人的节奏就行；理解业务后，再把目标放在提升自己产出的质量上，这样或许会更好一些。</p>
<p>还有一个和专注有关的事情是自己4月份的时候读完了十三邀的一本文集，后来自己感慨大师们这么厉害，也是因为他们足够专心，如果我把时间放在各种感兴趣的事情上，很大概率什么事情都只能得一些皮毛。所以之后我也放弃了日语学习，我觉得日语对我真的挺重要的，这样我就不需要翻译就能接触各种日本的媒体资源，也方便以后的出国旅游（也许5年后吧 QwQ，希望疫情快些结束🙏），但现阶段工作上的知识显然对我更重要，多背些英文单词和语法也比背五十音图带来的好处多，所以只能暂时放弃日语的学习，希望可以尽早恢复吧。</p>
<h2 id="依旧无趣">依旧无趣</h2>
<blockquote>
<p>We are living in one of the loneliest periods in human history.
这句话是我司CEO在接受the verge的decoder 播客<a href="https://www.theverge.com/22783422/airbnb-pandemic-ceo-brian-chesky-interview-travel-decoder-podcast">采访</a>时说的。这句话突然让我感到一种浪漫感，我也生活在最孤独的年纪里，某些时刻，或许我和世界同调了。</p>
</blockquote>
<p>孤单的同时我也越来越察觉到自己正在成为一个无趣的人，也感觉到自己的情绪越来越弱，刚来北京的前两年，我总是很挑食，也会尝试各种餐厅给自己找一些新鲜感，但现在我已经接受了每天的重复，一样的餐厅，一样的口味；生活也变得越来越规律，每周三次运动，每天都是到点入睡，到点醒来，除了工作和肚子太饿的情况……上半年自己因为工作太忙就不再参加各种社团，导致后面闲下来后和人的接触也越来越少……</p>
<p>这就是长大吗？真的好无聊呀。</p>
<p>自己还养成了一个习惯，就是看到感兴趣的文章、视频时，不管内容咋样，我都不会不立即去看。而是把相关的链接放到todo list里，只有无聊的时候才会去翻。接着我就发现，很多一开始自己感兴趣的东西，放几天后我就完全不想去看了，于是直接从todo list 移除，节省了很多时间。（所以一天天的就更无聊了……</p>
<p>休假期间，我也只能靠读书和写作打发无聊的时间，工作之后应对无聊的方法应该就是学习和面试吧。今天（12月30日）离上班还有4天，本也想回家看看，但需要提前一天做好核酸，中途转机来回也要一天，一回家还就要去做核酸准备回京，这样在家也只有2日，路上还有途径地点出现新病例的风险……想想还是作罢。</p>
<h2 id="mark一下">mark一下</h2>
<p>今年觉得有意思的东西……</p>
<h3 id="flomo">Flomo</h3>
<p>（写完后我发现这一段好像软文…… 干脆直接贴一个邀请码吧 <a href="https://flomoapp.com/register2/?MTYxNzM4">https://flomoapp.com/register2/?MTYxNzM4</a></p>
<p>知道Flomo 是因为今年8月份印象笔记对Flomo 的抄袭，以及Flomo 对此的<a href="https://mp.weixin.qq.com/s/iuhd-SmfPGHa_s5g2f1MYg">公关</a>。随后我对Flomo 就一发不可收拾了，Flomo 最大的特点是记录笔记没有阻力，电脑快捷键，微信语音输入，苹果生态的快捷指令……都能作为Flomo 的输入端。我自己有一个夸张的例子来说明Flomo的无阻力记录，自己睡前脑子经常会冒出一些想法，于是就会立即用Apple Watch 的快捷指令把想法记录到Flomo里面，其实就是对着Apple Watch说一段话点确认，说完就继续睡了。（然后发现睡前的想法都是当时觉得好厉害，清醒的时候却经不起推敲）</p>
<p>Flomo还有一个好处是不强迫用户去分类，很多时候想记一个东西，其他笔记产品都会要求你建立文件夹，然后下面放笔记，通常我在记笔记前都会因为这件事纠结很久，索性有的就不记了。但Flomo的策略就是让你先写完再说，写完才完成了思考，之后去考虑如何组织已有笔记更加高效。
一段时间后，整理一下Flomo，一些笔记要么变成Notion 里的wiki；要么变成Ulysses 中的文章；还有一些笔记因为没有成型可以打上标签继续留着；剩下的当然就是需要删除的废话笔记了。但是废话笔记也有用处，可以发现最近自己是不是在一些事情上卡住了，比如我发现我会反复记一些自我怀疑的话，而且相关的笔记随着时间推移，其内容也没有变化，说明我在这个问题上反复思考了太久却没有深入（需要去看心理医生吗（雾(´-ω-`)。还有一些被我发现的事情不方便在这里写，但的确让我引起了注意，并随后会想办法去解决。</p>
<h3 id="快捷键">快捷键</h3>
<p>最近自己迷上了各种快捷键，仿佛打开了新世界的大门，键盘的操作真的比鼠标准确快速多了，而且在mac 上还有各种好玩的脚本和工具可以下载，目前自己用的都还是些基础的（magnet、cheatsheet、zsh 的git 插件等……）。除此之外，浏览器也可以用Vimium或Vimari变成Vim模式，自己也打算未来有空去学习一下Emac。CMU也有一门课程专门说各种程序员常用效率小工具的，可以顺便在这儿推荐一下。<a href="https://missing.csail.mit.edu">https://missing.csail.mit.edu</a></p>
<h3 id="eva终">EVA终</h3>
<p>自己说了太多EVA相关的了，也许未来还会写一篇相关的文章。还有什么好说的呢？他人的死亡，恋人的远离，这些真嗣都学会了如何去接受，淡淡的告别和珍重，随后他长大了，福音战士们也一并消失了，该回到现实了。</p>
<h3 id="进击的巨人">进击的巨人</h3>
<p>虽然《进击的巨人》只是一个少年漫画和相关的动画系列，但在人群、国家逐渐对立的当下，《进击的巨人》或许可以引起大家的反思。巨人咋一看只是一个热血少年漫，但随着剧情的发展，巨人多了一些悬疑色彩，慢慢有了政治悬疑的味道，随之而来的是对宏大叙事的疑惑；到了最终季Part I，巨人俨然变成了反战主题，Part I 的最后几集真是把我哭得稀里哗啦的。因为动画还没有结局，我对漫画结局只有大概的了解，网上对漫画的结局普遍是负面的态度，但我觉得也不妨把这个结局当作是作者对人性的反思（反正我没看过结局瞎说的，别喷我( ´▽｀)</p>
<hr>
<p>嘛……总的来说今年是经历了很多事情的一年，收获了很多宝贵美好的经历，于是乎我又老了一岁。想起今年的某个深夜，街道上空阔无人，小雨落下几滴后就停住了，天上虽然有乌云但仿佛我可以看到繁星，那一刻我想起曾经读到的夜晚都市故事，都是那么的安详静谧。如今这个时刻也一并消失在了过去，没有什么会成为唯一和永恒，但那一场经历也因此变得独特而珍惜。</p>
]]></content:encoded>
  </item>
  <item>
    <title>置身事内</title>
    <link>https://www.yujiachen.com/in-the-system/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/in-the-system/</guid>
    <pubDate>Tue, 28 Dec 2021 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<h1 id="评论">评论</h1>
<h2 id="个人经历对工作选择的影响">个人经历对工作选择的影响</h2>
<p>90年代和00年代前期，就是一个公职人员福利不断增加的时代吧。我们父辈觉得公务员好，很大程度上是因为他们年轻时期的经历导致吧，我们对互联网的相信，也是因为年轻时各种互联网创业神话击败了这种“事业编制是铁饭碗”的叙事，本质上我们和父辈没有太大的区别。</p>
<p>我的老家是浙江的一个偏远地区，主要的地方收入都是省政府的财政补贴，更加剧了家乡中年人（至少是我父亲）对这个叙事的相信。</p>
<p>我的父亲同时也是一个极度厌恶风险的人，一部分也许和他小心谨慎的性格有关。还有一部分也是家乡并不是很好的创业环境，和我父亲相似学历的人，要么离开家乡承担风险；要么在家乡承担风险失败了；还有更多的是融入了体制取得了成功；而在家乡创业成功的本地人，大多是我父亲“看不上的土老板”。我们只不过是身边人的一个平均罢了。</p>
<h2 id="人情关系">人情关系</h2>
<p>只要工作业绩不能被清楚的衡量，那么就需要上级的主观评价。人情其实也是有好有坏的，如果双方的利益都能通过提升集体利益的方式实现，那么人情也是一种提高效率的方式，更像是信任与合作关系的体现。同时组织也需要一定程度的论资排辈机制（但我们也应该去探索更好的客观机制），用一些客观因素去防止人的主观判断失误以及个人利益损害集体利益的情况。</p>
<h2 id="升职">升职</h2>
<p>体制内的升职速度和企业相比是过于缓慢的，就这一点在企业上班的上升空间还是比体制内高的。</p>
<p>对企业而言，盘子小，凡处于扩展阶段的企业，大家努力工作就是正和博弈，新人会不断进来，大家都能升职加薪。但是政府编制的盘子太大了，客观上也无法急剧扩张，所以体制内升职变成了零和博弈。</p>
<p>这也是企业员工不得不内卷，但体制内有躺平自由的原因之一吧。不过文化总是会互相影响的，社会上大多数人还是在体制外工作，这种加班风气也会影响体制内；同时体制外也有工作生活平衡的呼声，这也会影响到企业。</p>
<h2 id="中美理财差异">中美理财差异</h2>
<p>中国人财富的压舱石是房子，美国人财富的压舱石是金融资产。从这个角度就能看出为什么A股一直萎靡不振，而美股节节高升了……</p>
<p>最近国家对股市的压制也是是防止GDP过度依赖金融业吧，2015年-2019年我国金融业增加值占GDP的平均比重达到了8%，相当于美国在全球金融危机前的水平。但美国的资本市场汇聚了全世界的资金，所以某种程度上我国的金融业规模的确需要缩小。</p>
<p>在中国牺牲股价保护房价，其实就是用小部分人的牺牲保护多数人的利益，其实是一个明智选择。</p>
<h2 id="对不平等的容忍度">对不平等的容忍度</h2>
<p>保持容忍度的最简单方法不是降低差异，而是保证个群体都有机会，还有较清晰的规则，这样至少大家愿意等待。</p>
<h2 id="风险不对等">风险不对等</h2>
<p>一旦系统中各方的风险承受能力是不对等的，那么风险往往会让承受能力最弱的那一方承担。</p>
<p>债务的风险承担方一般是穷人而不是富人；很多时候股权是更合理的融资方式，双方共同承担盈亏，但是只有相当体量的公司或是被市场和投资人看好的初创公司才能享受这种融资方式，同时大多数创业者并不缺钱，现有的融资体系有合理也有不公的地方。</p>
<p>还可以看一下“影子银行”的例子，企业想要从银行借钱，愿意出10%的利息，那么银行绕过监管的方法就是开放一个基金，也许会宣传基金的收益率是5%，但是不保证盈亏。一般散户把前投入基金后，如果企业亏损，那么基金亏损，大家一起承担风险；但如果企业盈利的话，银行可以只把部分利息放入基金中，另一部分直接收走（这个例子中是5%的差价），此时也是散户承担了最多的风险。</p>
<h2 id="工业发展趋势">工业发展趋势</h2>
<p>工业必然会越来越自动化，未来大多数就业会依靠服务业的发展，这里面人的因素占比会越来越大，需求也灵活多变，非标准化。</p>
<p>想起来最近听的一期《声东击西》播客，里面说到算法标准化带来的问题，于是就有了MCN人为地给旗下主播分配资源位；配送站之间的骑手互相帮助处理异常单。当算法和前面说到的自动化工业成为一个既定的事实标准后，围绕着这些规定的边边角角就会诞生对现实更优的解决方案（而这些方案一旦证明了自身的优势和可扩展性后，就会被吸收进系统）。</p>
<p><a href="https://www.xiaoyuzhoufm.com/episode/61a845fc36124d2d26b5d914?s=eyJ1IjogIjVmYjlkMjMwZTBmNWU3MjNiYmE5Yzg4MiJ9">#192 平台：现代社会的遥远巫术</a></p>
<hr>
<h1 id="观点">观点</h1>
<p>要避免把舶来的理论化成先入为主的判——看到现实与理论不符，便直斥现实之非，进而把要了解的现象变成了讥讽的对象——否则就丧失了“同情的理解”的机会。</p>
<p>另一方面，公众所接触的信息和看到的现象，大都己经是博弈后的结果，而缺少社会阅历的学生容易把博弈结果错当成博弈过程。</p>
<h1 id="地方政府的权力与事务">地方政府的权力与事务</h1>
<p>在任何体制下，权利运作都受到两种约束：做事的能力及做事的意愿。前者取决于掌握的资源，后者取决于各方的积极性和主动性。</p>
<h2 id="外部性与规模经济"><strong>外部性与规模经济</strong></h2>
<p>一方面，因为规模经济，覆盖的人越多越划算，政区越大越好；另一方面，受制于人们获取这些服务的代价和意愿，政区不能无限扩大。</p>
<p>公共物品是可以产生规模经济的。</p>
<h2 id="复杂信息"><strong>复杂信息</strong></h2>
<p>上级虽然名义上有最终决定权，拥有“形式权威”，但由于信息复杂、不易处理，下级实际上自主性很大，拥有“实际权威”。</p>
<p>工作总要下级来做，不可能没有一点自主性；下级也总要接受上级的监督和评价，不可能完全不理上级意见。但无论如何，信息优势始终是权利运作的关键要素。</p>
<p>实际权威来自信息优势，这一逻辑也适用于单位内部。</p>
<p>所谓权力，实质就是在说不清楚的情况下由谁来拍板决策的问题。</p>
<p>合同不可能事先写清楚所有情况，所以权力的实质就是在这种不确定情况下的决定权，可以称为“剩余控制权”。</p>
<p>上级在提拔下级时，除考虑工作能力外，关键岗位上都要尽量安排信得过的人。</p>
<h2 id="激励相容"><strong>激励相容</strong></h2>
<p>能评价和奖惩工作业绩的上级，能决定工作内容的上级，受下级工作影响最大的上级，应该是同一上级。</p>
<p>做任何事都有代价，最优的结果是让效果和代价匹配，而不是不计代价地达成目标。</p>
<h1 id="财税与政府行为">财税与政府行为</h1>
<h2 id="分税制改革">分税制改革</h2>
<p>人员过多一直是政府顽疾，分税制改革后建立的转移支付体系中，相当一部分转移支付是为了维持基层政府正常运转和保障人员工资。财政供养人员（即有编制的人员）越多，得到的转移支付越多，这自然会刺激地方政府扩编。从1994年到2005年，地方政府的财政供养人员(在职加退休）猛增了60%，从2981万人增加到4778万人。2005年实行 “三奖一补”之后,2006年财政供养人口下降了318万。之后又开始缓慢上升,2008年达到4 631万。2009年后，财政供养人员的数据不再公布。</p>
<h1 id="政府投资与债务">政府投资与债务</h1>
<h2 id="招商引资中的地方官员">招商引资中的地方官员</h2>
<p>在官员考核和晋升中，政绩非常重要，但这不代表人情关系不重要。无论是公司还是政府，只要工作业绩不能百分百清楚地衡量（像送快递件数那样），那上级的主观评价就是重要的，与上级的人情关系就是重要的。人情和业绩之间可能互相促进：业绩突出容易受领导青睐，而领导支持也有助于做好工作。但如果某些领导为扩大自己的权力和影响，在选人用人中忽视工作业绩，任人唯亲，就可能打击下属的积极性。在这类问题突出的地区，官僚体系为了约束领导的 “任性”可能在晋升中搞论资排辈，因为年龄和工龄客观透明，不能随便修改。但如此一来,政府部门的工作效率和积极性都会降低。</p>
<hr>
<p>平均来说，在一个县里所有的正科实职干部中，每年升副县级的概率也就1%，而从副县级干部到县委副书记，还要经历好几个岗位和台阶，动辄数年乃至数十年。因此绝大多数政府工作人员最在意的激励并不是晋升，而是实际收入以及一些工作福利。</p>
<h1 id="城市化与不平衡">城市化与不平衡</h1>
<h2 id="房价与居民债务">房价与居民债务</h2>
<p>根据中国人民银行的这项调查，城镇居民 2019年的负债中有76%是房货。而从资产端看，城镇居民的主要财产也就是房子。房产占了家庭资产的近七成，其中六成是住房，一成是商铺。而在美国居民的财富中，72%是金融资产，房产占比不到28%。中国人财富的压舱石是房子，美国人财富的压舱石是金融资产。这个重大差别可以帮助理解两国的一些基本政策，比如中国对房市的重视以及美国对股市的重视。</p>
<h2 id="不平衡要素与市场改革">不平衡要素与市场改革</h2>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/in-the-system/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/in-the-system/zh/image_1.png" alt="" class="article-image" width="600" height="408" />
</picture>
</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/in-the-system/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/in-the-system/zh/image_2.png" alt="" class="article-image" width="600" height="344" />
</picture>
</p>
<p>上面两个图表分别是《2019年美国各州占全国GDP和人口比重》，以及《2019年中国各省、自治区、直辖市占全国GDP和人口的比重》</p>
<p>可以看出来如果要均衡发展，假设经济不会衰退，但各地最终GDP占比和人口占比的比例达到了1，则：</p>
<ul>
<li>目前大于1的地区：
<ul>
<li>人口占比变大，房价上涨；</li>
<li>经济增速放缓，房价保持不变。</li>
</ul>
</li>
<li>目前小于1的地区：
<ul>
<li>人口占比变小，房价下跌；</li>
<li>经济增速加快，房价上涨。</li>
</ul>
</li>
</ul>
<h2 id="经济发展与贫富差距">经济发展与贫富差距</h2>
<p>不妨想象正在排队的两队人，富人队伍前进得比穷人快，但穷人队伍也在不停前进，所以排队的穷人相对来说比较有耐心。但如果穷人的队伍完全静止不动，哪怕富人队伍的前进速度也减慢了，因在原地的穷人也会很快失去耐心而骚动起来。</p>
<p>家庭观念也会影响对不平等的容忍度。在家庭观念强的地方，如果子女发展得好、有出息，自己的生活就算是有了保障，对贫富差距容忍度也会比较高，毕竟下一代还能赶上。</p>
<h1 id="债务与风险">债务与风险</h1>
<p>法律优先保护债权人的索赔权，债务常常把风险集中到承受能力最弱的穷人身上。</p>
<hr>
<p>若某房地产企业愿意用10%的利息借钱，银行想借，但我国严格限制银行给房企的货款量，怎么办？银行可以卖给老百姓一个理财产品,利息5%，再把筹来的钱委托给信托公司，让信托公司把钱借给房企。在这笔“银信合作”业务中，发行的理财产品不算银行储蓄，委托给信托公司的投资不算银行贷款，所以这笔“表外业务”就绕开了对银行的监管，是一种“影子银行”业务。</p>
<hr>
<h1 id="言论">言论</h1>
<p>挟管仲之智者，非为厮役之使也。怀陶朱之虑者，不居贫困之处。文学能言而不能行，居下而讪上，处贫而非富，大言而不从，高厉而行卑，诽誉訾议，以要名采善于当世。夫禄不过秉握者，不足以言治，家不满檐石者，不足以计事。儒皆贫羸，衣冠不完，安知国家之政，县官之事乎？何斗辟造阳也！</p>
<p>写这样一本书，若想说清观点，作者有时必须装得成竹在胸一点。想让自己的论述站得稳，便不能甫一下笔就顾虑重重。论述这些问题实非易事，我有时轻描淡写，斩钉截铁，但其实心中始终有所顾虑，也许读者能够体谅。</p>
<p>——凯恩斯《论概率》</p>
]]></content:encoded>
  </item>
  <item>
    <title>关键迭代：可信赖的线上对照实验</title>
    <link>https://www.yujiachen.com/key-iterations-trustworthy-online-controlled-experiments/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/key-iterations-trustworthy-online-controlled-experiments/zh/</guid>
    <pubDate>Fri, 24 Dec 2021 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>本文是对《关键迭代：可信赖的线上对照实验》的摘抄和总结。或者说一位 Airbnb 的读者，对一本作者与译者均来自 Airbnb 的技术书做的小结 😁。如有错误恳请指出，欢迎各种评论。</p>
<blockquote class="callout callout-note">
<p>💡 如果你只有一个锤子，那你看什么都像钉子。——亚伯拉罕·马斯洛</p>
</blockquote>
<h1 id="准备测试">准备测试</h1>
<h2 id="想成功就多失败">想成功就多失败</h2>
<p>实验的带来的认知改变也和预期于现实的差距有关。</p>
<p>如果你认为一件事情会发生，然后它真的发生了，那么你不会学到什么。如果你认为一件事情会发生，但没有发生，那么你会学到一些重要的东西。如果你原本认为一件事情不值一提，但它带来了惊人的或突破性的结果，那么你会学到一些非常有价值的东西。</p>
<p>团队认为一个产品功能有用才会去开发它，然而，很多领域的大部分想法都无法提升关键指标。在微软，被测试过的想法仅有三分之一能改善目标指标。在已经高度优化的产品领域，如必应和谷歌，想要成功就更难了，测试的成功率仅在10%～20%之间。 必应几百人的关联算法团队每年的任务就是将单个OEC指标提高2%。</p>
<h2 id="测试是战术-决策是战略">测试是战术，决策是战略</h2>
<p>测试大胆的想法时，运行和评估实验的方式也有所变化。</p>
<ul>
<li>实验的运行时长，房间里温度的小幅提升不会引起变化，而一旦达到熔点，冰块就会开始融化。</li>
<li>被测试的创意数量。每个实验只测试一个具体的战术，该战术是总体战略的一个组成部分。个别实验的失败不代表总体战略有问题。但如果经对照实验评估后的很多战术都以失败告终，那大概率就是战略的问题。用实验来验证战略是极其消耗成本的，制定战略所需的数据应该从已收集的可用数据中得出。</li>
</ul>
<p>OKR 的一种解释就是确定战略 O，其后的 KR 衍生出一系列战术来满足 KR 并回馈到 O。</p>
<h2 id="什么是显著结果">什么是显著结果</h2>
<p>不是所有用户显著的结果都有实际意义。以人均营收为例，多大的差异从业务角度来说是紧要的？换句话说，什么演的变化是<strong>实际显著</strong>的（practically significant）？构建这一实质性的边界很重要，它可以帮助理解一个差异是否值得话费相应改动所需的成本。如果你的网站像谷歌和必应那样有数十亿美金的营收，那么 0.2% 的变化是实际显著的。作为对比，一个初创公司可能认为 2% 的增长都太小了，因为他们追求的是 10% 或更大的增长。</p>
<p>2012年 bing 每 10 毫秒的性能提升（眨眼速度的 1/30）足以支付雇佣一个全职工程师一年的成本。到了 2015 年这个数字变成了 4 毫秒。</p>
<h1 id="搭建测试">搭建测试</h1>
<h2 id="变体分配">变体分配</h2>
<p>如何把实验分配给用户</p>
<ul>
<li>单层方法。把用户分桶，比如1000 个桶，每次拿两个用户桶做实验。</li>
<li>并行实验。
<ul>
<li>把代码架构分层，每层只有一个实验。</li>
<li>不关心实验互相影响，默认实验都是正交的，如果有不正交的实验，依赖执行团队发现并解决矛盾。</li>
</ul>
</li>
</ul>
<h2 id="指标分类">指标分类</h2>
<ul>
<li><strong>目标指标</strong>，也被称为<strong>成功指标</strong>或<strong>北极星指标</strong>，它体现了机构终极关心的是什么。能用语言把你的目标清楚表达出来是重要的，因为从目标到指标的转化通常都不完美，你的目标指标也许只是你真正关心事物的一个近似，并且需要随着时间推移而迭代改进。让人们能理解这个局限性，以及指标与目标陈述之间的区别，对于把握公司的正确方向是至关重要的。</li>
<li><strong>驱动指标</strong>，也被称为<strong>路标指标</strong>、<strong>代理指标</strong>、<strong>间接</strong>或<strong>预测指标</strong>，一般比目标指标更短期，变化更快也更灵敏。驱动指标反映了一个思维上的因果模型，它是关于如何做可以让机构更成功，也就是对成功的驱动力的假设，而非关于成功本身是什么样的。</li>
<li><strong>护栏指标</strong>，保证我们在通往成功的道路上有正确的权衡取舍，不会违背重要的限制。</li>
</ul>
<h2 id="指标选择">指标选择</h2>
<p>指标选择在不能违反数理常识的前提下，还取决于设计者的价值选择（“人是目的，不是手段”）。指标代表着你想要系统怎么去理解数据，你的关心是什么。例如关注极端值就要用P95 P99，关注整体情况就用平均值和中位数。</p>
<h3 id="代理指标">代理指标</h3>
<p>一些订阅服务以年为单位续订。除非你愿意运行一个长达一年的实验，否则很难测量对续订量的影响。对于这种情况，我们不能用续订率作为实验指标，而是需要寻找代理指标，比如服务的使用量，这类指标往往可以提早显示用户对服务的满意度，并最终影响续订率。</p>
<h3 id="指标归一化">指标归一化</h3>
<p>即便想要提高的是营收总和，也不建议将营收总和作为指标，因为它依赖于变体对应的用户数量。即便各变体被等量分配，实际用户数也可能因为偶然性而有所不同。我们推荐按实际样本量归一化的关键指标，因此<strong>人均营收</strong>才是一个好的综合评估标准。</p>
<h3 id="对偶性">对偶性</h3>
<p>有时候精确测量你不想要的事物反而比测量你想要的更简单，如用户的不满意度和不幸福度。 从观测数据中建立因果关系是很难的，但一个仔细进行的观测研究有助于否定错误的假设。</p>
<h3 id="预防子指标冲突">预防子指标冲突</h3>
<p>要仔细检查大指标下面的各个子指标，很有可能子指标之间是互相冲突的，例如搜索引擎的人均搜索量 = 人均会话数 * 会话平均的去重查询个数。</p>
<p>一个会话的开始被定义为用户开始第一次查询，结束则是用户30分钟内在搜索引擎上没有活动。</p>
<ul>
<li>人均会话数大概率是一个正向的指标，用户对搜索引擎越喜欢，其使用频次就会上升，那么人均会话数也会上升。</li>
<li>会话的平均去重查询却应该减少，这个与总目标相违背。因为单次会话的平均去重查询减少代表用户解决问题的步骤变少了，但是也有可能代表用户放弃了查询。我们最好伴随这个指标在建立一个查询中途放弃的指标。</li>
</ul>
<h2 id="陷阱">陷阱</h2>
<h3 id="警惕极端结果">警惕极端结果</h3>
<p>当看到令人惊讶的正面结果（例如对关键指标的重大改进）时，我们倾向于围绕它构思一个故事，分享并庆祝。当结果出人意料地是负面的时候，我们倾向于找出这项研究的某些局限性或较小的缺陷，并将其忽略掉。 经验告诉我们，许多极端结果更有可能是由工具化记录（例如，日志记录）的错误、数据丢失（或数据重复）或计算错误导致的。</p>
<h3 id="辛普森悖论">辛普森悖论</h3>
<p>在某个条件下的两组数据，分别讨论时都会满足某种性质，可是一旦合并考虑，却可能导致相反的结论。</p>
<p><a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s paradox - Wikipedia</a></p>
<p>当实验feature 导致了两个互为穷尽且互斥的细分群中的个体发生迁移，也会导致类似的情况（虽然书中强调这不是辛普森悖论）。</p>
<p>例如某个feature 让等级2 的用户回到了等级1，可能两个等级的数据都变好了，因为等级2 的用户群剔除了表现差的用户，而等级1 的用户群增加了表现好的用户，但可能两个等级的总用户表现不会有变化甚至会变差。</p>
<p>在理想情况下，只应该通过在实验之前就确定的值来进行细分，这样实验不会导致用户对应细分群的更改，但实际上在某些案例下我们很难限制这种细分。</p>
<h3 id="用户群改变">用户群改变</h3>
<p>当计算指标或运行实验时，所有的数据都来自现有的用户群。尤其是对早期产品和初创企业来说，早期用户可能无法代表业务长期发展所希望获取的用户群。</p>
<h3 id="不确定的混淆因素">不确定的混淆因素</h3>
<p>共享这些因素可能会导致实验失败：</p>
<ul>
<li><strong>市场资源</strong>。民宿、网约车有这样的问题，一旦进入supply constraint，一个组抢占过多的资源会让另一个组失去原有的资源。</li>
<li><strong>广告活动的预算</strong>。</li>
<li><strong>关联模型训练</strong>。一旦两个模型都是用全量用户的数据计算的，那么几天后很可能两个模型的知识会发生共享。</li>
<li><strong>CPU或其他计算资源</strong>。</li>
</ul>
<h3 id="others">Others</h3>
<p>Goodhart 法则：当一个测量变成目标时，它就不再是一个好的测量。</p>
<p>Lucas 批判观察到在历史观测数据中的关系是无法被考虑为结构性的或者因果关系的。政策上的决定会改变经济模型的结构，这样以来历史上的关联性就不再成立了。随着时间的变化，可能我们之前倚赖的因果关系都会变化。</p>
<h2 id="长期实验">长期实验</h2>
<p>短期实验和长期实验结果可能不同的原因：</p>
<ul>
<li>用户的习得效应。</li>
<li>网络效应。</li>
<li>延迟的体验和评估。</li>
<li>生态系统的变化
<ul>
<li>启动其他新功能。</li>
<li>季节性。</li>
<li>竞争格局。</li>
<li>政府政策。</li>
<li>概念漂移。</li>
<li>软件性能下降。</li>
</ul>
</li>
</ul>
<p>长期运行实验的改善方法：</p>
<ul>
<li><strong>群组分析</strong>。长期跟踪一个稳定群组的用户数据。</li>
<li><strong>后期分析</strong>。运行一段时间后关闭实验/或者把实验开放给所有用户，然后继续测量对照组和实验组的差异。</li>
<li><strong>时间交错时实验</strong>。把实验开始时间t 作为变量创建多个实验组，比较不同t 之间用户的差异表现。</li>
<li><strong>留出和反转实验</strong>。
<ul>
<li>留出：留下10%的用户在对照组；</li>
<li>反转：几个月后吧10%的用户重新放到对照组。去测量用户的表现。</li>
</ul>
</li>
</ul>
<h2 id="伦理">伦理</h2>
<ul>
<li><strong>尊重人</strong>：尊重实验参与者是有自主行为能力的个体，并在他们丧失这种能力时保护他们。这一原则的重点是透明、真实和自愿（选择和同意）。</li>
<li><strong>有益性</strong>：保护人们免受伤害。正确评估风险和收益，并在审查拟议研究时适当平衡风险和收益。</li>
<li><strong>正义性</strong>：确保不剥削参与者，并公平分配风险和收益。</li>
</ul>
<h2 id="一个例子-设计一个减速实验">一个例子：设计一个减速实验</h2>
<p>为什么减速实验可以测出加速对产品的影响？</p>
<p>假设相关指标（如营收）对性能（如速度）的变化图线，在当前值附近可以很好的被线性拟合。这就是一阶泰勒展开的近似，或者说是线性近似。</p>
<p>即如果我们改进性能，得到的指标变化是可以用降低性能得到的指标变化来近似的。</p>
<p>还有两个原因可以支持这个假设</p>
<ul>
<li>从我们自己作为用户的经验来看，网站速度是越快越好的。即大家都喜欢性能好的产品。</li>
<li>我们还可以去验证线性假设，比如测试一下延迟100ms 和延迟250ms 的指标，看一看在这两个情况下得到的指标是否符合线性关系。</li>
</ul>
<h2 id="替代方案">替代方案</h2>
<p>如何去测量虚拟事实呢？考虑要计算一个测试对象为人群的实验，想要知道此实验的虚拟事实和现实的偏差，我们有：</p>
<pre class="hljs"><code>  受影响人群的结果 - 未受影响人群的结果
=（受影响人群的结果 - 受影响人群如果未受影响的结果） +
 （受影响人群如果未受影响的结果 - 未受影响人群的结果）
= 变动对于受影响人群的作用 + 选择性偏差
</code></pre>
<p>我们能观测到的是是否收到影响人群的表现，但我们想知道的是变动对于受影响人群的作用，所以我们期望系统中的选择性偏差为0。</p>
<p>A/B 测试就是选择性偏差为0 的系统，但是很多实际情况我们无法把A/B 测试施加到一个现实问题中，比如没有随机化单元，比如实验会带来巨大的（机会）成本浪费，比如实验会有违伦理道德。</p>
<p>一般有这些方法来替代A/B 测试，但这一类方案总是会比A/B 测试带来更大的误差和夸张的结果：</p>
<ul>
<li><strong>中断时间序列</strong>，把实验时间分割成许多小段，每段时间均匀（且随机、或者就是轮询）地分配给各个事实，然后对此进行测量和分析（一些时序模型可以派上用场，比如贝叶斯结构时间序列分析）。</li>
<li><strong>交错式实验</strong>，经常用于排名算法，奇数位置展示算法A，偶数位置展示算法B，以此来比较差异。</li>
<li><strong>断点回归设计</strong>，当受实验影响的人群是由一个明确阈值识别的情况下时考虑该方法，把刚好低于阈值的人群作为对照组，将刚好高于阈值的人群作为实验组，通过比较这两组人群来减少选择性偏差。比如研究奖学金对学生的影响，80分以上的考生可以有奖学金，那我们就研究84-80 和79-75 这两个考生群体。</li>
<li><strong>工具变量和自然实验</strong>，如果能在被研究流程中找到可以帮助我们实现随机分组的工具，那么利用这个工具来分析实验，比如采取抽签制的征兵和入学分配，若可以判定抽签过程是随机的，那么就可以用抽签作为随机化单元。</li>
<li><strong>倾向评分匹配</strong>，虽然我们无法随机化，但是如果我们可以分清楚不同组别之间可能会影响我们对变量判断的混淆因素（协变量），又或者可以确定无法辨别的混淆因素不会影响分析，那我们就可以去分析变量和结果之间的因果关系，通常很难做到。</li>
<li><strong>双重差分法</strong>，识别出与实验组尽可能相似的对照组，假设两组在趋势上是相同的。比如选择两个各类特征都相近的两个城市作为对照城市，一个开启新feature，一个不是，然后比较两个城市之间的差异。</li>
</ul>
<p>这一类分析需要小心使用，可能会因为如下原因失效：</p>
<ul>
<li><strong>共同原因</strong>，手掌越小寿命越长，其实是女性的寿命越长。</li>
<li><strong>伪相关性或欺骗性的相关性</strong>，全美拼写比赛的单词长度和当年被毒蜘蛛咬死的人数正相关，但这显然是伪相关性。</li>
</ul>
<h1 id="数学推导">数学推导</h1>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/key-iterations-trustworthy-online-controlled-experiments/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/key-iterations-trustworthy-online-controlled-experiments/zh/image_1.png" alt="" class="article-image" width="1055" height="506" />
</picture>
</p>
<p>我们用双样本t检验来计算p-value，这符合实际的实验设置。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo>=</mo><mfrac><mi>Δ</mi><msqrt><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mi>Δ</mi><mo stretchy="false">)</mo></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex"> T = \frac{\mathit{\Delta}}{\sqrt{\text{var} (\mathit{\Delta})}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4903em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathit">Δ</span><span class="mclose">)</span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">Δ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></eqn></section><p>其中<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mo>=</mo><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover><mo>−</mo><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\mathit{\Delta} = \overline{Y^t} - \overline{Y^c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathit">Δ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0029em;vertical-align:-0.0833em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span></eq> 是实验组均值和对照组均值之差，<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{Y^t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9196em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span></eq> 和 <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\overline{Y^c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8833em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span></eq> 因为中心极限定理符合正态分布。</p>
<p>考虑独立变量的方差公式 <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>a</mi><mn>2</mn></msup><mtext>var</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mtext>var</mtext><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{var}(ax+by) = a^2\text{var}(x) + b^2\text{var}(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></eq>：</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mi>Δ</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover><mo>−</mo><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo><mo>+</mo><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> \text{var}(\mathit{\Delta}) = \text{var}(\overline{Y^t} - \overline{Y^c}) = \text{var}(\overline{Y^t}) + \text{var}(\overline{Y^c}) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathit">Δ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1333em;vertical-align:-0.25em;"></span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1333em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></eqn></section><p>其中<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><mi>Y</mi><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mtext>var</mtext><mo stretchy="false">(</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><msup><mi>n</mi><mn>2</mn></msup></mfrac><mo>∗</mo><mi>n</mi><mo>∗</mo><mtext>var</mtext><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">\text{var}(\overline Y) = \text{var}(\frac 1n \sum^n_{i=1}Y_i)=\frac 1 {n^2} * n * \text{var}(Y) = \frac{\text{var}(Y)}n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1333em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">var</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></eq></p>
<p>p-value 在事实上就是一个条件概率，这个条件概率是：“当零假设为真时，观测到当前差异甚至更大差异的条件概率”，即 <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(观测到\mathit{\Delta}|H_0 为真)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span></span></span></span></eq>。这里的<eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi></mrow><annotation encoding="application/x-tex">\mathit \Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathit">Δ</span></span></span></span></eq> 其实是经过归一化后的 <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></eq>，这个条件概率是可以无视具体实验提前计算出来的，所以我们认为<strong>p-value具有普适性</strong>。</p>
<p>有人会误以为p-value 代表“当观测到当前差异甚至更大差异时，零假设为真的概率是多少”，其实这里面隐含的条件“观测到当前差异甚至更大差异”的概率是针对每个实验不同的， 没有普适性。可以用贝叶斯定理推导两者的关系：</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mi mathvariant="normal">∣</mi><mtext>观测到</mtext><mi>Δ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>∗</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mi mathvariant="normal">∣</mi><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>0</mn></msub><mtext>为真</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>观测到</mtext><mi>Δ</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>∗</mo><mi>p</mi><mtext>值</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{align*} P(H_0 为真|观测到\mathit{\Delta}) &amp;= \frac {P(观测到\mathit{\Delta}|H_0 为真)P(H_0 为真)} {P(观测到\mathit{\Delta})} \\ &amp;= \frac {P(H_0 为真)}{P(观测到\mathit{\Delta})} * P(观测到\mathit{\Delta}|H_0 为真) \\ &amp;= \frac {P(H_0 为真)}{P(观测到\mathit{\Delta})} * p值 \end{align*} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.989em;vertical-align:-3.7445em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2445em;"><span style="top:-6.2445em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mord">∣</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mclose">)</span></span></span><span style="top:-3.5815em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"></span></span><span style="top:-0.9185em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7445em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2445em;"><span style="top:-6.2445em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.5815em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span></span></span><span style="top:-0.9185em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">观测到</span><span class="mord mathit">Δ</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">为真</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">值</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7445em;"><span></span></span></span></span></span></span></span></span></span></span></span></eqn></section><h2 id="方差相关问题">方差相关问题</h2>
<p>p-value 的计算依赖方差，方差估计常见问题：</p>
<h3 id="增量-以及比率指标的方差计算"><strong>增量%，以及比率指标的方差计算</strong></h3>
<p>此时注意，如果指标的含义和分析单元是不同的，很可能会导致一些取值不是独立同分布的。比如算页面转化率，而实验单位是用户，那么用户多次访问页面，让页面数据变成非独立同分布的数据。这时候方差需要从比率计算公式的分子分母各自对应的方差计算得来，不能根据比率公式算出比率再算方差。</p>
<p>下面是正确的计算方法 我们把比率指标写成两个用户指标平均指标的比率</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mfrac><mover accent="true"><mi>X</mi><mo stretchy="true">‾</mo></mover><mover accent="true"><mi>Y</mi><mo stretchy="true">‾</mo></mover></mfrac></mrow><annotation encoding="application/x-tex"> M = \frac {\overline X} {\overline Y} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3337em;vertical-align:-0.7733em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5603em;"><span style="top:-2.2267em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7733em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></eqn></section><p>通过delta 方法，跳过推导，最后的方差公式是：</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>var</mtext><mo stretchy="false">(</mo><mi>Δ</mi><mi mathvariant="normal">%</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><msup><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover><mn>2</mn></msup></mfrac><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo><mo>+</mo><mfrac><msup><mover accent="true"><msup><mi>Y</mi><mi>t</mi></msup><mo stretchy="true">‾</mo></mover><mn>2</mn></msup><msup><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover><mn>4</mn></msup></mfrac><mtext>var</mtext><mo stretchy="false">(</mo><mover accent="true"><msup><mi>Y</mi><mi>c</mi></msup><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> \text{var}(\mathit \Delta \%) = \frac 1 {\overline{Y^c}^2}\text{var}(\overline{Y^t}) + \frac{\overline{Y^t}^2}{\overline{Y^c}^4}\text{var}(\overline{Y^c}) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord mathit">Δ</span><span class="mord">%</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2988em;vertical-align:-0.9773em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.0873em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0873em;"><span style="top:-3.3362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.3173em;"><span class="pstrut" style="height:3.0873em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7643em;"><span class="pstrut" style="height:3.0873em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9773em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.7779em;vertical-align:-0.9773em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8006em;"><span style="top:-2.1462em;"><span class="pstrut" style="height:3.1236em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0873em;"><span style="top:-3.3362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span><span style="top:-3.3536em;"><span class="pstrut" style="height:3.1236em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8006em;"><span class="pstrut" style="height:3.1236em;"></span><span class="mord"><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9196em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8396em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1236em;"><span style="top:-3.3725em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9773em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord text"><span class="mord">var</span></span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></eqn></section><h3 id="离群值"><strong>离群值</strong></h3>
<p>离群值会干扰试验，可以对观测指标添加一个合理的阈值，其他方法自己搜索。</p>
<h3 id="提高灵敏度"><strong>提高灵敏度</strong></h3>
<p>方差越小显著性越高，这些方法可以减小方差：</p>
<ul>
<li><strong>通过添加阈值、二元化和对数转化来改变指标</strong>。购买量比是否购买有更大的方差，人均观看时长比观看超过x小时有更大的方差。</li>
<li><strong>通过触发分析移除噪音</strong>。</li>
<li><strong>通过分层采样，控制变量法或者CUPED在采样范围内进行分层</strong>。最后把每层的结果合并得到总值，这样计算出的方差更小。</li>
<li><strong>选择颗粒度更精细的随机化单元</strong>。</li>
<li><strong>共享对照组</strong>。合理计算出一个对照组的大小，和多个实验组做比较，这样的方差更小，可以提高所有实验组的功效，但也会带来一些问题。</li>
</ul>
<h2 id="p-value-的取值问题"><strong>p-value 的取值问题</strong></h2>
<p>警惕这样一个事实：当p-value 为0.05时，测试一个不显著的feature（比如没有任何改动的feature，此时零假设为真）100次，那么在统计上有5次测试我们会错误地认为这个feature 是显著的（测量到了极端值）。这里我们引入两个概念：</p>
<ul>
<li><strong>第一型错误</strong>，测量结果是显著差异的，但是真实情况是没有差异的。</li>
<li><strong>第二型错误</strong>，测量结果是非显著差异的，但是真实情况是有差异的。</li>
</ul>
<p>不难发现，p-value 越小，第一型错误越少，但第二型错误会增多；反之第一型错误变大，第二型错误变小。</p>
<p>为了防止前述“在统计上有5次测试我们会错误地认为这个feature 是显著的”，这样的第一型错误产生，我们可以对一些确认与实验无关（或间接相关）的指标施加更小的p-value，防止第一型错误发生。<strong>信心越坚定，所需的显著性水平越低。</strong></p>
<p>同时，对比较敏感，我们不希望没有发现差异的guardrail metrics，应该放大p-value。特别是一些指标我们明确其不变化幅度不能超过x%，那我们应该遵循工业界，检验应有80%统计功效的原则（统计功效 = 1 - 第二型错误，一些具体的近似公式请自行查询），根据x 的数值去计算更具体的p-value。</p>
<h2 id="样本量n要多大"><strong>样本量n要多大</strong></h2>
<p>这一段和提高灵敏度那一段重复了一些内容。</p>
<p>样本量n越大越好的理论基础是什么呢？这是因为t分布的前提假设之一就是其测算分布是正态分布，而根据<strong>中心极限定理</strong>，在适当的条件下，大量相互独立随机变量的均值经适当标准化后依分布收敛于标准正态分布。所以我们需要n足够大。</p>
<p>前面叙述的统计功效近似公式可以在给定条件下帮我们测算n的大小，但这个公式需要我们去指定变化幅度x%，只适用在一些guardrail metrics上。</p>
<p>那为了让均值服从正态分布，我们还有基于偏态系数的经验公式来计算n，一些差异较大的指标偏态系数也会很大，我们可以通过限制差异（比如超过10的数值都为10）来降低偏态系数和n，只要限制差异的条件不违反我们的假设就可以。</p>
<p>当然还可以通过构建零分布来验证，但是涉及的概念就更复杂了，此处略过。</p>
<h2 id="tbd-为什么选择t-分布">TBD 为什么选择t 分布？</h2>
<p>需要比较几个抽样分布的特点，可以参考一下大学教材中的总结。</p>
]]></content:encoded>
  </item>
  <item>
    <title>大教堂与集市</title>
    <link>https://www.yujiachen.com/the-cathedral-and-the-bazaar/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/the-cathedral-and-the-bazaar/</guid>
    <pubDate>Fri, 24 Dec 2021 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>思考：最近了解到了两本书APUE （《UNIX 环境高级编程》）和《The Linux Programming Interface》，是对UNIX 和Linux 很权威+详尽的参考书籍。加上自己最近在看《大教堂与集市》 ，了解到了Linux 其实是一个很“混乱”的开源项目，项目本身其实不是在设计好的设计，而是让贡献者的想法被自然筛选，最终去演化好的设计。虽然我没有读过开头说的那两本书，但我想这两本书会着重于说为什么这些设计是好的，但其实这些为什么无关Linux，Linux 只不过是一个不断演进的生态系统而已。</p>
<p>我的启发就是，不是去追求一个完美的设计，而是追求一个可以不断演变的设计，并不断吸纳新的想法去迭代设计，反复尝试多次命中目标的概率，还是要比准备完备却只尝试一次命中目标的概率大吧。</p>
<h1 id="开源的动机">开源的动机</h1>
<h2 id="礼物文化">礼物文化</h2>
<p>文章说了3 种在不同情况下产生的人类组织体系：</p>
<ul>
<li>命令体系，当物资绝对不充裕时，一定会有暴力和强制性的组织形式产生。</li>
<li>自由市场，当物资相对充裕时，资源已经无法被一个小的命令体系控制了。自由经济会诞生，人们互相交换资源，以达到资源分配的最大效益。</li>
<li>礼物文化，当物资绝对充裕时（极端例子：比如空气），就连交易都不会产生，人们做的是互相赠予，表达心意。</li>
</ul>
<p>在黑客圈中，智力和时间是接近充裕的，除非你的领域足够深，那么你可以对内形成命令体系，对外形成自由市场，在此之前，还是要接受大家的资源差不多的事实。</p>
<p>礼物文化并不是对物质稀缺的适应，而是对物质充裕的适应。充裕性会使命令关系难以维持，会使交换关系变成无意义的游戏。在礼物文化中，社会地位并不取决于你控制了什么，而是你给予了什么。</p>
<h3 id="p-s-什么是好的礼物">P.S. 什么是好的礼物</h3>
<ol>
<li>如果它不能像我所预期的那样工作，那就不是好的——不管它多么聪明和有原创性。</li>
<li>在心智层的拓展性工作要比在某功能域内（对现有作品）的重复性工作好。</li>
<li>能进入主要发行版的作品比不能进入的好。在所有主要发行版中都包含的作品最令人尊敬。</li>
<li>“使用”是最真实的赞美，类别杀手比同类竞争者好。类别杀手指作品好到没人再想使用其他备选。</li>
<li>相比那些只挑有趣和简单工作的人，长期致力于艰苦和乏味工作（如调试、写文档）的人更令人倾佩。</li>
<li>重要的功能扩展比低层次的修补好。这也说明社区会动态分配bug 的优先级，没人关心的bug 自然不会有人修复，修复得到的回报也少。</li>
</ol>
<h2 id="自谦的领导者">自谦的领导者</h2>
<p>通常开源项目会有一个自谦领导者在不断推动，当然也存在由委员会管理项目的情况。</p>
<p>自谦的好处：</p>
<ul>
<li>（和自夸相比）更容易得到contributors的喜爱和支持</li>
<li>一直表示自己（的项目）不够好，有助于推动他人想方设法完善你的项目（即使已经够好了）</li>
</ul>
<p>如果一个人慷慨、智慧、公平交易，有领导能力，或者有其他优秀品质，就更容易让人相信和他合作能获得好处。</p>
<p>从进化学角度讲，工匠所具备的努力奋进的性格特点（就像内化的道德）源自于欺骗的高成本和高风险。进化心理学家搜集的实验证据表明，人类拥有专门识别社会欺骗行为的大脑逻辑，我们也很容易明白为什么我们的祖先会因能够识别欺骗而被进化选择。因此，如果一个人希望因为好的人格特质而获得声誉并进而取得好处，但又想避免风险或代价，那么最好的策略也许就是实际拥有而非假装拥有这些特质。（“诚实是最好的策略。&quot;） 创造性工作会给创作者带来类似冥想那样的感觉，这点我们不应低估，但工匠的努力奋进至少有一部分是这种内化（其基本特质为“极其认真勒奋” 或类似的能力）的表现。</p>
<h2 id="积极的参与者">积极的参与者</h2>
<p>有乐趣的工作既不是太容易而让人无聊，也不是太困难而无法完成。一个快乐的程序员是一个既没有被浪费也没有被压垮（由于不适当的目标或过程中充满压力与冲突）的人，乐趣预示着效率。</p>
<p>“与完全出于兴趣的工作相比，被委托的工作通常表现出较少的创造性”、“活动越复杂，就越容易被外部的报酬损害。”、该研究还指出，固定工资不会降低人们的积极性，但计件工资和奖金会。对任何一个任务，如果它更像是手段而不是它本身的话，往往会降低人们的积极性。</p>
<p>自己在工作里也经历过类似的项目，种种过多的外部报酬和复杂的项目流程，对人们的积极性造成了重大影响，最后项目流产。</p>
<h1 id="开源的优势">开源的优势</h1>
<h2 id="分布式-扁平的评审机构">分布式、扁平的评审机构</h2>
<p>开源世界最擅长的就是去中心化的同行评审，所有那些致力于细节不被疏漏的传统流程在它面前都会失效。</p>
<p>远见源自个人，其周遭社会机器的最好做法，就是响应这些有突破性的远见—滋养、奖赏并严格测试它们，而不是压制它们。</p>
<p>当然，Kropotkin批判和Linus定律引发了人们对社会组织控制论的更广范思考。比如软件工程的一个通俗理论(Conway定律 ）常常被表述为“如果有四个小组致力于开发一个编译器，那么你将会得到一个四步（4-pass）编译器。〞其原始陈述更具一般性：“如果一个系统由多个组织共同设计，那么其设计的系统将不得不成为这些组织间沟通结构的拷贝。”我们可以更简洁地称之为 “方法决定结果”，或者乃至“过程变成产品”值得注意的是，开源社区的组织形态和功能在很多层面上是匹配的。网络就是一切，而且无处不在，不只是互联网，还包括在其上工作的人，<strong>这些人形成了一个分布式、松耦合以及点到点的网络，它很优雅地实现了多重冗余和去等级化</strong>。这两个网络中，一个节点只有在其他节点想要和它合作时才显得重要。</p>
<p>更进一步，“SNAFU原则 ”（situation normal all fucked up，指事态已经混乱不堪，但从管理上看一切正常。）预测在权力组织中，决策者和现实情况会越来越脱节，因为决策者会听到越来越多好听的蔬言。在传统软件开发中很容易看到这一点，由于下级有强烈的动机去隐藏、忽略和最小化问题，当这个“过程变成产品”时，软件会成为一个灾难。</p>
<h2 id="平衡功能和交付期限">平衡功能和交付期限</h2>
<p>Linux将实验版和稳定版分开的做法，还有一个与风险对冲相关但又截然不同的作用，那就是解决要命的最后期限问题 (the deadliness of deadlines)。程序员在需求列表不能调整和最后期限不能拖延的双重要求下，会完全顾不上质量，整个工作很可能会变成一团乱麻。哈佛商学院的Marco lansiti和Alan MacCormack证明，放宽这两个限制的任意一个，都会使进度变得可行。</p>
<h3 id="稳定版">稳定版</h3>
<p>一种办法是保持最后期限不变而让需求列表灵活一些，允许某些到最后期限时仍未完成的需求被舍弃，这基本上就是 “稳定版”核心采取的策略。Alan Cox（稳定版核心的维护人）以相当规律的时间间隔将核心发布，但并不保证某个特定bug何时被修复，也不保证实验版中的某个特性何时会搬到稳定版中。</p>
<h3 id="实验版">实验版</h3>
<p>另一个办法是设定好想要的需求列表，并在其完成时发布，这基本上是“实验版”核心的策略。De Marco和Lister引1用研究结果，指出这个进度策略即是“好了告诉我”wake me up when it’s done)，这不仅能够保证最高质量，而且就平均而言，与“保守”或“激进”的进度安排相比，它的交付时间更短。</p>
<p>不成熟发布带來的负面影响，会抵消开源通常所带来的质量收益。</p>
<h2 id="提高项目的-统治地位">提高项目的“统治地位”</h2>
<p>黑客厌恶项目分化的另一个原因是，他们惋惜那些被浪费的重复工作—分化后的两个子项目总是有着或多或少平行的演化路线。他们也会注意到分支倾向于分裂合作开发者社区，使得两个子项目的人手都比父项目的人手更少。</p>
<p>Henry Spencer(<a href="mailto:henry@spsystems.net">henry@spsystems.net</a>）指出：通常，政治体系的稳定性与其政治过程的准入门槛高度是成反比的。他的分析值得在这里引用： 对于相对开放的民主制度而言，它的一个主要优势在于，绝大多数潜在的革命者发现通过在系统中工作比攻击该系统更容易让自己向目标前进。但如果既有政觉联合起来“提高门槛”，导致那些较小的不满意团体觉得更难实现自己目标的话，这种优势就很容易被侵蚀破坏。 准入门槛不高的开放过程鼓励参与而非分裂，因为参与者能从中获得成果，而不用付出分裂所需的高昂成本。尽管这种成果可能不像分裂所得成果那样令人印象深刻，但其成本较低，且大多数人都能接受这种折衷。</p>
<h2 id="p-p-s-如何开发一个好的开源项目">P.P.S. 如何开发一个好的开源项目</h2>
<ol>
<li>好的软件作品，往往源自于开发者的个人需要。</li>
<li>优秀的程序员知道写什么，卓越的程序员们知道改写（和重用）什么。</li>
<li>“计划好扔掉一个吧，迟早你会这么做的”</li>
<li>如果你有正确的态度，有趣的事情自然会找到你。</li>
<li>当你对一个程序不再感兴趣时，你最后的责任就是把它交个一个可以胜任的接棒者。</li>
<li>把你的用户当成开发合作者对待，如果想让代码质量快速提升并有效排错，这是最省心的途径。</li>
<li>早发布，常发布，倾听用户的反馈。</li>
<li>如果有足够多的beta 测试者和合作开发者，几乎所有问题都会很快显现，然后自然有人会把它解决。</li>
<li>聪明的数据结构配上愚笨的代码，远比反过来要好得多。</li>
<li>如果你把beta 测试着当作最珍贵的资源对待，他们就会成为你最珍贵的资源。</li>
<li>仅次于拥有好主意的是，识别来自用户的好主意，有时后者会更好。</li>
<li>通常，那些最有突破性和最有创新力的解决方案来自于你认识到你对问题的基本观念是错的。</li>
<li>“设计上的完美不是没有东西可以再加，而是没有东西可以再减。”</li>
<li>任何工具都应具备预期内的功能，但一个伟大的工具能给你带来预期外的功能。</li>
<li>写网关类软件时，尽可能不要干扰数据流，而且绝不要扔掉信息，除非接收方强迫你这么做。</li>
<li>当你的语言还远不是图灵完备（Turing-complete，在可计算性理论，如果一系列操作数据的规则可以用来模拟任何图灵机，那么它是图灵完备的。这意味着这个系统也可以识别其他数据处理规则集，图灵完备性被用作表达这种数据处理规则集的一种属性。）的时候，语法糖会让你受益良多。</li>
<li>系统的安全性只取决于它所拥有的秘密。谨防虚假的秘密。</li>
<li>想要解决一个有趣的问题，先去找一个让你感兴趣的问题。</li>
<li>如果开发协调者有一个至少像Internet 这样好的沟通媒介，并且知道如何不靠强制来领导，那么多人合作必然强于单兵作战。</li>
</ol>
<h1 id="开源的商业模型">开源的商业模型</h1>
<h2 id="软件的价值">软件的价值</h2>
<p>软件的价值是使用价值而不是销售价值，所以以使用价值来收取软件的费用是更合理的。现在采用销售价值的软件已经越来越少了。</p>
<h2 id="使用价值模型">使用价值模型</h2>
<ul>
<li><strong>成本分摊</strong>。所有公司一起开发大家都需要的功能，可以极大降低开发成本，比如Apache。</li>
<li><strong>风险分担</strong>。对冲项目核心人员离职带来的损失。</li>
</ul>
<h2 id="间接的销售价值模型">间接的销售价值模型</h2>
<ul>
<li><strong>占领市场</strong>。利用开源提高产品质量等以占领市场。网景开源Mozilla，Google 开源Chromium。</li>
<li><strong>硬件糖霜</strong>。销售硬件商可以通过开源软件来延展软件的生命周期。苹果开源Darwin。</li>
<li><strong>送配方，开餐馆</strong>。开源软件，但提供附加价值，因为开源所以消费者不必担心垄断。Red Hat，Elasticsearch。</li>
<li><strong>附属物策略</strong>。低端市场可出售相关的杯子和T 恤，高端市场可以出售相关的专业书籍和文章。O’Reilly。</li>
<li><strong>当下收费，未来免费</strong>。</li>
<li><strong>软件免费，品牌收费</strong>。软件开源，但保留其测试套件或兼容性标准，之后出售品牌认证服务。</li>
<li><strong>软件免费，内容收费</strong>。客户端开源，但服务端和相关内容闭源。如Android 和Google Play。</li>
</ul>
<h2 id="何时开源">何时开源？</h2>
<p>如果满足下面这些条件，就该考虑把源码开放：</p>
<ol>
<li>可靠性/稳定性/可扩展性非常重要。</li>
<li>除了独立的同行评审，没有其他便捷易行的方法验证设计和实现的正确性。</li>
<li>该软件对客户的业务非常关键。</li>
<li>该软件创建或运转一个公共计算或通信基础架构（开源后产品可以迅速成为事实标准）。TCP/IP，万维网。</li>
<li>关键方法（或能实现等同功能的方法）属于公共知识（开源后可以降低竞争对手出现的概率）。</li>
</ol>
<h2 id="开源的其他优势">开源的其他优势</h2>
<p>吸引精明的客户以及那些还没有足够大到可以独自投资竞争性开发的潜在盟友。如Android。</p>
<p>开源项目可以有效防止闭源产品制约市场，能重置竞争并让新进公司从劣势领域转至优势领域里。如网景和IE 的竞争。</p>
<p>竞争者花在复制和理解上的时间，将会占据产品周期的很大一部分，他们本该把时间花在创新和考虑如何让产品差异化的。在一切都变得更快的互联网时代，这种效应更明显。如果你确实走在前面，他们的剽窃会正中你的下怀。</p>
<p>我觉得还有一点就是降低竞争者（潜在合作者）的准入门槛，这是把蛋糕做大的方法之一？如波士顿动力？</p>
<h1 id="对未来趋势的判断">对未来趋势的判断</h1>
<ul>
<li>基础架构：完全开源由stakeholders 共同维护。Apache 项目在不断扩大就是最好的例子。</li>
<li>中间件：开源和闭源混杂。</li>
<li>应用：闭源，垂直市场最有可能发生这种闭源，不公开源码可以提高应用的使用价值。</li>
</ul>
<p>随着时代发展，越来越多的中间件会进入基础架构的领域（完全开源），成功的应用也会因不断的分层和解耦慢慢进入中间件的领域。可以预期，由于开源的存在，任何软件技术的最终命运不是灭亡就是成为开源基础架构的一部分。</p>
<h1 id="作者推广开源的经验">作者推广开源的经验</h1>
<p>这个人一方面和CEO 们秘密往来，一方面站在屋顶又唱又跳大喊大叫地吸引记者，不断刺激媒体直到这个机器的齿轮碾出一句：革命来了！</p>
<h2 id="注意力策略">注意力策略</h2>
<p>围绕“吸引人的不一致”来煽动人们对传道者的好奇心，然后充分利用这种好奇心来推广想要推广的理念。 “最高水平的挑逗”：在采访中兴致盎然地谈论起我对枪支、无政府主义以及巫术的兴趣，同时尽可能让我看起来体体面面、充满童心并且拥有典型美国式的阳光心态。诀窍在于，语出惊人但却传达出让人放心的诚实和单纯。</p>
<h2 id="推广策略">推广策略</h2>
<ol>
<li>忘掉自底向上，开始自顶向下。自底向上难以抵抗市场统治者的营销。</li>
<li>Linux 是我们最好的例证。如果推广Linux 都不能成功，那推广其他开源软件也不会成功了。</li>
<li>抓住财富500强。财富500强不只是有钱，而且有集中和相对容易获取的钱。</li>
<li>赢得哪些效劳财富500强的有威望媒体。</li>
<li>说服黑客，游击市场。集团内部达到统一。</li>
<li>使用“Open Source”认证标识，保持纯净度。防止不怀好意的他人窃取革命成果。</li>
</ol>
<h1 id="黑客的格调">黑客的格调</h1>
<p>如果你是因为没有生活而被编程吸引，那也没什么—至少你不会茫然无措。然后，也许你会因此而找到生活。</p>
<h2 id="要多做">要多做</h2>
<ul>
<li>学习很好的使用你的母语写作。</li>
<li>阅读科幻小说，参加科幻小说集会（这是认识黑客和潜在黑客的好方法）。</li>
<li>研习禅修，并且/或者学习武术（心智训练似乎在很多重要方面都是类似的）。</li>
<li>培养起对音乐的鉴赏力。学会欣赏一些独特类型的音乐。学习很好地演奏乐器，或者学习如何唱歌。</li>
<li>培养出你对双关语和俏皮话的欣赏能力。</li>
</ul>
<p>这些只是作者的观察结论，至于为什么并不清楚，作者觉得这可能和左右脑技能的结合有关。（黑客不仅需要有很强的逻辑推理能力，而且要能够很快从问题的具体逻辑中跳脱出来）。</p>
<h2 id="不要做">不要做</h2>
<ul>
<li>不要使用愚蠢、浮夸的用户名或昵称。</li>
<li>不要卷入任何平台的网络骂战。</li>
<li>不要自称为“电脑朋克”（那些愤世嫉俗的人），也不要让费时间交往那些自称电脑朋克的人。</li>
<li>不要让你的帖子或email 充满错误的拼写和糟糕的语法。</li>
</ul>
<h1 id="others">Others</h1>
<p>互联网成为主流后，黑客文化开始受到尊敬，并有了一定政治影响力，1994年到1995年问，黑客的大规模强烈抗议，使得试图将 “强加密”算法置于美国政府控制之下的Clipper提案无疾而终。1996年，黑客动员起广泛的同盟，导致所谓的 “通信合宜法”（CDA)被废止日，阻止了政府对互联网的审查。</p>
<p>就在刚刚自己看了《互联网之子》纪录片，让SOPA法案破产的一个关键因素就是Wikipedia、Reddit 和其他互联网服务商用关停服务的方式表达对SOPA的不满。</p>
<p>黑客要“太懒以至于无所不能”。</p>
]]></content:encoded>
  </item>
  <item>
    <title>事务与共识 from DDIA</title>
    <link>https://www.yujiachen.com/transactions-and-consensus-from-ddia/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/transactions-and-consensus-from-ddia/zh/</guid>
    <pubDate>Mon, 27 Sep 2021 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<h1 id="一些感想">一些感想</h1>
<p>大多数的应用程序是通过一层一层叠加数据模型来构建的。</p>
<p>计算资源的过剩和短缺问题是会一直存在的，“节省资源的技术，只会带来资源使用率的增加”（<a href="https://en.wikipedia.org/wiki/Jevons_paradox">Jevons paradox</a>）。</p>
<p>书中讨论的一些问题都是在遵循P（现实问题）的前提下，找到代价最小（通常也是最低要求的）C，并以此达到最好的A（成果），书里的例子是多核CPU。 虽然多核CPU 算是分布式系统，但是不会受到网络延迟的影响，所以CAP 理论中的Partition tolerance 会被永远满足。可为了追求更快的计算速度，多核CPU 还是会放弃一致性来追求更强的可用性，哪怕可能会算错，可能会重复计算，还是要尽一切可能压榨计算资源。</p>
<h1 id="范式有用吗">范式有用吗？</h1>
<p>范式是为了规范化数据使用流程而存在的东西，可随着硬件的不断提高，应用场景的不断扩充。我们发现破坏规则给我们带来的收益更大。不然NoSQL 也不会出现，存一个大json ，DB 都不用了，迭代效率一下提升很多。</p>
<p>那范式还需要遵循吗？其实范式只是一个让我们知道什么场景下该做什么事，不做的后果是什么的，一个度量标准。而不是必须死死遵循的准则。</p>
<h1 id="什么是并发问题">什么是并发问题？</h1>
<p>单机单线程总能避免各种并发问题，但是这种计算方式过于缓慢，所以我们会发展出多线程，多进程，多机，分布式。与之带来的就是并发问题，符合这样一种条件的问题可以被归类为并发问题👇</p>
<blockquote class="callout callout-note">
<p>💡</p>
<p>在相同条件下，如果两个任务串行执行的结果和并行执行的结果不一致，那么此时竞争状态出现，导致并发问题。</p>
</blockquote>
<h1 id="单机并发问题">单机并发问题</h1>
<p>先讨论在单机多线程多进程就会出现的并发问题。</p>
<p>讨论问题的模型：</p>
<ol>
<li>问题情景下相关的事务，有且只有2 个。</li>
<li>对于现实中超过2 个事务导致的问题，我们通过归纳把问题重新调整成2 个事务并发所导致的结果。例如分析问题时把多个没有冲突的事务归纳为1 个事务，或把问题拆分成不同原因，每个原因各自对应2 个事务。</li>
</ol>
<p>情景一，事务1 在读，事务2 在写，导致：</p>
<ul>
<li>脏读</li>
<li>不可重复读取 / 读倾斜</li>
</ul>
<p>情景二：两个事务都在写，导致：</p>
<ul>
<li>更新丢失</li>
<li>脏写</li>
<li>写倾斜</li>
</ul>
<h2 id="脏读">脏读</h2>
<blockquote class="callout callout-note">
<p>💡 必要条件：一个事务读取到了另一个未提交事务的部分修改结果。</p>
</blockquote>
<p>在没有读-提交时，脏读会在如下场景发生：</p>
<ul>
<li>一个事务更新了多个对象，同时另一个事务看到了部分更新的对象，而不是全部更新的对象。</li>
<li>一个事务发生中止，回滚时另一个事务看到了部分未回滚的对象，而不是全部回滚的对象。</li>
</ul>
<p>举例：</p>
<p>例子1：Alice 在银行有两个账户，账户1 有100元，账户2 有0元，接着账户1 给账户2 转账100元，对应事务扣除账户1 的100元，给账户2 添加100元。若在事务扣除账户1 的100元且还没有给账户2 添加100 元时，Alice 读取了自己的存款余额，结果是0元。这个例子一个不好的点是不可重复读取也能导致相同的情况，我们在不可重复读取section 接着讨论。</p>
<p>例子2：在例子1 的条件上加上一个限制条件，账户2 是II 类账户，一次转账不能超过50 元，如果账户2 的转账超过了限额，则事务回滚。在事务扣除账户1 的100 元后，其他查询读取了账户1 的数据，发现账户1 的余额是0元，之后转账失败，事务回滚。因为事务的原子性，我们可以说事实上账户1 的余额从来就没有变成0 元，但是某个时刻其他事务却看到了余额为0 元的账户1。</p>
<h2 id="脏写">脏写</h2>
<blockquote class="callout callout-note">
<p>💡 必要条件：一个事务修改了另一个未提交事务的部分修改结果。</p>
</blockquote>
<p>在没有读-提交时，脏写会在如下场景发生：</p>
<ul>
<li>事务1 更新了多个对象，同时事务2 修改了部分被更新的对象（事务2 修改的原因可以是更新、创建、删除，和对应的回滚），之后事务1 更新了另一部分没有被事务2 修改的对象。</li>
</ul>
<p>举例：</p>
<p>某交易网站的一次交易会添加物品的收货人，和付款方。Alice 和Bob 同时购买一个商品，Alice 的事务在添加收货人是Alice 后，Bob 的事务把收货人改成了Bob 并声明Bob 是付款方，之后Alice 的事务更新了付款方为Alice，结果收货人成了Bob，Alice 却成了付款方。</p>
<h2 id="不可重复读取-读倾斜">不可重复读取 / 读倾斜</h2>
<blockquote class="callout callout-note">
<p>💡 必要条件：事务2 的执行时间在事务1 启动后，完成时间却在事务1 结束前，且事务1 读取到了事务2 的修改结果。</p>
</blockquote>
<p>大多数业务场景都不希望发生不可重复度，如下场景尤其不能容许不可重复读取：</p>
<ul>
<li>备份</li>
<li>较长的分析查询和完成性检查</li>
</ul>
<p>不可重复读取又被称为读倾斜的原因：理想情况下，一个事务读取全部数据的发生时间应该是一瞬间，但发生不可重复读取时，事务读取全部数据的时间分布在时间轴的各处而不是一瞬间，所以我们说这个时候“读倾斜”了。</p>
<p>举例：</p>
<p>接着脏读的例子1，Alice 在开启转账事务2 前还运行了读取账户余额的事务1。考虑如下读取情况，事务1 先读取了账户2 的0 元，此操作符合读-提交；接着事务2 完成，账户1 变为0 元， 账户2 变为100 元；最后事务1 读取了账户1 的0 元，总金额为0 元，此操作也符合读-提交。</p>
<h2 id="更新丢失">更新丢失</h2>
<blockquote class="callout callout-note">
<p>💡 两个事务同时执行读-修改-写入序列，出现了其中一个覆盖了另一个的写入，但又没包含对方最新值的情况，最终导致了部分修改数据发生了丢失。</p>
</blockquote>
<p>举例：</p>
<ul>
<li>递增计数器</li>
<li>对复杂对象的一部分内容执行修改，比如多个用户修改一个大json</li>
</ul>
<h2 id="写倾斜">写倾斜</h2>
<p>是更新丢失的升级版，不同之处是对应用层代码有更多的逻辑依赖，有着如下模式：</p>
<ol>
<li><strong>读</strong> 输入一些匹配条件，进行查询。</li>
<li><strong>修改</strong> 根据查询的结果，应用层代码来决定下一步的操作。</li>
<li><strong>写入</strong> 如果应用程序决定继续执行，它将发起数据库写入。</li>
</ol>
<p>一般来说，如果2 个事务更新不同的对象导致出错（一般是应用层的语义出错），就是写倾斜，同一个对象就可能是脏写或更新丢失了。</p>
<p>为什么叫“写倾斜”：我们可以参考读倾斜的含义去归纳，理想情况下，一个事务读取进行写事务的操作应该是一瞬间，但发生写倾斜时，往往是事务先读取一个过期的数据，然后数据被修改，事务在没有觉察的情况下写入了非法的数据。也就是说单个事务的多次读取和写入分布在时间轴的各处，所以我们说这个时候“写倾斜”了。</p>
<p>举例：用户有一个支出项目表，同时还有余额的限制，两个事务各自同时插入没有超额的支出项目，但是因为两个事务没有注意到对方，多出的两个支出项目让账户余额成了负数（应用层逻辑）。</p>
<p>在这里我们讨论一个可行性不大的解决方案：</p>
<h3 id="实体化冲突">实体化冲突</h3>
<blockquote class="callout callout-note">
<p>💡 写倾斜发生时往往是因为查询结果中没有对象，这就无法加锁，那我们提前创建好可加锁的对象。</p>
</blockquote>
<p>例如对上面那个余额为0 的例子，我们创建一个账户余额表，其内容为账户的总余额，然后加一个新收支字段，即一个时刻的余额只能被一次收支改变，这样两次事务就不用去计算账户的总余额，而是给当前余额加一个收支，问题变成了更新丢失或脏写问题。</p>
<p>实体化冲突主要的问题是过于占用数据库内容，比如我们要设计一个会议室预订系统，那么是否需要实体化未来6个月内所有房间和时间的组合呢？</p>
<p><strong>除非万不得已，一般不会使用这个方法。</strong></p>
<h2 id="幻读">幻读</h2>
<blockquote class="callout callout-note">
<p>💡 在一个事务中的写入改变了另一个事务查询结果的现象，被称为幻读。</p>
</blockquote>
<p>幻读是一个高概括性的概念，个人认为目前讨论并发问题都可以被归类为幻读？</p>
<h1 id="防止更新丢失">防止更新丢失</h1>
<blockquote class="callout callout-note">
<p>💡 我们只有防止更新丢失，才能防止其他的幻读。之后我们可以看到，分布式事务的关键就是实现共识，而共识就是在防范更新丢失。</p>
</blockquote>
<p>更新丢失的情景相较于其他并发问题更简单，解决方法也好理解，因此我们先讨论怎么防止更新丢失。</p>
<h2 id="原子写操作">原子写操作</h2>
<p>如果DB 支持原子写操作，就尽量使用原子写操作。</p>
<p>DB 底层可以用独占锁或者让所有原子操作在单线程上执行来实现原子写操作。</p>
<h2 id="显式加锁">显式加锁</h2>
<p>应用程序显式锁定相关对象，DDIA 中用 <code>FOR UPDATE</code> 关键词来表示应用层请求为 <code>SELECT</code> 的结果加锁。</p>
<p>看似这个方案也能解决写倾斜问题，但需要考虑写倾斜也包括“检查不满足给定搜索条件的行（预期结果为空）”的情况，这个时候没有对象可以加锁，我们在其他section 讨论写倾斜的解决方案。</p>
<hr>
<p>上面讨论了两种依赖锁的解决方案，接下来我们讨论一下无锁的解决方案。</p>
<h2 id="自动检查更新丢失">自动检查更新丢失</h2>
<p>先让更新并发执行，如果事务管理器检测到了更新丢失风险，就终止当前事务，并回退到某个安全的“读-修改-写回”方式。</p>
<p>数据库可以借助快照级别隔离来执行检查，我的一个猜测是一个对象在一个时刻只能有一个没提交的版本？应该还有更细粒度的检测方法。</p>
<h2 id="原子比较和设置">原子比较和设置</h2>
<p>只有在上次读取的数据没有发生变化时才允许更新，如果已经发生了变化，回退到其他“读-修改-写回”方式，或者重试。</p>
<p>实现方法：CAS compare and swap，现代的CPU 都支持这个指令。或者显式地在执行时加上 <code>WHERE content = 'old content'</code> 一类的条件，危险的是如果 <code>WHERE</code> 是在快照上执行的，那么 <code>content</code> 对应的值很有可能不是最新的。</p>
<h2 id="冲突解决与复制">冲突解决与复制</h2>
<p>详情会在分布式并发问题section 讨论，大体是这样的思路，应用层有逻辑，或者数据结构有逻辑来应对冲突的写入；或者尽可能把操作设计成与操作顺序无关的，这一类操作自然就不会有更新冲突。</p>
<h1 id="隔离级别">隔离级别</h1>
<h2 id="读-提交">读-提交</h2>
<blockquote class="callout callout-note">
<p>💡 最基本的事务隔离级别，事务内部的执行过程不会被其他事务影响。</p>
</blockquote>
<p>解决了：</p>
<ul>
<li>脏读</li>
<li>脏写</li>
</ul>
<p>为什么叫“读-提交”？我认为这个名词指代的是读操作也需被当作事务(提交)看待？</p>
<p>实现方法：</p>
<h3 id="行级读锁">行级读锁</h3>
<p>加上了读锁当然可以实现读-提交，但有以下缺点：</p>
<ul>
<li>性能很差</li>
<li>潜在的死锁</li>
</ul>
<h3 id="新旧值快照">新旧值快照</h3>
<p>对每个待更新的对象，维护旧值和当前持锁事务将要设置的新值两个版本。在事务提交之前，所有其他读操作都读取旧值；仅当写事务提交之后，才会切换到新值。</p>
<h3 id="多版本并发控制-mvcc">多版本并发控制 / MVCC</h3>
<p>下一个section 会提到</p>
<h2 id="快照级别隔离">快照级别隔离</h2>
<blockquote class="callout callout-note">
<p>💡 每个事务读取的是数据库的一致性快照，一旦发生读取，数据不会发生改变。</p>
</blockquote>
<p>可以避免：</p>
<ul>
<li>不可重复读取 / 读倾斜</li>
</ul>
<h3 id="多版本并发控制-mvcc-2">多版本并发控制 / MVCC</h3>
<p>数据库保存对象多个不同的提交版本，并给每一行加上 <code>created_by</code> 和 <code>deleted_by</code> 字段，代表数据行在不同事务操作下产生的版本。同时有定时的垃圾回收任务清除不再需要的版本。</p>
<p>一个事务不能见到：</p>
<ul>
<li>在该事务开始之前的仍在运行的事务所造成的改动</li>
<li>所有中止事务所做的修改</li>
<li>晚于当前事务所做的修改</li>
<li>其他改动都对该事务可见（我理解这里的其他改动指代不是事务造成的改动）</li>
</ul>
<p>反之一个事务可以见到：</p>
<ul>
<li>事务开始前就被其他已提交事务创建、更新的对象</li>
<li>事务开始前没有被其他未提交事务删除的对象</li>
</ul>
<p>MVCC 的索引大致有两种实现思路</p>
<ul>
<li>索引直接指向对象的所有版本。PostgreSQL 用这个方法实现，并把一个对象的所有版本放在一个内存页面上来优化性能。</li>
<li>可持久化数据结构，通常是可持久化的B-tree，不同事务写入时会创建各自的数据库入口节点，读取时把最新已提及事务对应的节点作为入口。</li>
</ul>
<h2 id="可串行化隔离">可串行化隔离</h2>
<blockquote class="callout callout-note">
<p>💡 即使事务可能会并行执行，其最终的结果与每次一个即串行执行结果相同。</p>
</blockquote>
<p>通常被认为是最强的隔离级别。</p>
<p>但在现实中实现可串行化非常困难，讨论下面3 种实现方法。</p>
<h3 id="实际串行执行">实际串行执行</h3>
<p>随着硬件的不断发展，数据库研究人员重新意识到单线程执行事务是可行而且高效的。</p>
<p>以下条件可以帮助我们利用内存和单个CPU 来实现串行化隔离：</p>
<ul>
<li>事务必须简短而高效，否则一个缓慢的事务会影响到所有其他事务的执行性能（因为是单线程）。</li>
<li>仅限于活动数据集可以完全加载到内存的场景。</li>
<li>写入吞吐量必须足够低，才能在单个CPU 核上处理；否则就需要采用分区，最好没有跨分区事务。</li>
<li>跨分区事务虽然也可以支持，但是占比必须很小。</li>
</ul>
<p>具体操作时，我们可以用存储过程封装事务，因为一般的OLTP 执行步骤短，只要我们可以把用户IO 排除在一次事务中，那么单线程操作事务就会很高效。业务服务器把所有逻辑打包成数据发送给数据库服务器，然后数据库服务器就可以立即在内存中执行相关操作。过往的存储过程因为各个数据库有各自的实现语言，被饱受诟病，目前的解决方案是用通用编程语言来实现存储过程（举例：Redis 使用Lua 实现）。</p>
<h3 id="两阶段加锁">两阶段加锁</h3>
<p>近30 年来唯一被广泛使用的串行化算法。</p>
<ol>
<li>用加锁来实现串行化隔离，事务读取对象前需要共享锁，修改对象前一定要获得独占锁，排除所有其他读写被修改对象的事务（两阶段：开始前拿锁，结束后释放锁）。数据库系统自动检测事务之间的死锁情况，并强行终止其中的一个来结束僵局。</li>
<li>对于在读倾斜section 讨论的无法加锁情况（结果为空才执行），施加谓词锁。谓词锁作用于满足某些搜索条件的所有查询对象（类似于给 <code>WHERE</code> 语句加独占锁，在同一时刻下，事务之间 <code>WHERE</code> 语句对应的范围不能重叠），但是谓词锁的实现非常困难，而且效率低。
<ol>
<li>一般用索引区间锁替代谓词锁，将谓词锁的保护对象扩大。通过对被查询对象的单个或多个索引区间加锁，代表该索引区间被施加了独占锁，最坏情况下整个表都会被一个事务上锁。</li>
</ol>
</li>
</ol>
<h3 id="可串行化的快照隔离">可串行化的快照隔离</h3>
<p>在MVCC 基础上提出的乐观控制算法，08 年被提出，没有太多实践。DDIA 的作者基于如下理由认为此算法是未来数据库的标配：</p>
<ul>
<li>悲观控制关停了过多事务，重试的代价太大了。</li>
<li>未来的硬件提升空间还有很多，在未来我们会遇到更少的并发问题，我们对并发应该采取乐观控制策略。</li>
</ul>
<p>基于MVCC 的快照隔离，我们用如下原则进行乐观控制：</p>
<ul>
<li>在事务读取前，检查其读取数据是否即将过期（读取前有未提交的快照）。</li>
<li>在事务提交前，检查其写入数据是否会影响其他事务（读取后有为提交的快照）。</li>
</ul>
<p>一旦有，冲突发现，回滚。</p>
<p>可串行化的快照隔离(Serializable Snapshot Isolation) 依赖于SSI 锁，类似于索引区间锁，但SSI 锁只记录，不阻塞。在事务提交后通知其他相关事务，并被丢弃。</p>
<p>实现的tradeoff 是锁的粒度，大了可能会误判冲突，扩大一个事务的影响范围，小了可能会导致元数据开销过大。</p>
<h1 id="分布式系统挑战">分布式系统挑战</h1>
<ul>
<li>网络延迟</li>
<li>时钟同步</li>
<li>进程暂停、出错</li>
</ul>
<p>为什么要分布式</p>
<ul>
<li>可扩展性</li>
<li>容错</li>
<li>低延迟</li>
<li>如果可以避免打开潘多拉魔盒，那么把工作都放在一台机器也值得一试</li>
</ul>
<p>属性</p>
<ul>
<li>安全性：不可以被违反的属性，一旦违反则系统设计失败</li>
<li>活性：在一些必要条件下系统保证的可用性，若必要条件失效，恢复必要条件后系统就会正常</li>
</ul>
<p>接下来的讨论我们会假设通过事务我们已经解决了一些问题。</p>
<h2 id="拜占庭错误">拜占庭错误</h2>
<p>不需要考虑。</p>
<ul>
<li>代价昂贵。</li>
<li>辐射等环境问题可能导致拜占庭错误，但这种事情在地表发生的概率极低，当然，在宇宙中运行的机器必须考虑此问题。</li>
<li>软件bug会导致机器错误，但所有机器运行的都是一样的代码，所以bug无法预防，除非所有机器的软件都是各自被开发的，且只有少数软件有bug，这显然不现实。</li>
<li>网络入侵有可能导致机器错误，问题是一旦入侵者可以侵入一台机器，我们就没有理由认为他不能侵入所有机器，所有机器都出错自然也无法防止拜占庭错误。认证、加密、防火墙等方法才是应对网络入侵的更好方法</li>
</ul>
<h1 id="共识">共识</h1>
<p>共识是对分布式系统中最重要的一个抽象：所有的节点就某一项提议达成一致。基于此可以克服许多分布式系统挑战。下面的这些方案可以实现共识，最后可发现共识类似图灵完备，只要实现了一个共识方案，那么就能基于这个共识方案推演出其他所有共识方案。</p>
<h2 id="可线性化">可线性化</h2>
<blockquote class="callout callout-note">
<p>💡 基本思想：让一个系统看起来好像只有一个数据副本，且所有的操作都是原子的。 之后我们会发现因为可线性化定义简单，所以我们可以用其他方案能否实现可线性化的方法，来检验其他方案是否是共识算法。</p>
</blockquote>
<p>注意：</p>
<ul>
<li>可线性化的最直观要求就是一旦一次系统对读取返回了最新值，哪怕相关的写入还没有提交，之后的读取都得返回最新值。</li>
<li>操作原子，这个特性可以被封装成CAS（compare-and-set）操作，这里有点类似单机事务中提到的<a href="https://www.notion.so/from-DDIA-704fa0d3a24a4fbda99c97b9f142c6cd?pvs=21">防止更新丢失</a>了。</li>
<li>接上面所说，我们<strong>不考虑外界网络延迟在观测系统时造成的影响</strong>，即不用去考虑幻读，一旦实现了可线性化，我们自然可以封装出分布式的事务来处理幻读。但是思考问题模型的时候一定要想清楚，事务是表和表之间的数据不一致造成的，表之间的数据不一致是业务层面的；分布式系统的挑战则是因为副本之间的数据同步不一致造成的，这个是infra 层面的。</li>
<li>接上，注意区分<a href="https://www.notion.so/from-DDIA-704fa0d3a24a4fbda99c97b9f142c6cd?pvs=21">可串行化</a> 和可线性化的区别，前者关注的是<strong>并发</strong>执行事务的结果和串行执行相同；后者关注的是数据副本对外表现得像一个副本，最强的可线性化让能不让外界感知到<strong>并行</strong>。</li>
<li>接上，<a href="https://www.notion.so/from-DDIA-704fa0d3a24a4fbda99c97b9f142c6cd?pvs=21">实际串行执行</a> 和<a href="https://www.notion.so/from-DDIA-704fa0d3a24a4fbda99c97b9f142c6cd?pvs=21">两阶段加锁</a> 先是通过限制并行和并发来达到可线性化，并以此达到可串行化；但是<a href="https://www.notion.so/from-DDIA-704fa0d3a24a4fbda99c97b9f142c6cd?pvs=21">可串行的快照隔离</a> 在快照上添加不同的副本来乐观控制并发，副本和副本的改动之间就是并行关系，并不满足可串行化，基于可串行化快照隔离实现的多个事务是会读到不同的值的，只不过这一类事务无法commit，但是前两者不会让此情况发生。</li>
</ul>
<p>quorum 可以实现可线性化，前提是没有不确定的网络延迟。</p>
<blockquote class="callout callout-note">
<p>💡 只要有不可靠的网络，都会发生违背线性化的风险。即CAP 理论，网络一定不可靠，剩下的可用性和一致性之间只能二选一。</p>
</blockquote>
<h2 id="顺序保证">顺序保证</h2>
<h3 id="因果一致性">因果一致性</h3>
<p>可线性化的限制太多，能否降低要求完成共识呢？我们想到了因果一致性，只要保证有因果关系的事件有序发生，其他事件并行发生，难度应该小于可线性化（可线性化等同于没有并行）。</p>
<blockquote class="callout callout-note">
<p>💡 如果系统服从因果关系所规定的顺序，我们称之为因果一致性。 如果两个操作都没有发生在对方之前，那么者两个操作是并发关系；反之是因果关系，两个操作可以被排序。</p>
</blockquote>
<p>那么如何给操作做因果排序呢？有一个方案叫Lamport 时间戳，给每个操作和客户端都加上一个序列号，序列号有一个自增的数字和节点ID 组成，两个序列号之前由自增数字决定大小，如果数字一样，就由节点ID 大小决定。每个请求都要带上时间戳，节点和客户端一旦遇到最大的序列号，就自增数字形成一个更大的序列号，放在下次的请求中，这样就能对每次操作排序。</p>
<p>只要没有不确定网络延迟，就能保证顺序。如果有网络延迟，考虑实现CAS，Lamport 时间戳此时需要先需要每个节点都确认没有并发的CAS 请求（有的话根据序列号决定先后），因此网络延迟会直接让系统停顿。（具体Lamport 时间戳的运行环境需要更多假设，我们不去讨论）</p>
<h3 id="全序关系广播">全序关系广播</h3>
<p>Lamport 时间戳和其他因果一致性模型失败的原因是它是一个同步模型（得到所有节点信息再决策），我们考虑用异步模型，就能实现CAS。</p>
<p>不考虑实现环境，只要有这两个条件，CAS 就会被实现：</p>
<ul>
<li>可靠发送：没有信息丢失，如果消息发送到了某一个节点，则它一定要发送到所有节点。</li>
<li>严格有序：消息总是以相同的顺序发送给每个节点。</li>
</ul>
<p>以此CAS 只要在一个节点实现，其他节点就必须遵从这个CAS 操作，因为操作可靠发送且严格有序。</p>
<p>所以实现全序广播就能实现共识吗？我们可以用全序广播能否实现可线性化来验证，结果发现异步模型无法处理读取的问题，即**系统内部的网络延迟（不是外部，前面说了我们不必考虑外部网络延迟）**会使外界在读到新值后又读到旧值。</p>
<p>因此：</p>
<ul>
<li>我们说全序广播满足写入可线性化（其实这就是可串行化），但不满足读取可线性化。</li>
<li>但事实真的是这样吗？其实，我们只要把读取（或者是严格要求准确性的读取）也当作是一个操作，加入到操作队列里，就满足了读取可线性化。ZooKeeper 和etcd 就有类似的实现。</li>
</ul>
<p>之所以有上面的两段论述，是想引出下面的观点：</p>
<blockquote class="callout callout-note">
<p>💡 完全异步的共识是无法实现的，同步可以实现共识但会有性能问题。</p>
</blockquote>
<p>所以我们如何实现全序关系广播呢？（答：使用可线性化……）</p>
<h2 id="实现全序关系广播">实现全序关系广播</h2>
<p>最后，讨论如何通过实现全序关系广播来实现共识。</p>
<p>我们先讨论一个可行的近似方案，之后把这个方案扩展成全序关系广播。</p>
<h3 id="两阶段提交-2pc">两阶段提交 (2PC)</h3>
<p>引入一个新组件：协调者，协调者和各节点之间这样实现两阶段提交：</p>
<ol>
<li>发送一个请求准备到所有节点，询问他们是否可以提交。</li>
<li>如果所有节点返回“是”，那么协调者发出提交请求，节点提交操作。反之如果有一个节点返回“否”，那么协调者要求其他节点放弃提交。</li>
</ol>
<p>显然这样是可以实现共识的，问题依然是网络延迟。所以我们增强协调者的容错性，看看能否实现共识：</p>
<h3 id="支持容错的共识">支持容错的共识</h3>
<p>书中介绍了几种容错式共识算法：VSR，Paxos，Raft 和Zab。我比较熟悉Raft (MIT 6.824)，所以用Raft 来介绍如何扩展2PC 以增强容错性。</p>
<p>协调者其实也可以是主节点，每当出现问题，若我们可以从所有可用的节点中选出新的主节点作为协调者，那么共识就依然有效。选出新的节点其实也是一个共识，这个共识只要被超过半数的节点承认，那么就是共识。</p>
<p>即每当有节点发现主节点失效，其就可以声明自己成为新的主节点，只要它得到了半数以上的节点认可，那么其就是主节点。之后这个主节点作为协调者，来给各个从节点的操作做排序即可，只要有半数以上的节点同意某操作，即立刻执行。</p>
<p>一旦系统中超过半数的节点挂掉，则系统进入宕机状态。我们可以发现半数以上的节点的好处在于，永远有一个节点参与了所有投票，确保脑裂不会发生，共识可以在系统中被延续。</p>
<h3 id="成员与协调服务">成员与协调服务</h3>
<p>至此我们知道了如何实现共识，并在讨论中我们发现，不是所有操作都需要共识的参与，只要一些关键的操作符合共识，我们就能构建出稳定的分布式系统。因此我们可以用封装好的ZooKeeper (Zab)，etcd (Raft) 针对少量、可完全载入内存的数据建立共识，以次达成高可靠的共识算法。</p>
]]></content:encoded>
  </item>
  <item>
    <title>如何反对</title>
    <link>https://www.yujiachen.com/how-to-disagree/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/how-to-disagree/</guid>
    <pubDate>Tue, 06 Apr 2021 00:00:00 GMT</pubDate>
    <category>Essays</category>
    <content:encoded><![CDATA[<p><a href="http://www.paulgraham.com/disagree.html">How to Disagree</a>一文讨论了一个很有意思的“反对等级”（ “disagreement hierarchy”，简称 “DH” ），其总结了不同种类的反对，并根据其对讨论的帮助程度从小到大排序。</p>
<h1 id="dh0-name-calling">DH0. Name-calling.</h1>
<p>问候姓名式提问，如“你说你🐎呢”。 最常见也最无助于讨论的反对。</p>
<h1 id="dh1-ad-hominem">DH1. Ad Hominem.</h1>
<p>个人推论，如“你当然觉得女权不合理，因为你是活在男权社会里的男性”。 如果别人观点说的不对，就说哪里说的不对，这样才有进一步的讨论，用别人的身份来推出其观点错误是很有问题的推理。</p>
<h1 id="dh2-responding-to-tone">DH2. Responding to Tone.</h1>
<p>带着语气回复，如“我不相信作者会以如此轻率的方式否定智能设计论”。（注：智能设计论是对神的存在的宗教性逻辑论证。） 虽然此回复好于前两者，但其实作者的语气（以及你的语气）对解决问题是于事无补的。</p>
<h1 id="dh3-contradiction">DH3. Contradiction.</h1>
<p>产生矛盾，如“我不相信作者会以如此轻率的方式否定智能设计。智能设计是一种合法的科学理论。” 说出了反对的点很好，但最好也带上相关的证据。</p>
<h1 id="dh4-counterargument">DH4. Counterargument.</h1>
<p>相反论点，即矛盾加上推理/证据。 这是第一个可以说服别人的反对，但也要注意，提出一个相反的论点可能把大家的注意力从原问题引导到新的问题上，所以提出相反论点时要想想有没有触及到原问题的核心。</p>
<h1 id="dh5-refutation">DH5. Refutation.</h1>
<p>反驳，针对他人的观点或问题有条理地剖析，去分析问题的症结。 这是最容易说服别人的反对，也是网上很少见的反对。</p>
<h1 id="dh6-refuting-the-central-point">DH6. Refuting the Central Point.</h1>
<p>反驳核心观点，反驳不是去文章里面挑刺钻牛角尖（比如讨论别人的语法错误），而是指出他人的核心观点（他人也同意这是他的核心观点），然后有如下形式的讨论：</p>
<blockquote>
<p>The author’s main point seems to be x. As he says: &lt;quotation&gt; But this is wrong for the following reasons…</p>
</blockquote>
<blockquote>
<p>作者的主要观点看上去像……。如他所说： &lt;引言&gt; 但下面这些原因可以证明其错误……</p>
</blockquote>
<p>作者也说到了为什么需要“反对等级”，不是说谁的反对等级更高谁就是对的，而是说谁的反对等级更低，那他往往是错的。 同时这样的框架也可以更好地帮助我们讨论问题，分析他人观点，陈述自己观点。很多时候我们不需要表现得很刻薄，大家也不希望变得刻薄，只不过有时大家不知道怎么表现才不刻薄。</p>
<p>同时，我在这里也慷他人之慨，贴一个同事分享的对网上争论的看法：</p>
<blockquote>
<p>这个对话的平台是中立的么（反例是 Fox News 或者铁血论坛）这个对话的平台还有其中的参与者是为了诉求真知还是为了满足社交偷窥癖（也就是吃人血馒头），后者的话，大家是不会去关注或者相信不「精彩」的故事的，所以参与就是抱薪救火，不管你的态度是什么这个话题本身是可证伪的么（比如讨论星座或者八卦就不会有结论）自己是回答这个话题最好的人么参与这个话题的人在现实生活中能 hold accountable 么</p>
</blockquote>
]]></content:encoded>
  </item>
  <item>
    <title>特别的一年——2020 小结</title>
    <link>https://www.yujiachen.com/2020-summary/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2020-summary/</guid>
    <pubDate>Sun, 20 Dec 2020 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<blockquote>
<p>我不知道这篇文章读完需要几分钟，我也不知道为什么平常的耐心如今成为了奢侈品。</p>
</blockquote>
<hr>
<p>公司一直有锁发版的惯例——奥运会了（其实今年并没有发生），禁止发版；IPO了，禁止发版；公司放假，国内外要放长假了，禁止发版。</p>
<p>前段时间，因为IPO 禁止发版，合作的一个团队加班到了早上10点，赶上了IPO 之前的最后一次branch cut，当时我觉得很新奇，还大半夜地不回家，去看他们加班。那天凌晨，他们一边泡着茶（还问我喝不喝茶）一边热火朝天地讨论各种问题，我在一旁感到了丝丝倦意，便起身回家了。</p>
<p>自己没想到的是，我在刚过去的周五也加班到了次日凌晨4点（本篇幅撰写于2020年12月19日）。马上就是国外的圣诞假期，我负责的一个项目恰巧也要在这期间上线，为了自己睡得安稳，我几天前又检查了这些功能的逻辑和相关的QA 流程，结果很难过，我在项目中一些看似不重要的细节中发现了当初被我有意和无意忽视的几个漏洞，一晚上写了一些单测，修改了代码，提出PR，address comments，CI check。终于在凌晨4点，12:00 PM PST，我的代码到了线上。</p>
<p>接下来的一天过得昏昏沉沉，10点早晨我习惯地醒来上卫生间，困意随着我的生物钟消失一小时后又被现实推回来，昏睡一会儿后自己又饿醒了，等来了外卖吃完，因为我不喜欢饱腹的时候睡觉，就等消化了差不多才回到床上，迷迷糊糊又睡了一会儿，醒来已经下午4点了。</p>
<p>这天我想要尽量地早睡，但还是因为薄弱的意志力，磨蹭到了十一点，我睡得很沉，可一会儿我又醒了。不知道为什么我梦到了自己在梦里把我的生活分成了好几部分，每一个部分看起来都有提升空间但现状还是让人满意，靠前的一个部分——她，不见了。</p>
<p>我才想起来，我已经3个多月没和前女友说过话了。虽然和她说话很不正常，可是这么多年来，她一直是我倾诉的对象，但是最近的几年里，我却一直有意无意地想要逃离两人一起构建的城堡，此刻我突然发现自己早已在寒风中麻木了，甚至已经忘记去那个城堡的路了。</p>
<hr>
<p>一下子醒了，在情绪消散前睡不着，也许该着手去重新整理这特别的一年了。</p>
<p>想起来最近几天读到的几首诗，有一些相同之处，把它们按自己的理解拼凑出一个了片段：
我的心不是我的心
是火的热情
是焰的抚媚</p>
<hr>
<h2 id="我的心不是我的心">我的心不是我的心</h2>
<p>2020年真是非同寻常的一年呀。本以为2019年的中美贸易战依然会是今年最重要的事件，没想到一开年疫情就从各种猜测成了全国抗疫，最后是如今全球范围的流行病，各类经济停摆，奥运会停办，封锁带来的焦虑弥漫在空气中。</p>
<p>本还计划着在暑假去耶路撒冷参观，看一下这一座被穆斯林和基督徒反反复复争夺的城市，现在回想，他们肯定不是因为纯粹的信仰而争夺耶路撒冷吧，好比如今的世界一样，美苏争霸结束几十年后，中美对抗开始浮现。灯塔国虽然变得分裂，但它的信徒依然散布在世界各地，正如我们爱吃米面的身体一样，我们也无法无视上一代和上上代人留下的思想。</p>
<p>今年的一个流行词“内卷”，也是在形容现实中越发封闭的环境和缓慢增大的压力吧，字节把文化输出到快手，大家加班得越来越凶猛。从前人遗传下来的记忆中回想，以前的加班和努力，都是为了祖国的生产建设，如今是为了打败国内其他竞争对手，竞争的指标不是生产的价值，而是无限的娱乐，片面又抽象的统计数字，用户的注意力和泡沫里的估值。</p>
<p>是呀，因为我们能给这些平台提供的只有我们的注意力或金钱了啊，用户生命周期也成了研究的课题，我们的心不仅仅是我们的心，还是在可供在网络空间里栽培的作物，我们被注意力陷阱捕获，随后被平台打上标记并被灌输更合适的养料。正如肉体由消化的物质转化而来；我们的思想也在不断地吸收信息并发生变化。极少部分人会转化为饲料的供应商，大部分人则在不断提供广告和购买价值。</p>
<p>抱歉，上面一段话说的极端了，但不知不觉间，总觉得平台和用户之间的鸿沟在不断变大。科技巨头们在这场无尽的战斗中放弃了非工作时间，加速了产品迭代的速度，二三线城市里的人却因为科技的便捷不断获得更空闲的时间；高薪人群丑闻不断（充足的物质是社会旧俗被抛弃的基础之一？），普通百姓却不断下放“渣男/女”的标准，拥抱绝对的道德秩序；听说字节的创始人倡导延迟满足，我猜他也不太会用抖音娱乐自己，字节的各种产品却充斥在普通人的日常生活中，用他不喜的方式娱乐着大众。</p>
<p>这种感受，是因为自己的成长而出来的吗？还是世界真的已经变了？两者都有吧，我猜后者的比重更大一些。</p>
<hr>
<p>今年，虽然试图用各种方式充沛自己的内心，但是依然忐忑不安，我自己还是没有想清楚自己应该成为什么样的人，虽然公司还算安逸，但我总觉得在公司里学到的技术栈和国内差异较大，也没能坚定未来的方向。</p>
<p>最近公司上市，我也在盘算可以交易后的泡沫会不会破裂，预计的收入是多少。甚至在想2021年的下半年能不能休息半年，虽然一直很喜欢学习技术上的各种东西（但是一直学不好），可我也在反思在学习这些东西的过程中，对安全感的追求占了几分。是不是存在一种可能性，回到安逸的老家，或是探索从未深入感受过的国外生活，虽然生活变得拮据，但可以在茶余饭后悠闲地调侃一句“我就是个垃圾，BAT AMT 的那些大佬才是吾辈楷模，技术大牛”（笑。</p>
<p>2020年疫情最严重的那段时间，公司CEO 每周都要在Q&amp;A 上念叨几遍：“Things are never as good as they seem or as bad as they seem.” (now it has gone <a href="https://twitter.com/bchesky/status/1340426665713778688?s=20">public</a>)，甚至公司内部还派生了好几个版本的‘TANAGATSOABATS’ 表情包（这些字母是前面那句话各个单词的首字母）。的确是一句万金油吧，我也可以套用一下：“现在的情况远没有看上去那么好，未来的情况也没有想象中的那么糟”。</p>
<p>我会在这或好或坏的世间飘荡多久？又回去哪儿呢？</p>
<hr>
<p>如上面说的，今年依然是面对内心欲望苦苦挣扎的一年，想要的东西太多，自己的能力又特别有限。甚至希望自己可以变成一台工作+学习机器，但有时又会在一个人的时候感到寂寞和伤感，明明有了明确的目标，却又不能管好自己的注意力，还会因为加班熬夜对自己的皮肤和身体忧心忡忡。</p>
<p>我总在想，人的欲望里，有多少是我们从语言中，文化里偷来，却以为是自己的呢？有多少是刻在基因里，是本能的渴望呢？而又有哪些，不属于肉体，也不属于文明，只是我们简单却又独特的渴求呢？无病呻吟罢了。</p>
<h2 id="是火的热情">是火的热情</h2>
<p>今年有几件事情让我认识到了自己的局限性。</p>
<p>第一件事情是跳舞，每次跳舞老师都会吐槽几句我跳的有多烂，甚至有次跳完舞，在我边上的一个女生开心地和我说，“你跳的好烂哦，看完你跳舞我就有了信心”。</p>
<p>但是我很认真地去记动作了啊，身体却做不出来。也有同事和我说，跳舞记的是节拍不是动作，动作是跟着节拍自然而然做出来的。这话我听完感觉自己练的不是跳舞，是什么武林绝学。</p>
<p>虽然为了年会的表演我私下练了好久，动作是做对了，终究没有别人那么流畅自然。这让我想到读书的时光，我一直觉得我是一个很努力的人，但读书成绩一直不好，高考也甚是不理想（但事后才觉得进入杭电是真的幸运），虽然读了大学后成绩变好了，可也是因为同学们懒了而我婊了。有时候努力真的不是最重要的东西，但更多的时候，尽可能认清局势，分析完策略后，剩下就只有运气和天赋的玄学，以及努力的安全感吧。</p>
<p>还有一件事情是留长发，总而言之这事情也很失败呢。2020年3，4月份我的头发疯长，觉得到年底肯定就得长发飘飘了，结果很不情愿得承认，我的头发从暑假开始就已经不会变长了，我也不知道原因，因为头发烫过的痕迹渐渐消失了，所以头发肯定在不断长出来，但是长度却一直没变。也在网上搜到了好多女生分享的头发不再变长的经历和一些解决方法，但这目前对我来说还是玄学，会不会是熬夜呢？总觉得用不再熬夜来解决问题有点像用钱来解决问题一样，都是万能的，也都是万万不能的。</p>
<p>长发的过程中我对自己的发质也有了更好的认识，我的头发是细软发质，短的时候头顶没有立体感，长的时候头发又是一团炸毛。有时候真的羡慕一些人的头发又粗又直，没我这么多的困扰。是啊，生物就是这样，基因就决定了好多，我们是无能为力的。</p>
<hr>
<p>今年意外地接触到了《十三邀》和《得到》，其中《十三邀》我隔离期间无事，一口气看了好多，后面就索性把它全看完了。</p>
<p>许知远要是让我给他一个形容词的话，就是不害臊。他不修篇幅地主持节目，别人讨论现实问题，他硬要说几句理想主义和英雄主义这种堂而皇之的话。但他的采访也有技巧，问的问题也很让人反思，我最喜欢的几期大概有许倬云，项飙，唐诺，罗大佑，还有很多期看的时候有感觉，现在却不是能准确回想起来了。</p>
<p>也想要再重看一遍，多写一些总结（还好拖了一会儿，前四季的文字版现在已经出书了）。但对我而言，写总结也是一件为难的事情，我们要把多少时间花费在回忆上呢？但如果用在回忆的时间太少，难道我们的时间都是转瞬即逝并随着我们进入墓地而消亡的嘛？对这些问题，我还没有很好的答案，而且自己想学的东西太多，时间太少，我这个人又太完美主义+强迫症，真是问题重重。</p>
<hr>
<p>今年不得不说的二三事里，投资肯定有一席之地，“去年沪深300涨了27%，大家跑赢大盘了吗？”，2021年元旦就收到了朋友的“亲切”问候，我平时买的都是支付宝基金，上面显示我今年的收益率是8%，我对投资的预期是资产一直小幅上涨，高于银行定期就好，目前还不值得把其他时间放在研究股票上，自己还是更容易被其他事情吸引。</p>
<p>不过最近自己也在开始考虑投资比特币，自己的投资原则就是把钱尽可能地投出去，同时也尽可能地分散——万一命中黑天鹅呢？就算没命中，亏钱的风险也小，时间也被用在了其他事情上，对我而言还不错。</p>
<p>但总体而说，今年的确是很好的投资和学习经验的机会吧，近年来大家对投资越来越理解，政府和学者也积累了更多的经验，我估计下一次经济危机大概率是战争敌对或者自然灾害引发的。如果未来几十年内世界一直和平发展，这一代有经验的管理者和投资者也不会过早退场，十年后可能不会按（98-08-20）规律这样，再次发生经济危机了（2020年的危机可以说是自然灾害引发的吧），也许要等待20年甚至更多年经济危机才会爆发吧。</p>
<p>但潜在的危机一直存在，中美逐渐对立，日本按我的理解现在是负债累累，还没能从泡沫破裂（更别说战败了）的阴影里走出，美联储无限量QE说不定会和百年前取消金本位一样，有着更长久和强大的余威。此外，今年除了疫情也发生了其他大规模自然灾害（火灾，洪灾），这些都是非常不稳定的因素，都有可能在未来某个时间点偶然又必然地引发经济甚至更大层面的危机。</p>
<hr>
<p>我对2021年的期待里，也有学习日语这一项，现实生活中我接触的主要三个语言就是中英日三国语言，前两者虽然抠脚但是勉强能用，如果是用在阅读上，那我掌握的还算熟练，但是日语完全就一窍不通了，五十音图的平假名和片假名至今分不清楚。</p>
<p>其他两种语言已经有了一定基础，日常不断的接触肯定也能不断刷新自己的知识体系，而日语我因为没有基础，就完全是靠着翻译在日语世界无意识游荡了，想到以后还要接触很多日本的东西，有点吃亏了呢。</p>
<p>促使我去学日语的还有一个原因是，2020年的圣诞假期里，最让我开心的三件事情分别是：</p>
<ul>
<li>Eva 最后一部剧场版的正式预告和宇多田光献唱的主题曲《one last kiss》。</li>
<li>北影节悄咪咪放映了《鬼灭之刃 无限列车篇》，而我抢到票去看了，可好看了。</li>
<li>《月姬Remark》在月姬发售20周年之际，在跳票10年后确定要在2021年暑假发售了！
这三件事情属于不同的日本亚文化圈，如果我以后也想持续地获得一手资料甚至体验，不会每次都特别巧地碰上北影节这种特殊活动的，所以日语对我的娱乐生活也是很重要。</li>
</ul>
<p>嘛，以后要是一旦有和日语相关的娱乐，我就先缓一缓，把娱乐的时间拿来学日语好了，虽然我也不知道能坚持多久……就先立一个flag 好了。</p>
<hr>
<p>2020年竟然是非常努力工作的一年，这可能和我换组了有关系吧。5月份的时候公司裁员，我所在的某项目组就被砍了，我也被换到了另外一个项目组，一开始活很多，我还很消极，暑假那段时间过得特别不开心，每天都想着辞职和找工作。不过后面老板让我自己负责了好几个项目，虽然公司里所学技术栈和国内差别较大，但至少我在项目管理和发现商业机会上也有了管中窥豹的机会，还可以自己去探索感兴趣的方向。组里面虽然活多但是排期和计划都做的特别好，虽然自己把2020年这一个本该是快乐摸鱼的年份变成了拼命工作年，但相对地自己也获得了一些成长，也对项目排期和加班有了一些自己的理解吧。</p>
<p>我自己一开始面对其他人都不敢发出自己的声音，导致了很多默默无闻的加班，到现在是各种挑别人毛病，主导提出延期，也是一种进步吧，希望新的一年我对项目的掌控可以更多一些，在商业上的理解也更深一些。如果在能在取悦用户的前提上做出新的功能，那真的是太好不过了。在这过程中，我也要试着改变他人片面盲从数据驱动的想法，并尝试获得新的认知，希望会是很有意义的一年。</p>
<hr>
<p>2020年一直想要旅游却一直鸽，结果今年啥旅行都没有，如果时间允许，希望明年可以出国，或者跟着《大唐西域记》从走一遍西域呀（2020年和好多同事说了这个flag然并卵）。</p>
<h2 id="是焰的抚媚">是焰的抚媚</h2>
<p>2019年我和前女友提出了分手，2020年1月初她正式从我家搬走了。</p>
<p>有段时间我不愿意去想和她相关的事情，更不愿把她相关的事情说出来，我也不知道为什么。关于分手的原因更是被我说的模糊不清。</p>
<p>其实很简单，19年，或者说更早的时候，但之前还没有意识到，我喜欢上了别的女孩子，就把她推开了。</p>
<p>这种感情很复杂，我觉得我可以同时喜欢两个人，并自己不觉得矛盾，但我也不敢和任何人说。</p>
<p>现在回想起来，我根本不会处理自己的一些感情，我和她很幼稚，两人也得不到帮助，19年的时候她一定要辞掉工作搬到北京和我一起住，我却觉得这是她的自私。在那年9月份，我去了一趟美国，回来后再度面对北京的那个家，我真的不知道该怎么处理了。</p>
<p>分手后她去了英国留学，每周都要在b站上发一条vlog。我去和我喜欢的另一个人表白了，然后并没有然后，我也不期待有然后，只不过我这种直肠子觉得把话说全了会好受一些。</p>
<p>我也想试图像其他朋友一样谈几场随意的恋爱，但是内心深处我觉得我还是做不到和别人有亲密的关系。几天前（本篇幅撰写于2021年1月1日），我看到英国疫情变重的消息，终于鼓起勇气去问她要不要回国过年，却不知不觉话锋一转，说到了她每周发一条vlog 的事情（这简直和我找别人review 代码的时候还要趁机批评几句别人代码写的不对一摸一样）。为什么就不能放下一切努力地学习呢？你出国到底是为了什么？对得起父母的期待吗？话是这么说，我却至今一篇vlog 都没看过。</p>
<p>我不知道啊，不知道要怎么去面对她在英国的生活，我更害怕自己看完后会更生气，会更埋怨她只懂得享受不懂得努力，会说这种vlog 简直就是为了炫耀和取悦他人而做的一样。当她说想做医学方向的数据挖掘毕设时，我转手就把最近在看的DeepMind AlphaFold 文章扔了过去，让她好好学习。我觉得她哭了，她说我不知道鼓励她，就知道强迫她。</p>
<p>我的确不知道啊，在失去了可以游走的亲密关系后，我该怎么样去表达自己的关心，又不把这个关心变成威胁。更何况，在之前，我就做不好。我总觉得，我可以轻易去触动她的情感，而自己却觉得她的话是矫情和虚情假意。</p>
<p>有天凌晨，玩得最好的小学同学突然打电话给我，“我就想问问你们两为什么分了呢？分手半年前还见你们处得那么好。诶，你知道吗，我前面摸了下头发，发现我两边秃了……”，我被他的电话弄得哭笑不得，却不知道怎么回应他的问题。</p>
<p>我要怎么回忆，总结，这快8年的关系呢？在回到家乡后，我要怎么面对两人共同的高中同学呢？在街上偶遇她还是她的家人又要做出什么样的表情呢？</p>
<p>在未来，如果有新的关系，我要怎么去处理呢？如果没有，我又要怎样呢？我还应该继续鼓励她向我觉得正确的方向努力吗？又还是从此消失不见呢？这些问题，说实话我都不知道答案。我还需要更多的时间，去找到面对的方法。</p>
<p>也许，简单的话语未必就是智慧，复杂的论述也会不切实际。恰当的结束，不代表永恒的终结。这世间非黑即白的事情变得好多，从一个极端到另一个极端的距离近了，但人与人之间的距离却慢慢远离。</p>
<p>但还是得往前走，在回到永恒的寂静前，找到更大的叙事和更根本的方法，并以此收获更多的</p>
<p>困惑？</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2020-summary/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2020-summary/zh/image_1.png" alt="" class="article-image" width="478" height="1648" />
</picture>
感谢单向街对本文的帮助 : )</p>
]]></content:encoded>
  </item>
  <item>
    <title>2019 年小结</title>
    <link>https://www.yujiachen.com/2019-year-in-review/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2019-year-in-review/</guid>
    <pubDate>Tue, 31 Dec 2019 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<p>转眼19年就这样结束了。因为近来在休假，闲来无事就决定写一写今年的小结。</p>
<h1 id="今年的物质生活">今年的物质生活</h1>
<p>今年年初的时候因为发现自己想学的6.824需要Linux 环境，在对WSL 的深深绝望下，向家里要钱买了一台Mac（从此人生改变了，我穷了。</p>
<p>今年的前半年就是我和贫穷的奋斗史，在年初买了一台Mac 首亏万把大洋之后，因为在学校里闲的无聊，就和同学约起了去日本的旅行，向家里要了一点钱后还是不够，最后的选择只有砸锅卖铁。去日本前，我卖掉了寝室里的显示器，卖掉了寝室里的椅子，卖掉了寝室里的书，这样才多攒了一千多块钱，让我在日本少吃了几顿食其家。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_1.jpg" alt="" class="article-image" width="886" height="886" />
</picture>

我在上野公园许下的新年愿望</p>
<p>旅游结束之后，自己也希望能有一些赚钱的途径，所以希望可以找一个实习。然后就在同学推荐下参加了某某线上教学平台的笔试，笔试的内容是在一个星期内做一个TODO list 的前后端，说起来惭愧，当时作为一个已经要毕业的大四学生，我是在这次笔试中第一次知道REST api、React 这些技术框架。这个TODO list 的demo 很简陋地做出来了，然后因为各种原因我就被挂了。不过没有这次笔试，我可能毕业了也不会接触这些技术栈。</p>
<p>毕业后工作前，家里又给了我一笔钱，当时的我有一种进入社会后消费升级的错觉，买的生活用品都挺好的，然后马上又陷入了贫穷……</p>
<p>财富自由，任重道远啊。</p>
<h1 id="去而复返">去而复返</h1>
<p>大一刚开始的时候，我听辅导员说我们学校的ACM 特别厉害，于是就参加了。当时我没有什么特别的想法，对某种人来说，他总需要有一种东西来证明自己，总需要有一个东西作为方向，才不会让他感觉太迷茫，我想当时我就是这种人。</p>
<p>大二下的时候我转了专业，接触了当时很火的机器学习，那时的我有一种天真的想法，觉得算法比开发要高出一等，我选择去学习算法，就会让我比软件工程的同学们显得高高在上。</p>
<p>大三我意外拿到了区域赛金牌，结果就是我更自傲了。草草地退了队，然后参加实验室、数学建模。那段时间我就是单纯地想让自己显得比周围的同学厉害，而没有去想过做一件事情的目的和意义。</p>
<p>大四，我接了现在公司的offer，职位是全栈工程师，人生有时候就是这么兜兜转转，我入学时是软件工程专业，后来转到了计算机科学与技术，学的都是算法相关的知识，最后在秋招的时候我又改变主意，选择了软件开发的工作。</p>
<p>当然大学也不可能是苦闷的，在大学期间，我玩通了《Fate / Stay Night》，《魔法使之夜》这些绚丽夺目的游戏。在惊叹EVA 对人物的深层剖析后认识了GAINAX，随后通过GAINAX 的其他作品和主创们，对儿时就接触的特摄有了另一方面的认识。我还认识了很多厉害的小伙伴，一起在校园内外分享生活的喜乐。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_2.png" alt="" class="article-image" width="1080" height="588" />
</picture>

魔法使之夜的结尾，青子发动第五法向未来的自己借了10年修行，现在看来这个结尾有着独特的讽刺意味</p>
<p>离校那天，我是最后一个离开寝室的，走的时候给寝室拍了一个tour，留着以后同学聚会时看。大学期间，在寝室里发生过很多愉快和不愉快的，虽说以后也是如此，但是时间已经流去。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_3.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

我的毕业照之一</p>
<p>今年看了一些书，管理、经济、宗教，虽然看的主题不同，但又觉得书里说的都是一件事，这件事就是不断重复的历史，和在历史中不变的人性。今年的我常想的一件事情是历史，08年和今年类似，经济的不景气让人不断抱怨，从09年开始，经济重新恢复，到了18年又开始放缓。我第一次感受到了历史的重复，以及人在历史中的渺小，历史的车轮转呀转，战争与和平、繁荣与衰弱、摧毁和重建都在不断地兜圈子。</p>
<p>《千面英雄》是今年看的一本书之一，其总结各个神话的共性，力图用一个统一的模板来阐述所有的神话故事。我也深受其影响，网上有的观点认为人类的智力在近一万年间没有显著变化，我曾觉得这一万年间，人性也没有变过。直到最近，我看到了今年看过的《千面英雄》的书评：“神话间最重要的是差异而非其中的共性”，这才觉得历史和人也并不是一成不变的。我想我也可以套用这句话：“人性中最重要的是其美好向上的一面，而不是万年不变的劣根性”。历史也并不是在重复，而是在螺旋地上升，因为人类的变化而在不断上升。</p>
<h1 id="屠龙少年是否会变成恶龙">屠龙少年是否会变成恶龙？</h1>
<p>近期在看DDIA 的时候看到一句话：“NoSQL 会发现自己重新发明了SQL”，我在工作中也常和同事说：“民宿会发现自己重新发明了酒店”。在商业化的道路上保持初心，作出对的选择远比喊口号要来的难，几乎所有的创业公司最终都被资本控制，从&quot;Don’t be evil” 变成了 “Do the right thing”，这也是我选择现在这家公司的原因之一，希望可以近距离看看理想和资本的博弈，站着也把钱挣了，希望它可以做到。</p>
<p>9月份的时候我去三藩工作了一个月，工作繁忙，没有太多时间去吃喝玩乐。不过很开心的是我在三藩工作的一个月间结识了我所住民宿的房东，他是一个很好的中国人，在三藩那边做会计，临走的时候他还送了我和其他同事每人一大盒费列罗巧克力。其实在工作的时候，和线下有接触往往是因为bug，或者是什么不好的事件，感受到的都是民宿不好的一面，我想我们的工作使命之一就是让人们在使用民宿的时候，可以容易表现出好的那一面，而很难表现出坏的那一面，不让劣币驱除良币。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_4.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

9月份我就住在三藩的变形虫唱片附近，听说这条街是美国嘻哈乐的发源地，我自己住的房源曾今就是一个乐队的住所</p>
<p>开始工作之后，我也开始想什么样的生活是适合自己的，自己来北京之前就决定了不会一直在北京住下去，我一直喜欢着自己的家乡，如果以后我有了孩子，我希望他/她可以在我的家乡长大。但是现在看来，这种愿望可能会很难实现。</p>
<p>有人也会把孩子生在美国，在美国的时候，我不知道怎么和华裔交流才不会冒犯他们，因为我不知道他们是中国人还是美国人（也可能是我想太多了）。人还是需要文化才能活下来，社会里的人多少都是被社会同化的，就我自己而言，我非常认同我的中国人身份，我热爱中国的历史底蕴，可美国更加富裕和包容也是事实。有朋友和我分析，在北京落户的难度和收益，都没有在移民美国来的容易，我想我在直觉上会同意他的观点，但是因为其他国家更富裕更好就移民是正确的事情吗？我现在不这样认为，如果大家对社会多一点责任心，而不是选择逃避，也许我们的国家也会变得更好。当然，也许以后的自己看到这篇文章，会嘲笑当年的自己竟如此不成熟。</p>
<h1 id="今年的精神生活">今年的精神生活</h1>
<h2 id="纸片人二三事">纸片人二三事</h2>
<p>2019年1月9日，我打开bilibili，开心地看到HF第一章要在中国上映了，然后就约了两个小伙伴一起去看。结果两个小伙伴都睡着了，因为我是第二遍看，才发现这个作品是如此的平庸，感觉钱就这样被骗走了 嘤嘤嘤。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_5.png" alt="" class="article-image" width="1080" height="1920" />
</picture>

看到凛老婆就突然有了想去送钱的欲望</p>
<p>然后4月份到日本旅游的时候，看到HF第二章还在歌舞伎町的TOHO Cinema上映，又屁颠屁颠地跑去送钱，看完还是和看第一章一样的感想，为什么人就这么心甘情愿地喜欢把钱送给别人呢？（笑

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_6.jpg" alt="" class="article-image" width="768" height="1024" />
</picture>

看HF2送的明信片</p>
<h2 id="我的网红梦">我的网红梦</h2>
<p>今年我有一个成为vloger 的梦想，所以我在各种旅行中都拍了很多视频，但是最后自己还是没有坚持这个梦想，虽然拍了很多视频，但是最后还是不知道应该怎么去剪这些视频，最后不了了之。</p>
<p>我还在豆瓣上写了一个<a href="https://www.douban.com/note/714273562/">日本游记</a>，有24人给我点赞让我感到很开心～</p>
<p>今年国庆期间去了LA 的格里菲斯天文台，LA 的城市，LA 的山丘，都一览眼底，看着太阳落山，天从蓝色变成橙色，最后变成紫色，实在是太过梦幻。当时我就下定决心想买一台单反，但是因为一直懒得去研究相机的种种参数，迟迟没有下手……

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_7.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_7.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

看着LA，心里想到的却是EVA 中美里拍着真嗣的肩膀说，这就是你要守护的城市啊！

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_8.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_8.jpg" alt="" class="article-image" width="1080" height="430" />
</picture>

黄昏的LA</p>
<h2 id="怎么土怎么来">怎么土怎么来</h2>
<p>一年的土味珍藏：</p>
<p>开封大宋武侠城，全天的土味打斗，特别是三打祝家庄，贼嗨～

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_9.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_9.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

大宋武侠城的节目表

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_10.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_10.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

猛龙过江</p>
<p>东北化的海南，在三亚的沙滩上全是东北主播喊麦，现场看着几十个东北主播开播，这才感受到东北轻工业的发达。

<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_11.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2019-year-in-review/zh/image_11.jpg" alt="" class="article-image" width="1024" height="768" />
</picture>

沙滩上的主播</p>
<h1 id="总结">总结</h1>
<p>曾经有段时间，自己一直在日记，以此来督促自己，可能是天性懒惰，坚持了一段时间后觉得没啥作用，逐作罢。某种意义上，小结这件事情是希望一段时光变得有意义，这想法本身就有一种媚俗的意味，人是有着遗忘的天赋的（就连LSTM 也是因为有了遗忘的特性才能处理不定常的序列），所以有些事情也不必一定要有一个小结。Anyway，说了这么多小结的坏话还是写完了这个小结，新的一年，祝自己武运昌盛。</p>
]]></content:encoded>
  </item>
  <item>
    <title>2018 年小结</title>
    <link>https://www.yujiachen.com/2018-year-in-review/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/2018-year-in-review/</guid>
    <pubDate>Sat, 29 Dec 2018 00:00:00 GMT</pubDate>
    <category>Yearbook</category>
    <content:encoded><![CDATA[<p>今年对自己来说是相对自由的一年，但也是很慵懒的一年，总有一种啥事都没做，就把一年给混过去的感觉，今天早上闲的很，心想不如写一个其实很久以前就想写的小结把。</p>
<p>而且自己写东西的能力变得越来越差，希望自己可以坚持写完这一篇把。</p>
<p>春</p>
<p>我觉得今年春季自己的关键词是困惑，分享一下打数学建模美赛，找工作，打算读研的心路历程，看见周围一群人打美赛，我就去打了，看见周围一群人找工作，我就也去找了，看见周围一群人打算保研，我就也去刷分准备保研。真的是一段沙雕时光。</p>
<p>实习结束的时候自己决定去找工作，面试的过程中，也没人关心我数模美赛打的怎么样，没人问我成绩，等于说我上半年把大量的时间花在了很多对我没有直接影响的事情上。不过我不觉得这些事情是在浪费时间，毕竟人总要有一个纠结的过程，我很庆幸自己做的这些事情最后帮助我想清楚了自己目前想做的是什么，很多事情如果不去做过，光靠想去做选择的确是挺难的。而且通过数模，我认识了我的数模队友（以及数模队友的几个朋友，而且一些人自己之前就认识，圈子真的好小啊），还和他们一起发了一篇论文（其实这论文并没有什么用哈哈哈）。虽然为了准备保研去刷分并没有提高我的综合成绩排名，至少让我保持了一个早起的习惯，不然肯定会把一些时间放在玩上面。</p>
<p>总的来说，我并没有因为这段匆匆溜走的时光感到沮丧，对自己乐观的心态感到满意，而且虽然上半年自己做的许多事情没有给自己带来直接的回报，但留下的经验也在无形地重塑自己。</p>
<p>夏</p>
<p>夏天是在北京Face++实习的美好时光，我的工位就在窗边，晴天是浅蓝的，下雨的时候天空是深深深蓝，外加上Face++的logo也是蓝色的。总之实习的时光现在回忆起来还是很不错的，虽然当时还是有点痛苦23333。我的leader zhanghuayi兼任我的mentor，他是一个工作很认真的人，但是有时候工作也太认真了，会经常不回消息，对我完全放任，给了我各个数据集的写权限（权限大到我一个rm -rf /，整个组的数据会全部消失，删库跑路很真实了哈哈），于是我的实习就有了一点放养的感觉。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_1.jpg" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_2.jpg" alt="" class="article-image" width="1008" height="1008" />
</picture>
</p>
<p>旷视的实习面试只有一轮，这让自己有点沮丧，因为我春招的时候，除了旷视和华为其他所有公司都把我挂了（除了头条和微软我没有去面），自己当时对自己的评价就是很菜，只是运气好才过的面试，因此一直自信不起来，常常担心自己不能转正，秋招的时候也会找不到其他厂的工作。虽然说实话没有一场面试自己是准备过的，coding题完全随缘做，计网OS什么的基础题完全不会，本身实力不强，还不努力，自然还是比不过其他候选人的把。除此之外自己还十分内向，不懂得怎么和别人交往，周围很多实习生基本全是985的学生，清华的特别多，经常会闲聊说一些在清华上课时各种搞笑的事情，自己也因此不知道怎么和他们找到话题。不过还好自己还是认识了一些朋友，正式员工jianghao每天都会找我吃饭，说各种事情。后来自己边上坐了一位刚入职的Final选手tangdongjian，他也是一个很有趣的人，他是保送的复旦软件工程，但是转专业去了社会学，他说反正以后出来都是搬砖，大学期间不如学自己真正感兴趣的东西。</p>
<p>其实我一直对电影和小说这一类文学的东西感兴趣，可惜的是自己没有时间和毅力来学相关的东西。所以有时候人的选择真的是很重要的，现在自己越来越感觉自己离理想的自己越来越远，只能选择一部分想实现的目标来实现，但不尝试又怎么知道自己到底行不行，其实系统的入门一个东西不会花很多时间，真正难的是深入，希望自己在明年毕业前可以抽出一些时间来学习和工作无关的东西，扩宽自己的视野。</p>
<p>虽然现在对Face++的回忆是很美好的，但在实习的时候常常会因为遇到很多困难而产生挫败感，不过还是很开心当时周围也有同学在一直鼓励我，还记得Airbnb cultural fit的时候，面试官问我有没有帮助过别人，别人是怎么回报你的，当时自己回答的有点支支吾吾，现在想起来，人和人之间一句鼓励的话，就已经是对别人的帮助，和对自己的回报吧。我觉得关于自己人格上，需要自己时刻注意的两件事情分别是：人格的独立和与他人的联系。人格的独立是希望自己不会被他人影响，能独立做出自己的判断，在挫折和失败的时候能够承受必须经历的痛苦和孤独；与他人的联系是希望自己不要做一个孤僻的人，尽可能多的与他人建立联系，在与人交流的时候大方而有度，和他人分享温暖和快乐。</p>
<p>夏天最后的阶段就是准备秋招了，当时通过linhaihong学长认识了微信的hr实习生yuanliqi，自己和其他小伙伴就被他内推进了WXG。夏末的秋招对自己而言真的是充满了艰辛，自己一开始最想进的厂就是WXG，因为害怕像春招一样挂的那么惨烈，自己当时疯狂投了超多简历，主要就是为了让自己能不断面试不断总结经验，然后强迫自己每一次面完就写面经，复盘面试，把不懂的知识点补起来。因为疯狂面试也认识了一些不同厂的小伙伴，比如FZU的大佬chenyupeng，和我分享了一些面经，还有Hulu的hr Ashley，我感觉她是我见过最好最好的hr了，每次面完会和你说面试的反馈，和你协调下次的面试时间，还会给你建议，见面的时候脸上也挂着大大的微笑，给人很nice的感觉。</p>
<p>对自己而言印象最深的一次面试是阿里高德的二面，当时阿里高德一面的面试官知道我在北京，就邀请我去高德现场面试，结果现场面的时候，自己连线程和进程的区别都不知道（就算如此，面试官也依然很耐心地花了一个小时问我各种常问的面试题，虽然自己没答上来，但是之后自己对这些问题进行了总结，学会了很多知识点），自己面完就立刻被挂了，那天晚上自己特别难过，自己明白以目前的状态是不会拿到一个自己想要的offer的。因为自己当时自己准备的是算法岗面试，所以根本没有想去准备复习基础的计算机知识。当自己重新复习（预习）了一遍基础的计算机知识后，面试真的有了很大的改观。比如说网易互娱的面试，问的都是基础的计算机知识，三天后自己就收到了offer，还是自己完全没有经验的游戏研发岗，当时真的是不敢相信。</p>
<p>因为实习期间一直做的是深度学习炼丹，可是在工作中又发现自己相关的各种基础实在是太浅了，加上当时保研的可能性已经非常小了，暂时没有了深造的机会，深深感觉到也许算法岗并不适合我，而且现在的算法岗招聘已经不是前几年那么容易的了，今年的算法岗招聘已是千军万马过独木桥，竞争过于惨烈。另外从兴趣点上看，我觉得工程上的知识更吸引我，炼丹相关的知识需要太多数学基础，而且有了数学基础也要面对神经网络这个类似玄学的系统（但并不是玄学，只是目前自己功力不够），而把太多精力放在模型上的时候，又会和代码严重脱离，写代码纯粹变成了调包，失去了很多乐趣。所以自己在面了几次算法岗之后，决定去面工程岗，当然当时并不指望自己可以拿到一个工程岗的offer，心里的想法是把目标放在了春招上面。因此自己每到了面试结束，面试官问我有什么问题的时候，我都会说我觉得我还不够好，打算参加春招，能否给我一些指导和意见。感觉很多面试官都挺喜欢这个问题的，愿意和我说一些意见。结果后来运气足够好，yuanliqi帮我把WXG的面试转到了工程岗，然后自己在提前批的最后一天连着过了四面和hr面，后来收到了WXG的offer，那一刻真的是开心的不得了。</p>
<p>当然还有一些印象深刻的面试，Face++的转正面，最后一面是Jian Sun老师面的我，他指出了我的很多不足，并给了一些意见（PS：转正一面面我的是Deformable Conv的作者之一Yichen Wei老师，加上ResNet和ShuffleNet的作者之一Jian Sun，Face++的转正面试真的是我离大神们最近的一刻了）。还有头条的前两面，问的问题全都是我会的图像风格化和GAN，自己基本全答出来了，当时的感受是自己之前的炼丹时间没有白费，至少我收获了很多知识。</p>
<p>最后离开北京还是有很多的不舍，很多北京想去玩的地方没有去玩到，主要是自己太懒了，哭唧唧。</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_3.jpg" alt="" class="article-image" width="1008" height="1008" />
</picture>
</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_4.jpg" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/2018-year-in-review/zh/image_5.jpg" alt="" class="article-image" width="1080" height="810" />
</picture>
</p>
<p>秋 冬</p>
<p>转眼差不多把今年的小结写了一半啦，感觉自己棒棒哒</p>
<p>秋天主要是关于选择了吧，自己最后还是没有去选择保研（事后算了下自己的保研排名，在参加保研的人里面排第5，我们学院保研的名额是4个），也没有考研的毅力，其实我也不知道读研是为了什么，队友sujintao说他读研是因为自己爸妈希望他读研所以他就读了，轻轻松松的。我感觉我更幸运一点，因为我从小都不听爸妈的，所以我不管做什么选择，他们只能支持我，帮助我，哈哈哈。毕竟面对选择，希望自己可以做自己真正想要的决定，尽管有时候我们连自己真正想要的是什么都不知道。总之，自己的梦想是希望这几年能赚好多的钱，然后去us读一个master，学的可以是其他东西，只要自己喜欢就好，希望这个梦想可以实现八。</p>
<p>还有一个选择就是接哪一家的offer，自己是非常非常喜欢WXG的，但是因为收到了Airbnb的offer，于是选择了Airbnb，选择Airbnb的理由首先是因为价值观，Belong Anywhere，我想知道价值观对公司的运作和管理能有多深刻的影响，Airbnb无疑能提供一个思考公司发展模式的一个环境；然后是因为Airbnb是外企，我觉得在外企，交流是一个很大的挑战，外加我本来就是一个有点内向的人，英语也不好，Airbnb能给我很多的学习机会。目前来说，我希望自己能成为一个非常有趣的人，而不是因为加班多了而秃头的程序员呜呜呜。</p>
<p>秋天的大多数精力都放在了毕业设计上，自己毕业设计选的是和深度学习里面图像翻译相关的。本来打算很快地做完，结果实验一直跑不出理想的结果，于是到了现在毕业设计要结题了，自己只能按目前的研究进度写成毕业论文交上去。自己这段时间也一直也在反思，如何提高自己的效率，怎么及时总结，改进自己的工作模式。因为本来期望这个学期可以学一些关于Go语言和分布式的知识，结果一直没有开始学，好难过。</p>
<p>之所以把秋冬放在一起写，主要是有点不知道应该写什么，这个学期自己一直要求自己养成各种习惯，因为除了毕设，其他什么事都不需要考虑，未来恼人的事情没有到来，我幸运地静静地待在校园里，经常发呆。偶尔会去帮老刘做助教，看到班里的小朋友们，他们的爸爸妈妈为了他们的未来不断地把他们往前赶，希望自己以后不会成为这么焦虑的父母。</p>
<p>日子就这样一天天地过，转眼到了今年的最后几天……</p>
<hr>
<p>说实话，自己对未来没有什么特别的展望，现在最想做的就是赶快弄好毕业设计的答辩，然后就可以开始学习新知识了。除此之外我也希望找到工作、学习、业余爱好的平衡，少发呆，少偷懒，养成好习惯，学好多的知识，读很多的书，还有看好多的电影~</p>
<p>私货</p>
<p>今年看了还算多的电影哦，但是书没有一本看完的，自己越来越浮躁了。</p>
<p>今年挺喜欢的，像拿出来mark下的几个东西：</p>
<ol>
<li>
<p>很抱歉我没能拯救世界——&quot;奇迹少年&quot;庵野秀明【大师之路】</p>
</li>
<li>
<p>SSSS.GRIDMAN</p>
</li>
<li>
<p>燃烧和其他一些影视作品</p>
</li>
<li>
<p>耶路撒冷</p>
</li>
</ol>
<p>很抱歉我没能拯救世界——&quot;奇迹少年&quot;庵野秀明【大师之路】</p>
<p>这个是B站上的一个视频，但是看完之后，你一定会赞叹这个视频的精力制作和独特的叙事。名作之壁贴吧是一个以讨论日本动漫光碟销量为主题的百度贴吧，而这个视频是名作之壁吧里的大神们制作的《大师之路》系列的一部，《大师之路》讲述的是日本动漫大师的故事和作品，而我特别喜欢的这个视频就是《大师之路》关于庵野秀明的一期节目。</p>
<p>这个片子讲述了庵野秀明的各个作品以及他通过他的作品展现出来的价值观：用破坏来连接观众和动画中的世界、经费充足时精益求精的制作态度、缺乏经费时出奇制胜的表现手法。还有他和宫崎骏的关系、他本人的抑郁症，和他早年疯狂的工作习惯，他本人发明的“庵野爆炸”，以及那部被誉为神作的《新世纪福音战士》。</p>
<p>我觉得不管对日漫是否有兴趣，都可以看一看这个片子，首先是前面说到的，本片制作精良，值得一看，其次是因为庵野秀明的确是一个很有趣的人，他从小喜欢特摄（指日本让演员穿着皮套进行表演的拍摄手法和相关的作品，比较知名的作品有 奥特曼 哥斯拉 假面骑士等），长大后从事动画行业，有一天和一群人突然想做动画电影，于是创立了公司，结果公司亏钱，只能一直做动画还钱，直到最后做出了现象级的《新世纪福音战士》……</p>
<p>b站视频地址：<a href="https://www.bilibili.com/video/av28304435">https://www.bilibili.com/video/av28304435</a></p>
<p>SSSS.GRIDMAN</p>
<p>这是一部把奥特曼做成动画的动画，打斗精彩，人设可爱，有趣的是最后的一个真人镜头圆了动画里的很多设定。</p>
<p>我对这个动画的喜欢还有一定的私货在里面，奥特曼是大家小时候都看过，但是现在却因为其幼稚而嗤之以鼻的系列作品，但是SSSS.GRIDMAN的主创不仅依然热爱着这个系列，还想用动画化的方式对以前的电光超人古立特进行符合当下审美的再创作。奥特曼系列肯定有着自身的长处，创作人员没有因为这是一个幼稚的主题就忽略了其闪光点，而是把闪光点进行保留，不足之处进行替换。这使得这个作品有着很棒的创意，还有那么一点的情怀。</p>
<p>燃烧和其他一些影视作品</p>
<p>本年度看过的最喜欢的几部电影里面肯定有燃烧了。虽然自己没有给这部电影5星，但是的确有着很不错的观感，自己常想起来的情节就是女主家阳台朝北，只有每日午后的几分钟阳光会因为反射而射入房间。还有男主角在田野里的一次次奔跑。</p>
<p>自己从电影里引出的思考：男二家境富裕，对女孩子很有吸引力，因此对感情玩世不恭，男主却是农村里的一个土包子，因此一次和女主发生了关系后，就一直爱着女主，却又因为在男二面前的自卑不敢追求女主。男主在电影里表现出的一些价值观，是否是他的阶级带来的呢？如果男主的生活条件发生了改变，朴实善良的他是否也会摇身一变成玩世不恭的男二呢？那么，到底什么才是正确的价值观呢？谁也说不清，只剩阶级在赤裸裸地对立着。</p>
<p>还有其他一些影视作品，比如说 鬼子来了 影 超胆侠第三季  春宵苦短，少女前进吧 等等，都是很不错的片子</p>
<p>耶路撒冷</p>
<p>耶路撒冷，三教圣城，很难想象这一个地方几千年来直到现在还在被不同的力量争夺着。我们的生活里没有宗教，人们对耶路撒冷的疯狂是我难以想象的，而且我也对这座城中沉甸甸的历史感到兴趣。我对其了解的不多，只知道耶稣就是在这里被钉上了十字架。希望自己可以多了解相关的历史，然后能去这里短住一段时间。</p>
]]></content:encoded>
  </item>
  <item>
    <title>ring-allreduce 简介</title>
    <link>https://www.yujiachen.com/ring-allreduce/zh/</link>
    <guid isPermaLink="true">https://www.yujiachen.com/ring-allreduce/zh/</guid>
    <pubDate>Thu, 24 May 2018 00:00:00 GMT</pubDate>
    <category>Tech</category>
    <content:encoded><![CDATA[<p>今天无聊看到了ring-allreduce的gpu通信算法，本来希望在<a href="http://research.baidu.com/bringing-hpc-techniques-deep-learning/">相关网页</a>上看看相关介绍的，但是在baidu research上却搜不到相关的东西，后来看了看<a href="https://github.com/baidu-research/baidu-allreduce">baidu-allreduce</a>代码的注释，才明白。这是一个说明起来挺简单的算法，自己打算随便说说。</p>
<p>觉得英文好的可以直接看看GitHub上注释，写的很清晰：<a href="https://github.com/baidu-research/baidu-allreduce/blob/master/collectives.cu#L156">https://github.com/baidu-research/baidu-allreduce/blob/master/collectives.cu#L156</a></p>
<ul>
<li><em>如无特殊说明，本博客的图片都来自于<a href="https://www.zhihu.com/question/57799212/answer/292494636?utm_source=ZHShareTargetIDMore&amp;utm_medium=social&amp;utm_oi=37729630945280">知乎上的一个回答</a>，主要原因是baidu research上找不到这篇文章，所以相关的图例只在这个知乎回答里找到了</em>*</li>
</ul>
<p>一般的多卡gpu训练有一个很大的缺陷，就是因为每次都需要一个gpu从其他gpu上收集训练的梯度，然后将新的模型分发到其他gpu上。如下图：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_1.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_1.png" alt="" class="article-image" width="452" height="310" />
</picture>
</p>
<p>这样的模型最大的缺陷是gpu 0的通信时间是随着gpu卡数的增长而线性增长的。所以就有了ring-allreduce，如下图：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_2.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_2.png" alt="" class="article-image" width="419" height="330" />
</picture>

该算法的基本思想是取消Reducer，让数据在gpu形成的环内流动，整个ring-allreduce的过程分为两大步，第一步是scatter-reduce，第二步是allgather。</p>
<p>先说第一步：首先我们有n块gpu，那么我们把每个gpu上的数据（均等的）划分成n块，并给每个gpu指定它的左右邻居（图中0号gpu的左邻居是4号，右邻居是1号，1号gpu的左邻居是0号，右邻居是2号……），然后开始执行n-1次操作，在第i次操作时，gpu j会将自己的第(j - i)%n块数据发送给gpu j+1，并接受gpu j-1的(j - i - 1)%n块数据。并将接受来的数据进行reduce操作，示意图如下：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_3.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_3.png" alt="" class="article-image" width="480" height="335" />
</picture>

当n-1次操作完成后，ring-allreduce的第一大步scatter-reduce就已经完成了，此时，第i块gpu的第(i + 1) % n块数据已经收集到了所有n块gpu的第(i + 1) % n块数据，那么，再进行一次allgather就可以完成算法了。</p>
<p>第二步allgather做的事情很简单，就是通过n-1次传递，把第i块gpu的第(i + 1) % n块数据传递给其他gpu，同样也是在i次传递时，gpu j把自己的第(j - i - 1)%n块数据发送给右邻居，接受左邻居的第(j - i - 2) % n数据，但是接受来的数据不需要像第一步那样做reduce，而是直接用接受来的数据代替自己的数据就好了。</p>
<p>最后每个gpu的数据就变成了这样：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_4.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_4.png" alt="" class="article-image" width="572" height="321" />
</picture>

如果觉得不懂的话，我们举一个3gpu的例子：</p>
<p>首先是第一步，scatter-reduce：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_5.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_5.png" alt="" class="article-image" width="772" height="913" />
</picture>
</p>
<p>然后是allgather的例子：</p>
<p>
<picture>
  <source srcset="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_6.webp" type="image/webp" />
  <img src="https://www.yujiachen.com/assets/posts/ring-allreduce/zh/image_6.png" alt="" class="article-image" width="1080" height="1321" />
</picture>
</p>
<p>reference:</p>
<p><a href="https://github.com/baidu-research/baidu-allreduce">https://github.com/baidu-research/baidu-allreduce</a></p>
<p><a href="https://www.zhihu.com/question/57799212/answer/292494636?utm_source=ZHShareTargetIDMore&amp;utm_medium=social&amp;utm_oi=37729630945280">https://www.zhihu.com/question/57799212/answer/292494636?utm_source=ZHShareTargetIDMore&amp;utm_medium=social&amp;utm_oi=37729630945280</a></p>
]]></content:encoded>
  </item>
  </channel>
</rss>
